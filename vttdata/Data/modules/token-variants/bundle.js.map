{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack:///./token-variants/applications/artSelect.js","webpack:///./token-variants/applications/missingImageConfig.js","webpack:///./token-variants/applications/compendiumMap.js","webpack:///./token-variants/applications/configureSettings.js","webpack:///./token-variants/applications/dialogs.js","webpack:///./token-variants/applications/configJsonEdit.js","webpack:///./token-variants/applications/configScriptEdit.js","webpack:///./token-variants/applications/effectMappingForm.js","webpack:///./token-variants/applications/overlayConfig.js","webpack:///./token-variants/applications/templates.js","webpack:///./token-variants/applications/tokenCustomConfig.js","webpack:///./token-variants/applications/userList.js","webpack:///./token-variants/applications/flagsConfig.js","webpack:///./token-variants/applications/randomizerConfig.js","webpack:///./token-variants/applications/tokenHUD.js","webpack:///./token-variants/scripts/hooks/effectMappingHooks.js","webpack:///./token-variants/scripts/hooks/effectIconHooks.js","webpack:///./token-variants/scripts/hooks/artSelectButtonHooks.js","webpack:///./token-variants/scripts/hooks/hudHooks.js","webpack:///./token-variants/scripts/hooks/userMappingHooks.js","webpack:///./token-variants/scripts/hooks/wildcardHooks.js","webpack:///./token-variants/scripts/hooks/popUpRandomizeHooks.js","webpack:///./token-variants/scripts/hooks/hooks.js","webpack:///./token-variants/scripts/hooks/overlayHooks.js","webpack:///./token-variants/scripts/mappingTemplates.js","webpack:///./token-variants/scripts/models.js","webpack:///./token-variants/scripts/reticle.js","webpack:///./token-variants/scripts/fuse/fuse.js","webpack:///./token-variants/scripts/search.js","webpack:///./token-variants/applications/forgeSearchPaths.js","webpack:///./token-variants/applications/tokenHUDClientSettings.js","webpack:///./token-variants/applications/importExport.js","webpack:///./token-variants/scripts/settings.js","webpack:///./token-variants/scripts/sprite/HTMLOverlay.js","webpack:///./token-variants/scripts/sprite/TVAOverlay.js","webpack:///./token-variants/scripts/token/overlay.js","webpack:///./token-variants/scripts/utils.js","webpack:///./token-variants/scripts/wrappers/userMappingWrappers.js","webpack:///./token-variants/scripts/wrappers/effectIconWrappers.js","webpack:///./token-variants/scripts/wrappers/hideElementWrappers.js","webpack:///./token-variants/scripts/wrappers/hudWrappers.js","webpack:///./token-variants/scripts/wrappers/wrappers.js","webpack:///./token-variants/token-variants.mjs","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/startup"],"sourcesContent":["import TokenCustomConfig from './tokenCustomConfig.js';\r\nimport { isVideo, isImage, keyPressed, SEARCH_TYPE, BASE_IMAGE_CATEGORIES, getFileName } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport { TVA_CONFIG, getSearchOptions } from '../scripts/settings.js';\r\nimport { cacheImages } from '../scripts/search.js';\r\n\r\nexport function addToArtSelectQueue(search, options) {\r\n  ArtSelect.queue.push({\r\n    search: search,\r\n    options: options,\r\n  });\r\n  $('button#token-variant-art-clear-queue').html(`Clear Queue (${ArtSelect.queue.length})`).show();\r\n}\r\n\r\nexport function addToQueue(search, options) {\r\n  ArtSelect.queue.push({\r\n    search: search,\r\n    options: options,\r\n  });\r\n}\r\n\r\nexport function renderFromQueue(force = false) {\r\n  if (!force) {\r\n    const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n    if (artSelects.length !== 0) {\r\n      if (ArtSelect.queue.length !== 0)\r\n        $('button#token-variant-art-clear-queue').html(`Clear Queue (${ArtSelect.queue.length})`).show();\r\n      return;\r\n    }\r\n  }\r\n\r\n  let callData = ArtSelect.queue.shift();\r\n  if (callData?.options.execute) {\r\n    callData.options.execute();\r\n    callData = ArtSelect.queue.shift();\r\n  }\r\n  if (callData) {\r\n    showArtSelect(callData.search, callData.options);\r\n  }\r\n}\r\n\r\nfunction delay(fn, ms) {\r\n  let timer = 0;\r\n  return function (...args) {\r\n    clearTimeout(timer);\r\n    timer = setTimeout(fn.bind(this, ...args), ms || 0);\r\n  };\r\n}\r\n\r\nexport class ArtSelect extends FormApplication {\r\n  static queue = [];\r\n\r\n  static instance = null;\r\n\r\n  // showArtSelect(...) can take a while to fully execute and it is possible for it to be called\r\n  // multiple times in very quick succession especially if copy pasting tokens or importing actors.\r\n  // This variable set early in the function execution is used to queue additional requests rather\r\n  // than continue execution\r\n  static executing = false;\r\n\r\n  static IMAGE_DISPLAY = {\r\n    NONE: 0,\r\n    PORTRAIT: 1,\r\n    TOKEN: 2,\r\n    PORTRAIT_TOKEN: 3,\r\n    IMAGE: 4,\r\n  };\r\n\r\n  constructor(\r\n    search,\r\n    {\r\n      preventClose = false,\r\n      object = null,\r\n      callback = null,\r\n      searchType = null,\r\n      allImages = null,\r\n      image1 = '',\r\n      image2 = '',\r\n      displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\r\n      multipleSelection = false,\r\n      searchOptions = {},\r\n    } = {}\r\n  ) {\r\n    let title = game.i18n.localize('token-variants.windows.art-select.select-variant');\r\n    if (searchType === SEARCH_TYPE.TOKEN)\r\n      title = game.i18n.localize('token-variants.windows.art-select.select-token-art');\r\n    else if (searchType === SEARCH_TYPE.PORTRAIT)\r\n      title = game.i18n.localize('token-variants.windows.art-select.select-portrait-art');\r\n\r\n    super(\r\n      {},\r\n      {\r\n        closeOnSubmit: false,\r\n        width: ArtSelect.WIDTH || 500,\r\n        height: ArtSelect.HEIGHT || 500,\r\n        left: ArtSelect.LEFT,\r\n        top: ArtSelect.TOP,\r\n        title: title,\r\n      }\r\n    );\r\n    this.search = search;\r\n    this.allImages = allImages;\r\n    this.callback = callback;\r\n    this.doc = object;\r\n    this.preventClose = preventClose;\r\n    this.image1 = image1;\r\n    this.image2 = image2;\r\n    this.displayMode = displayMode;\r\n    this.multipleSelection = multipleSelection;\r\n    this.searchType = searchType;\r\n    this.searchOptions = foundry.utils.mergeObject(searchOptions, getSearchOptions(), {\r\n      overwrite: false,\r\n    });\r\n    ArtSelect.instance = this;\r\n\r\n    const constructorName = `ArtSelect`;\r\n    Object.defineProperty(ArtSelect.prototype.constructor, 'name', { value: constructorName });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-art-select',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/artSelect.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n    });\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    buttons.unshift({\r\n      label: 'Rebuild Cache',\r\n      class: 'cache-rebuild',\r\n      icon: 'fas fa-sync-alt',\r\n      onclick: async () => {\r\n        await cacheImages();\r\n        this._performSearch(this.search, true);\r\n      },\r\n    });\r\n\r\n    buttons.unshift({\r\n      label: 'FilePicker',\r\n      class: 'file-picker',\r\n      icon: 'fas fa-file-import fa-fw',\r\n      onclick: () => {\r\n        new foundry.applications.apps.FilePicker.implementation({\r\n          type: 'imagevideo',\r\n          callback: (path) => {\r\n            if (!this.preventClose) {\r\n              this.close();\r\n            }\r\n            if (this.callback) {\r\n              this.callback(path, getFileName(path));\r\n            }\r\n          },\r\n        }).render();\r\n      },\r\n    });\r\n    buttons.unshift({\r\n      label: 'Image Category',\r\n      class: 'type',\r\n      icon: 'fas fa-swatchbook',\r\n      onclick: () => {\r\n        if (ArtSelect.instance) ArtSelect.instance._typeSelect();\r\n      },\r\n    });\r\n\r\n    return buttons;\r\n  }\r\n\r\n  _typeSelect() {\r\n    const categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n\r\n    const buttons = {};\r\n    for (const c of categories) {\r\n      let label = c;\r\n      if (c === this.searchType) {\r\n        label = '<b>>>> ' + label + ' <<<</b>';\r\n      }\r\n      buttons[c] = {\r\n        label: label,\r\n        callback: () => {\r\n          if (this.searchType !== c) {\r\n            this.searchType = c;\r\n            this._performSearch(this.search, true);\r\n          }\r\n        },\r\n      };\r\n    }\r\n\r\n    new Dialog({\r\n      title: `Select Image Category and Filter`,\r\n      content: `<style>.dialog .dialog-button {flex: 0 0 auto;}</style>`,\r\n      buttons: buttons,\r\n    }).render(true);\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    if (this.doc instanceof Item) {\r\n      data.item = true;\r\n      data.description = this.doc.system?.description?.value ?? '';\r\n    }\r\n    const searchOptions = this.searchOptions;\r\n    const algorithm = searchOptions.algorithm;\r\n\r\n    //\r\n    // Create buttons\r\n    //\r\n    const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n    const fuzzySearch = algorithm.fuzzy;\r\n\r\n    let allButtons = new Map();\r\n    let artFound = false;\r\n\r\n    const genLabel = function (str, indices, start = '<mark>', end = '</mark>', fillChar = null) {\r\n      if (!indices) return str;\r\n      let fillStr = fillChar ? fillChar.repeat(str.length) : str;\r\n      let label = '';\r\n      let lastIndex = 0;\r\n      for (const index of indices) {\r\n        label += fillStr.slice(lastIndex, index[0]);\r\n        label += start + str.slice(index[0], index[1] + 1) + end;\r\n        lastIndex = index[1] + 1;\r\n      }\r\n      label += fillStr.slice(lastIndex, fillStr.length);\r\n\r\n      return label;\r\n    };\r\n\r\n    const genTitle = function (obj) {\r\n      if (!fuzzySearch) return obj.path;\r\n\r\n      let percent = Math.ceil((1 - obj.score) * 100) + '%';\r\n      if (searchOptions.runSearchOnPath) {\r\n        return percent + '\\n' + genLabel(obj.path, obj.indices, '', '', '-') + '\\n' + obj.path;\r\n      }\r\n      return percent;\r\n    };\r\n\r\n    this.allImages.forEach((images, search) => {\r\n      const buttons = [];\r\n      images.forEach((imageObj) => {\r\n        artFound = true;\r\n        const vid = isVideo(imageObj.path);\r\n        const img = isImage(imageObj.path);\r\n        buttons.push({\r\n          path: imageObj.path,\r\n          img: img,\r\n          vid: vid,\r\n          type: vid || img,\r\n          name: imageObj.name,\r\n          label:\r\n            fuzzySearch && !searchOptions.runSearchOnPath ? genLabel(imageObj.name, imageObj.indices) : imageObj.name,\r\n          title: genTitle(imageObj),\r\n          hasConfig:\r\n            this.searchType === SEARCH_TYPE.TOKEN || this.searchType === SEARCH_TYPE.PORTRAIT_AND_TOKEN\r\n              ? Boolean(\r\n                  tokenConfigs.find((config) => config.tvImgSrc == imageObj.path && config.tvImgName == imageObj.name)\r\n                )\r\n              : false,\r\n        });\r\n      });\r\n      allButtons.set(search, buttons);\r\n    });\r\n\r\n    if (artFound) data.allImages = allButtons;\r\n\r\n    data.search = this.search;\r\n    data.queue = ArtSelect.queue.length;\r\n    data.image1 = this.image1;\r\n    data.image2 = this.image2;\r\n    data.displayMode = this.displayMode;\r\n    data.multipleSelection = this.multipleSelection;\r\n    data.displaySlider = algorithm.fuzzy && algorithm.fuzzyArtSelectPercentSlider;\r\n    data.fuzzyThreshold = algorithm.fuzzyThreshold;\r\n    if (data.displaySlider) {\r\n      data.fuzzyThreshold = 100 - data.fuzzyThreshold * 100;\r\n      data.fuzzyThreshold = data.fuzzyThreshold.toFixed(0);\r\n    }\r\n    data.autoplay = !TVA_CONFIG.playVideoOnHover;\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    const callback = this.callback;\r\n    const close = () => this.close();\r\n    const object = this.doc;\r\n    const preventClose = this.preventClose;\r\n    const multipleSelection = this.multipleSelection;\r\n\r\n    const boxes = html.find(`.token-variants-grid-box`);\r\n    boxes.hover(\r\n      function () {\r\n        if (TVA_CONFIG.playVideoOnHover) {\r\n          const vid = $(this).siblings('video');\r\n          if (vid.length) {\r\n            vid[0].play();\r\n            $(this).siblings('.fa-play').hide();\r\n          }\r\n        }\r\n      },\r\n      function () {\r\n        if (TVA_CONFIG.pauseVideoOnHoverOut) {\r\n          const vid = $(this).siblings('video');\r\n          if (vid.length) {\r\n            vid[0].pause();\r\n            vid[0].currentTime = 0;\r\n            $(this).siblings('.fa-play').show();\r\n          }\r\n        }\r\n      }\r\n    );\r\n    boxes.map((box) => {\r\n      boxes[box].addEventListener('click', async function (event) {\r\n        if (keyPressed('config')) {\r\n          if (object)\r\n            new TokenCustomConfig(object, {}, event.target.dataset.name, event.target.dataset.filename).render(true);\r\n        } else {\r\n          if (!preventClose) {\r\n            close();\r\n          }\r\n          if (callback) {\r\n            callback(event.target.dataset.name, event.target.dataset.filename);\r\n          }\r\n        }\r\n      });\r\n      if (multipleSelection) {\r\n        boxes[box].addEventListener('contextmenu', async function (event) {\r\n          $(event.target).toggleClass('selected');\r\n        });\r\n      }\r\n    });\r\n\r\n    let searchInput = html.find('#custom-art-search');\r\n    searchInput.focus();\r\n    searchInput[0].selectionStart = searchInput[0].selectionEnd = 10000;\r\n\r\n    searchInput.on(\r\n      'input',\r\n      delay((event) => {\r\n        this._performSearch(event.target.value);\r\n      }, 350)\r\n    );\r\n\r\n    html.find(`button#token-variant-art-clear-queue`).on('click', (event) => {\r\n      ArtSelect.queue = ArtSelect.queue.filter((callData) => callData.options.execute);\r\n      $(event.target).hide();\r\n    });\r\n\r\n    $(html)\r\n      .find('[name=\"fuzzyThreshold\"]')\r\n      .change((e) => {\r\n        $(e.target)\r\n          .siblings('.token-variants-range-value')\r\n          .html(`${parseFloat(e.target.value).toFixed(0)}%`);\r\n        this.searchOptions.algorithm.fuzzyThreshold = (100 - e.target.value) / 100;\r\n      })\r\n      .change(\r\n        delay((event) => {\r\n          this._performSearch(this.search, true);\r\n        }, 350)\r\n      );\r\n\r\n    if (multipleSelection) {\r\n      html.find(`button#token-variant-art-return-selected`).on('click', () => {\r\n        if (callback) {\r\n          const images = [];\r\n          html\r\n            .find(`.token-variants-grid-box.selected`)\r\n            .siblings('.token-variants-grid-image')\r\n            .each(function () {\r\n              images.push(this.getAttribute('src'));\r\n            });\r\n          callback(images);\r\n        }\r\n        close();\r\n      });\r\n      html.find(`button#token-variant-art-return-all`).on('click', () => {\r\n        if (callback) {\r\n          const images = [];\r\n          html.find(`.token-variants-grid-image`).each(function () {\r\n            images.push(this.getAttribute('src'));\r\n          });\r\n          callback(images);\r\n        }\r\n        close();\r\n      });\r\n    }\r\n  }\r\n\r\n  _performSearch(search, force = false) {\r\n    if (!force && this.search.trim() === search.trim()) return;\r\n    showArtSelect(search, {\r\n      callback: this.callback,\r\n      searchType: this.searchType,\r\n      object: this.doc,\r\n      force: true,\r\n      image1: this.image1,\r\n      image2: this.image2,\r\n      displayMode: this.displayMode,\r\n      multipleSelection: this.multipleSelection,\r\n      searchOptions: this.searchOptions,\r\n      preventClose: this.preventClose,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (formData && formData.search != this.search) {\r\n      this._performSearch(formData.search);\r\n    } else {\r\n      this.close();\r\n    }\r\n  }\r\n\r\n  setPosition(options = {}) {\r\n    if (options.width) ArtSelect.WIDTH = options.width;\r\n    if (options.height) ArtSelect.HEIGHT = options.height;\r\n    if (options.top) ArtSelect.TOP = options.top;\r\n    if (options.left) ArtSelect.LEFT = options.left;\r\n    super.setPosition(options);\r\n  }\r\n\r\n  async close(options = {}) {\r\n    let callData = ArtSelect.queue.shift();\r\n    if (callData?.options.execute) {\r\n      callData.options.execute();\r\n      callData = ArtSelect.queue.shift();\r\n    }\r\n    if (callData) {\r\n      callData.options.force = true;\r\n      showArtSelect(callData.search, callData.options);\r\n    } else {\r\n      // For some reason there might be app instances that have not closed themselves by this point\r\n      // If there are, close them now\r\n      const artSelects = Object.values(ui.windows)\r\n        .filter((app) => app instanceof ArtSelect)\r\n        .filter((app) => app.appId !== this.appId);\r\n      for (const app of artSelects) {\r\n        app.close();\r\n      }\r\n\r\n      return super.close(options);\r\n    }\r\n  }\r\n}\r\n\r\nexport function insertArtSelectButton(html, target, { search = '', searchType = SEARCH_TYPE.TOKEN } = {}) {\r\n  const button = $(`<button \r\n      class=\"token-variants-image-select-button\" \r\n      type=\"button\"\r\n      data-type=\"imagevideo\"\r\n      data-target=\"${target}\"\r\n      title=\"${game.i18n.localize('token-variants.windows.art-select.select-variant')}\">\r\n        <i class=\"fas fa-images\"></i>\r\n      </button>`);\r\n  button.on('click', () => {\r\n    showArtSelect(search, {\r\n      callback: (imgSrc, name) => {\r\n        button.siblings(`[name=\"${target}\"]`).val(imgSrc);\r\n      },\r\n      searchType,\r\n    });\r\n  });\r\n  const input = $(html).find(`[name=\"${target}\"]`);\r\n  input.after(button);\r\n  return Boolean(input.length);\r\n}\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { getFileName } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\n\r\nexport default class MissingImageConfig extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-missing-images',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/missingImageConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Define Missing Images',\r\n      width: 560,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    if (!this.missingImages) this.missingImages = foundry.utils.deepClone(TVA_CONFIG.compendiumMapper.missingImages);\r\n\r\n    data.missingImages = this.missingImages;\r\n\r\n    data.documents = ['all', 'Actor', 'Cards', 'Item', 'Macro', 'RollTable'];\r\n    return data;\r\n  }\r\n\r\n  _processFormData(formData) {\r\n    if (!Array.isArray(formData.document)) {\r\n      formData.document = [formData.document];\r\n      formData.image = [formData.image];\r\n    }\r\n\r\n    const missingImages = [];\r\n    for (let i = 0; i < formData.document.length; i++) {\r\n      missingImages.push({ document: formData.document[i], image: formData.image[i] });\r\n    }\r\n    return missingImages;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.on('click', '.add-row', () => {\r\n      const formData = this._getSubmitData();\r\n      this.missingImages = this._processFormData(formData);\r\n      this.missingImages.push({ document: 'all', image: CONST.DEFAULT_TOKEN });\r\n      this.render();\r\n    });\r\n\r\n    html.on('click', '.delete-row', (event) => {\r\n      const formData = this._getSubmitData();\r\n      this.missingImages = this._processFormData(formData);\r\n      const index = $(event.target).closest('li')[0].dataset.index;\r\n      this.missingImages.splice(index, 1);\r\n      this.render();\r\n    });\r\n\r\n    html.on('click', '.file-picker', (event) => {\r\n      new foundry.applications.apps.FilePicker.implementation({\r\n        type: 'imagevideo',\r\n        callback: (path) => {\r\n          $(event.target).closest('li').find('[name=\"image\"]').val(path);\r\n          $(event.target).closest('li').find('img').attr('src', path);\r\n        },\r\n      }).render();\r\n    });\r\n\r\n    html.on('click', '.duplicate-picker', (event) => {\r\n      let content = `<select style=\"width: 100%;\" name=\"compendium\">`;\r\n\r\n      game.packs.forEach((pack) => {\r\n        content += `<option value='${pack.collection}'>${pack.title}</option>`;\r\n      });\r\n\r\n      content += `</select>`;\r\n\r\n      new Dialog({\r\n        title: `Compendiums`,\r\n        content: content,\r\n        buttons: {\r\n          yes: {\r\n            icon: \"<i class='far fa-search'></i>\",\r\n            label: 'Search for Duplicates',\r\n            callback: (html) => {\r\n              const found = new Set();\r\n              const duplicates = new Set();\r\n              const compendium = game.packs.get(html.find(\"[name='compendium']\").val());\r\n              compendium.index.forEach((k) => {\r\n                if (found.has(k.img)) {\r\n                  duplicates.add(k.img);\r\n                }\r\n                found.add(k.img);\r\n              });\r\n              if (!duplicates.size) {\r\n                ui.notifications.info('No duplicates found in: ' + compendium.title);\r\n              }\r\n\r\n              const images = Array.from(duplicates).map((img) => {\r\n                return { path: img, name: getFileName(img) };\r\n              });\r\n              const allImages = new Map();\r\n              allImages.set('Duplicates', images);\r\n\r\n              showArtSelect('Duplicates', {\r\n                allImages,\r\n                callback: (img) => {\r\n                  $(event.target).closest('li').find('[name=\"image\"]').val(img);\r\n                  $(event.target).closest('li').find('img').attr('src', img);\r\n                },\r\n              });\r\n            },\r\n          },\r\n        },\r\n        default: 'yes',\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    updateSettings({\r\n      compendiumMapper: { missingImages: this._processFormData(formData) },\r\n    });\r\n  }\r\n}\r\n","import { showArtSelect } from '../token-variants.mjs';\r\nimport {\r\n  BASE_IMAGE_CATEGORIES,\r\n  SEARCH_TYPE,\r\n  updateActorImage,\r\n  updateTokenImage,\r\n  userRequiresImageCache,\r\n} from '../scripts/utils.js';\r\nimport { addToQueue, ArtSelect, renderFromQueue } from './artSelect.js';\r\nimport { getSearchOptions, TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport ConfigureSettings from './configureSettings.js';\r\nimport MissingImageConfig from './missingImageConfig.js';\r\nimport { cacheImages, doImageSearch } from '../scripts/search.js';\r\n\r\nasync function autoApply(actor, image1, image2, formData, typeOverride) {\r\n  let portraitFound = formData.ignorePortrait;\r\n  let tokenFound = formData.ignoreToken;\r\n\r\n  if (formData.diffImages) {\r\n    let results = [];\r\n\r\n    if (!formData.ignorePortrait) {\r\n      results = await doImageSearch(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        simpleResults: true,\r\n        searchOptions: formData.searchOptions,\r\n      });\r\n\r\n      if ((results ?? []).length != 0) {\r\n        portraitFound = true;\r\n        await updateActorImage(actor, results[0], false, formData.compendium);\r\n      }\r\n    }\r\n\r\n    if (!formData.ignoreToken) {\r\n      results = await doImageSearch(actor.prototypeToken.name, {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        simpleResults: true,\r\n        searchOptions: formData.searchOptions,\r\n      });\r\n\r\n      if ((results ?? []).length != 0) {\r\n        tokenFound = true;\r\n        updateTokenImage(results[0], {\r\n          actor: actor,\r\n          pack: formData.compendium,\r\n          applyDefaultConfig: false,\r\n        });\r\n      }\r\n    }\r\n  } else {\r\n    let results = await doImageSearch(actor.name, {\r\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n      simpleResults: true,\r\n      searchOptions: formData.searchOptions,\r\n    });\r\n\r\n    if ((results ?? []).length != 0) {\r\n      portraitFound = tokenFound = true;\r\n      updateTokenImage(results[0], {\r\n        actor: actor,\r\n        actorUpdate: { img: results[0] },\r\n        pack: formData.compendium,\r\n        applyDefaultConfig: false,\r\n      });\r\n    }\r\n  }\r\n\r\n  if (!(tokenFound && portraitFound) && formData.autoDisplayArtSelect) {\r\n    addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\r\n  }\r\n}\r\n\r\nfunction addToArtSelectQueue(actor, image1, image2, formData, typeOverride) {\r\n  if (formData.diffImages) {\r\n    if (!formData.ignorePortrait && !formData.ignoreToken) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        object: actor,\r\n        preventClose: true,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, _) {\r\n          await updateActorImage(actor, imgSrc);\r\n          showArtSelect(actor.prototypeToken.name, {\r\n            searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\r\n            object: actor,\r\n            force: true,\r\n            image1: imgSrc,\r\n            image2: image2,\r\n            displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\r\n            searchOptions: formData.searchOptions,\r\n            callback: (imgSrc, name) =>\r\n              updateTokenImage(imgSrc, {\r\n                actor: actor,\r\n                imgName: name,\r\n                applyDefaultConfig: false,\r\n              }),\r\n          });\r\n        },\r\n      });\r\n    } else if (formData.ignorePortrait) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\r\n        object: actor,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, name) {\r\n          updateTokenImage(imgSrc, {\r\n            actor: actor,\r\n            imgName: name,\r\n            applyDefaultConfig: false,\r\n          });\r\n        },\r\n      });\r\n    } else if (formData.ignoreToken) {\r\n      addToQueue(actor.name, {\r\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\r\n        object: actor,\r\n        image1: image1,\r\n        image2: image2,\r\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\r\n        searchOptions: formData.searchOptions,\r\n        callback: async function (imgSrc, name) {\r\n          await updateActorImage(actor, imgSrc);\r\n        },\r\n      });\r\n    }\r\n  } else {\r\n    addToQueue(actor.name, {\r\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n      object: actor,\r\n      image1: image1,\r\n      image2: image2,\r\n      displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT_TOKEN,\r\n      searchOptions: formData.searchOptions,\r\n      callback: async function (imgSrc, name) {\r\n        await updateActorImage(actor, imgSrc);\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          applyDefaultConfig: false,\r\n        });\r\n      },\r\n    });\r\n  }\r\n}\r\n\r\nexport default class CompendiumMapConfig extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n    this.searchOptions = foundry.utils.deepClone(getSearchOptions());\r\n    foundry.utils.mergeObject(this.searchOptions, foundry.utils.deepClone(TVA_CONFIG.compendiumMapper.searchOptions));\r\n    this._fixSearchPaths();\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-compendium-map-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/compendiumMap.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: game.i18n.localize('token-variants.settings.compendium-mapper.Name'),\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    let data = super.getData(options);\r\n    data = foundry.utils.mergeObject(data, TVA_CONFIG.compendiumMapper);\r\n\r\n    const supportedPacks = ['Actor', 'Cards', 'Item', 'Macro', 'RollTable'];\r\n    data.supportedPacks = supportedPacks.join(', ');\r\n\r\n    const packs = [];\r\n    game.packs.forEach((pack) => {\r\n      if (!pack.locked && supportedPacks.includes(pack.documentName)) {\r\n        packs.push({ title: pack.title, id: pack.collection, type: pack.documentName });\r\n      }\r\n    });\r\n    data.compendiums = packs;\r\n    data.compendium = TVA_CONFIG.compendiumMapper.compendium;\r\n\r\n    data.categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n    data.category = TVA_CONFIG.compendiumMapper.category;\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.token-variants-override-category').change(this._onCategoryOverride).trigger('change');\r\n    html.find('.token-variants-auto-apply').change(this._onAutoApply);\r\n    html.find('.token-variants-diff-images').change(this._onDiffImages);\r\n    html.find(`.token-variants-search-options`).on('click', this._onSearchOptions.bind(this));\r\n    html.find(`.token-variants-missing-images`).on('click', this._onMissingImages.bind(this));\r\n\r\n    $(html).find('[name=\"compendium\"]').change(this._onCompendiumSelect.bind(this)).trigger('change');\r\n  }\r\n\r\n  async _onAutoApply(event) {\r\n    $(event.target).closest('form').find('.token-variants-auto-art-select').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onCategoryOverride(event) {\r\n    $(event.target).closest('form').find('.token-variants-category').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onDiffImages(event) {\r\n    $(event.target).closest('form').find('.token-variants-tp-ignore').prop('disabled', !event.target.checked);\r\n  }\r\n\r\n  async _onCompendiumSelect(event) {\r\n    const compendium = game.packs.get($(event.target).val());\r\n    if (compendium) {\r\n      $(event.target)\r\n        .closest('form')\r\n        .find('.token-specific')\r\n        .css('visibility', compendium.documentName === 'Actor' ? 'visible' : 'hidden');\r\n    }\r\n  }\r\n\r\n  _fixSearchPaths() {\r\n    if (!this.searchOptions.searchPaths?.length) {\r\n      this.searchOptions.searchPaths = foundry.utils.deepClone(TVA_CONFIG.searchPaths);\r\n    }\r\n  }\r\n\r\n  async _onSearchOptions(event) {\r\n    this._fixSearchPaths();\r\n    new ConfigureSettings(this.searchOptions, {\r\n      searchPaths: true,\r\n      searchFilters: true,\r\n      searchAlgorithm: true,\r\n      randomizer: false,\r\n      features: false,\r\n      popup: false,\r\n      permissions: false,\r\n      worldHud: false,\r\n      misc: false,\r\n      activeEffects: false,\r\n    }).render(true);\r\n  }\r\n\r\n  async _onMissingImages(event) {\r\n    new MissingImageConfig().render(true);\r\n  }\r\n\r\n  async startMapping(formData) {\r\n    if (formData.diffImages && formData.ignoreToken && formData.ignorePortrait) {\r\n      return;\r\n    }\r\n\r\n    const originalSearchPaths = TVA_CONFIG.searchPaths;\r\n    if (formData.searchOptions.searchPaths?.length) {\r\n      TVA_CONFIG.searchPaths = formData.searchOptions.searchPaths;\r\n    }\r\n\r\n    if (formData.cache || !userRequiresImageCache() || formData.searchOptions.searchPaths?.length) {\r\n      console.log('TVA-Mapper: Starting Image caching.');\r\n      await cacheImages();\r\n      console.log('TVA-Mapper: Caching finished.');\r\n    }\r\n\r\n    const endMapping = function () {\r\n      if (formData.searchOptions.searchPaths?.length) {\r\n        TVA_CONFIG.searchPaths = originalSearchPaths;\r\n        cacheImages();\r\n      }\r\n    };\r\n\r\n    const compendium = game.packs.get(formData.compendium);\r\n    let missingImageList = TVA_CONFIG.compendiumMapper.missingImages\r\n      .filter((mi) => mi.document === 'all' || mi.document === compendium.documentName)\r\n      .map((mi) => mi.image);\r\n    const typeOverride = formData.overrideCategory ? formData.category : null;\r\n    let artSelectDisplayed = false;\r\n\r\n    let processItem;\r\n    let consoleProcessedTracking = 0;\r\n    if (compendium.documentName === 'Actor') {\r\n      processItem = async function (item) {\r\n        const actor = item;\r\n        if (actor.name === '#[CF_tempEntity]') return; // Compendium Folders module's control entity\r\n\r\n        let hasPortrait = actor.img !== CONST.DEFAULT_TOKEN && !missingImageList.includes(actor.img);\r\n        let hasToken =\r\n          actor.prototypeToken.texture.src !== CONST.DEFAULT_TOKEN &&\r\n          !missingImageList.includes(actor.prototypeToken.texture.src);\r\n        if (formData.syncImages && hasPortrait !== hasToken) {\r\n          if (hasPortrait) {\r\n            await updateTokenImage(actor.img, { actor: actor, applyDefaultConfig: false });\r\n          } else {\r\n            await updateActorImage(actor, actor.prototypeToken.texture.src);\r\n          }\r\n          hasPortrait = hasToken = true;\r\n        }\r\n\r\n        let includeThisActor = !(formData.missingOnly && hasPortrait) && !formData.ignorePortrait;\r\n        let includeThisToken = !(formData.missingOnly && hasToken) && !formData.ignoreToken;\r\n\r\n        const image1 = formData.showImages ? actor.img : '';\r\n        const image2 = formData.showImages ? actor.prototypeToken.texture.src : '';\r\n\r\n        if (includeThisActor || includeThisToken) {\r\n          if (formData.autoApply) {\r\n            await autoApply(actor, image1, image2, formData, typeOverride);\r\n          } else {\r\n            artSelectDisplayed = true;\r\n            addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\r\n          }\r\n        }\r\n\r\n        consoleProcessedTracking++;\r\n        if (consoleProcessedTracking % 100 === 0)\r\n          console.log(`TVA-Mapper: Processed ${consoleProcessedTracking} ${compendium.documentName}s`);\r\n      };\r\n    } else {\r\n      processItem = async function (item) {\r\n        const doc = item;\r\n        if (doc.name === '#[CF_tempEntity]') return; // Compendium Folders module's control entity\r\n\r\n        let defaultImg = '';\r\n        if (doc.schema.fields.img || doc.schema.fields.texture) {\r\n          defaultImg = (doc.schema.fields.img ?? doc.schema.fields.texture).initial(doc);\r\n        }\r\n        const hasImage = doc.img != null && doc.img !== defaultImg && !missingImageList.includes(doc.img);\r\n\r\n        let imageFound = false;\r\n        if (formData.missingOnly && hasImage) return;\r\n        if (formData.autoApply) {\r\n          let results = await doImageSearch(doc.name, {\r\n            searchType: typeOverride ?? compendium.documentName,\r\n            simpleResults: true,\r\n            searchOptions: formData.searchOptions,\r\n          });\r\n\r\n          if ((results ?? []).length != 0) {\r\n            imageFound = true;\r\n            await updateActorImage(doc, results[0], false, formData.compendium);\r\n          }\r\n        }\r\n\r\n        if (!formData.autoApply || (formData.autoDisplayArtSelect && !imageFound)) {\r\n          artSelectDisplayed = true;\r\n          addToQueue(doc.name, {\r\n            searchType: typeOverride ?? compendium.documentName,\r\n            object: doc,\r\n            image1: formData.showImages ? doc.img : '',\r\n            displayMode: ArtSelect.IMAGE_DISPLAY.IMAGE,\r\n            searchOptions: formData.searchOptions,\r\n            callback: async function (imgSrc, name) {\r\n              await updateActorImage(doc, imgSrc);\r\n            },\r\n          });\r\n        }\r\n\r\n        consoleProcessedTracking++;\r\n        if (consoleProcessedTracking % 100 === 0)\r\n          console.log(`TVA-Mapper: Processed ${consoleProcessedTracking} ${compendium.documentName}s`);\r\n      };\r\n    }\r\n\r\n    console.log(`TVA-Mapper: Starting Batch ${compendium.documentName} load.`);\r\n    const documents = await compendium.getDocuments();\r\n    console.log(`TVA-Mapper: Load finished. Beginning processing.`);\r\n\r\n    if (formData.autoApply) {\r\n      let processing = true;\r\n      let stopProcessing = false;\r\n      let processed = 0;\r\n      let counter = $(`<p>CACHING 0/${documents.length}</p>`);\r\n      let d;\r\n\r\n      const startProcessing = async function () {\r\n        while (processing && processed < documents.length) {\r\n          await new Promise((resolve, reject) => {\r\n            setTimeout(async () => {\r\n              await processItem(documents[processed]);\r\n              resolve();\r\n            }, 10);\r\n          });\r\n          processed++;\r\n          counter.html(`${processed}/${documents.length}`);\r\n        }\r\n        if (stopProcessing || processed === documents.length) {\r\n          d?.close(true);\r\n          addToQueue('DUMMY', { execute: endMapping });\r\n          renderFromQueue();\r\n        }\r\n      };\r\n\r\n      d = new Dialog({\r\n        title: `Mapping: ${compendium.title}`,\r\n        content: `\r\n        <div style=\"text-align:center;\" class=\"fa-3x\"><i class=\"fas fa-spinner fa-pulse\"></i></div>\r\n        <div style=\"text-align:center;\" class=\"counter\"></div>\r\n        <button style=\"width:100%;\" class=\"pause\"><i class=\"fas fa-play-circle\"></i> Pause/Start</button>`,\r\n        buttons: {\r\n          cancel: {\r\n            icon: '<i class=\"fas fa-stop-circle\"></i>',\r\n            label: 'Cancel',\r\n          },\r\n        },\r\n        default: 'cancel',\r\n        render: (html) => {\r\n          html.find('.counter').append(counter);\r\n          const spinner = html.find('.fa-spinner');\r\n          html.find('.pause').on('click', () => {\r\n            if (processing) {\r\n              processing = false;\r\n              spinner.removeClass('fa-pulse');\r\n            } else {\r\n              processing = true;\r\n              startProcessing();\r\n              spinner.addClass('fa-pulse');\r\n            }\r\n          });\r\n          setTimeout(async () => startProcessing(), 1000);\r\n        },\r\n        close: () => {\r\n          if (!stopProcessing) {\r\n            stopProcessing = true;\r\n            if (!processing) startProcessing();\r\n            else processing = false;\r\n          }\r\n        },\r\n      });\r\n      d.render(true);\r\n    } else {\r\n      const tasks = documents.map(processItem);\r\n      Promise.all(tasks).then(() => {\r\n        addToQueue('DUMMY', { execute: endMapping });\r\n        renderFromQueue();\r\n        if (formData.missingOnly && !artSelectDisplayed) {\r\n          ui.notifications.warn('Token Variant Art: No documents found containing missing images.');\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    // If search paths are the same, remove them from searchOptions\r\n    if (\r\n      !this.searchOptions.searchPaths?.length ||\r\n      foundry.utils.isEmpty(foundry.utils.diffObject(this.searchOptions.searchPaths, TVA_CONFIG.searchPaths))\r\n    ) {\r\n      this.searchOptions.searchPaths = [];\r\n    }\r\n\r\n    formData.searchOptions = this.searchOptions;\r\n\r\n    await updateSettings({ compendiumMapper: formData });\r\n    if (formData.compendium) {\r\n      this.startMapping(formData);\r\n    }\r\n  }\r\n}\r\n","import { cacheImages } from '../scripts/search.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { getFileName } from '../scripts/utils.js';\r\nimport EffectMappingForm from './effectMappingForm.js';\r\nimport { showPathSelectCategoryDialog, showPathSelectConfigForm } from './dialogs.js';\r\n\r\nexport default class ConfigureSettings extends FormApplication {\r\n  constructor(\r\n    dummySettings,\r\n    {\r\n      searchPaths = true,\r\n      searchFilters = true,\r\n      searchAlgorithm = true,\r\n      randomizer = true,\r\n      popup = true,\r\n      permissions = true,\r\n      worldHud = true,\r\n      misc = true,\r\n      activeEffects = true,\r\n      features = false,\r\n    } = {}\r\n  ) {\r\n    super({}, {});\r\n    this.enabledTabs = {\r\n      searchPaths,\r\n      searchFilters,\r\n      searchAlgorithm,\r\n      randomizer,\r\n      features,\r\n      popup,\r\n      permissions,\r\n      worldHud,\r\n      misc,\r\n      activeEffects,\r\n    };\r\n    this.settings = foundry.utils.deepClone(TVA_CONFIG);\r\n    if (dummySettings) {\r\n      this.settings = foundry.utils.mergeObject(this.settings, dummySettings, { insertKeys: false });\r\n      this.dummySettings = dummySettings;\r\n    }\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-configure-settings',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configureSettings.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Configure Settings',\r\n      width: 700,\r\n      height: 'auto',\r\n      tabs: [{ navSelector: '.sheet-tabs', contentSelector: '.content', initial: 'searchPaths' }],\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const settings = this.settings;\r\n\r\n    data.enabledTabs = this.enabledTabs;\r\n\r\n    // === Search Paths ===\r\n    const paths = settings.searchPaths.map((path) => {\r\n      const r = {};\r\n      r.text = path.text;\r\n      r.icon = this._pathIcon(path.source || '');\r\n      r.cache = path.cache;\r\n      r.source = path.source || '';\r\n      r.types = path.types.join(',');\r\n      r.config = JSON.stringify(path.config ?? {});\r\n      r.hasConfig = path.config && !foundry.utils.isEmpty(path.config);\r\n      return r;\r\n    });\r\n    data.searchPaths = paths;\r\n\r\n    // === Search Filters ===\r\n    data.searchFilters = settings.searchFilters;\r\n    for (const filter in data.searchFilters) {\r\n      data.searchFilters[filter].label = filter;\r\n    }\r\n\r\n    // === Algorithm ===\r\n    data.algorithm = foundry.utils.deepClone(settings.algorithm);\r\n    data.algorithm.fuzzyThreshold = 100 - data.algorithm.fuzzyThreshold * 100;\r\n\r\n    // === Randomizer ===\r\n    // Get all actor types defined by the game system\r\n    data.randomizer = foundry.utils.deepClone(settings.randomizer);\r\n    const actorTypes = game.documentTypes.Actor;\r\n    data.randomizer.actorTypes = actorTypes.reduce((obj, t) => {\r\n      const label = CONFIG.Actor?.typeLabels?.[t] ?? t;\r\n      obj[t] = {\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        disable: settings.randomizer[`${t}Disable`] ?? false,\r\n      };\r\n      return obj;\r\n    }, {});\r\n\r\n    data.randomizer.tokenToPortraitDisabled =\r\n      !(settings.randomizer.tokenCreate || settings.randomizer.tokenCopyPaste) || data.randomizer.diffImages;\r\n\r\n    // === Pop-up ===\r\n    data.popup = foundry.utils.deepClone(settings.popup);\r\n    // Get all actor types defined by the game system\r\n    data.popup.actorTypes = actorTypes.reduce((obj, t) => {\r\n      const label = CONFIG.Actor?.typeLabels?.[t] ?? t;\r\n      obj[t] = {\r\n        type: t,\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        disable: settings.popup[`${t}Disable`] ?? false,\r\n      };\r\n      return obj;\r\n    }, {});\r\n\r\n    // Split into arrays of max length 3\r\n    let allTypes = [];\r\n    let tempTypes = [];\r\n    let i = 0;\r\n    for (const [key, value] of Object.entries(data.popup.actorTypes)) {\r\n      tempTypes.push(value);\r\n      i++;\r\n      if (i % 3 == 0) {\r\n        allTypes.push(tempTypes);\r\n        tempTypes = [];\r\n      }\r\n    }\r\n    if (tempTypes.length > 0) allTypes.push(tempTypes);\r\n    data.popup.actorTypes = allTypes;\r\n\r\n    // === Permissions ===\r\n    data.permissions = settings.permissions;\r\n\r\n    // === Token HUD ===\r\n    data.worldHud = foundry.utils.deepClone(settings.worldHud);\r\n    data.worldHud.tokenHUDWildcardActive = game.modules.get('token-hud-wildcard')?.active;\r\n\r\n    // === Internal Effects ===\r\n    data.internalEffects = foundry.utils.deepClone(settings.internalEffects);\r\n\r\n    // === Misc ===\r\n    data.keywordSearch = settings.keywordSearch;\r\n    data.excludedKeywords = settings.excludedKeywords;\r\n    data.systemHpPath = settings.systemHpPath;\r\n    data.runSearchOnPath = settings.runSearchOnPath;\r\n    data.imgurClientId = settings.imgurClientId;\r\n    data.enableStatusConfig = settings.enableStatusConfig;\r\n    data.disableNotifs = settings.disableNotifs;\r\n    data.staticCache = settings.staticCache;\r\n    data.staticCacheFile = settings.staticCacheFile;\r\n    data.stackStatusConfig = settings.stackStatusConfig;\r\n    data.mergeGroup = settings.mergeGroup;\r\n    data.customImageCategories = settings.customImageCategories.join(',');\r\n    data.disableEffectIcons = settings.disableEffectIcons;\r\n    data.displayEffectIconsOnHover = settings.displayEffectIconsOnHover;\r\n    data.filterEffectIcons = settings.filterEffectIcons;\r\n    data.hideElevationTooltip = settings.hideElevationTooltip;\r\n    data.hideTokenBorder = settings.hideTokenBorder;\r\n    data.filterCustomEffectIcons = settings.filterCustomEffectIcons;\r\n    data.filterIconList = settings.filterIconList.join(',');\r\n    data.updateTokenProto = settings.updateTokenProto;\r\n    data.imgNameContainsDimensions = settings.imgNameContainsDimensions;\r\n    data.imgNameContainsFADimensions = settings.imgNameContainsFADimensions;\r\n    data.playVideoOnHover = settings.playVideoOnHover;\r\n    data.pauseVideoOnHoverOut = settings.pauseVideoOnHoverOut;\r\n    data.disableImageChangeOnPolymorphed = settings.disableImageChangeOnPolymorphed;\r\n    data.disableImageUpdateOnNonPrototype = settings.disableImageUpdateOnNonPrototype;\r\n    data.disableTokenUpdateAnimation = settings.disableTokenUpdateAnimation;\r\n    data.evaluateOverlayOnHover = settings.evaluateOverlayOnHover;\r\n\r\n    // Controls\r\n    data.pathfinder = ['pf1e', 'pf2e'].includes(game.system.id);\r\n    data.dnd5e = game.system.id === 'dnd5e';\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Search Paths\r\n    super.activateListeners(html);\r\n    html.find('a.create-path').click(this._onCreatePath.bind(this));\r\n    html.on('input', '.searchSource', this._onSearchSourceTextChange.bind(this));\r\n    $(html).on('click', 'a.delete-path', this._onDeletePath.bind(this));\r\n    $(html).on('click', 'a.convert-imgur', this._onConvertImgurPath.bind(this));\r\n    $(html).on('click', 'a.convert-json', this._onConvertJsonPath.bind(this));\r\n    $(html).on('click', '.path-image.source-icon a', this._onBrowseFolder.bind(this));\r\n    $(html).on('click', 'a.select-category', showPathSelectCategoryDialog.bind(this));\r\n    $(html).on('click', 'a.select-config', showPathSelectConfigForm.bind(this));\r\n\r\n    // Search Filters\r\n    html.on('input', 'input.filterRegex', this._validateRegex.bind(this));\r\n\r\n    // Active Effects\r\n    const disableEffectIcons = html.find('[name=\"disableEffectIcons\"]');\r\n    const filterEffectIcons = html.find('[name=\"filterEffectIcons\"]');\r\n    disableEffectIcons\r\n      .on('change', (e) => {\r\n        if (e.target.checked) filterEffectIcons.prop('checked', false);\r\n      })\r\n      .trigger('change');\r\n    filterEffectIcons.on('change', (e) => {\r\n      if (e.target.checked) disableEffectIcons.prop('checked', false);\r\n    });\r\n\r\n    // Algorithm\r\n    const algorithmTab = $(html).find('div[data-tab=\"searchAlgorithm\"]');\r\n    algorithmTab.find(`input[name=\"algorithm.exact\"]`).change((e) => {\r\n      $(e.target).closest('form').find('input[name=\"algorithm.fuzzy\"]').prop('checked', !e.target.checked);\r\n    });\r\n    algorithmTab.find(`input[name=\"algorithm.fuzzy\"]`).change((e) => {\r\n      $(e.target).closest('form').find('input[name=\"algorithm.exact\"]').prop('checked', !e.target.checked);\r\n    });\r\n    algorithmTab.find('input[name=\"algorithm.fuzzyThreshold\"]').change((e) => {\r\n      $(e.target).siblings('.token-variants-range-value').html(`${e.target.value}%`);\r\n    });\r\n\r\n    // Randomizer\r\n    const tokenCreate = html.find('input[name=\"randomizer.tokenCreate\"]');\r\n    const tokenCopyPaste = html.find('input[name=\"randomizer.tokenCopyPaste\"]');\r\n    const tokenToPortrait = html.find('input[name=\"randomizer.tokenToPortrait\"]');\r\n    const _toggle = () => {\r\n      tokenToPortrait.prop('disabled', !(tokenCreate.is(':checked') || tokenCopyPaste.is(':checked')));\r\n    };\r\n    tokenCreate.change(_toggle);\r\n    tokenCopyPaste.change(_toggle);\r\n\r\n    const diffImages = html.find('input[name=\"randomizer.diffImages\"]');\r\n    const syncImages = html.find('input[name=\"randomizer.syncImages\"]');\r\n    diffImages.change(() => {\r\n      syncImages.prop('disabled', !diffImages.is(':checked'));\r\n      tokenToPortrait.prop('disabled', diffImages.is(':checked'));\r\n    });\r\n\r\n    // Token HUD\r\n    html.find('input[name=\"worldHud.updateActorImage\"]').change((event) => {\r\n      $(event.target)\r\n        .closest('form')\r\n        .find('input[name=\"worldHud.useNameSimilarity\"]')\r\n        .prop('disabled', !event.target.checked);\r\n    });\r\n\r\n    // Static Cache\r\n    html.find('button.token-variants-cache-images').click((event) => {\r\n      const tab = $(event.target).closest('.tab');\r\n      const staticOn = tab.find('input[name=\"staticCache\"]');\r\n      const staticFile = tab.find('input[name=\"staticCacheFile\"]');\r\n      cacheImages({ staticCache: staticOn.is(':checked'), staticCacheFile: staticFile.val() });\r\n    });\r\n\r\n    // Global Mappings\r\n    html.find('button.token-variants-global-mapping').click(() => {\r\n      const token = new TokenDocument();\r\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Validates regex entered into Search Filter's RegEx input field\r\n   */\r\n  async _validateRegex(event) {\r\n    if (this._validRegex(event.target.value)) {\r\n      event.target.style.backgroundColor = '';\r\n    } else {\r\n      event.target.style.backgroundColor = '#ff7066';\r\n    }\r\n  }\r\n\r\n  _validRegex(val) {\r\n    if (val) {\r\n      try {\r\n        new RegExp(val);\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Open a FilePicker so the user can select a local folder to use as an image source\r\n   */\r\n  async _onBrowseFolder(event) {\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    let activeSource = sourceInput.val() || 'data';\r\n    let current = pathInput.val();\r\n\r\n    if (activeSource.startsWith('s3:')) {\r\n      const bucketName = activeSource.replace('s3:', '');\r\n      current = `${game.data.files.s3?.endpoint.protocol}//${bucketName}.${game.data.files.s3?.endpoint.host}/${current}`;\r\n    } else if (activeSource.startsWith('rolltable')) {\r\n      let content = `<select style=\"width: 100%;\" name=\"table-name\" id=\"output-tableKey\">`;\r\n\r\n      game.tables.forEach((rollTable) => {\r\n        content += `<option value='${rollTable.name}'>${rollTable.name}</option>`;\r\n      });\r\n\r\n      content += `</select>`;\r\n\r\n      new Dialog({\r\n        title: `Select a Rolltable`,\r\n        content: content,\r\n        buttons: {\r\n          yes: {\r\n            icon: \"<i class='fas fa-check'></i>\",\r\n            label: 'Select',\r\n            callback: (html) => {\r\n              pathInput.val();\r\n              const tableName = html.find(\"select[name='table-name']\").val();\r\n              pathInput.val(tableName);\r\n            },\r\n          },\r\n        },\r\n        default: 'yes',\r\n      }).render(true);\r\n      return;\r\n    }\r\n\r\n    if (activeSource === 'json') {\r\n      new foundry.applications.apps.FilePicker.implementation({\r\n        type: 'text',\r\n        activeSource: 'data',\r\n        current: current,\r\n        callback: (path, fp) => {\r\n          pathInput.val(path);\r\n        },\r\n      }).render(true);\r\n    } else {\r\n      new foundry.applications.apps.FilePicker.implementation({\r\n        type: 'folder',\r\n        activeSource: activeSource,\r\n        current: current,\r\n        callback: (path, fp) => {\r\n          pathInput.val(fp.result.target);\r\n          if (fp.activeSource === 's3') {\r\n            sourceInput.val(`s3:${fp.result.bucket}`);\r\n          } else {\r\n            sourceInput.val(fp.activeSource);\r\n          }\r\n        },\r\n      }).render(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Converts Imgur path to a rolltable\r\n   */\r\n  async _onConvertImgurPath(event) {\r\n    event.preventDefault();\r\n\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    const albumHash = pathInput.val();\r\n    const imgurClientId = TVA_CONFIG.imgurClientId === '' ? 'df9d991443bb222' : TVA_CONFIG.imgurClientId;\r\n\r\n    fetch('https://api.imgur.com/3/gallery/album/' + albumHash, {\r\n      headers: {\r\n        Authorization: 'Client-ID ' + imgurClientId,\r\n        Accept: 'application/json',\r\n      },\r\n    })\r\n      .then((response) => response.json())\r\n      .then(\r\n        async function (result) {\r\n          if (!result.success && location.hostname === 'localhost') {\r\n            ui.notifications.warn(game.i18n.format('token-variants.notifications.warn.imgur-localhost'));\r\n            return;\r\n          }\r\n\r\n          const data = result.data;\r\n\r\n          let resultsArray = [];\r\n          data.images.forEach((img, i) => {\r\n            resultsArray.push({\r\n              type: 0,\r\n              text: img.title ?? img.description ?? '',\r\n              weight: 1,\r\n              range: [i + 1, i + 1],\r\n              collection: 'Text',\r\n              drawn: false,\r\n              img: img.link,\r\n            });\r\n          });\r\n\r\n          await RollTable.create({\r\n            name: data.title,\r\n            description: 'Token Variant Art auto generated RollTable: https://imgur.com/gallery/' + albumHash,\r\n            results: resultsArray,\r\n            replacement: true,\r\n            displayRoll: true,\r\n            img: 'modules/token-variants/img/token-images.svg',\r\n          });\r\n\r\n          pathInput.val(data.title);\r\n          sourceInput.val('rolltable').trigger('input');\r\n        }.bind(this)\r\n      )\r\n      .catch((error) => console.warn('TVA | ', error));\r\n  }\r\n\r\n  /**\r\n   * Converts Json path to a rolltable\r\n   */\r\n  async _onConvertJsonPath(event) {\r\n    event.preventDefault();\r\n\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n    const sourceInput = $(event.target).closest('.table-row').find('.path-source input');\r\n\r\n    const jsonPath = pathInput.val();\r\n\r\n    fetch(jsonPath, {\r\n      headers: {\r\n        Accept: 'application/json',\r\n      },\r\n    })\r\n      .then((response) => response.json())\r\n      .then(\r\n        async function (result) {\r\n          if (!result.length > 0) {\r\n            ui.notifications.warn(game.i18n.format('token-variants.notifications.warn.json-localhost'));\r\n            return;\r\n          }\r\n\r\n          const data = result;\r\n          data.title = getFileName(jsonPath);\r\n\r\n          let resultsArray = [];\r\n          data.forEach((img, i) => {\r\n            resultsArray.push({\r\n              type: 0,\r\n              text: img.name ?? '',\r\n              weight: 1,\r\n              range: [i + 1, i + 1],\r\n              collection: 'Text',\r\n              drawn: false,\r\n              img: img.path,\r\n            });\r\n          });\r\n\r\n          await RollTable.create({\r\n            name: data.title,\r\n            description: 'Token Variant Art auto generated RollTable: ' + jsonPath,\r\n            results: resultsArray,\r\n            replacement: true,\r\n            displayRoll: true,\r\n            img: 'modules/token-variants/img/token-images.svg',\r\n          });\r\n\r\n          pathInput.val(data.title);\r\n          sourceInput.val('rolltable').trigger('input');\r\n        }.bind(this)\r\n      )\r\n      .catch((error) => console.warn('TVA | ', error));\r\n  }\r\n\r\n  /**\r\n   * Generates a new search path row\r\n   */\r\n  async _onCreatePath(event) {\r\n    event.preventDefault();\r\n    const table = $(event.currentTarget).closest('.token-variant-table');\r\n    let row = `\r\n    <li class=\"table-row flexrow\">\r\n        <div class=\"path-image source-icon\">\r\n            <a><i class=\"${this._pathIcon('')}\"></i></a>\r\n        </div>\r\n        <div class=\"path-source\">\r\n          <input class=\"searchSource\" type=\"text\" name=\"searchPaths.source\" value=\"\" placeholder=\"data\"/>\r\n        </div>\r\n        <div class=\"path-text\">\r\n            <input class=\"searchPath\" type=\"text\" name=\"searchPaths.text\" value=\"\" placeholder=\"Path to folder\"/>\r\n        </div>\r\n        <div class=\"imgur-control\">\r\n            <a class=\"convert-imgur\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\r\n        </div>\r\n        <div class=\"json-control\">\r\n          <a class=\"convert-json\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\r\n        </div>\r\n        <div class=\"path-category\">\r\n            <a class=\"select-category\" title=\"Select image categories/filters\"><i class=\"fas fa-swatchbook\"></i></a>\r\n            <input type=\"hidden\" name=\"searchPaths.types\" value=\"Portrait,Token,PortraitAndToken\">\r\n        </div>\r\n        <div class=\"path-config\">\r\n          <a class=\"select-config\" title=\"Apply configuration to images under this path.\"><i class=\"fas fa-cog fa-lg\"></i></a>\r\n          <input type=\"hidden\" name=\"searchPaths.config\" value=\"{}\">\r\n         </div>\r\n        <div class=\"path-cache\">\r\n            <input type=\"checkbox\" name=\"searchPaths.cache\" data-dtype=\"Boolean\" checked/>\r\n        </div>\r\n        <div class=\"path-controls\">\r\n            <a class=\"delete-path\" title=\"Delete path\"><i class=\"fas fa-trash\"></i></a>\r\n        </div>\r\n    </li>\r\n  `;\r\n    table.append(row);\r\n\r\n    this._reIndexPaths(table);\r\n\r\n    this.setPosition(); // Auto-resize window\r\n  }\r\n\r\n  async _reIndexPaths(table) {\r\n    table\r\n      .find('.path-source')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.source`);\r\n      });\r\n\r\n    table\r\n      .find('.path-text')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.text`);\r\n      });\r\n\r\n    table\r\n      .find('.path-cache')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.cache`);\r\n      });\r\n    table\r\n      .find('.path-category')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.types`);\r\n      });\r\n    table\r\n      .find('.path-config')\r\n      .find('input')\r\n      .each(function (index) {\r\n        $(this).attr('name', `searchPaths.${index}.config`);\r\n      });\r\n  }\r\n\r\n  async _onDeletePath(event) {\r\n    event.preventDefault();\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    li.remove();\r\n\r\n    const table = $(event.currentTarget).closest('.token-variant-table');\r\n    this._reIndexPaths(table);\r\n\r\n    this.setPosition(); // Auto-resize window\r\n  }\r\n\r\n  async _onSearchSourceTextChange(event) {\r\n    const image = this._pathIcon(event.target.value);\r\n    const imgur = image === 'fas fa-info';\r\n    const json = image === 'fas fa-brackets-curly';\r\n\r\n    const imgurControl = $(event.currentTarget).closest('.table-row').find('.imgur-control');\r\n    if (imgur) imgurControl.addClass('active');\r\n    else imgurControl.removeClass('active');\r\n\r\n    const jsonControl = $(event.currentTarget).closest('.table-row').find('.json-control');\r\n    if (json) jsonControl.addClass('active');\r\n    else jsonControl.removeClass('active');\r\n\r\n    $(event.currentTarget).closest('.table-row').find('.path-image i').attr('class', image);\r\n  }\r\n\r\n  // Return icon appropriate for the path provided\r\n  _pathIcon(source) {\r\n    if (source.startsWith('s3')) {\r\n      return 'fas fa-database';\r\n    } else if (source.startsWith('rolltable')) {\r\n      return 'fas fa-dice';\r\n    } else if (source.startsWith('forgevtt') || source.startsWith('forge-bazaar')) {\r\n      return 'fas fa-hammer';\r\n    } else if (source.startsWith('imgur')) {\r\n      return 'fas fa-info';\r\n    } else if (source.startsWith('json')) {\r\n      return 'fas fa-brackets-curly';\r\n    }\r\n\r\n    return 'fas fa-folder';\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    const settings = this.settings;\r\n    formData = foundry.utils.expandObject(formData);\r\n\r\n    // Search Paths\r\n    settings.searchPaths = formData.hasOwnProperty('searchPaths') ? Object.values(formData.searchPaths) : [];\r\n    settings.searchPaths.forEach((path) => {\r\n      if (!path.source) path.source = 'data';\r\n      if (path.types) path.types = path.types.split(',');\r\n      else path.types = [];\r\n      if (path.config) {\r\n        try {\r\n          path.config = JSON.parse(path.config);\r\n        } catch (e) {\r\n          delete path.config;\r\n        }\r\n      } else delete path.config;\r\n    });\r\n\r\n    // Search Filters\r\n    for (const filter in formData.searchFilters) {\r\n      if (!this._validRegex(formData.searchFilters[filter].regex)) formData.searchFilters[filter].regex = '';\r\n    }\r\n    foundry.utils.mergeObject(settings.searchFilters, formData.searchFilters);\r\n\r\n    // Algorithm\r\n    formData.algorithm.fuzzyLimit = parseInt(formData.algorithm.fuzzyLimit);\r\n    if (isNaN(formData.algorithm.fuzzyLimit) || formData.algorithm.fuzzyLimit < 1) formData.algorithm.fuzzyLimit = 50;\r\n    formData.algorithm.fuzzyThreshold = (100 - formData.algorithm.fuzzyThreshold) / 100;\r\n    foundry.utils.mergeObject(settings.algorithm, formData.algorithm);\r\n\r\n    // Randomizer\r\n    foundry.utils.mergeObject(settings.randomizer, formData.randomizer);\r\n\r\n    // Pop-up\r\n    foundry.utils.mergeObject(settings.popup, formData.popup);\r\n\r\n    // Permissions\r\n    foundry.utils.mergeObject(settings.permissions, formData.permissions);\r\n\r\n    // Token HUD\r\n    foundry.utils.mergeObject(settings.worldHud, formData.worldHud);\r\n\r\n    // Internal Effects\r\n    foundry.utils.mergeObject(settings.internalEffects, formData.internalEffects);\r\n\r\n    // Misc\r\n    foundry.utils.mergeObject(settings, {\r\n      keywordSearch: formData.keywordSearch,\r\n      excludedKeywords: formData.excludedKeywords,\r\n      systemHpPath: formData.systemHpPath?.trim(),\r\n      runSearchOnPath: formData.runSearchOnPath,\r\n      imgurClientId: formData.imgurClientId,\r\n      enableStatusConfig: formData.enableStatusConfig,\r\n      disableNotifs: formData.disableNotifs,\r\n      staticCache: formData.staticCache,\r\n      staticCacheFile: formData.staticCacheFile,\r\n      stackStatusConfig: formData.stackStatusConfig,\r\n      mergeGroup: formData.mergeGroup,\r\n      customImageCategories: (formData.customImageCategories || '')\r\n        .split(',')\r\n        .map((t) => t.trim())\r\n        .filter((t) => t),\r\n      disableEffectIcons: formData.disableEffectIcons,\r\n      displayEffectIconsOnHover: formData.displayEffectIconsOnHover,\r\n      filterEffectIcons: formData.filterEffectIcons,\r\n      hideElevationTooltip: formData.hideElevationTooltip,\r\n      hideTokenBorder: formData.hideTokenBorder,\r\n      filterCustomEffectIcons: formData.filterCustomEffectIcons,\r\n      filterIconList: (formData.filterIconList || '')\r\n        .split(',')\r\n        .map((t) => t.trim())\r\n        .filter((t) => t),\r\n      updateTokenProto: formData.updateTokenProto,\r\n      imgNameContainsDimensions: formData.imgNameContainsDimensions,\r\n      imgNameContainsFADimensions: formData.imgNameContainsFADimensions,\r\n      playVideoOnHover: formData.playVideoOnHover,\r\n      pauseVideoOnHoverOut: formData.pauseVideoOnHoverOut,\r\n      disableImageChangeOnPolymorphed: formData.disableImageChangeOnPolymorphed,\r\n      disableImageUpdateOnNonPrototype: formData.disableImageUpdateOnNonPrototype,\r\n      disableTokenUpdateAnimation: formData.disableTokenUpdateAnimation,\r\n      evaluateOverlayOnHover: formData.evaluateOverlayOnHover,\r\n    });\r\n\r\n    // Global Mappings\r\n    settings.globalMappings = TVA_CONFIG.globalMappings;\r\n\r\n    // Save Settings\r\n    if (this.dummySettings) {\r\n      mergeObjectFix(this.dummySettings, settings, { insertKeys: false });\r\n    } else {\r\n      updateSettings(settings);\r\n    }\r\n  }\r\n}\r\n\r\n// ========================\r\n// v8 support, broken merge\r\n// ========================\r\nexport function mergeObjectFix(\r\n  original,\r\n  other = {},\r\n  {\r\n    insertKeys = true,\r\n    insertValues = true,\r\n    overwrite = true,\r\n    recursive = true,\r\n    inplace = true,\r\n    enforceTypes = false,\r\n  } = {},\r\n  _d = 0\r\n) {\r\n  other = other || {};\r\n  if (!(original instanceof Object) || !(other instanceof Object)) {\r\n    throw new Error('One of original or other are not Objects!');\r\n  }\r\n  const options = { insertKeys, insertValues, overwrite, recursive, inplace, enforceTypes };\r\n\r\n  // Special handling at depth 0\r\n  if (_d === 0) {\r\n    if (!inplace) original = foundry.utils.deepClone(original);\r\n    if (Object.keys(original).some((k) => /\\./.test(k))) original = foundry.utils.expandObject(original);\r\n    if (Object.keys(other).some((k) => /\\./.test(k))) other = foundry.utils.expandObject(other);\r\n  }\r\n\r\n  // Iterate over the other object\r\n  for (let k of Object.keys(other)) {\r\n    const v = other[k];\r\n    if (original.hasOwnProperty(k)) _mergeUpdate(original, k, v, options, _d + 1);\r\n    else _mergeInsertFix(original, k, v, options, _d + 1);\r\n  }\r\n  return original;\r\n}\r\n\r\nfunction _mergeInsertFix(original, k, v, { insertKeys, insertValues } = {}, _d) {\r\n  // Recursively create simple objects\r\n  if (v?.constructor === Object && insertKeys) {\r\n    original[k] = mergeObjectFix({}, v, { insertKeys: true, inplace: true });\r\n    return;\r\n  }\r\n\r\n  // Delete a key\r\n  if (k.startsWith('-=')) {\r\n    delete original[k.slice(2)];\r\n    return;\r\n  }\r\n\r\n  // Insert a key\r\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\r\n  if (canInsert) original[k] = v;\r\n}\r\n\r\nfunction _mergeUpdate(original, k, v, { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {}, _d) {\r\n  const x = original[k];\r\n  const tv = foundry.utils.getType(v);\r\n  const tx = foundry.utils.getType(x);\r\n\r\n  // Recursively merge an inner object\r\n  if (tv === 'Object' && tx === 'Object' && recursive) {\r\n    return mergeObjectFix(\r\n      x,\r\n      v,\r\n      {\r\n        insertKeys: insertKeys,\r\n        insertValues: insertValues,\r\n        overwrite: overwrite,\r\n        inplace: true,\r\n        enforceTypes: enforceTypes,\r\n      },\r\n      _d\r\n    );\r\n  }\r\n\r\n  // Overwrite an existing value\r\n  if (overwrite) {\r\n    if (tx !== 'undefined' && tv !== tx && enforceTypes) {\r\n      throw new Error(`Mismatched data types encountered during object merge.`);\r\n    }\r\n    original[k] = v;\r\n  }\r\n}\r\n","import { toggleTemplateOnSelected } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { BASE_IMAGE_CATEGORIES, uploadTokenImage } from '../scripts/utils.js';\r\nimport { sortMappingsToGroups } from './effectMappingForm.js';\r\nimport { Templates } from './templates.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\n\r\n// Edit overlay configuration as a json string\r\nexport function showOverlayJsonConfigDialog(overlayConfig, callback) {\r\n  const config = foundry.utils.deepClone(overlayConfig || {});\r\n  delete config.effect;\r\n  let content = `<div style=\"height: 300px;\" class=\"form-group stacked command\"><textarea style=\"height: 300px;\" class=\"configJson\">${JSON.stringify(\r\n    config,\r\n    null,\r\n    2\r\n  )}</textarea></div>`;\r\n\r\n  new Dialog({\r\n    title: `Overlay Configuration`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Save',\r\n        callback: (html) => {\r\n          let json = $(html).find('.configJson').val();\r\n          if (json) {\r\n            try {\r\n              json = JSON.parse(json);\r\n            } catch (e) {\r\n              console.warn(`TVA |`, e);\r\n              json = {};\r\n            }\r\n          } else {\r\n            json = {};\r\n          }\r\n          callback(json);\r\n        },\r\n      },\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\n// Change categories assigned to a path\r\nexport async function showPathSelectCategoryDialog(event) {\r\n  event.preventDefault();\r\n  const typesInput = $(event.target).closest('.path-category').find('input');\r\n  const selectedTypes = typesInput.val().split(',');\r\n\r\n  const categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\r\n\r\n  let content = '<div class=\"token-variants-popup-settings\">';\r\n\r\n  // Split into rows of 4\r\n  const splits = [];\r\n  let currSplit = [];\r\n  for (let i = 0; i < categories.length; i++) {\r\n    if (i > 0 && i + 1 != categories.length && i % 4 == 0) {\r\n      splits.push(currSplit);\r\n      currSplit = [];\r\n    }\r\n    currSplit.push(categories[i]);\r\n  }\r\n  if (currSplit.length) splits.push(currSplit);\r\n\r\n  for (const split of splits) {\r\n    content += '<header class=\"table-header flexrow\">';\r\n    for (const type of split) {\r\n      content += `<label>${type}</label>`;\r\n    }\r\n    content += '</header><ul class=\"setting-list\"><li class=\"setting form-group\"><div class=\"form-fields\">';\r\n    for (const type of split) {\r\n      content += `<input class=\"category\" type=\"checkbox\" name=\"${type}\" data-dtype=\"Boolean\" ${\r\n        selectedTypes.includes(type) ? 'checked' : ''\r\n      }>`;\r\n    }\r\n    content += '</div></li></ul>';\r\n  }\r\n  content += '</div>';\r\n\r\n  new Dialog({\r\n    title: `Image Categories/Filters`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Apply',\r\n        callback: (html) => {\r\n          const types = [];\r\n          $(html)\r\n            .find('.category')\r\n            .each(function () {\r\n              if ($(this).is(':checked')) {\r\n                types.push($(this).attr('name'));\r\n              }\r\n            });\r\n          typesInput.val(types.join(','));\r\n        },\r\n      },\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\n// Change configs assigned to a path\r\nexport async function showPathSelectConfigForm(event) {\r\n  event.preventDefault();\r\n  const configInput = $(event.target).closest('.path-config').find('input');\r\n  let config = {};\r\n  try {\r\n    config = JSON.parse(configInput.val());\r\n  } catch (e) {}\r\n\r\n  const token = new TokenDocument();\r\n  new TokenCustomConfig(\r\n    token,\r\n    {},\r\n    null,\r\n    null,\r\n    (conf) => {\r\n      if (!conf) conf = {};\r\n      if (conf.flags == null || foundry.utils.isEmpty(conf.flags)) delete conf.flags;\r\n      configInput.val(JSON.stringify(conf));\r\n      const cog = configInput.siblings('.select-config');\r\n      if (foundry.utils.isEmpty(conf)) cog.removeClass('active');\r\n      else cog.addClass('active');\r\n    },\r\n    config\r\n  ).render(true);\r\n}\r\n\r\nexport async function showTokenCaptureDialog(token) {\r\n  if (!token) return;\r\n  let content = `<form>\r\n<div class=\"form-group\">\r\n  <label>Image Name</label>\r\n  <input type=\"text\" name=\"name\" value=\"${token.name}\">\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Image Path</label>\r\n    <div class=\"form-fields\">\r\n      <input type=\"text\" name=\"path\" value=\"modules/token-variants/\">\r\n      <button type=\"button\" class=\"file-picker\" data-type=\"folder\" data-target=\"path\" title=\"Browse Folders\" tabindex=\"-1\">\r\n        <i class=\"fas fa-file-import fa-fw\"></i>\r\n      </button>\r\n    </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Width <span class=\"units\">(pixels)</span></label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"number\" step=\"1\" name=\"width\" value=\"${token.mesh.texture.width}\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Height <span class=\"units\">(pixels)</span></label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"number\" step=\"1\" name=\"height\" value=\"${token.mesh.texture.height}\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group slim\">\r\n  <label>Scale</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"number\" step=\"any\" name=\"scale\" value=\"3\">\r\n  </div>\r\n</div>\r\n</form>`;\r\n\r\n  new Dialog({\r\n    title: `Save Token/Overlay Image`,\r\n    content: content,\r\n    buttons: {\r\n      yes: {\r\n        icon: \"<i class='fas fa-save'></i>\",\r\n        label: 'Save',\r\n        callback: (html) => {\r\n          const options = {};\r\n          $(html)\r\n            .find('[name]')\r\n            .each(function () {\r\n              let val = parseFloat(this.value);\r\n              if (isNaN(val)) val = this.value;\r\n              options[this.name] = val;\r\n            });\r\n          uploadTokenImage(token, options);\r\n        },\r\n      },\r\n    },\r\n    render: (html) => {\r\n      html.find('.file-picker').click(() => {\r\n        new foundry.applications.apps.FilePicker.implementation({\r\n          type: 'folder',\r\n          current: html.find('[name=\"path\"]').val(),\r\n          callback: (path) => {\r\n            html.find('[name=\"path\"]').val(path);\r\n          },\r\n        }).render();\r\n      });\r\n    },\r\n    default: 'yes',\r\n  }).render(true);\r\n}\r\n\r\nexport function showMappingSelectDialog(\r\n  mappings,\r\n  { title1 = 'Mappings', title2 = 'Select Mappings', buttonTitle = 'Confirm', callback = null } = {}\r\n) {\r\n  if (!mappings || !mappings.length) return;\r\n\r\n  let content = `<form style=\"overflow-y: scroll; height:400px;\"><h2>${title2}</h2>`;\r\n\r\n  const [_, mappingGroups] = sortMappingsToGroups(mappings);\r\n  for (const [group, obj] of Object.entries(mappingGroups)) {\r\n    if (obj.list.length) {\r\n      content += `<h4 style=\"text-align:center;\"><b>${group}</b></h4>`;\r\n      for (const mapping of obj.list) {\r\n        content += `\r\n        <div class=\"form-group\">\r\n          <label>${mapping.label}</label>\r\n          <div class=\"form-fields\">\r\n              <input type=\"checkbox\" name=\"${mapping.id}\" data-dtype=\"Boolean\">\r\n          </div>\r\n        </div>\r\n        `;\r\n      }\r\n    }\r\n  }\r\n\r\n  content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\r\n\r\n  new Dialog({\r\n    title: title1,\r\n    content: content,\r\n    buttons: {\r\n      Ok: {\r\n        label: buttonTitle,\r\n        callback: async (html) => {\r\n          if (!callback) return;\r\n          const selectedMappings = [];\r\n          html.find('input[type=\"checkbox\"]').each(function () {\r\n            if (this.checked) {\r\n              const mapping = mappings.find((m) => m.id === this.name);\r\n              if (mapping) {\r\n                const cMapping = foundry.utils.deepClone(mapping);\r\n                selectedMappings.push(cMapping);\r\n                delete cMapping.targetActors;\r\n              }\r\n            }\r\n          });\r\n          callback(selectedMappings);\r\n        },\r\n      },\r\n    },\r\n    close: () => callback(null),\r\n    render: (html) => {\r\n      html.find('.select-all').click(() => {\r\n        html.find('input[type=\"checkbox\"]').prop('checked', true);\r\n      });\r\n    },\r\n  }).render(true);\r\n}\r\n\r\nexport function showUserTemplateCreateDialog(mappings) {\r\n  let content = `\r\n<div class=\"form-group\">\r\n  <label>Template Name</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"templateName\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Hover Text (optional)</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"templateHint\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>\r\n<div class=\"form-group\">\r\n  <label>Hover Image (optional)</label>\r\n  <div class=\"form-fields\">\r\n    <input type=\"text\" name=\"img\" data-dtype=\"String\" value=\"\">\r\n  </div>\r\n</div>`;\r\n\r\n  let dialog;\r\n  dialog = new Dialog({\r\n    title: 'Mapping Templates',\r\n    content,\r\n    buttons: {\r\n      create: {\r\n        label: 'Create Template',\r\n        callback: (html) => {\r\n          const name = html.find('[name=\"templateName\"]').val().trim();\r\n          const hint = html.find('[name=\"templateHint\"]').val().trim();\r\n          const img = html.find('[name=\"img\"]').val().trim();\r\n          if (name.trim()) {\r\n            TVA_CONFIG.templateMappings.push({\r\n              id: foundry.utils.randomID(),\r\n              name,\r\n              hint,\r\n              img,\r\n              mappings: foundry.utils.deepClone(mappings),\r\n            });\r\n            updateSettings({ templateMappings: TVA_CONFIG.templateMappings });\r\n          }\r\n        },\r\n      },\r\n      cancel: {\r\n        label: 'Cancel',\r\n      },\r\n    },\r\n    default: 'cancel',\r\n  });\r\n  dialog.render(true);\r\n}\r\n\r\nexport function toggleTemplateDialog() {\r\n  new Templates({ callback: (templateName, mappings) => toggleTemplateOnSelected(templateName, mappings) }).render(\r\n    true\r\n  );\r\n}\r\n","export default class EditJsonConfig extends FormApplication {\r\n  constructor(config, callback) {\r\n    super({}, {});\r\n    this.config = config;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-config-json-edit',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configJsonEdit.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Edit Token Configuration',\r\n      width: 400,\r\n      height: 380,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.hasConfig = this.config != null && Object.keys(this.config).length !== 0;\r\n    data.config = JSON.stringify(data.hasConfig ? this.config : {}, null, 2);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.on('input', '.command textarea', this._validateJSON.bind(this));\r\n    // Override 'Tab' key to insert spaces\r\n    html.on('keydown', '.command textarea', function (e) {\r\n      if (e.key === 'Tab' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var start = this.selectionStart;\r\n        var end = this.selectionEnd;\r\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\r\n        this.selectionStart = this.selectionEnd = start + 2;\r\n        return false;\r\n      }\r\n    });\r\n\r\n    html.find('.remove').click(this._onRemove.bind(this));\r\n    html.find('.format').click(this._onFormat.bind(this));\r\n  }\r\n\r\n  async _validateJSON(event) {\r\n    const controls = $(event.target).closest('form').find('button[type=\"submit\"], button.format');\r\n    try {\r\n      this.config = JSON.parse(event.target.value);\r\n      this.config = foundry.utils.expandObject(this.config);\r\n      this.flag = this.config.flag;\r\n      controls.prop('disabled', false);\r\n    } catch (e) {\r\n      controls.prop('disabled', true);\r\n    }\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    this.config = {};\r\n    this.submit();\r\n  }\r\n\r\n  async _onFormat(event) {\r\n    $(event.target).closest('form').find('textarea[name=\"config\"]').val(JSON.stringify(this.config, null, 2));\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (this.callback) this.callback(this.config);\r\n  }\r\n}\r\n","export default class EditScriptConfig extends FormApplication {\r\n  constructor(script, callback) {\r\n    super({}, {});\r\n    this.script = script;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-config-script-edit',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/configScriptEdit.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Scripts',\r\n      width: 640,\r\n      height: 640,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    const script = this.script ? this.script : {};\r\n    data.hasScript = !foundry.utils.isEmpty(script);\r\n    data.onApply = script.onApply;\r\n    data.onRemove = script.onRemove;\r\n    data.macroOnApply = script.macroOnApply;\r\n    data.macroOnRemove = script.macroOnRemove;\r\n\r\n    data.tmfxPreset = script.tmfxPreset;\r\n    data.tmfxActive = game.modules.get('tokenmagic')?.active;\r\n    if (data.tmfxActive) {\r\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\r\n    }\r\n\r\n    data.ceActive = game.modules.get('dfreds-convenient-effects')?.active;\r\n    if (data.ceActive) {\r\n      data.ceEffect = script.ceEffect ?? { apply: true, remove: true };\r\n      data.ceEffects = game.dfreds.effectInterface.findEffects().map((ef) => ef.name);\r\n    }\r\n\r\n    data.macros = game.macros.map((m) => m.name);\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    // Override 'Tab' key to insert spaces\r\n    html.on('keydown', '.command textarea', function (e) {\r\n      if (e.key === 'Tab' && !e.shiftKey) {\r\n        e.preventDefault();\r\n        var start = this.selectionStart;\r\n        var end = this.selectionEnd;\r\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\r\n        this.selectionStart = this.selectionEnd = start + 2;\r\n        return false;\r\n      }\r\n    });\r\n\r\n    html.find('.remove').click(this._onRemove.bind(this));\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    if (this.callback) this.callback(null);\r\n    this.close();\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    formData = foundry.utils.expandObject(formData);\r\n    ['onApply', 'onRemove', 'macroOnApply', 'macroOnRemove'].forEach((k) => {\r\n      formData[k] = formData[k].trim();\r\n    });\r\n    if (formData.ceEffect?.name) formData.ceEffect.name = formData.ceEffect.name.trim();\r\n\r\n    if (\r\n      !formData.onApply &&\r\n      !formData.onRemove &&\r\n      !formData.tmfxPreset &&\r\n      !formData.ceEffect.name &&\r\n      !formData.macroOnApply &&\r\n      !formData.macroOnRemove\r\n    ) {\r\n      if (this.callback) this.callback(null);\r\n    } else {\r\n      if (this.callback) this.callback(formData);\r\n    }\r\n  }\r\n}\r\n","import { showArtSelect } from '../token-variants.mjs';\r\nimport { SEARCH_TYPE, getFileName, isVideo, keyPressed, mergeMappings } from '../scripts/utils.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\nimport { TVA_CONFIG, getFlagMappings, migrateMappings, updateSettings } from '../scripts/settings.js';\r\nimport EditJsonConfig from './configJsonEdit.js';\r\nimport EditScriptConfig from './configScriptEdit.js';\r\nimport { OverlayConfig } from './overlayConfig.js';\r\nimport { showMappingSelectDialog, showOverlayJsonConfigDialog, showTokenCaptureDialog } from './dialogs.js';\r\nimport { DEFAULT_ACTIVE_EFFECT_CONFIG } from '../scripts/models.js';\r\nimport { updateWithEffectMapping } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { drawOverlays } from '../scripts/token/overlay.js';\r\nimport { Templates } from './templates.js';\r\n\r\n// Persist group toggles across forms\r\nlet TOGGLED_GROUPS;\r\nconst NO_IMAGE = 'modules\\\\token-variants\\\\img\\\\empty.webp';\r\n\r\nexport default class EffectMappingForm extends FormApplication {\r\n  constructor(token, { globalMappings = false, callback = null, createMapping = null } = {}) {\r\n    super({}, {});\r\n\r\n    this.token = token;\r\n    if (globalMappings) {\r\n      this.globalMappings = foundry.utils.deepClone(TVA_CONFIG.globalMappings).filter(Boolean);\r\n    }\r\n    if (!globalMappings) this.objectToFlag = game.actors.get(token.actorId);\r\n    this.callback = callback;\r\n    TOGGLED_GROUPS = game.settings.get('token-variants', 'effectMappingToggleGroups') || {\r\n      Default: true,\r\n    };\r\n    this.createMapping = createMapping;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-active-effect-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/effectMappingForm.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      width: 1020,\r\n      height: 'auto',\r\n      scrollY: ['ol.token-variant-table'],\r\n    });\r\n  }\r\n\r\n  get title() {\r\n    let scope = 'GLOBAL';\r\n    if (!this.globalMappings) scope = this.objectToFlag.name;\r\n    return `[${scope}] Mappings`;\r\n  }\r\n\r\n  _processConfig(mapping) {\r\n    if (!mapping.config) mapping.config = {};\r\n    let hasTokenConfig = Object.keys(mapping.config).filter((k) => mapping.config[k]).length;\r\n    if (mapping.config.flags) hasTokenConfig--;\r\n    if (mapping.config.tv_script) hasTokenConfig--;\r\n\r\n    return {\r\n      id: mapping.id || foundry.utils.randomID(8),\r\n      label: mapping.label,\r\n      expression: mapping.expression,\r\n      codeExp: mapping.codeExp,\r\n      hasCodeExp: Boolean(mapping.codeExp),\r\n      highlightedExpression: highlightOperators(mapping.expression),\r\n      imgName: mapping.imgName,\r\n      imgSrc: mapping.imgSrc,\r\n      isVideo: mapping.imgSrc ? isVideo(mapping.imgSrc) : false,\r\n      priority: mapping.priority,\r\n      hasConfig: mapping.config ? !foundry.utils.isEmpty(mapping.config) : false,\r\n      hasScript: mapping.config && mapping.config.tv_script,\r\n      hasTokenConfig: hasTokenConfig > 0,\r\n      config: mapping.config,\r\n      overlay: mapping.overlay,\r\n      alwaysOn: mapping.alwaysOn,\r\n      tokens: mapping.tokens,\r\n      tokensString: mapping.tokens?.join(',') ?? '',\r\n      tokenIDs: mapping.tokens?.length\r\n        ? 'Assigned Tokens\\n' + mapping.tokens.join('\\n') + '\\n\\n[CLICK TO UNASSIGN]'\r\n        : '',\r\n      disabled: mapping.disabled,\r\n      overlayConfig: mapping.overlayConfig,\r\n      targetActors: mapping.targetActors,\r\n      group: mapping.group,\r\n      parentID: mapping.overlayConfig?.parentID,\r\n    };\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.NO_IMAGE = NO_IMAGE;\r\n\r\n    let mappings = [];\r\n    if (this.object.mappings) {\r\n      mappings = this.object.mappings.map(this._processConfig);\r\n    } else {\r\n      const effectMappings = this.globalMappings ?? getFlagMappings(this.objectToFlag);\r\n      mappings = effectMappings.map(this._processConfig);\r\n\r\n      if (this.createMapping && !effectMappings.find((m) => m.expression === this.createMapping.expression)) {\r\n        mappings.push(this._processConfig(this._getNewEffectConfig(this.createMapping)));\r\n      }\r\n      this.createMapping = null;\r\n    }\r\n\r\n    mappings = mappings.sort((m1, m2) => {\r\n      if (!m1.label && m2.label) return -1;\r\n      else if (m1.label && !m2.label) return 1;\r\n\r\n      if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\r\n      else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID) return 1;\r\n\r\n      let priorityDiff = m1.priority - m2.priority;\r\n      if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\r\n      return priorityDiff;\r\n    });\r\n\r\n    const [sMappings, groupedMappings] = sortMappingsToGroups(mappings);\r\n    data.groups = Object.keys(groupedMappings);\r\n\r\n    this.object.mappings = sMappings;\r\n    data.groupedMappings = groupedMappings;\r\n    data.global = Boolean(this.globalMappings);\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.delete-mapping').click(this._onRemove.bind(this));\r\n    html.find('.clone-mapping').click(this._onClone.bind(this));\r\n    html.find('.create-mapping').click(this._onCreate.bind(this));\r\n    html.find('.save-mappings').click(this._onSaveMappings.bind(this));\r\n    html.find('.save-mappings-close').click(this._onSaveMappingsClose.bind(this));\r\n    if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\r\n      html.find('.mapping-image img').click(this._onImageClick.bind(this));\r\n      html.find('.mapping-image img').mousedown(this._onImageMouseDown.bind(this));\r\n      html.find('.mapping-image video').click(this._onImageClick.bind(this));\r\n      html.find('.mapping-target.btn').click(this._onConfigureApplicableActors.bind(this));\r\n    }\r\n    html.find('.mapping-image img').contextmenu(this._onImageRightClick.bind(this));\r\n    html.find('.mapping-image video').contextmenu(this._onImageRightClick.bind(this));\r\n    html.find('.mapping-config i.config').click(this._onConfigClick.bind(this));\r\n    html.find('.mapping-config i.config-edit').click(this._onConfigEditClick.bind(this));\r\n    html.find('.mapping-config i.config-script').click(this._onConfigScriptClick.bind(this));\r\n    html.find('.mapping-overlay i.overlay-config').click(this._onOverlayConfigClick.bind(this));\r\n    html.on('contextmenu', '.mapping-overlay i.overlay-config', this._onOverlayConfigRightClick.bind(this));\r\n    html.find('.mapping-overlay input').on('change', this._onOverlayChange).trigger('change');\r\n    html.find('.div-input').on('input paste focus', this._onExpressionChange);\r\n    const app = this;\r\n    html\r\n      .find('.group-toggle > a')\r\n      .on('click', this._onGroupToggle.bind(this))\r\n      .each(function () {\r\n        const group = $(this).closest('.group-toggle');\r\n        const groupName = group.data('group');\r\n        if (!TOGGLED_GROUPS[groupName]) {\r\n          $(this).trigger('click');\r\n        }\r\n      });\r\n    this.setPosition({ width: 1020 });\r\n    html.find('.mapping-disable > input').on('change', this._onDisable.bind(this));\r\n    html.find('.group-disable > a').on('click', this._onGroupDisable.bind(this));\r\n    html.find('.group-delete').on('click', this._onGroupDelete.bind(this));\r\n    html.find('.mapping-group > input').on('change', this._onGroupChange.bind(this));\r\n    html.find('.expression-switch').on('click', this._onExpressionSwitch.bind(this));\r\n    html\r\n      .find('.expression-code textarea')\r\n      .focus((event) => $(event.target).animate({ height: '10em' }, 500, () => this.setPosition()))\r\n      .focusout((event) =>\r\n        $(event.target).animate({ height: '1em' }, 500, () => {\r\n          if (this._state === Application.RENDER_STATES.RENDERED) this.setPosition();\r\n        })\r\n      );\r\n    html.find('.tokens').on('click', this._onTokensRemove.bind(this));\r\n  }\r\n\r\n  async _onTokensRemove(event) {\r\n    await this._onSubmit(event);\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    mapping.tokens = undefined;\r\n\r\n    this.render();\r\n  }\r\n\r\n  _onExpressionSwitch(event) {\r\n    const container = $(event.target).closest('.expression-container');\r\n    const divInput = container.find('.div-input');\r\n    const codeExp = container.find('.expression-code');\r\n\r\n    if (codeExp.hasClass('hidden')) {\r\n      codeExp.removeClass('hidden');\r\n      divInput.addClass('hidden');\r\n    } else {\r\n      codeExp.addClass('hidden');\r\n      divInput.removeClass('hidden');\r\n    }\r\n  }\r\n\r\n  async _onDisable(event) {\r\n    const groupName = $(event.target).closest('.table-row').data('group');\r\n    const disableGroupToggle = $(event.target)\r\n      .closest('.token-variant-table')\r\n      .find(`.group-disable[data-group=\"${groupName}\"]`);\r\n\r\n    const checkboxes = $(event.target)\r\n      .closest('.token-variant-table')\r\n      .find(`[data-group=\"${groupName}\"] > .mapping-disable`);\r\n    const numChecked = checkboxes.find('input:checked').length;\r\n\r\n    if (checkboxes.length !== numChecked) {\r\n      disableGroupToggle.addClass('active');\r\n    } else disableGroupToggle.removeClass('active');\r\n  }\r\n\r\n  async _onGroupDisable(event) {\r\n    const group = $(event.target).closest('.group-disable');\r\n    const groupName = group.data('group');\r\n    const chks = $(event.target).closest('form').find(`[data-group=\"${groupName}\"]`).find('.mapping-disable > input');\r\n\r\n    if (group.hasClass('active')) {\r\n      group.removeClass('active');\r\n      chks.prop('checked', true);\r\n    } else {\r\n      group.addClass('active');\r\n      chks.prop('checked', false);\r\n    }\r\n  }\r\n\r\n  async _onGroupDelete(event) {\r\n    const group = $(event.target).closest('.group-delete');\r\n    const groupName = group.data('group');\r\n    await this._onSubmit(event);\r\n    this.object.mappings = this.object.mappings.filter((m) => m.group !== groupName);\r\n    this.render();\r\n  }\r\n\r\n  async _onGroupChange(event) {\r\n    const input = $(event.target);\r\n    let group = input.val().trim();\r\n    if (!group) group = 'Default';\r\n    input.val(group);\r\n\r\n    await this._onSubmit(event);\r\n    this.render();\r\n  }\r\n\r\n  _onGroupToggle(event) {\r\n    const group = $(event.target).closest('.group-toggle');\r\n    const groupName = group.data('group');\r\n    const form = $(event.target).closest('form');\r\n    form.find(`li[data-group=\"${groupName}\"]`).toggle();\r\n    if (group.hasClass('active')) {\r\n      group.removeClass('active');\r\n      group.find('i').addClass('fa-rotate-180');\r\n      TOGGLED_GROUPS[groupName] = false;\r\n    } else {\r\n      group.addClass('active');\r\n      group.find('i').removeClass('fa-rotate-180');\r\n      TOGGLED_GROUPS[groupName] = true;\r\n    }\r\n    game.settings.set('token-variants', 'effectMappingToggleGroups', TOGGLED_GROUPS);\r\n    this.setPosition({ height: 'auto' });\r\n  }\r\n\r\n  async _onExpressionChange(event) {\r\n    var el = event.target;\r\n\r\n    // Update the hidden input field so that the text entered in the div will be submitted via the form\r\n    $(el).siblings('input').val(event.target.innerText);\r\n\r\n    // The rest of the function is to handle operator highlighting and management of the caret position\r\n\r\n    if (!el.childNodes.length) return;\r\n\r\n    // Calculate the true/total caret offset within the div\r\n    const sel = window.getSelection();\r\n    const focusNode = sel.focusNode;\r\n    let offset = sel.focusOffset;\r\n\r\n    for (const ch of el.childNodes) {\r\n      if (ch === focusNode || ch.childNodes[0] === focusNode) break;\r\n      offset += ch.nodeName === 'SPAN' ? ch.innerText.length : ch.length;\r\n    }\r\n\r\n    // Highlight the operators and update the div\r\n    let text = highlightOperators(event.target.innerText);\r\n    $(event.target).html(text);\r\n\r\n    // Set the new caret position with the div\r\n    setCaretPosition(el, offset);\r\n  }\r\n\r\n  async _onOverlayChange(event) {\r\n    if (event.target.checked) {\r\n      $(event.target).siblings('a').show();\r\n    } else {\r\n      $(event.target).siblings('a').hide();\r\n    }\r\n  }\r\n\r\n  async _onOverlayConfigClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new OverlayConfig(\r\n      mapping.overlayConfig,\r\n      (config) => {\r\n        mapping.overlayConfig = config;\r\n        const gear = $(li).find('.mapping-overlay > a');\r\n        if (config?.parentID && config.parentID !== 'TOKEN') {\r\n          gear.addClass('child');\r\n          gear.attr('title', 'Child Of: ' + config.parentID);\r\n        } else {\r\n          gear.removeClass('child');\r\n          gear.attr('title', '');\r\n        }\r\n      },\r\n      this.token,\r\n      { mapping, global: Boolean(this.globalMappings), actor: this.objectToFlag }\r\n    ).render(true);\r\n  }\r\n\r\n  async _onOverlayConfigRightClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    showOverlayJsonConfigDialog(mapping.overlayConfig, (config) => (mapping.overlayConfig = config));\r\n  }\r\n\r\n  async _toggleActiveControls(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    const tokenConfig = $(event.target).closest('.mapping-config').find('.config');\r\n    const configEdit = $(event.target).closest('.mapping-config').find('.config-edit');\r\n    const scriptEdit = $(event.target).closest('.mapping-config').find('.config-script');\r\n\r\n    let hasTokenConfig = Object.keys(mapping.config).filter((k) => mapping.config[k]).length;\r\n    if (mapping.config.flags) hasTokenConfig--;\r\n    if (mapping.config.tv_script) hasTokenConfig--;\r\n\r\n    if (hasTokenConfig) tokenConfig.addClass('active');\r\n    else tokenConfig.removeClass('active');\r\n\r\n    if (Object.keys(mapping.config).filter((k) => mapping.config[k]).length) configEdit.addClass('active');\r\n    else configEdit.removeClass('active');\r\n\r\n    if (mapping.config.tv_script) scriptEdit.addClass('active');\r\n    else scriptEdit.removeClass('active');\r\n  }\r\n\r\n  async _onConfigScriptClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new EditScriptConfig(mapping.config?.tv_script, (script) => {\r\n      if (!mapping.config) mapping.config = {};\r\n      if (script) mapping.config.tv_script = script;\r\n      else delete mapping.config.tv_script;\r\n      this._toggleActiveControls(event);\r\n    }).render(true);\r\n  }\r\n\r\n  async _onConfigEditClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new EditJsonConfig(mapping.config, (config) => {\r\n      mapping.config = config;\r\n      this._toggleActiveControls(event);\r\n    }).render(true);\r\n  }\r\n\r\n  async _onConfigClick(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n    new TokenCustomConfig(\r\n      this.token,\r\n      {},\r\n      null,\r\n      null,\r\n      (config) => {\r\n        if (!config || foundry.utils.isEmpty(config)) {\r\n          config = {};\r\n          config.tv_script = mapping.config.tv_script;\r\n          config.flags = mapping.config.flags;\r\n        }\r\n        mapping.config = config;\r\n        this._toggleActiveControls(event);\r\n      },\r\n      mapping.config ? mapping.config : {}\r\n    ).render(true);\r\n  }\r\n\r\n  _removeImage(event) {\r\n    const vid = $(event.target).closest('.mapping-image').find('video');\r\n    const img = $(event.target).closest('.mapping-image').find('img');\r\n    vid.add(img).attr('src', '').attr('title', '');\r\n    vid.hide();\r\n    img.show();\r\n    img.attr('src', NO_IMAGE);\r\n    $(event.target).siblings('.imgSrc').val('');\r\n    $(event.target).siblings('.imgName').val('');\r\n  }\r\n\r\n  async _onImageMouseDown(event) {\r\n    if (event.which === 2) {\r\n      this._removeImage(event);\r\n    }\r\n  }\r\n\r\n  async _onImageClick(event) {\r\n    if (keyPressed('config')) {\r\n      this._removeImage(event);\r\n      return;\r\n    }\r\n\r\n    let search = this.token.name;\r\n    if (search === 'Unknown') {\r\n      const li = event.currentTarget.closest('.table-row');\r\n      const mapping = this.object.mappings[li.dataset.index];\r\n      search = mapping.label;\r\n    }\r\n\r\n    showArtSelect(search, {\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n      callback: (imgSrc, imgName) => {\r\n        const vid = $(event.target).closest('.mapping-image').find('video');\r\n        const img = $(event.target).closest('.mapping-image').find('img');\r\n        vid.add(img).attr('src', imgSrc).attr('title', imgName);\r\n        if (isVideo(imgSrc)) {\r\n          vid.show();\r\n          img.hide();\r\n        } else {\r\n          vid.hide();\r\n          img.show();\r\n        }\r\n        $(event.target).siblings('.imgSrc').val(imgSrc);\r\n        $(event.target).siblings('.imgName').val(imgName);\r\n      },\r\n    });\r\n  }\r\n\r\n  async _onImageRightClick(event) {\r\n    if (keyPressed('config')) {\r\n      this._removeImage(event);\r\n      return;\r\n    }\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    new foundry.applications.apps.FilePicker.implementation({\r\n      type: 'imagevideo',\r\n      current: mapping.imgSrc,\r\n      callback: (path) => {\r\n        const vid = $(event.target).closest('.mapping-image').find('video');\r\n        const img = $(event.target).closest('.mapping-image').find('img');\r\n        vid.add(img).attr('src', path).attr('title', getFileName(path));\r\n        if (isVideo(path)) {\r\n          vid.show();\r\n          img.hide();\r\n        } else {\r\n          vid.hide();\r\n          img.show();\r\n        }\r\n        $(event.target).siblings('.imgSrc').val(path);\r\n        $(event.target).siblings('.imgName').val(getFileName(path));\r\n      },\r\n    }).render();\r\n  }\r\n\r\n  async _onRemove(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    const li = event.currentTarget.closest('.table-row');\r\n    this.object.mappings.splice(li.dataset.index, 1);\r\n    this.render();\r\n  }\r\n\r\n  async _onClone(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const clone = foundry.utils.deepClone(this.object.mappings[li.dataset.index]);\r\n    clone.label = clone.label + ' - Copy';\r\n    clone.id = foundry.utils.randomID(8);\r\n    this.object.mappings.push(clone);\r\n    this.render();\r\n  }\r\n\r\n  async _onCreate(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    this.object.mappings.push(this._getNewEffectConfig());\r\n    this.render();\r\n  }\r\n\r\n  _getNewEffectConfig({ label = '', expression = '' } = {}) {\r\n    // if (textOverlay) {\r\n    //   TOGGLED_GROUPS['Text Overlays'] = true;\r\n    //   return {\r\n    //     id: foundry.utils.randomID(8),\r\n    //     label: label,\r\n    //     expression: label,\r\n    //     highlightedExpression: highlightOperators(label),\r\n    //     imgName: '',\r\n    //     imgSrc: '',\r\n    //     priority: 50,\r\n    //     overlay: false,\r\n    //     alwaysOn: false,\r\n    //     disabled: false,\r\n    //     group: 'Text Overlays',\r\n    //     overlay: true,\r\n    //     overlayConfig: mergeObject(\r\n    //       DEFAULT_OVERLAY_CONFIG,\r\n    //       {\r\n    //         img: '',\r\n    //         linkScale: false,\r\n    //         linkRotation: false,\r\n    //         linkMirror: false,\r\n    //         offsetY: 0.5 + Math.round(Math.random() * 0.3 * 100) / 100,\r\n    //         offsetX: 0,\r\n    //         scaleX: 0.68,\r\n    //         scaleY: 0.68,\r\n    //         text: {\r\n    //           text: '{{effect}}',\r\n    //           fontFamily: CONFIG.defaultFontFamily,\r\n    //           fontSize: 36,\r\n    //           fill: new Color(Math.round(Math.random() * 16777215)).toString(),\r\n    //           stroke: '#000000',\r\n    //           strokeThickness: 2,\r\n    //           dropShadow: false,\r\n    //           curve: {\r\n    //             radius: 160,\r\n    //             invert: false,\r\n    //           },\r\n    //         },\r\n    //         animation: {\r\n    //           rotate: true,\r\n    //           duration: 10000 + Math.round(Math.random() * 14000) + 10000,\r\n    //           clockwise: true,\r\n    //         },\r\n    //       },\r\n    //       { inplace: false }\r\n    //     ),\r\n    //   };\r\n    // } else {\r\n    TOGGLED_GROUPS['Default'] = true;\r\n    return foundry.utils.mergeObject(foundry.utils.deepClone(DEFAULT_ACTIVE_EFFECT_CONFIG), {\r\n      label,\r\n      expression,\r\n      id: foundry.utils.randomID(8),\r\n    });\r\n    // }\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n\r\n    buttons.unshift({\r\n      label: 'Export',\r\n      class: 'token-variants-export',\r\n      icon: 'fas fa-file-export',\r\n      onclick: (ev) => this._exportConfigs(ev),\r\n    });\r\n    buttons.unshift({\r\n      label: 'Import',\r\n      class: 'token-variants-import',\r\n      icon: 'fas fa-file-import',\r\n      onclick: (ev) => this._importConfigs(ev),\r\n    });\r\n\r\n    buttons.unshift({\r\n      label: 'Templates',\r\n      class: 'token-variants-templates',\r\n      icon: 'fa-solid fa-book',\r\n      onclick: async (ev) => {\r\n        new Templates({\r\n          mappings: this.globalMappings ?? getFlagMappings(this.objectToFlag),\r\n          callback: (templateName, mappings) => {\r\n            this._insertMappings(ev, mappings);\r\n          },\r\n        }).render(true);\r\n      },\r\n    });\r\n\r\n    if (this.globalMappings) return buttons;\r\n\r\n    buttons.unshift({\r\n      label: 'Copy Global Config',\r\n      class: 'token-variants-copy-global',\r\n      icon: 'fas fa-globe',\r\n      onclick: (ev) => this._copyGlobalConfig(ev),\r\n    });\r\n    buttons.unshift({\r\n      label: 'Open Global',\r\n      class: 'token-variants-open-global',\r\n      icon: 'fas fa-globe',\r\n      onclick: async (ev) => {\r\n        await this.close();\r\n        new EffectMappingForm(this.token, { globalMappings: true }).render(true);\r\n      },\r\n    });\r\n\r\n    buttons.unshift({\r\n      label: '',\r\n      class: 'token-variants-print-token',\r\n      icon: 'fa fa-print',\r\n      onclick: () => showTokenCaptureDialog(canvas.tokens.get(this.token._id)),\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  async _exportConfigs(event) {\r\n    let filename = '';\r\n\r\n    let mappings = await new Promise((resolve) => {\r\n      showMappingSelectDialog(this.globalMappings ?? getFlagMappings(this.objectToFlag), { callback: resolve });\r\n    });\r\n\r\n    if (mappings && !foundry.utils.isEmpty(mappings)) {\r\n      if (this.globalMappings) {\r\n        filename = 'token-variants-global-mappings.json';\r\n      } else {\r\n        let actorName = this.objectToFlag.name ?? 'Actor';\r\n        actorName = actorName.replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n        filename = 'token-variants-' + actorName + '.json';\r\n      }\r\n      saveDataToFile(JSON.stringify({ globalMappings: mappings }, null, 2), 'text/json', filename);\r\n    }\r\n  }\r\n\r\n  async _importConfigs(event) {\r\n    const content = await foundry.applications.handlebars.renderTemplate('templates/apps/import-data.html', {\r\n      entity: 'token-variants',\r\n      name: 'settings',\r\n    });\r\n    let dialog = new Promise((resolve, reject) => {\r\n      new Dialog(\r\n        {\r\n          title: 'Import Effect Configurations',\r\n          content: content,\r\n          buttons: {\r\n            import: {\r\n              icon: '<i class=\"fas fa-file-import\"></i>',\r\n              label: game.i18n.localize('token-variants.common.import'),\r\n              callback: (html) => {\r\n                const form = html.find('form')[0];\r\n                if (!form.data.files.length) return ui.notifications?.error('You did not upload a data file!');\r\n                readTextFromFile(form.data.files[0]).then((json) => {\r\n                  json = JSON.parse(json);\r\n                  if (!json || !('globalMappings' in json)) {\r\n                    return ui.notifications?.error('No mappings found within the file!');\r\n                  }\r\n\r\n                  this._insertMappings(event, migrateMappings(json.globalMappings));\r\n                  resolve(true);\r\n                });\r\n              },\r\n            },\r\n            no: {\r\n              icon: '<i class=\"fas fa-times\"></i>',\r\n              label: 'Cancel',\r\n              callback: (html) => resolve(false),\r\n            },\r\n          },\r\n          default: 'import',\r\n        },\r\n        {\r\n          width: 400,\r\n        }\r\n      ).render(true);\r\n    });\r\n    return await dialog;\r\n  }\r\n\r\n  _copyGlobalConfig(event) {\r\n    showMappingSelectDialog(TVA_CONFIG.globalMappings, {\r\n      title1: 'Global Mappings',\r\n      title2: 'Select Mappings to Copy:',\r\n      buttonTitle: 'Copy',\r\n      callback: (mappings) => {\r\n        if (mappings) this._insertMappings(event, mappings);\r\n      },\r\n    });\r\n  }\r\n\r\n  async _insertMappings(event, mappings) {\r\n    const cMappings = foundry.utils.deepClone(mappings).map(this._processConfig);\r\n    await this._onSubmit(event);\r\n    mergeMappings(cMappings, this.object.mappings);\r\n    this.render();\r\n  }\r\n\r\n  _onConfigureApplicableActors(event) {\r\n    const li = event.currentTarget.closest('.table-row');\r\n    const mapping = this.object.mappings[li.dataset.index];\r\n\r\n    let actorTypes = Object.keys(game.system.documentTypes.Actor);\r\n    let actors = [];\r\n    for (const t of actorTypes) {\r\n      const label = CONFIG['Actor']?.typeLabels?.[t] ?? t;\r\n      actors.push({\r\n        id: t,\r\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\r\n        enabled: !mapping.targetActors || mapping.targetActors.includes(t),\r\n      });\r\n    }\r\n\r\n    let content = '<form style=\"overflow-y: scroll; height:250x;\">';\r\n    for (const act of actors) {\r\n      content += `\r\n      <div class=\"form-group\">\r\n        <label>${act.label}</label>\r\n        <div class=\"form-fields\">\r\n            <input type=\"checkbox\" name=\"${act.id}\" data-dtype=\"Boolean\" ${act.enabled ? 'checked' : ''}>\r\n        </div>\r\n      </div>\r\n      `;\r\n    }\r\n    content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\r\n\r\n    new Dialog({\r\n      title: `Configure Applicable Actors`,\r\n      content: content,\r\n      buttons: {\r\n        Ok: {\r\n          label: `Save`,\r\n          callback: async (html) => {\r\n            let targetActors = [];\r\n            html.find('input[type=\"checkbox\"]').each(function () {\r\n              if (this.checked) {\r\n                targetActors.push(this.name);\r\n              }\r\n            });\r\n            mapping.targetActors = targetActors;\r\n          },\r\n        },\r\n      },\r\n      render: (html) => {\r\n        html.find('.select-all').click(() => {\r\n          html.find('input[type=\"checkbox\"]').prop('checked', true);\r\n        });\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  async _onSaveMappingsClose(event) {\r\n    await this._onSaveMappings(event);\r\n    this.close();\r\n  }\r\n\r\n  // TODO fix this spaghetti code related to globalMappings...\r\n  async _onSaveMappings(event) {\r\n    await this._onSubmit(event);\r\n    if (this.objectToFlag || this.globalMappings) {\r\n      // First filter out empty mappings\r\n      let mappings = this.object.mappings;\r\n      mappings = mappings.filter((m) => Boolean(m.label?.trim()) || Boolean(m.expression?.trim()));\r\n\r\n      // Make sure a priority is assigned\r\n      for (const mapping of mappings) {\r\n        mapping.priority = mapping.priority ? mapping.priority : 50;\r\n        mapping.overlayConfig = mapping.overlayConfig ?? {};\r\n        mapping.overlayConfig.label = mapping.label;\r\n      }\r\n\r\n      if (mappings.length !== 0) {\r\n        const effectMappings = mappings.map((m) =>\r\n          foundry.utils.mergeObject(DEFAULT_ACTIVE_EFFECT_CONFIG, m, {\r\n            inplace: false,\r\n            insertKeys: false,\r\n            recursive: false,\r\n          })\r\n        );\r\n        if (this.globalMappings) {\r\n          updateSettings({ globalMappings: effectMappings });\r\n        } else {\r\n          await this.objectToFlag.setFlag('token-variants', 'effectMappings', effectMappings);\r\n        }\r\n      } else if (this.globalMappings) {\r\n        updateSettings({ globalMappings: [] });\r\n      } else {\r\n        await this.objectToFlag.unsetFlag('token-variants', 'effectMappings');\r\n      }\r\n\r\n      const tokens = this.globalMappings ? canvas.tokens.placeables : this.objectToFlag.getActiveTokens();\r\n      for (const tkn of tokens) {\r\n        if (TVA_CONFIG.filterEffectIcons) {\r\n          await tkn.drawEffects();\r\n        }\r\n        await updateWithEffectMapping(tkn);\r\n        drawOverlays(tkn);\r\n      }\r\n\r\n      // Instruct users on other scenes to refresh the overlays\r\n      const message = {\r\n        handlerName: 'drawOverlays',\r\n        args: { all: true, sceneId: canvas.scene.id },\r\n        type: 'UPDATE',\r\n      };\r\n      game.socket?.emit('module.token-variants', message);\r\n    }\r\n    if (this.callback) this.callback();\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    const mappings = foundry.utils.expandObject(formData).mappings ?? {};\r\n\r\n    // Merge form data with internal mappings\r\n    for (let i = 0; i < this.object.mappings.length; i++) {\r\n      const m1 = mappings[i];\r\n      const m2 = this.object.mappings[i];\r\n      m2.id = m1.id;\r\n      m2.label = m1.label.replaceAll(String.fromCharCode(160), ' ');\r\n      m2.expression = m1.expression.replaceAll(String.fromCharCode(160), ' ');\r\n      m2.codeExp = m1.codeExp?.trim();\r\n      m2.imgSrc = m1.imgSrc;\r\n      m2.imgName = m1.imgName;\r\n      m2.priority = m1.priority;\r\n      m2.overlay = m1.overlay;\r\n      m2.alwaysOn = m1.alwaysOn;\r\n      m2.tokens = m1.tokens?.split(',');\r\n      m2.disabled = m1.disabled;\r\n      m2.group = m1.group;\r\n    }\r\n  }\r\n}\r\n\r\n// Insert <span/> around operators\r\nfunction highlightOperators(text) {\r\n  // text = text.replaceAll(' ', '&nbsp;');\r\n\r\n  const re = new RegExp('([a-zA-Z0-9\\\\.\\\\-\\\\|\\\\+]+)([><=]+)(\".*?\"|-?\\\\d+)(%{0,1})', `gi`);\r\n  text = text.replace(re, function replace(match) {\r\n    return '<span class=\"hp-expression\">' + match + '</span>';\r\n  });\r\n\r\n  for (const op of ['\\\\(', '\\\\)', '&&', '||', '\\\\!', '\\\\*', '\\\\{', '\\\\}']) {\r\n    text = text.replaceAll(op, `<span>${op}</span>`);\r\n  }\r\n  return text;\r\n}\r\n\r\n// Move caret to a specific point in a DOM element\r\nfunction setCaretPosition(el, pos) {\r\n  for (var node of el.childNodes) {\r\n    // Check if it's a text node\r\n    if (node.nodeType == 3) {\r\n      if (node.length >= pos) {\r\n        var range = document.createRange(),\r\n          sel = window.getSelection();\r\n        range.setStart(node, pos);\r\n        range.collapse(true);\r\n        sel.removeAllRanges();\r\n        sel.addRange(range);\r\n        return -1; // We are done\r\n      } else {\r\n        pos -= node.length;\r\n      }\r\n    } else {\r\n      pos = setCaretPosition(node, pos);\r\n      if (pos == -1) {\r\n        return -1; // No need to finish the for loop\r\n      }\r\n    }\r\n  }\r\n  return pos;\r\n}\r\n\r\nexport function sortMappingsToGroups(mappings) {\r\n  mappings.sort((m1, m2) => {\r\n    if (!m1.label && m2.label) return -1;\r\n    else if (m1.label && !m2.label) return 1;\r\n\r\n    if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\r\n    else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID) return 1;\r\n\r\n    let priorityDiff = m1.priority - m2.priority;\r\n    if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\r\n    return priorityDiff;\r\n  });\r\n\r\n  let groupedMappings = { Default: { list: [], active: false } };\r\n  mappings.forEach((mapping, index) => {\r\n    mapping.i = index; // assign so that we can reference the mapping inside of an array\r\n    if (!mapping.group || !mapping.group.trim()) mapping.group = 'Default';\r\n    if (!(mapping.group in groupedMappings)) groupedMappings[mapping.group] = { list: [], active: false };\r\n    if (!mapping.disabled) groupedMappings[mapping.group].active = true;\r\n    groupedMappings[mapping.group].list.push(mapping);\r\n  });\r\n  return [mappings, groupedMappings];\r\n}\r\n","import { CORE_SHAPE, DEFAULT_OVERLAY_CONFIG, OVERLAY_SHAPES } from '../scripts/models.js';\r\nimport { VALID_EXPRESSION, getAllEffectMappings } from '../scripts/hooks/effectMappingHooks.js';\r\nimport { evaluateOverlayExpressions, genTexture } from '../scripts/token/overlay.js';\r\nimport { SEARCH_TYPE } from '../scripts/utils.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport { sortMappingsToGroups } from './effectMappingForm.js';\r\nimport { getFlagMappings } from '../scripts/settings.js';\r\nimport { Reticle } from '../scripts/reticle.js';\r\n\r\nexport class OverlayConfig extends FormApplication {\r\n  constructor(config, callback, token, { mapping, global = false, actor } = {}) {\r\n    super({}, {});\r\n    this.config = config ?? {};\r\n\r\n    if ((this.config.img || this.config.imgLinked) && !(this.config.img instanceof Array)) {\r\n      this.config.img = [{ src: this.config.img, linked: this.config.imgLinked }];\r\n    }\r\n\r\n    this.config.id = mapping.id;\r\n    this.callback = callback;\r\n    this.token = canvas.tokens.get(token._id);\r\n    this.previewConfig = foundry.utils.deepClone(this.config);\r\n    this.mapping = mapping;\r\n    this.global = global;\r\n    this.actor = actor;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-overlay-config',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/overlayConfig.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Overlay Settings',\r\n      width: 500,\r\n      height: 'auto',\r\n      //tabs: [{ navSelector: '.sheet-tabs', contentSelector: '.content', initial: 'misc' }, ],\r\n\r\n      tabs: [\r\n        { navSelector: '.tabs[data-group=\"main\"]', contentSelector: 'form', initial: 'misc' },\r\n        { navSelector: '.tabs[data-group=\"html\"]', contentSelector: '.tab[data-tab=\"html\"]', initial: 'template' },\r\n      ],\r\n    });\r\n  }\r\n\r\n  get title() {\r\n    let scope = 'GLOBAL';\r\n    if (!this.global && this.actor) {\r\n      scope = this.actor.name;\r\n    }\r\n    return `${this.mapping.label}  [${scope}]`;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    html.find('.reticle').on('click', (event) => {\r\n      const icons = this.getPreviewIcons();\r\n      if (icons.length) {\r\n        Reticle.activate({ tvaOverlay: icons[0].icon, app: this, config: this.previewConfig });\r\n      }\r\n    });\r\n\r\n    html.find('.repeat').on('change', (event) => {\r\n      const fieldset = $(event.target).closest('fieldset');\r\n      const content = fieldset.find('.content');\r\n      if (event.target.checked) {\r\n        content.show();\r\n        fieldset.addClass('active');\r\n      } else {\r\n        content.hide();\r\n        fieldset.removeClass('active');\r\n      }\r\n      this.setPosition();\r\n    });\r\n\r\n    // Insert Controls to the Shape Legend\r\n    const shapeLegends = html.find('.shape-legend');\r\n    let config = this.config;\r\n    shapeLegends.each(function (i) {\r\n      const legend = $(this);\r\n      legend.append(\r\n        `&nbsp;<a class=\"cloneShape\" data-index=\"${i}\" title=\"Clone\"><i class=\"fas fa-clone\"></i></a>\r\n         &nbsp;<a class=\"deleteShape\" data-index=\"${i}\" title=\"Remove\"><i class=\"fas fa-trash-alt\"></i></a>`\r\n      );\r\n      if (i != 0) {\r\n        legend.append(\r\n          `&nbsp;<a class=\"moveShapeUp\" data-index=\"${i}\" title=\"Move Up\"><i class=\"fas fa-arrow-up\"></i></a>`\r\n        );\r\n      }\r\n      if (i != shapeLegends.length - 1) {\r\n        legend.append(\r\n          `&nbsp;<a class=\"moveShapeDown\" data-index=\"${i}\" title=\"Move Down\"><i class=\"fas fa-arrow-down\"></i></a>`\r\n        );\r\n      }\r\n      legend.append(\r\n        `<input class=\"shape-legend-input\" type=\"text\" name=\"shapes.${i}.label\" value=\"${\r\n          config.shapes?.[i]?.label ?? ''\r\n        }\">`\r\n      );\r\n    });\r\n\r\n    // Shape listeners\r\n    html.find('.addShape').on('click', this._onAddShape.bind(this));\r\n    html.find('.addImage').on('click', this._onAddImage.bind(this));\r\n    html.find('.addEvent').on('click', this._onAddEvent.bind(this));\r\n    html.find('.deleteShape').on('click', this._onDeleteShape.bind(this));\r\n    html.find('.deleteImage').on('click', this._onDeleteImage.bind(this));\r\n    html.find('.deleteEvent').on('click', this._onDeleteEvent.bind(this));\r\n    html.find('.moveShapeUp').on('click', this._onMoveShapeUp.bind(this));\r\n    html.find('.moveShapeDown').on('click', this._onMoveShapeDown.bind(this));\r\n    html.find('.cloneShape').on('click', this._onCloneShape.bind(this));\r\n\r\n    html.find('input,select').on('change', this._onInputChange.bind(this));\r\n    html.find('color-picker').on('input', this._onInputChange.bind(this));\r\n    html.find('textarea').on('change', this._onInputChange.bind(this));\r\n    const parentId = html.find('[name=\"parentID\"]');\r\n    parentId.on('change', (event) => {\r\n      if (event.target.value === 'TOKEN') {\r\n        html.find('.token-specific-fields').show();\r\n      } else {\r\n        html.find('.token-specific-fields').hide();\r\n      }\r\n      this.setPosition();\r\n    });\r\n    parentId.trigger('change');\r\n    html\r\n      .find('[name=\"ui\"]')\r\n      .on('change', (event) => {\r\n        if (parentId.val() === 'TOKEN') {\r\n          if (event.target.checked) {\r\n            html.find('.ui-hide').hide();\r\n          } else {\r\n            html.find('.ui-hide').show();\r\n          }\r\n          this.setPosition();\r\n        }\r\n      })\r\n      .trigger('change');\r\n\r\n    html.find('[name=\"filter\"]').on('change', (event) => {\r\n      html.find('.filterOptions').empty();\r\n      const filterOptions = $(genFilterOptionControls(event.target.value));\r\n      html.find('.filterOptions').append(filterOptions);\r\n      this.setPosition({ height: 'auto' });\r\n      this.activateListeners(filterOptions);\r\n    });\r\n\r\n    html.find('.token-variants-image-select-button').click((event) => {\r\n      showArtSelect(this.token?.name ?? 'overlay', {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        callback: (imgSrc, imgName) => {\r\n          if (imgSrc) $(event.target).closest('.form-group').find('input').val(imgSrc).trigger('change');\r\n        },\r\n      });\r\n    });\r\n\r\n    html.find('.presetImport').on('click', (event) => {\r\n      const presetName = $(event.target).closest('.form-group').find('.tmfxPreset').val();\r\n      if (presetName) {\r\n        const preset = TokenMagic.getPreset(presetName);\r\n        if (preset) {\r\n          $(event.target)\r\n            .closest('.form-group')\r\n            .find('textarea')\r\n            .val(JSON.stringify(preset, null, 2))\r\n            .trigger('change');\r\n        }\r\n      }\r\n    });\r\n\r\n    // Controls for locking scale sliders together\r\n    let scaleState = { locked: true };\r\n\r\n    // Range inputs need to be triggered when slider moves to initiate preview\r\n    html\r\n      .find('.range-value')\r\n      .siblings('[type=\"range\"]')\r\n      .on('change', (event) => {\r\n        $(event.target).siblings('.range-value').val(event.target.value).trigger('change');\r\n      });\r\n\r\n    const lockButtons = $(html).find('.scaleLock > a');\r\n    const sliderScaleWidth = $(html).find('[name=\"scaleX\"]');\r\n    const sliderScaleHeight = $(html).find('[name=\"scaleY\"]');\r\n    const sliderWidth = html.find('.scaleX');\r\n    const sliderHeight = html.find('.scaleY');\r\n\r\n    lockButtons.on('click', function () {\r\n      scaleState.locked = !scaleState.locked;\r\n      lockButtons.html(scaleState.locked ? '<i class=\"fas fa-link\"></i>' : '<i class=\"fas fa-unlink\"></i>');\r\n    });\r\n\r\n    sliderScaleWidth.on('change', function () {\r\n      if (scaleState.locked && sliderScaleWidth.val() !== sliderScaleHeight.val()) {\r\n        sliderScaleHeight.val(sliderScaleWidth.val()).trigger('change');\r\n        sliderHeight.val(sliderScaleWidth.val());\r\n      }\r\n    });\r\n    sliderScaleHeight.on('change', function () {\r\n      if (scaleState.locked && sliderScaleWidth.val() !== sliderScaleHeight.val()) {\r\n        sliderScaleWidth.val(sliderScaleHeight.val()).trigger('change');\r\n        sliderWidth.val(sliderScaleHeight.val());\r\n      }\r\n    });\r\n    html.on('change', '.scaleX', () => {\r\n      sliderScaleWidth.trigger('change');\r\n    });\r\n    html.on('change', '.scaleY', () => {\r\n      sliderScaleHeight.trigger('change');\r\n    });\r\n\r\n    html.find('.me-edit-json').on('click', async (event) => {\r\n      const textarea = $(event.target).closest('.form-group').find('textarea');\r\n      let params;\r\n      try {\r\n        params = eval(textarea.val());\r\n      } catch (e) {\r\n        console.warn('TVA |', e);\r\n      }\r\n\r\n      if (params) {\r\n        let param;\r\n        if (Array.isArray(params)) {\r\n          if (params.length === 1) param = params[0];\r\n          else {\r\n            let i = await promptParamChoice(params);\r\n            if (i < 0) return;\r\n            param = params[i];\r\n          }\r\n        } else {\r\n          param = params;\r\n        }\r\n\r\n        if (param)\r\n          game.modules.get('multi-token-edit').api.showGenericForm(param, param.filterType ?? 'TMFX', {\r\n            inputChangeCallback: (selected) => {\r\n              foundry.utils.mergeObject(param, selected, { inplace: true });\r\n              textarea.val(JSON.stringify(params, null, 2)).trigger('change');\r\n            },\r\n          });\r\n      }\r\n    });\r\n\r\n    const underlay = html.find('[name=\"underlay\"]');\r\n    const top = html.find('[name=\"top\"]');\r\n    const bottom = html.find('[name=\"bottom\"]');\r\n    underlay.change(function () {\r\n      if (this.checked) top.prop('checked', false);\r\n      else bottom.prop('checked', false);\r\n    });\r\n    top.change(function () {\r\n      if (this.checked) {\r\n        underlay.prop('checked', false);\r\n        bottom.prop('checked', false);\r\n      }\r\n    });\r\n    bottom.change(function () {\r\n      if (this.checked) {\r\n        underlay.prop('checked', true);\r\n        top.prop('checked', false);\r\n      }\r\n    });\r\n\r\n    const linkScale = html.find('[name=\"linkScale\"]');\r\n    const linkDimensions = html.find('[name=\"linkDimensionsX\"], [name=\"linkDimensionsY\"]');\r\n    const linkStageScale = html.find('[name=\"linkStageScale\"]');\r\n    linkScale.change(function () {\r\n      if (this.checked) {\r\n        linkDimensions.prop('checked', false);\r\n        linkStageScale.prop('checked', false);\r\n      }\r\n    });\r\n    linkDimensions.change(function () {\r\n      if (this.checked) {\r\n        linkScale.prop('checked', false);\r\n        linkStageScale.prop('checked', false);\r\n      }\r\n    });\r\n    linkStageScale.change(function () {\r\n      if (this.checked) {\r\n        linkScale.prop('checked', false);\r\n        linkDimensions.prop('checked', false);\r\n      }\r\n    });\r\n\r\n    // Setting border color for property expression\r\n    const limitOnProperty = html.find('[name=\"limitOnProperty\"]');\r\n    limitOnProperty.on('input', (event) => {\r\n      const input = $(event.target);\r\n      if (input.val() === '') {\r\n        input.removeClass('tvaValid');\r\n        input.removeClass('tvaInvalid');\r\n      } else if (input.val().match(VALID_EXPRESSION)) {\r\n        input.addClass('tvaValid');\r\n        input.removeClass('tvaInvalid');\r\n      } else {\r\n        input.addClass('tvaInvalid');\r\n        input.removeClass('tvaValid');\r\n      }\r\n    });\r\n    limitOnProperty.trigger('input');\r\n\r\n    html.find('.create-variable').on('click', this._onCreateVariable.bind(this));\r\n    html.find('.delete-variable').on('click', this._onDeleteVariable.bind(this));\r\n  }\r\n\r\n  _onDeleteVariable(event) {\r\n    let index = $(event.target).closest('tr').data('index');\r\n    if (index != null) {\r\n      this.config = this._getSubmitData();\r\n      if (!this.config.variables) this.config.variables = [];\r\n      this.config.variables.splice(index, 1);\r\n      this.render(true);\r\n    }\r\n  }\r\n\r\n  _onCreateVariable(event) {\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.variables) this.config.variables = [];\r\n    this.config.variables.push({ name: '', value: '' });\r\n    this.render(true);\r\n  }\r\n\r\n  _onAddShape(event) {\r\n    let shape = $(event.target).siblings('select').val();\r\n    shape = foundry.utils.deepClone(OVERLAY_SHAPES[shape]);\r\n    shape = foundry.utils.mergeObject(foundry.utils.deepClone(CORE_SHAPE), { shape });\r\n\r\n    this.config = this._getSubmitData();\r\n\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    this.config.shapes.push(shape);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onAddImage(event) {\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.img) this.config.img = [];\r\n    else if (!(this.config.img instanceof Array)) {\r\n      this.config.img = [{ src: this.config.img, linked: this.config.imgLinked }];\r\n    }\r\n    this.config.img.push({ src: '', linked: false });\r\n    this.render(true);\r\n  }\r\n\r\n  _onAddEvent(event) {\r\n    let listener = $(event.target).siblings('select').val();\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.interactivity) this.config.interactivity = [];\r\n    this.config.interactivity.push({ listener, macro: '', script: '' });\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onDeleteShape(event) {\r\n    const index = $(event.target).closest('.deleteShape').data('index');\r\n    if (index == null) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    this.config.shapes.splice(index, 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onDeleteImage(event) {\r\n    const index = $(event.target).closest('.deleteImage').data('index');\r\n    if (index == null) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!(this.config.img instanceof Array)) this.config.img = [];\r\n    else this.config.img.splice(index, 1);\r\n\r\n    if (!this.config.img.length) this.config.img = '';\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onDeleteEvent(event) {\r\n    const index = $(event.target).closest('.deleteEvent').data('index');\r\n    if (index == null) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.interactivity) this.config.interactivity = [];\r\n    this.config.interactivity.splice(index, 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onCloneShape(event) {\r\n    const index = $(event.target).closest('.cloneShape').data('index');\r\n    if (!index && index != 0) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) return;\r\n    const nShape = foundry.utils.deepClone(this.config.shapes[index]);\r\n    if (nShape.label) {\r\n      nShape.label = nShape.label + ' - Copy';\r\n    }\r\n    this.config.shapes.push(nShape);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onMoveShapeUp(event) {\r\n    const index = $(event.target).closest('.moveShapeUp').data('index');\r\n    if (!index) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index - 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _onMoveShapeDown(event) {\r\n    const index = $(event.target).closest('.moveShapeDown').data('index');\r\n    if (!index && index != 0) return;\r\n\r\n    this.config = this._getSubmitData();\r\n    if (!this.config.shapes) this.config.shapes = [];\r\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index + 1);\r\n\r\n    this.render(true);\r\n  }\r\n\r\n  _swapShapes(i1, i2) {\r\n    let temp = this.config.shapes[i1];\r\n    this.config.shapes[i1] = this.config.shapes[i2];\r\n    this.config.shapes[i2] = temp;\r\n  }\r\n\r\n  _convertColor(colString) {\r\n    try {\r\n      const c = Color.fromString(colString);\r\n      return [...c.rgb, 1];\r\n    } catch (e) {\r\n      return [1, 1, 1, 1];\r\n    }\r\n  }\r\n\r\n  async _onInputChange(event) {\r\n    this.previewConfig = this._getSubmitData();\r\n    if (event.target.type === 'color') {\r\n      const color = $(event.target).siblings('.color');\r\n      color.val(event.target.value).trigger('change');\r\n      return;\r\n    }\r\n    this._applyPreviews();\r\n  }\r\n\r\n  getPreviewIcons() {\r\n    if (!this.config.id) return [];\r\n    const tokens = this.token ? [this.token] : canvas.tokens.placeables;\r\n    const previewIcons = [];\r\n    for (const tkn of tokens) {\r\n      if (tkn.tvaOverlays) {\r\n        for (const c of tkn.tvaOverlays) {\r\n          if (c.overlayConfig && c.overlayConfig.id === this.config.id) {\r\n            // Effect icon found, however if we're in global preview then we need to take into account\r\n            // a token/actor specific mapping which may override the global one\r\n            if (this.token) {\r\n              previewIcons.push({ token: tkn, icon: c });\r\n            } else if (!getFlagMappings(tkn).find((m) => m.id === this.config.id)) {\r\n              previewIcons.push({ token: tkn, icon: c });\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return previewIcons;\r\n  }\r\n\r\n  async _applyPreviews() {\r\n    const targets = this.getPreviewIcons();\r\n    for (const target of targets) {\r\n      const preview = evaluateOverlayExpressions(foundry.utils.deepClone(this.previewConfig), target.token, {\r\n        overlayConfig: this.previewConfig,\r\n      });\r\n      target.icon.refresh(preview, {\r\n        preview: true,\r\n        previewTexture: await genTexture(target.token, preview),\r\n        refreshFilters: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  async _removePreviews() {\r\n    const targets = this.getPreviewIcons();\r\n    for (const target of targets) {\r\n      target.icon.refresh(null, { refreshFilters: true });\r\n    }\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    data.filters = Object.keys(PIXI.filters);\r\n    data.filters.push('OutlineOverlayFilter');\r\n    data.filters.sort();\r\n    data.tmfxActive = game.modules.get('tokenmagic')?.active;\r\n    if (data.tmfxActive) {\r\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\r\n      data.filters.unshift('Token Magic FX');\r\n    }\r\n    data.filters.unshift('NONE');\r\n    const settings = foundry.utils.mergeObject(DEFAULT_OVERLAY_CONFIG, this.config, {\r\n      inplace: false,\r\n    });\r\n\r\n    data.ceActive = game.modules.get('dfreds-convenient-effects')?.active;\r\n    if (data.ceActive) {\r\n      data.ceEffects = game.dfreds.effectInterface.findEffects().map((ef) => ef.name);\r\n    }\r\n    data.macros = game.macros.map((m) => m.name);\r\n\r\n    if (settings.filter !== 'NONE') {\r\n      const filterOptions = genFilterOptionControls(settings.filter, settings.filterOptions);\r\n      if (filterOptions) {\r\n        settings.filterOptions = filterOptions;\r\n      } else {\r\n        settings.filterOptions = null;\r\n      }\r\n    } else {\r\n      settings.filterOptions = null;\r\n    }\r\n\r\n    data.users = game.users.map((u) => {\r\n      return { id: u.id, name: u.name, selected: settings.limitedUsers.includes(u.id) };\r\n    });\r\n\r\n    data.fonts = Object.keys(CONFIG.fontDefinitions).concat(\r\n      Object.keys(game.settings.get('core', foundry.applications.settings.menus.FontConfig.SETTING))\r\n    );\r\n    data.fontWeights = [\r\n      'normal',\r\n      'bold',\r\n      'bolder',\r\n      'lighter',\r\n      '100',\r\n      '200',\r\n      '300',\r\n      '400',\r\n      '500',\r\n      '600',\r\n      '700',\r\n      '800',\r\n      '900',\r\n    ];\r\n\r\n    const allMappings = getAllEffectMappings(this.token, true).filter((m) => m.id !== this.config.id);\r\n    const [_, groupedMappings] = sortMappingsToGroups(allMappings);\r\n\r\n    data.parents = groupedMappings;\r\n    if (!data.parentID) data.parentID = 'TOKEN';\r\n    if (!data.anchor) data.anchor = { x: 0.5, y: 0.5 };\r\n\r\n    // Cache Partials\r\n    for (const shapeName of Object.keys(OVERLAY_SHAPES)) {\r\n      await getTemplate(`modules/token-variants/templates/partials/shape${shapeName}.html`);\r\n    }\r\n    await getTemplate('modules/token-variants/templates/partials/repeating.html');\r\n    await getTemplate('modules/token-variants/templates/partials/interpolateColor.html');\r\n\r\n    data.allShapes = Object.keys(OVERLAY_SHAPES);\r\n    data.textAlignmentOptions = [\r\n      { value: 'left', label: 'Left' },\r\n      { value: 'center', label: 'Center' },\r\n      { value: 'right', label: 'Right' },\r\n      { value: 'justify', label: 'Justify' },\r\n    ];\r\n\r\n    data.vision5e = game.modules.get('vision-5e')?.active;\r\n\r\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\r\n    // Make sure we're using the latest fields\r\n    // 20/07/2023\r\n    if (!('linkDimensionsX' in settings) && settings.linkDimensions) {\r\n      settings.linkDimensionsX = true;\r\n      settings.linkDimensionsY = true;\r\n    }\r\n\r\n    return foundry.utils.mergeObject(data, settings);\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    buttons.unshift({\r\n      label: 'Core Variables',\r\n      class: '.core-variables',\r\n      icon: 'fas fa-file-import fa-fw',\r\n      onclick: () => {\r\n        let content = `\r\n        <table>\r\n          <tr><th>Variable</th><th>Description</th></tr>\r\n          <tr><td>@hp</td><td>Actor Health</td></tr>\r\n          <tr><td>@hpMax</td><td>Actor Health (Max)</td></tr>\r\n          <tr><td>@gridSize</td><td>Grid Size (Pixels)</td></tr>\r\n          <tr><td>@label</td><td>Mapping's Label Field</td></tr>\r\n        </table>\r\n        `;\r\n\r\n        new Dialog({\r\n          title: `Core Variables`,\r\n          content,\r\n          buttons: {},\r\n        }).render(true);\r\n      },\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  async close(options = {}) {\r\n    super.close(options);\r\n    this._removePreviews();\r\n  }\r\n\r\n  _getSubmitData() {\r\n    let formData = super._getSubmitData();\r\n    formData = foundry.utils.expandObject(formData);\r\n    if (formData.img) {\r\n      const images = Object.values(formData.img);\r\n      if (images.length === 1) {\r\n        formData.img = images[0].src;\r\n        formData.imgLinked = images[0].linked;\r\n      } else {\r\n        formData.img = images;\r\n      }\r\n    }\r\n\r\n    if (!formData.repeating) delete formData.repeat;\r\n    if (!formData.text.repeating) delete formData.text.repeat;\r\n\r\n    if (formData.shapes) {\r\n      formData.shapes = Object.values(formData.shapes);\r\n      formData.shapes.forEach((shape) => {\r\n        if (!shape.repeating) delete shape.repeat;\r\n      });\r\n    }\r\n\r\n    if (formData.interactivity) {\r\n      formData.interactivity = Object.values(formData.interactivity)\r\n        .map((e) => {\r\n          e.macro = e.macro.trim();\r\n          e.script = e.script.trim();\r\n          if (e.tmfxPreset) e.tmfxPreset = e.tmfxPreset.trim();\r\n          if (e.ceEffect) e.ceEffect = e.ceEffect.trim();\r\n          return e;\r\n        })\r\n        .filter((e) => e.macro || e.script || e.ceEffect || e.tmfxPreset);\r\n    } else {\r\n      formData.interactivity = [];\r\n    }\r\n\r\n    if (formData.variables) {\r\n      formData.variables = Object.values(formData.variables);\r\n      formData.variables = formData.variables.filter((v) => v.name.trim() && v.value.trim());\r\n    }\r\n    if (formData.limitedUsers) {\r\n      if (foundry.utils.getType(formData.limitedUsers) === 'string') formData.limitedUsers = [formData.limitedUsers];\r\n      formData.limitedUsers = formData.limitedUsers.filter((uid) => uid);\r\n    } else {\r\n      formData.limitedUsers = [];\r\n    }\r\n\r\n    formData.limitOnEffect = formData.limitOnEffect.trim();\r\n    formData.limitOnProperty = formData.limitOnProperty.trim();\r\n    if (formData.parentID === 'TOKEN') formData.parentID = '';\r\n\r\n    if (formData.filter === 'OutlineOverlayFilter' && formData.filterOptions?.outlineColor) {\r\n      formData.filterOptions.outlineColor = this._convertColor(formData.filterOptions.outlineColor);\r\n    } else if (formData.filter === 'BevelFilter') {\r\n      if (formData.filterOptions?.lightColor)\r\n        formData.filterOptions.lightColor = Number(Color.fromString(formData.filterOptions.lightColor));\r\n      if (formData.filterOptions?.shadowColor)\r\n        formData.filterOptions.shadowColor = Number(Color.fromString(formData.filterOptions.shadowColor));\r\n    } else if (['DropShadowFilter', 'GlowFilter', 'OutlineFilter', 'FilterFire'].includes(formData.filter)) {\r\n      if (formData.filterOptions?.color)\r\n        formData.filterOptions.color = Number(Color.fromString(formData.filterOptions.color));\r\n    }\r\n\r\n    return formData;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (this.callback) this.callback(formData);\r\n  }\r\n}\r\n\r\nexport const FILTERS = {\r\n  OutlineOverlayFilter: {\r\n    defaultValues: {\r\n      outlineColor: [0, 0, 0, 1],\r\n      trueThickness: 1,\r\n      animate: false,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'color',\r\n        name: 'outlineColor',\r\n      },\r\n      {\r\n        type: 'range',\r\n        label: 'Thickness',\r\n        name: 'trueThickness',\r\n        min: 0,\r\n        max: 5,\r\n        step: 0.01,\r\n      },\r\n      {\r\n        type: 'boolean',\r\n        label: 'Oscillate',\r\n        name: 'animate',\r\n      },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  AlphaFilter: {\r\n    defaultValues: {\r\n      alpha: 1,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'range',\r\n        name: 'alpha',\r\n        min: 0,\r\n        max: 1,\r\n        step: 0.01,\r\n      },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BlurFilter: {\r\n    defaultValues: {\r\n      strength: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'strength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BlurFilterPass: {\r\n    defaultValues: {\r\n      horizontal: false,\r\n      strength: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      {\r\n        type: 'boolean',\r\n        name: 'horizontal',\r\n      },\r\n      { type: 'range', name: 'strength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  NoiseFilter: {\r\n    defaultValues: {\r\n      noise: 0.5,\r\n      seed: 4475160954091,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'noise', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'seed', min: 0, max: 100000, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  AdjustmentFilter: {\r\n    defaultValues: {\r\n      gamma: 1,\r\n      saturation: 1,\r\n      contrast: 1,\r\n      brightness: 1,\r\n      red: 1,\r\n      green: 1,\r\n      blue: 1,\r\n      alpha: 1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'gamma', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'saturation', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'contrast', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'brightness', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'red', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'green', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'blue', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  AdvancedBloomFilter: {\r\n    defaultValues: {\r\n      threshold: 0.5,\r\n      bloomScale: 1,\r\n      brightness: 1,\r\n      blur: 8,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'threshold', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'bloomScale', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'brightness', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  AsciiFilter: {\r\n    defaultValues: {\r\n      size: 8,\r\n    },\r\n    controls: [{ type: 'range', name: 'size', min: 0, max: 20, step: 0.01 }],\r\n    argType: 'args',\r\n  },\r\n  BevelFilter: {\r\n    defaultValues: {\r\n      rotation: 45,\r\n      thickness: 2,\r\n      lightColor: 0xffffff,\r\n      lightAlpha: 0.7,\r\n      shadowColor: 0x000000,\r\n      shadowAlpha: 0.7,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'rotation', min: 0, max: 360, step: 1 },\r\n      { type: 'range', name: 'thickness', min: 0, max: 20, step: 0.01 },\r\n      { type: 'color', name: 'lightColor' },\r\n      { type: 'range', name: 'lightAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'color', name: 'shadowColor' },\r\n      { type: 'range', name: 'shadowAlpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  BloomFilter: {\r\n    defaultValues: {\r\n      blur: 2,\r\n      quality: 4,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  BulgePinchFilter: {\r\n    defaultValues: {\r\n      radius: 100,\r\n      strength: 1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'radius', min: 0, max: 500, step: 1 },\r\n      { type: 'range', name: 'strength', min: -1, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  CRTFilter: {\r\n    defaultValues: {\r\n      curvature: 1,\r\n      lineWidth: 1,\r\n      lineContrast: 0.25,\r\n      verticalLine: false,\r\n      noise: 0.3,\r\n      noiseSize: 1,\r\n      seed: 0,\r\n      vignetting: 0.3,\r\n      vignettingAlpha: 1,\r\n      vignettingBlur: 0.3,\r\n      time: 0,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'curvature', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'lineWidth', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'lineContrast', min: 0, max: 5, step: 0.01 },\r\n      { type: 'boolean', name: 'verticalLine' },\r\n      { type: 'range', name: 'noise', min: 0, max: 2, step: 0.01 },\r\n      { type: 'range', name: 'noiseSize', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'seed', min: 0, max: 100000, step: 1 },\r\n      { type: 'range', name: 'vignetting', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'vignettingAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingBlur', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  DotFilter: {\r\n    defaultValues: {\r\n      scale: 1,\r\n      angle: 5,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'scale', min: 0, max: 50, step: 1 },\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 0.1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  DropShadowFilter: {\r\n    defaultValues: {\r\n      rotation: 45,\r\n      distance: 5,\r\n      color: 0x000000,\r\n      alpha: 0.5,\r\n      shadowOnly: false,\r\n      blur: 2,\r\n      quality: 3,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'rotation', min: 0, max: 360, step: 0.1 },\r\n      { type: 'range', name: 'distance', min: 0, max: 100, step: 0.1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'boolean', name: 'shadowOnly' },\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 0.1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  EmbossFilter: {\r\n    defaultValues: {\r\n      strength: 5,\r\n    },\r\n    controls: [{ type: 'range', name: 'strength', min: 0, max: 20, step: 1 }],\r\n    argType: 'args',\r\n  },\r\n  GlitchFilter: {\r\n    defaultValues: {\r\n      slices: 5,\r\n      offset: 100,\r\n      direction: 0,\r\n      fillMode: 0,\r\n      seed: 0,\r\n      average: false,\r\n      minSize: 8,\r\n      sampleSize: 512,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'slices', min: 0, max: 50, step: 1 },\r\n      { type: 'range', name: 'distance', min: 0, max: 1000, step: 1 },\r\n      { type: 'range', name: 'direction', min: 0, max: 360, step: 0.1 },\r\n      {\r\n        type: 'select',\r\n        name: 'fillMode',\r\n        options: [\r\n          { value: 0, label: 'TRANSPARENT' },\r\n          { value: 1, label: 'ORIGINAL' },\r\n          { value: 2, label: 'LOOP' },\r\n          { value: 3, label: 'CLAMP' },\r\n          { value: 4, label: 'MIRROR' },\r\n        ],\r\n      },\r\n      { type: 'range', name: 'seed', min: 0, max: 10000, step: 1 },\r\n      { type: 'boolean', name: 'average' },\r\n      { type: 'range', name: 'minSize', min: 0, max: 500, step: 1 },\r\n      { type: 'range', name: 'sampleSize', min: 0, max: 1024, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  GlowFilter: {\r\n    defaultValues: {\r\n      distance: 10,\r\n      outerStrength: 4,\r\n      innerStrength: 0,\r\n      color: 0xffffff,\r\n      quality: 0.1,\r\n      knockout: false,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'distance', min: 1, max: 50, step: 1 },\r\n      { type: 'range', name: 'outerStrength', min: 0, max: 20, step: 1 },\r\n      { type: 'range', name: 'innerStrength', min: 0, max: 20, step: 1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'quality', min: 0, max: 5, step: 0.1 },\r\n      { type: 'boolean', name: 'knockout' },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  GodrayFilter: {\r\n    defaultValues: {\r\n      angle: 30,\r\n      gain: 0.5,\r\n      lacunarity: 2.5,\r\n      parallel: true,\r\n      time: 0,\r\n      alpha: 1.0,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 0.1 },\r\n      { type: 'range', name: 'gain', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'lacunarity', min: 0, max: 5, step: 0.01 },\r\n      { type: 'boolean', name: 'parallel' },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n      { type: 'range', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  KawaseBlurFilter: {\r\n    defaultValues: {\r\n      blur: 4,\r\n      quality: 3,\r\n      clamp: false,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'blur', min: 0, max: 20, step: 0.1 },\r\n      { type: 'range', name: 'quality', min: 0, max: 20, step: 1 },\r\n      { type: 'boolean', name: 'clamp' },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  OldFilmFilter: {\r\n    defaultValues: {\r\n      sepia: 0.3,\r\n      noise: 0.3,\r\n      noiseSize: 1.0,\r\n      scratch: 0.5,\r\n      scratchDensity: 0.3,\r\n      scratchWidth: 1.0,\r\n      vignetting: 0.3,\r\n      vignettingAlpha: 1.0,\r\n      vignettingBlur: 0.3,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'sepia', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'noise', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'noiseSize', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratch', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratchDensity', min: 0, max: 5, step: 0.01 },\r\n      { type: 'range', name: 'scratchWidth', min: 0, max: 20, step: 0.01 },\r\n      { type: 'range', name: 'vignetting', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingAlpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'vignettingBlur', min: 0, max: 5, step: 0.01 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  OutlineFilter: {\r\n    defaultValues: {\r\n      thickness: 1,\r\n      color: 0x000000,\r\n      quality: 0.1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'thickness', min: 0, max: 20, step: 0.1 },\r\n      { type: 'color', name: 'color' },\r\n      { type: 'range', name: 'quality', min: 0, max: 1, step: 0.01 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  PixelateFilter: {\r\n    defaultValues: {\r\n      size: 1,\r\n    },\r\n    controls: [{ type: 'range', name: 'size', min: 1, max: 100, step: 1 }],\r\n    argType: 'args',\r\n  },\r\n  RGBSplitFilter: {\r\n    defaultValues: {\r\n      red: [-10, 0],\r\n      green: [0, 10],\r\n      blue: [0, 0],\r\n    },\r\n    controls: [\r\n      { type: 'point', name: 'red', min: 0, max: 50, step: 1 },\r\n      { type: 'point', name: 'green', min: 0, max: 50, step: 1 },\r\n      { type: 'point', name: 'blue', min: 0, max: 50, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  RadialBlurFilter: {\r\n    defaultValues: {\r\n      angle: 0,\r\n      center: [0, 0],\r\n      radius: -1,\r\n    },\r\n    controls: [\r\n      { type: 'range', name: 'angle', min: 0, max: 360, step: 1 },\r\n      { type: 'point', name: 'center', min: 0, max: 1000, step: 1 },\r\n      { type: 'range', name: 'radius', min: -1, max: 1000, step: 1 },\r\n    ],\r\n    argType: 'args',\r\n  },\r\n  ReflectionFilter: {\r\n    defaultValues: {\r\n      mirror: true,\r\n      boundary: 0.5,\r\n      amplitude: [0, 20],\r\n      waveLength: [30, 100],\r\n      alpha: [1, 1],\r\n      time: 0,\r\n    },\r\n    controls: [\r\n      { type: 'boolean', name: 'mirror' },\r\n      { type: 'range', name: 'boundary', min: 0, max: 1, step: 0.01 },\r\n      { type: 'point', name: 'amplitude', min: 0, max: 100, step: 1 },\r\n      { type: 'point', name: 'waveLength', min: 0, max: 500, step: 1 },\r\n      { type: 'point', name: 'alpha', min: 0, max: 1, step: 0.01 },\r\n      { type: 'range', name: 'time', min: 0, max: 10000, step: 1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  DisplacementFilter: {\r\n    defaultValues: {\r\n      sprite: '',\r\n      textureScale: 1,\r\n      displacementScale: 1,\r\n    },\r\n    controls: [\r\n      { type: 'text', name: 'sprite' },\r\n      { type: 'range', name: 'textureScale', min: 0, max: 100, step: 0.1 },\r\n      { type: 'range', name: 'displacementScale', min: 0, max: 100, step: 0.1 },\r\n    ],\r\n    argType: 'options',\r\n  },\r\n  'Token Magic FX': {\r\n    defaultValues: {\r\n      params: [],\r\n    },\r\n    controls: [\r\n      { type: 'tmfxPreset', name: 'tmfxPreset' },\r\n      { type: 'json', name: 'params' },\r\n    ],\r\n  },\r\n};\r\n\r\nfunction genFilterOptionControls(filterName, filterOptions = {}) {\r\n  if (!(filterName in FILTERS)) return;\r\n\r\n  const options = foundry.utils.mergeObject(FILTERS[filterName].defaultValues, filterOptions);\r\n  const values = getControlValues(filterName, options);\r\n\r\n  const controls = FILTERS[filterName].controls;\r\n  let controlsHTML = '<fieldset><legend>Options</legend>';\r\n  for (const control of controls) {\r\n    controlsHTML += genControl(control, values);\r\n  }\r\n  controlsHTML += '</fieldset>';\r\n\r\n  return controlsHTML;\r\n}\r\n\r\nfunction getControlValues(filterName, options) {\r\n  if (filterName === 'OutlineOverlayFilter') {\r\n    options.outlineColor = Color.fromRGB(options.outlineColor).toString();\r\n  } else if (filterName === 'BevelFilter') {\r\n    options.lightColor = Color.from(options.lightColor).toString();\r\n    options.shadowColor = Color.from(options.shadowColor).toString();\r\n  } else if (['DropShadowFilter', 'GlowFilter', 'OutlineFilter'].includes(filterName)) {\r\n    options.color = Color.from(options.color).toString();\r\n  }\r\n  return options;\r\n}\r\n\r\nfunction genControl(control, values) {\r\n  const val = values[control.name];\r\n  const name = control.name;\r\n  const label = control.label ?? name.charAt(0).toUpperCase() + name.slice(1);\r\n  const type = control.type;\r\n  if (type === 'color') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input class=\"color\" type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\r\n      <input type=\"color\" value=\"${val}\" data-edit=\"filterOptions.${name}\">\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'range') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n      <span class=\"range-value\">${val}</span>\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'boolean') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"checkbox\" name=\"filterOptions.${name}\" data-dtype=\"Boolean\" value=\"${val}\" ${val ? 'checked' : ''}>\r\n  </div>\r\n</div>\r\n    `;\r\n  } else if (type === 'select') {\r\n    let select = `\r\n    <div class=\"form-group\">\r\n    <label>${label}</label>\r\n    <div class=\"form-fields\">\r\n      <select name=\"${name}\">\r\n`;\r\n\r\n    for (const opt of control.options) {\r\n      select += `<option value=\"${opt.value}\" ${val === opt.value ? 'selected=\"selected\"' : ''}>${opt.label}</option>`;\r\n    }\r\n\r\n    select += `</select></div></div>`;\r\n\r\n    return select;\r\n  } else if (type === 'point') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[0]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n      <span class=\"range-value\">${val[0]}</span>\r\n  </div>\r\n  <div class=\"form-fields\">\r\n    <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[1]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\r\n    <span class=\"range-value\">${val[1]}</span>\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'json') {\r\n    let control = `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <textarea style=\"width: 450px; height: 200px;\" name=\"filterOptions.${name}\">${val}</textarea>\r\n  </div>`;\r\n    const massEdit = game.modules.get('multi-token-edit');\r\n    if (massEdit?.active && massEdit.api.showGenericForm) {\r\n      control += `\r\n  <div style=\"text-align: right; color: orangered;\">\r\n      <a> <i class=\"me-edit-json fas fa-edit\" title=\"Show Generic Form\"></i></a>\r\n  </div>`;\r\n    }\r\n    control += `</div>`;\r\n    return control;\r\n  } else if (type === 'text') {\r\n    return `\r\n<div class=\"form-group\">\r\n  <label>${label}</label>\r\n  <div class=\"form-fields\">\r\n      <input type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\r\n  </div>\r\n</div>\r\n`;\r\n  } else if (type === 'tmfxPreset' && game.modules.get('tokenmagic')?.active) {\r\n    return `\r\n      <div class=\"form-group\">\r\n        <label>Preset <span class=\"units\">(TMFX)</span></label>\r\n        <div class=\"form-fields\">\r\n          <input list=\"tmfxPresets\" class=\"tmfxPreset\">\r\n          <button type=\"button\" class=\"presetImport\"><i class=\"fas fa-download\"></i></button>\r\n        </div>\r\n      `;\r\n  }\r\n  return '';\r\n}\r\n\r\nasync function promptParamChoice(params) {\r\n  return new Promise((resolve, reject) => {\r\n    const buttons = {};\r\n    for (let i = 0; i < params.length; i++) {\r\n      const label = params[i].filterType ?? params[i].filterId;\r\n      buttons[label] = {\r\n        label,\r\n        callback: () => {\r\n          resolve(i);\r\n        },\r\n      };\r\n    }\r\n\r\n    const dialog = new Dialog({\r\n      title: 'Select Filter To Edit',\r\n      content: '',\r\n      buttons,\r\n      close: () => resolve(-1),\r\n    });\r\n    dialog.render(true);\r\n  });\r\n}\r\n","import { CORE_TEMPLATES } from '../scripts/mappingTemplates.js';\r\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { showMappingSelectDialog, showUserTemplateCreateDialog } from './dialogs.js';\r\n\r\nexport class Templates extends FormApplication {\r\n  constructor({ mappings = null, callback = null } = {}) {\r\n    super({}, {});\r\n    this.mappings = mappings;\r\n    this.callback = callback;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-templates',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/templates.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Mapping Templates',\r\n      width: 500,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    if (!this.category) this.category = TVA_CONFIG.templateMappings?.length ? 'user' : 'core';\r\n    if (this.category === 'user') {\r\n      this.templates = TVA_CONFIG.templateMappings;\r\n    } else if (this.category === 'core') {\r\n      this.templates = CORE_TEMPLATES;\r\n    } else {\r\n      this.templates = await communityTemplates();\r\n    }\r\n\r\n    for (const template of this.templates) {\r\n      template.hint = template.hint?.replace(/(\\r\\n|\\n|\\r)/gm, '<br>');\r\n    }\r\n\r\n    data.category = this.category;\r\n    data.templates = this.templates;\r\n    data.allowDelete = this.category === 'user';\r\n    data.allowCreate = this.category === 'user';\r\n    data.allowCopy = this.category === 'community' || this.category === 'core';\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n\r\n    // Position tooltip\r\n    const appWindow = html.closest('#token-variants-templates');\r\n    html.find('.template').on('mouseover', (event) => {\r\n      const template = $(event.target).closest('.template');\r\n      const pos = template.position();\r\n      const tooltip = template.find('.tooltiptext');\r\n      const windowPos = appWindow.position();\r\n      tooltip.css('top', windowPos.top + pos.top).css('left', windowPos.left + pos.left);\r\n\r\n      // Lazy load image\r\n      const img = template.find('img');\r\n      if (!img.attr('src')) img.attr('src', img.data('src'));\r\n    });\r\n\r\n    if (this.callback) {\r\n      html.find('.template').on('click', async (event) => {\r\n        const li = $(event.target).closest('.template');\r\n        const id = li.data('id');\r\n        const url = li.data('url');\r\n        let mappings;\r\n        let templateName;\r\n        if (url) {\r\n          const template = await getTemplateFromFileURL(url);\r\n          if (template) mappings = template.mappings;\r\n        } else if (id) {\r\n          const template = this.templates.find((t) => t.id === id);\r\n          if (template) {\r\n            templateName = template.name;\r\n            mappings = template.mappings;\r\n          }\r\n        }\r\n\r\n        if (mappings) this.callback(templateName, mappings);\r\n      });\r\n    }\r\n\r\n    html.find('.search').on('input', () => {\r\n      const filter = html.find('.search').val().trim().toLowerCase();\r\n      html.find('.template-list li').each(function () {\r\n        const li = $(this);\r\n        const description = li.find('.description').text().trim().toLowerCase();\r\n        const name = li.data('name').trim().toLowerCase();\r\n        const createdBy = li.data('creator').trim().toLowerCase();\r\n        if (name.includes(filter) || description.includes(filter) || createdBy.includes(filter)) li.show();\r\n        else li.hide();\r\n      });\r\n    });\r\n\r\n    html.find('[name=\"category\"]').on('change', (event) => {\r\n      this.category = event.target.value;\r\n      this.render(true);\r\n    });\r\n\r\n    html.find('.delete').on('click', async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const id = $(event.target).closest('.template').data('id');\r\n      if (id) {\r\n        await updateSettings({\r\n          templateMappings: TVA_CONFIG.templateMappings.filter((m) => m.id !== id),\r\n        });\r\n        this.render(true);\r\n      }\r\n    });\r\n\r\n    html.find('.copy').on('click', async (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const id = $(event.target).closest('.template').data('id');\r\n      if (id) {\r\n        let template;\r\n        if (this.category === 'core') {\r\n          template = foundry.utils.deepClone(CORE_TEMPLATES.find((t) => t.id === id));\r\n        } else {\r\n          const fileURL = $(event.target).closest('.template').data('url');\r\n          if (fileURL) template = await getTemplateFromFileURL(fileURL);\r\n        }\r\n\r\n        if (template) {\r\n          TVA_CONFIG.templateMappings.push(template);\r\n          await updateSettings({\r\n            templateMappings: TVA_CONFIG.templateMappings,\r\n          });\r\n          ui.notifications.info(`Template {${template.name}} copied to User templates.`);\r\n          this.render(true);\r\n        }\r\n      }\r\n    });\r\n\r\n    html.find('.create').on('click', () => {\r\n      showMappingSelectDialog(this.mappings, {\r\n        title1: 'Create Template',\r\n        callback: (selectedMappings) => {\r\n          if (selectedMappings?.length) showUserTemplateCreateDialog(selectedMappings);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  _getHeaderButtons() {\r\n    const buttons = super._getHeaderButtons();\r\n    buttons.unshift({\r\n      label: 'Upload Template',\r\n      class: '.token-variants-submit-template',\r\n      icon: 'fa-solid fa-cloud-arrow-up',\r\n      onclick: () => {\r\n        new TemplateSubmissionForm().render(true);\r\n      },\r\n    });\r\n    return buttons;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {}\r\n}\r\n\r\nclass TemplateSubmissionForm extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static apiKey = 'AIzaSyCJpwIkpjrG10jaHwcpllvSChxRPawcMXE';\r\n\r\n  static get pk() {\r\n    const k2 = 'AIzaSyCJpw';\r\n    const k1 = 'IkpjrG10jaHwcpllv';\r\n    const k3 = 'SChxRPawcMXE';\r\n    return k2 + k1 + k3;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-template-submission',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/templateSubmission.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      title: 'Upload Template',\r\n      width: 500,\r\n      height: 'auto',\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n\r\n    data.systemID = game.system.id;\r\n    data.systemTitle = game.system.title;\r\n    data.templates = TVA_CONFIG.templateMappings;\r\n\r\n    data.modules = game.modules\r\n      .filter((m) => m.active)\r\n      .map((m) => {\r\n        return { id: m.name, name: m.title };\r\n      });\r\n\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (!formData.template) return;\r\n    let template = TVA_CONFIG.templateMappings.find((t) => t.id === formData.template);\r\n    if (!template) return;\r\n\r\n    const name = formData.name.trim() || template.name;\r\n    const hint = formData.hint.trim() || template.hint?.trim();\r\n    const createdBy = formData.createdBy.trim();\r\n    const system = formData.system;\r\n\r\n    if (!(formData.modules instanceof Array)) formData.modules = [formData.modules];\r\n    const modules = formData.modules.filter(Boolean).map((id) => {\r\n      return { id, name: game.modules.get(id).title };\r\n    });\r\n\r\n    const id = foundry.utils.randomID();\r\n    const img = formData.img.trim();\r\n\r\n    const result = await submitTemplate({\r\n      id,\r\n      name,\r\n      hint,\r\n      img,\r\n      createdBy,\r\n      system,\r\n      modules,\r\n      mappings: template.mappings,\r\n    });\r\n    if (result) this.close();\r\n  }\r\n}\r\n\r\nfunction _setStringField(template, fields, field) {\r\n  if (template[field] && template[field] !== '') {\r\n    fields[field] = { stringValue: template[field] };\r\n  }\r\n}\r\n\r\nasync function submitTemplate(template) {\r\n  const fields = {};\r\n  ['name', 'hint', 'img', 'id', 'createdBy', 'system'].forEach((field) => _setStringField(template, fields, field));\r\n  fields.modules = { stringValue: template.modules.length ? JSON.stringify(template.modules) : '' };\r\n  fields.mappings = { stringValue: JSON.stringify(template.mappings) };\r\n  fields.createTime = { integerValue: new Date().getTime() };\r\n  fields.approved = { booleanValue: false };\r\n\r\n  const response = await fetch(\r\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents/templates?key=${TemplateSubmissionForm.pk}`,\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify({\r\n        fields: fields,\r\n      }),\r\n      headers: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n    }\r\n  );\r\n\r\n  if (response.ok && response.status === 200) {\r\n    ui.notifications.info('Template submission completed.');\r\n    return true;\r\n  } else {\r\n    ui.notifications.warn('Template submission failed.');\r\n    return false;\r\n  }\r\n}\r\n\r\nconst SEARCH_QUERY = {\r\n  structuredQuery: {\r\n    select: {\r\n      fields: [\r\n        {\r\n          fieldPath: 'id',\r\n        },\r\n        {\r\n          fieldPath: 'name',\r\n        },\r\n        {\r\n          fieldPath: 'hint',\r\n        },\r\n        {\r\n          fieldPath: 'createdBy',\r\n        },\r\n        {\r\n          fieldPath: 'img',\r\n        },\r\n        {\r\n          fieldPath: 'system',\r\n        },\r\n        {\r\n          fieldPath: 'modules',\r\n        },\r\n      ],\r\n    },\r\n    where: {\r\n      fieldFilter: {\r\n        field: {\r\n          fieldPath: 'approved',\r\n        },\r\n        op: 'EQUAL',\r\n        value: {\r\n          booleanValue: true,\r\n        },\r\n      },\r\n    },\r\n    from: [{ collectionId: 'templates' }],\r\n    orderBy: [\r\n      {\r\n        field: {\r\n          fieldPath: 'createTime',\r\n        },\r\n      },\r\n    ],\r\n    offset: 0,\r\n    limit: 50,\r\n  },\r\n};\r\n\r\nasync function communityTemplates(search = null) {\r\n  const response = await fetch(\r\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents:runQuery?key=${TemplateSubmissionForm.pk}`,\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify(SEARCH_QUERY),\r\n      headers: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json',\r\n      },\r\n    }\r\n  );\r\n\r\n  const templates = [];\r\n  if (response.ok && response.status === 200) {\r\n    const documents = await response.json();\r\n\r\n    for (let doc of documents) {\r\n      if ('document' in doc) templates.push(_docToTemplate(doc.document));\r\n    }\r\n  } else {\r\n    ui.notifications.warn('Failed to retrieve Community templates.');\r\n  }\r\n  return templates;\r\n}\r\n\r\nfunction _docToTemplate(doc) {\r\n  const template = {};\r\n  ['id', 'name', 'mappings', 'createdBy', 'img', 'hint', 'system', 'modules'].forEach((f) => {\r\n    template[f] = doc.fields[f]?.stringValue || '';\r\n  });\r\n  if (template.mappings) template.mappings = JSON.parse(template.mappings);\r\n  else template.fileURL = doc.name;\r\n\r\n  if (template.modules) template.modules = JSON.parse(template.modules);\r\n\r\n  if (!template.createdBy) template.createdBy = 'Anonymous';\r\n  return template;\r\n}\r\n\r\nasync function getTemplateFromFileURL(fileURL) {\r\n  const response = await fetch(`https://firestore.googleapis.com/v1/${fileURL}?key=${TemplateSubmissionForm.pk}`, {\r\n    method: 'GET',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n  });\r\n\r\n  if (response.ok && response.status === 200) {\r\n    const doc = await response.json();\r\n    return _docToTemplate(doc);\r\n  }\r\n  return null;\r\n}\r\n","import { getTokenConfig, setTokenConfig } from '../scripts/utils.js';\r\n\r\nexport default class TokenCustomConfig extends foundry.applications.sheets.TokenConfig {\r\n  constructor(object, options, imgSrc, imgName, callback, config) {\r\n    let token;\r\n    if (object instanceof Actor) {\r\n      token = new TokenDocument(object.token, {\r\n        actor: object,\r\n      });\r\n    } else {\r\n      token = new TokenDocument(object.document, {\r\n        actor: game.actors.get(object.actorId),\r\n      });\r\n    }\r\n    super(token, options);\r\n    this.imgSrc = imgSrc;\r\n    this.imgName = imgName;\r\n    this.callback = callback;\r\n    this.config = config;\r\n    if (this.config) {\r\n      this.flags = this.config.flags;\r\n      this.tv_script = this.config.tv_script;\r\n    }\r\n  }\r\n\r\n  _getSubmitData(updateData = {}) {\r\n    if (!this.form) throw new Error('The FormApplication subclass has no registered form element');\r\n    const fd = new FormDataExtended(this.form, { editors: this.editors });\r\n    let data = fd.object;\r\n    if (updateData) data = foundry.utils.flattenObject(foundry.utils.mergeObject(data, updateData));\r\n\r\n    // Clear detection modes array\r\n    if (!('detectionModes.0.id' in data)) data.detectionModes = [];\r\n\r\n    // Treat \"None\" as null for bar attributes\r\n    data['bar1.attribute'] ||= null;\r\n    data['bar2.attribute'] ||= null;\r\n    return data;\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const filtered = {};\r\n\r\n    const form = $(event.target).closest('form');\r\n\r\n    form.find('.form-group').each(function (_) {\r\n      const tva_checkbox = $(this).find('.tva-config-checkbox > input');\r\n      if (tva_checkbox.length && tva_checkbox.is(':checked')) {\r\n        $(this)\r\n          .find('[name]')\r\n          .each(function (_) {\r\n            const name = $(this).attr('name');\r\n            filtered[name] = formData[name];\r\n          });\r\n      }\r\n    });\r\n\r\n    if (this.tv_script) {\r\n      filtered.tv_script = this.tv_script;\r\n    }\r\n\r\n    if (this.config) {\r\n      let config = foundry.utils.expandObject(filtered);\r\n      config.flags = config.flags ? foundry.utils.mergeObject(this.flags || {}, config.flags) : this.flags;\r\n      if (this.callback) this.callback(config);\r\n    } else {\r\n      const saved = setTokenConfig(this.imgSrc, this.imgName, filtered);\r\n      if (this.callback) this.callback(saved);\r\n    }\r\n  }\r\n\r\n  applyCustomConfig() {\r\n    const tokenConfig = foundry.utils.flattenObject(this.config || getTokenConfig(this.imgSrc, this.imgName));\r\n    const form = $(this.form);\r\n    for (const key of Object.keys(tokenConfig)) {\r\n      const el = form.find(`[name=\"${key}\"]`);\r\n      if (el.is(':checkbox')) {\r\n        el.prop('checked', tokenConfig[key]);\r\n      } else {\r\n        el.val(tokenConfig[key]);\r\n      }\r\n      el.trigger('change');\r\n    }\r\n  }\r\n\r\n  // *************\r\n  // consider moving html injection to:\r\n  // _replaceHTML | _injectHTML\r\n\r\n  async activateListeners(html) {\r\n    await super.activateListeners(html);\r\n\r\n    // Disable image path controls\r\n    $(html).find('.token-variants-image-select-button').prop('disabled', true);\r\n    $(html).find('.file-picker').prop('disabled', true);\r\n    $(html).find('.image').prop('disabled', true);\r\n\r\n    // Remove 'Assign Token' button\r\n    $(html).find('.assign-token').remove();\r\n\r\n    // Add checkboxes to control inclusion of specific tabs in the custom config\r\n    const tokenConfig = this.config || getTokenConfig(this.imgSrc, this.imgName);\r\n    this.tv_script = tokenConfig.tv_script;\r\n\r\n    $(html).on('change', '.tva-config-checkbox', this._onCheckboxChange);\r\n\r\n    const processFormGroup = function (formGroup) {\r\n      // Checkbox is not added for the Image Path group\r\n      if (!$(formGroup).find('[name=\"img\"]').length) {\r\n        let savedField = false;\r\n        if (tokenConfig) {\r\n          const flatConfig = foundry.utils.flattenObject(tokenConfig);\r\n          $(formGroup)\r\n            .find('[name]')\r\n            .each(function (_) {\r\n              const name = $(this).attr('name');\r\n              if (name in flatConfig) {\r\n                savedField = true;\r\n              }\r\n            });\r\n        }\r\n\r\n        const checkbox = $(\r\n          `<div class=\"tva-config-checkbox\"><input type=\"checkbox\" data-dtype=\"Boolean\" ${\r\n            savedField ? 'checked=\"\"' : ''\r\n          }></div>`\r\n        );\r\n        if ($(formGroup).find('p.hint').length) {\r\n          $(formGroup).find('p.hint').before(checkbox);\r\n        } else {\r\n          $(formGroup).append(checkbox);\r\n        }\r\n        checkbox.find('input').trigger('change');\r\n      }\r\n    };\r\n    // Add checkboxes to each form-group to control highlighting and which fields will are to be saved\r\n    $(html)\r\n      .find('.form-group')\r\n      .each(function (index) {\r\n        processFormGroup(this);\r\n      });\r\n\r\n    // Add 'update' and 'remove' config buttons\r\n    $(html).find('.sheet-footer > button').remove();\r\n    $(html)\r\n      .find('.sheet-footer')\r\n      .append('<button type=\"submit\" value=\"1\"><i class=\"far fa-save\"></i> Save Config</button>');\r\n    if (tokenConfig) {\r\n      $(html)\r\n        .find('.sheet-footer')\r\n        .append('<button type=\"button\" class=\"remove-config\"><i class=\"fas fa-trash\"></i> Remove Config</button>');\r\n      html.find('.remove-config').click(this._onRemoveConfig.bind(this));\r\n    }\r\n\r\n    // Pre-select image or appearance tab\r\n    $(html).find('.tabs > .item[data-tab=\"image\"] > i').trigger('click');\r\n    $(html).find('.tabs > .item[data-tab=\"appearance\"] > i').trigger('click');\r\n\r\n    document.activeElement.blur(); // Hack fix for key UP/DOWN effects not registering after config has been opened\r\n\r\n    // TokenConfig might be changed by some modules after activateListeners is processed\r\n    // Look out for these updates and add checkboxes for any newly added form-groups\r\n    const mutate = (mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        mutation.addedNodes.forEach((node) => {\r\n          if (node.nodeName === 'DIV' && node.className === 'form-group') {\r\n            processFormGroup(node);\r\n            this.applyCustomConfig();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    const observer = new MutationObserver(mutate);\r\n    observer.observe(html[0], {\r\n      characterData: false,\r\n      attributes: false,\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    // On any field being changed we want to automatically select the form-group to be included in the update\r\n    $(html).on('change', 'input, select', onInputChange);\r\n    $(html).on('click', 'button', onInputChange);\r\n\r\n    this.applyCustomConfig();\r\n  }\r\n\r\n  async _onCheckboxChange(event) {\r\n    const checkbox = $(event.target);\r\n    checkbox.closest('.form-group').css({\r\n      'outline-color': checkbox.is(':checked') ? 'green' : '#ffcc6e',\r\n      'outline-width': '2px',\r\n      'outline-style': 'dotted',\r\n      'margin-bottom': '5px',\r\n    });\r\n    checkbox.closest('.tva-config-checkbox').css({\r\n      'outline-color': checkbox.is(':checked') ? 'green' : '#ffcc6e',\r\n      'outline-width': '2px',\r\n      'outline-style': 'solid',\r\n    });\r\n  }\r\n\r\n  async _onRemoveConfig(event) {\r\n    if (this.config) {\r\n      if (this.callback) this.callback({});\r\n    } else {\r\n      const saved = setTokenConfig(this.imgSrc, this.imgName, null);\r\n      if (this.callback) this.callback(saved);\r\n    }\r\n    this.close();\r\n  }\r\n\r\n  get id() {\r\n    return `token-custom-config-${this.document.id}`;\r\n  }\r\n}\r\n\r\n// Toggle checkbox if input has been detected inside it's form-group\r\nasync function onInputChange(event) {\r\n  if (event.target.parentNode.className === 'tva-config-checkbox') return;\r\n  $(event.target).closest('.form-group').find('.tva-config-checkbox input').prop('checked', true);\r\n}\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { SEARCH_TYPE, decodeURISafely } from '../scripts/utils.js';\r\nimport { insertArtSelectButton } from './artSelect.js';\r\n\r\nexport default class UserList extends FormApplication {\r\n  constructor(object, img, regenStyle) {\r\n    super({}, {});\r\n    this.object = object;\r\n    this.img = img;\r\n    this.regenStyle = regenStyle;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-user-list',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/userList.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'User To Image',\r\n      width: 300,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\r\n    let users = [];\r\n    game.users.forEach((user) => {\r\n      users.push({\r\n        avatar: user.avatar,\r\n        name: user.name,\r\n        apply: user.id in mappings && mappings[user.id] === this.img,\r\n        userId: user.id,\r\n        color: user.color,\r\n      });\r\n    });\r\n    data.users = users;\r\n    data.invisibleImage = TVA_CONFIG.invisibleImage;\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    insertArtSelectButton(html, 'invisibleImage', {\r\n      search: 'Invisible Image',\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n    });\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\r\n\r\n    if (formData.invisibleImage !== TVA_CONFIG.invisibleImage) {\r\n      updateSettings({ invisibleImage: decodeURISafely(formData.invisibleImage) });\r\n    }\r\n    delete formData.invisibleImage;\r\n\r\n    const affectedImages = [this.img];\r\n\r\n    for (const [userId, apply] of Object.entries(formData)) {\r\n      if (apply) {\r\n        if (mappings[userId] && mappings[userId] !== this.img) affectedImages.push(mappings[userId]);\r\n        mappings[userId] = this.img;\r\n      } else if (mappings[userId] === this.img) {\r\n        delete mappings[userId];\r\n        mappings['-=' + userId] = null;\r\n      }\r\n    }\r\n\r\n    if (Object.keys(mappings).filter((userId) => !userId.startsWith('-=')).length === 0) {\r\n      await this.object.document.unsetFlag('token-variants', 'userMappings');\r\n    } else {\r\n      await this.object.document.setFlag('token-variants', 'userMappings', mappings);\r\n    }\r\n\r\n    for (const img of affectedImages) {\r\n      this.regenStyle(this.object, img);\r\n    }\r\n  }\r\n}\r\n","export default class FlagsConfig extends FormApplication {\r\n  constructor(obj) {\r\n    super({}, {});\r\n    if (obj instanceof Tile) {\r\n      this.objectToFlag = obj.document;\r\n      this.isTile = true;\r\n    } else {\r\n      this.objectToFlag = game.actors.get(obj.document.actorId) || obj.document;\r\n    }\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-token-flags',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/flagsConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Flags',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const popups = this.objectToFlag.getFlag('token-variants', 'popups');\r\n    const disableNameSearch = this.objectToFlag.getFlag('token-variants', 'disableNameSearch');\r\n    const directory = this.objectToFlag.getFlag('token-variants', 'directory') || {};\r\n\r\n    return foundry.utils.mergeObject(data, {\r\n      popups: popups,\r\n      popupsSetFlag: popups != null,\r\n      disableNameSearch: disableNameSearch,\r\n      disableNameSearchSetFlag: disableNameSearch != null,\r\n      directory: directory.path,\r\n      directorySource: directory.source,\r\n      directorySetFlag: !foundry.utils.isEmpty(directory),\r\n      tile: this.isTile,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.controlFlag').click((e) => {\r\n      $(e.target).siblings('.flag').prop('disabled', !e.target.checked);\r\n    });\r\n    html.find('.directory-fp').click((event) => {\r\n      new foundry.applications.apps.FilePicker.implementation({\r\n        type: 'folder',\r\n        activeSource: 'data',\r\n        callback: (path, fp) => {\r\n          html.find('[name=\"directory\"]').val(fp.result.target);\r\n          $(event.target)\r\n            .closest('button')\r\n            .attr('title', 'Directory: ' + fp.result.target);\r\n          const sourceEl = html.find('[name=\"directorySource\"]');\r\n          if (fp.activeSource === 's3') {\r\n            sourceEl.val(`s3:${fp.result.bucket}`);\r\n          } else {\r\n            sourceEl.val(fp.activeSource);\r\n          }\r\n        },\r\n      }).render(true);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if ('directory' in formData) {\r\n      formData.directory = { path: formData.directory, source: formData.directorySource };\r\n    }\r\n\r\n    ['popups', 'disableNameSearch', 'directory'].forEach((flag) => {\r\n      if (flag in formData) {\r\n        this.objectToFlag.setFlag('token-variants', flag, formData[flag]);\r\n      } else {\r\n        this.objectToFlag.unsetFlag('token-variants', flag);\r\n      }\r\n    });\r\n  }\r\n}\r\n","export default class RandomizerConfig extends FormApplication {\r\n  constructor(obj) {\r\n    super({}, {});\r\n    this.actor = game.actors.get(obj.actorId);\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-token-flags',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/randomizerConfig.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      title: 'Randomizer',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    const settings = this.actor.getFlag('token-variants', 'randomizerSettings') || {};\r\n    data.randomizer = settings;\r\n    data.hasSettings = !foundry.utils.isEmpty(settings);\r\n    data.nameForgeActive = game.modules.get('nameforge')?.active;\r\n    if (data.randomizer.nameForge?.models && Array.isArray(data.randomizer.nameForge.models)) {\r\n      data.randomizer.nameForge.models = data.randomizer.nameForge.models.join(',');\r\n    }\r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.selectNameForgeModels').click(this._selectNameForgeModels.bind(this));\r\n\r\n    // Can't have both tokenName and actorName checkboxes checked at the same time\r\n    const tokenName = html.find('input[name=\"randomizer.tokenName\"]');\r\n    const actorName = html.find('input[name=\"randomizer.actorName\"]');\r\n    tokenName.change(() => {\r\n      if (tokenName.is(':checked')) actorName.prop('checked', false);\r\n    });\r\n    actorName.change(() => {\r\n      if (actorName.is(':checked')) tokenName.prop('checked', false);\r\n    });\r\n  }\r\n\r\n  _selectNameForgeModels(event) {\r\n    const inputSelected = $(event.target).siblings('input');\r\n    const selected = inputSelected.val().split(',');\r\n    const genCheckbox = function (name, value) {\r\n      return `\r\n      <div class=\"form-group\">\r\n        <label>${name}</label>\r\n        <div class=\"form-fields\">\r\n            <input type=\"checkbox\" name=\"model\" value=\"${value}\" data-dtype=\"Boolean\" ${\r\n        selected?.find((v) => v === value) ? 'checked' : ''\r\n      }>\r\n        </div>\r\n      </div>\r\n      `;\r\n    };\r\n\r\n    let content = '<form style=\"overflow-y: scroll; height:400px;\">';\r\n\r\n    const models = game.modules.get('nameforge').models;\r\n    for (const [k, v] of Object.entries(models.defaultModels)) {\r\n      content += genCheckbox(v.name, 'defaultModels.' + k);\r\n    }\r\n    for (const [k, v] of Object.entries(models.userModels)) {\r\n      content += genCheckbox(v.name, 'userModels.' + k);\r\n    }\r\n    content += `</form>`;\r\n\r\n    new Dialog({\r\n      title: `Name Forge Models`,\r\n      content: content,\r\n      buttons: {\r\n        Ok: {\r\n          label: `Select`,\r\n          callback: async (html) => {\r\n            const selectedModels = [];\r\n            html.find('input[type=\"checkbox\"]').each(function () {\r\n              if (this.checked) selectedModels.push(this.value);\r\n            });\r\n            inputSelected.val(selectedModels.join(','));\r\n          },\r\n        },\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    if (event.submitter.value === 'remove') {\r\n      await this.actor.unsetFlag('token-variants', 'randomizerSettings');\r\n    } else {\r\n      const expanded = foundry.utils.expandObject(formData);\r\n      if (expanded.randomizer.nameForge?.models) {\r\n        expanded.randomizer.nameForge.models = expanded.randomizer.nameForge.models.split(',');\r\n      }\r\n      this.actor.setFlag('token-variants', 'randomizerSettings', expanded.randomizer);\r\n    }\r\n  }\r\n}\r\n","import {\r\n  getFileName,\r\n  isImage,\r\n  isVideo,\r\n  SEARCH_TYPE,\r\n  keyPressed,\r\n  updateActorImage,\r\n  updateTokenImage,\r\n  decodeURISafely,\r\n} from '../scripts/utils.js';\r\nimport TokenCustomConfig from './tokenCustomConfig.js';\r\nimport EffectMappingForm from './effectMappingForm.js';\r\nimport { TVA_CONFIG } from '../scripts/settings.js';\r\nimport UserList from './userList.js';\r\nimport FlagsConfig from './flagsConfig.js';\r\nimport RandomizerConfig from './randomizerConfig.js';\r\nimport { doImageSearch, findImagesFuzzy } from '../scripts/search.js';\r\n\r\nexport const TOKEN_HUD_VARIANTS = { variants: null, actor: null };\r\n\r\nexport async function renderTokenHUD(hud, html, token, searchText = '', fp_files = null) {\r\n  //activateStatusEffectListeners(token);\r\n\r\n  const hudSettings = TVA_CONFIG.hud;\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\r\n\r\n  // Check if the HUD button should be displayed\r\n  if (\r\n    !hudSettings.enableSideMenu ||\r\n    (!PARTIAL_ACCESS && !FULL_ACCESS) ||\r\n    token.flags['token-variants']?.disableHUDButton\r\n  )\r\n    return;\r\n\r\n  const tokenActor = game.actors.get(token.actorId);\r\n\r\n  // Disable button if Token HUD Wildcard is enabled and appropriate setting is set\r\n  if (TVA_CONFIG.worldHud.disableIfTHWEnabled && game.modules.get('token-hud-wildcard')?.active) {\r\n    if (tokenActor && tokenActor.prototypeToken.randomImg) return;\r\n  }\r\n\r\n  const button = $(`\r\n  <button type=\"button\" class=\"control-icon\" data-action=\"tva\" data-palette=\"tva\" data-tooltip=\"Left-click: Image Menu&#013;Shift+Left-click: Search & Additional settings\">\r\n    <img src=\"modules/token-variants/img/token-images.svg\" width=\"36\" height=\"36\"/>\r\n  </button>\r\n`);\r\n\r\n  html.querySelector('div.right').appendChild(button[0]);\r\n}\r\n\r\nexport async function renderContextMenuPalette(token) {\r\n  const contextMenu = $(\r\n    await foundry.applications.handlebars.renderTemplate('modules/token-variants/templates/contextMenuPalette.html', {})\r\n  );\r\n\r\n  // Register contextmenu listeners\r\n  contextMenu\r\n    .find('.token-variants-side-search')\r\n    .on('keyup', (event) => _onImageSearchKeyUp(event, token))\r\n    .on('click', (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    });\r\n  contextMenu.find('.flags').click((event) => {\r\n    const tkn = canvas.tokens.get(token._id);\r\n    if (tkn) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      new FlagsConfig(tkn).render(true);\r\n    }\r\n  });\r\n  contextMenu.find('.file-picker').click(async (event) => {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    new foundry.applications.apps.FilePicker.implementation({\r\n      type: 'imagevideo',\r\n      callback: async (path, fp) => {\r\n        const content = await foundry.applications.apps.FilePicker.implementation.browse(\r\n          fp.activeSource,\r\n          fp.result.target\r\n        );\r\n        let files = content.files.filter((f) => isImage(f) || isVideo(f));\r\n        if (files.length) {\r\n          const palette = await renderPalette(token, '', files);\r\n          palette.addClass('active');\r\n          contextMenu.replaceWith(palette);\r\n        }\r\n      },\r\n    }).render(true);\r\n  });\r\n  contextMenu.find('.effectConfig').click((event) => {\r\n    new EffectMappingForm(token).render(true);\r\n  });\r\n  contextMenu.find('.randomizerConfig').click((event) => {\r\n    new RandomizerConfig(token).render(true);\r\n  });\r\n  return contextMenu;\r\n}\r\n\r\nexport async function renderPalette(token, searchText = '', fp_files = null) {\r\n  const hudSettings = TVA_CONFIG.hud;\r\n  const worldHudSettings = TVA_CONFIG.worldHud;\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\r\n\r\n  const tokenActor = game.actors.get(token.actorId);\r\n\r\n  let images = [];\r\n  let actorVariants = [];\r\n  let imageDuplicates = new Set();\r\n  const pushImage = (img) => {\r\n    if (imageDuplicates.has(img.path)) {\r\n      if (!images.find((obj) => obj.path === img.path && obj.name === img.name)) {\r\n        images.push(img);\r\n      }\r\n    } else {\r\n      images.push(img);\r\n      imageDuplicates.add(img.path);\r\n    }\r\n  };\r\n\r\n  actorVariants = getVariants(tokenActor);\r\n\r\n  if (!fp_files) {\r\n    if (!searchText) {\r\n      // Insert current token image\r\n      if (token.texture?.src && token.texture?.src !== CONST.DEFAULT_TOKEN) {\r\n        pushImage({\r\n          path: decodeURISafely(token.texture.src),\r\n          name: token.flags?.['token-variants']?.name ?? getFileName(token.texture.src),\r\n        });\r\n      }\r\n\r\n      if (tokenActor) {\r\n        // Insert default token image\r\n        const defaultImg =\r\n          tokenActor.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n          tokenActor.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n          '';\r\n        if (defaultImg) {\r\n          pushImage({ path: decodeURISafely(defaultImg), name: getFileName(defaultImg) });\r\n        }\r\n\r\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\r\n          actorVariants.forEach((variant) => {\r\n            for (const name of variant.names) {\r\n              pushImage({ path: decodeURISafely(variant.imgSrc), name: name });\r\n            }\r\n          });\r\n        }\r\n\r\n        // Parse directory flag and include the images\r\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\r\n          const directoryFlag = tokenActor.getFlag('token-variants', 'directory');\r\n          if (directoryFlag) {\r\n            let dirFlagImages;\r\n            try {\r\n              let path = directoryFlag.path;\r\n              let source = directoryFlag.source;\r\n              let bucket = '';\r\n              if (source.startsWith('s3:')) {\r\n                bucket = source.substring(3, source.length);\r\n                source = 's3';\r\n              }\r\n              const content = await foundry.applications.apps.FilePicker.implementation.browse(source, path, {\r\n                type: 'imagevideo',\r\n                bucket,\r\n              });\r\n              dirFlagImages = content.files;\r\n            } catch (err) {\r\n              dirFlagImages = [];\r\n            }\r\n            dirFlagImages = dirFlagImages.forEach((f) => {\r\n              if (isImage(f) || isVideo(f)) pushImage({ path: decodeURISafely(f), name: getFileName(f) });\r\n            });\r\n          }\r\n        }\r\n\r\n        if (\r\n          (FULL_ACCESS || PARTIAL_ACCESS) &&\r\n          worldHudSettings.includeWildcard &&\r\n          !worldHudSettings.displayOnlySharedImages\r\n        ) {\r\n          // Merge wildcard images\r\n          const protoImg = tokenActor.prototypeToken.texture.src;\r\n          if (tokenActor.prototypeToken.randomImg) {\r\n            (await tokenActor.getTokenImages())\r\n              .filter((img) => !img.includes('*'))\r\n              .forEach((img) => {\r\n                pushImage({ path: decodeURISafely(img), name: getFileName(img) });\r\n              });\r\n          } else if (protoImg.includes('*') || protoImg.includes('{') || protoImg.includes('}')) {\r\n            // Modified version of Actor.getTokenImages()\r\n            const getTokenImages = async () => {\r\n              if (tokenActor._tokenImages) return tokenActor._tokenImages;\r\n\r\n              let source = 'data';\r\n              let pattern = tokenActor.prototypeToken.texture.src;\r\n              const browseOptions = { wildcard: true };\r\n\r\n              // Support non-user sources\r\n              if (/\\.s3\\./.test(pattern)) {\r\n                source = 's3';\r\n                const { bucket, keyPrefix } = foundry.applications.apps.FilePicker.implementation.parseS3URL(pattern);\r\n                if (bucket) {\r\n                  browseOptions.bucket = bucket;\r\n                  pattern = keyPrefix;\r\n                }\r\n              } else if (pattern.startsWith('icons/')) source = 'public';\r\n\r\n              // Retrieve wildcard content\r\n              try {\r\n                const content = await foundry.applications.apps.FilePicker.implementation.browse(\r\n                  source,\r\n                  pattern,\r\n                  browseOptions\r\n                );\r\n                tokenActor._tokenImages = content.files;\r\n              } catch (err) {\r\n                tokenActor._tokenImages = [];\r\n              }\r\n              return tokenActor._tokenImages;\r\n            };\r\n\r\n            (await getTokenImages())\r\n              .filter((img) => !img.includes('*') && (isImage(img) || isVideo(img)))\r\n              .forEach((variant) => {\r\n                pushImage({ path: decodeURISafely(variant), name: getFileName(variant) });\r\n              });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Perform image search if needed\r\n    if (FULL_ACCESS) {\r\n      let search;\r\n      if (searchText) {\r\n        search = searchText.length > 2 ? searchText : null;\r\n      } else {\r\n        if (worldHudSettings.displayOnlySharedImages || tokenActor?.getFlag('token-variants', 'disableNameSearch')) {\r\n          // No search\r\n        } else if (token.name.length > 2) {\r\n          search = token.name;\r\n        }\r\n      }\r\n\r\n      if (search) {\r\n        let artSearch = await doImageSearch(search, {\r\n          searchType: SEARCH_TYPE.TOKEN,\r\n          searchOptions: { keywordSearch: worldHudSettings.includeKeywords },\r\n        });\r\n\r\n        // Merge full search, and keywords into a single array\r\n        if (artSearch) {\r\n          artSearch.forEach((results) => {\r\n            results.forEach((img) => pushImage(img));\r\n          });\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    images = fp_files.map((f) => {\r\n      return { path: decodeURISafely(f), name: getFileName(f) };\r\n    });\r\n  }\r\n\r\n  // Retrieving the possibly custom name attached as a flag to the token\r\n  let tokenImageName = '';\r\n  if (token.flags['token-variants'] && token.flags['token-variants']['name']) {\r\n    tokenImageName = token.flags['token-variants']['name'];\r\n  } else {\r\n    tokenImageName = getFileName(token.texture.src);\r\n  }\r\n\r\n  let imagesParsed = [];\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  const tkn = canvas.tokens.get(token._id);\r\n  const userMappings = tkn.document.getFlag('token-variants', 'userMappings') || {};\r\n\r\n  for (const imageObj of images) {\r\n    const img = isImage(imageObj.path);\r\n    const vid = isVideo(imageObj.path);\r\n\r\n    const hasConfig = Boolean(\r\n      tokenConfigs.find((config) => config.tvImgSrc === imageObj.path && config.tvImgName === imageObj.name)\r\n    );\r\n    let shared = false;\r\n    if (TVA_CONFIG.permissions.hudFullAccess[game.user.role]) {\r\n      actorVariants.forEach((variant) => {\r\n        if (variant.imgSrc === imageObj.path && variant.names.includes(imageObj.name)) {\r\n          shared = true;\r\n        }\r\n      });\r\n    }\r\n\r\n    const [title, style] = genTitleAndStyle(userMappings, imageObj.path, imageObj.name);\r\n\r\n    imagesParsed.push({\r\n      route: imageObj.path,\r\n      name: imageObj.name,\r\n      used: imageObj.path === token.texture.src && imageObj.name === tokenImageName,\r\n      img,\r\n      vid,\r\n      unknownType: !img && !vid,\r\n      shared: shared,\r\n      hasConfig: hasConfig,\r\n      title: title,\r\n      style: game.user.isGM && style ? 'box-shadow: ' + style + ';' : null,\r\n    });\r\n  }\r\n\r\n  //\r\n  // Render\r\n  //\r\n  const imageOpacity = hudSettings.imageOpacity / 100;\r\n\r\n  const sideSelect = $(\r\n    await foundry.applications.handlebars.renderTemplate('modules/token-variants/templates/palette.html', {\r\n      imagesParsed,\r\n      imageOpacity,\r\n      tokenHud: true,\r\n    })\r\n  );\r\n\r\n  // Activate listeners\r\n  sideSelect.find('video').hover(\r\n    function () {\r\n      if (TVA_CONFIG.playVideoOnHover) {\r\n        this.play();\r\n        $(this).siblings('.fa-play').hide();\r\n      }\r\n    },\r\n    function () {\r\n      if (TVA_CONFIG.pauseVideoOnHoverOut) {\r\n        this.pause();\r\n        this.currentTime = 0;\r\n        $(this).siblings('.fa-play').show();\r\n      }\r\n    }\r\n  );\r\n  sideSelect.find('.token-variants-button-select').click((event) => _onImageClick(event, token._id));\r\n\r\n  if (FULL_ACCESS) {\r\n    sideSelect.find('.token-variants-button-select').on('contextmenu', (event) => _onImageRightClick(event, token._id));\r\n  }\r\n\r\n  return sideSelect;\r\n}\r\n\r\nasync function _onImageClick(event, tokenId) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n\r\n  const token = canvas.tokens.controlled.find((t) => t.document.id === tokenId);\r\n  if (!token) return;\r\n\r\n  const worldHudSettings = TVA_CONFIG.worldHud;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n\r\n  if (!imgSrc || !name) return;\r\n\r\n  if (keyPressed('config') && game.user.isGM) {\r\n    const toggleCog = (saved) => {\r\n      const cog = imgButton.find('.fa-cog');\r\n      if (saved) {\r\n        cog.addClass('active');\r\n      } else {\r\n        cog.removeClass('active');\r\n      }\r\n    };\r\n    new TokenCustomConfig(token, {}, imgSrc, name, toggleCog).render(true);\r\n  } else if (token.document.texture.src === imgSrc) {\r\n    let tokenImageName = token.document.getFlag('token-variants', 'name');\r\n    if (!tokenImageName) tokenImageName = getFileName(token.document.texture.src);\r\n    if (tokenImageName !== name) {\r\n      await updateTokenImage(imgSrc, {\r\n        token: token,\r\n        imgName: name,\r\n        animate: worldHudSettings.animate,\r\n      });\r\n      if (token.actor && worldHudSettings.updateActorImage) {\r\n        if (worldHudSettings.useNameSimilarity) {\r\n          updateActorWithSimilarName(imgSrc, name, token.actor);\r\n        } else {\r\n          updateActorImage(token.actor, imgSrc, { imgName: name });\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    await updateTokenImage(imgSrc, {\r\n      token: token,\r\n      imgName: name,\r\n      animate: worldHudSettings.animate,\r\n    });\r\n    if (token.actor && worldHudSettings.updateActorImage) {\r\n      if (worldHudSettings.useNameSimilarity) {\r\n        updateActorWithSimilarName(imgSrc, name, token.actor);\r\n      } else {\r\n        updateActorImage(token.actor, imgSrc, { imgName: name });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function _onImageRightClick(event, tokenId) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n  let token = canvas.tokens.controlled.find((t) => t.document.id === tokenId);\r\n  if (!token) return;\r\n\r\n  const imgButton = $(event.target).closest('.token-variants-button-select');\r\n  const imgSrc = imgButton.attr('data-name');\r\n  const name = imgButton.attr('data-filename');\r\n\r\n  if (!imgSrc || !name) return;\r\n\r\n  if (keyPressed('config') && game.user.isGM) {\r\n    const regenStyle = (token, img) => {\r\n      const mappings = token.document.getFlag('token-variants', 'userMappings') || {};\r\n      const name = imgButton.attr('data-filename');\r\n      const [title, style] = genTitleAndStyle(mappings, img, name);\r\n      imgButton\r\n        .closest('.token-variants-palette')\r\n        .find(`.token-variants-button-select[data-name='${img}']`)\r\n        .css('box-shadow', style)\r\n        .prop('title', title);\r\n    };\r\n    new UserList(token, imgSrc, regenStyle).render(true);\r\n  } else if (token.actor) {\r\n    let tokenActor = game.actors.get(token.actor.id);\r\n    let variants = getVariants(tokenActor);\r\n\r\n    // Remove selected variant if present in the flag, add otherwise\r\n    let del = false;\r\n    let updated = false;\r\n    for (let variant of variants) {\r\n      if (variant.imgSrc === imgSrc) {\r\n        let fNames = variant.names.filter((name) => name !== name);\r\n        if (fNames.length === 0) {\r\n          del = true;\r\n        } else if (fNames.length === variant.names.length) {\r\n          fNames.push(name);\r\n        }\r\n        variant.names = fNames;\r\n        updated = true;\r\n        break;\r\n      }\r\n    }\r\n    if (del) variants = variants.filter((variant) => variant.imgSrc !== imgSrc);\r\n    else if (!updated) variants.push({ imgSrc: imgSrc, names: [name] });\r\n\r\n    // Set shared variants as an actor flag\r\n    setVariants(tokenActor, variants);\r\n    imgButton.find('.fa-share').toggleClass('active'); // Display green arrow\r\n  }\r\n}\r\n\r\nasync function _onImageSearchKeyUp(event, token) {\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n  if (event.key === 'Enter' || event.keyCode === 13) {\r\n    if (event.target.value.length >= 3) {\r\n      const palette = $(event.target).closest('.palette');\r\n      const sideSelect = await renderPalette(token, event.target.value);\r\n      sideSelect.addClass('active');\r\n      palette.replaceWith(sideSelect);\r\n    }\r\n  }\r\n}\r\n\r\nfunction genTitleAndStyle(mappings, imgSrc, name) {\r\n  let title = TVA_CONFIG.worldHud.showFullPath ? imgSrc : name;\r\n  let style = '';\r\n  let offset = 2;\r\n  for (const [userId, img] of Object.entries(mappings)) {\r\n    if (img === imgSrc) {\r\n      const user = game.users.get(userId);\r\n      if (!user) continue;\r\n      if (style.length === 0) {\r\n        style = `inset 0 0 0 ${offset}px ${user.color}`;\r\n      } else {\r\n        style += `, inset 0 0 0 ${offset}px ${user.color}`;\r\n      }\r\n      offset += 2;\r\n      title += `\\nDisplayed to: ${user.name}`;\r\n    }\r\n  }\r\n  return [title, style];\r\n}\r\n\r\nasync function updateActorWithSimilarName(imgSrc, imgName, actor) {\r\n  const results = await findImagesFuzzy(\r\n    imgName,\r\n    SEARCH_TYPE.PORTRAIT,\r\n    {\r\n      algorithm: {\r\n        fuzzyThreshold: 0.4,\r\n        fuzzyLimit: 50,\r\n      },\r\n    },\r\n    true\r\n  );\r\n\r\n  if (results && results.length !== 0) {\r\n    updateActorImage(actor, results[0].path, { imgName: results[0].name });\r\n  } else {\r\n    updateActorImage(actor, imgSrc, { imgName: imgName });\r\n  }\r\n}\r\n\r\nfunction activateStatusEffectListeners(token) {\r\n  if (TVA_CONFIG.permissions.statusConfig[game.user.role] && token.actorId && game.actors.get(token.actorId)) {\r\n    $('.control-icon[data-action=\"effects\"]')\r\n      .find('img:first')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token).render(true);\r\n        }\r\n      });\r\n\r\n    $('.control-icon[data-action=\"visibility\"]')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: 'In Combat', expression: 'token-variants-visibility' },\r\n          }).render(true);\r\n        }\r\n      });\r\n\r\n    $('.control-icon[data-action=\"combat\"]')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: 'In Combat', expression: 'token-variants-combat' },\r\n          }).render(true);\r\n        }\r\n      });\r\n\r\n    $('.status-effects')\r\n      .find('img')\r\n      .click((event) => {\r\n        event.preventDefault();\r\n        if (keyPressed('config')) {\r\n          event.stopPropagation();\r\n\r\n          let effectName = $(event.target).data('tooltip');\r\n          if (game.system.id === 'pf2e') {\r\n            effectName = $(event.target).closest('picture').attr('title');\r\n          }\r\n          new EffectMappingForm(token, {\r\n            createMapping: { label: effectName, expression: effectName },\r\n          }).render(true);\r\n        }\r\n      });\r\n  }\r\n}\r\n\r\nfunction getVariants(actor) {\r\n  if (TOKEN_HUD_VARIANTS.variants) return TOKEN_HUD_VARIANTS.variants;\r\n  else return actor?.getFlag('token-variants', 'variants') || [];\r\n}\r\n\r\nfunction setVariants(actor, variants) {\r\n  TOKEN_HUD_VARIANTS.variants = variants;\r\n  TOKEN_HUD_VARIANTS.actor = actor;\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG, getFlagMappings, updateSettings } from '../settings.js';\r\nimport {\r\n  applyCEEffect,\r\n  applyTMFXPreset,\r\n  determineAddedRemovedEffects,\r\n  executeMacro,\r\n  EXPRESSION_OPERATORS,\r\n  getAllActorTokens,\r\n  getFileName,\r\n  mergeMappings,\r\n  tv_executeScript,\r\n  updateTokenImage,\r\n} from '../utils.js';\r\nimport { broadcastDrawOverlays, drawOverlays } from '../token/overlay.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\nimport { CORE_TEMPLATES } from '../mappingTemplates.js';\r\n\r\nconst EXPRESSION_MATCH_RE = /(\\\\\\()|(\\\\\\))|(\\|\\|)|(\\&\\&)|(\\\\\\!)/g;\r\nconst PF2E_ITEM_TYPES = ['condition', 'effect', 'weapon', 'equipment'];\r\nconst ITEM_TYPES = ['equipment', 'weapon'];\r\nconst feature_id = 'EffectMappings';\r\n\r\nexport function registerEffectMappingHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    [\r\n      'canvasReady',\r\n      'createActiveEffect',\r\n      'deleteActiveEffect',\r\n      'preUpdateActiveEffect',\r\n      'updateActiveEffect',\r\n      'createCombatant',\r\n      'deleteCombatant',\r\n      'preUpdateCombat',\r\n      'updateCombat',\r\n      'deleteCombat',\r\n      'preUpdateToken',\r\n      'preUpdateActor',\r\n      'updateActor',\r\n      'updateToken',\r\n      'createToken',\r\n      'preUpdateItem',\r\n      'updateItem',\r\n      'createItem',\r\n      'deleteItem',\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n    return;\r\n  }\r\n\r\n  if (game.user.isGM) {\r\n    registerHook(feature_id, 'canvasReady', _refreshTokenMappings);\r\n    _refreshTokenMappings();\r\n  }\r\n\r\n  registerHook(feature_id, 'createActiveEffect', (activeEffect, options, userId) => {\r\n    if (activeEffect.disabled || game.userId !== userId) return;\r\n    const effectName = activeEffect.name ?? activeEffect.label;\r\n    _updateImageOnEffectChange(effectName, activeEffect, true);\r\n  });\r\n  registerHook(feature_id, 'deleteActiveEffect', (activeEffect, options, userId) => {\r\n    if (activeEffect.disabled || game.userId !== userId) return;\r\n    const effectName = activeEffect.name ?? activeEffect.label;\r\n    _updateImageOnEffectChange(effectName, activeEffect, false);\r\n  });\r\n  registerHook(feature_id, 'preUpdateActiveEffect', _preUpdateActiveEffect);\r\n  registerHook(feature_id, 'updateActiveEffect', _updateActiveEffect);\r\n  registerHook(feature_id, 'preUpdateToken', _preUpdateToken);\r\n  registerHook(feature_id, 'preUpdateActor', _preUpdateActor);\r\n  registerHook(feature_id, 'updateActor', _updateActor);\r\n  registerHook(feature_id, 'updateToken', _updateToken);\r\n  registerHook(feature_id, 'createToken', _createToken);\r\n  registerHook(feature_id, 'createCombatant', _createCombatant);\r\n  registerHook(feature_id, 'deleteCombatant', (combatant, options, userId) => {\r\n    if (game.userId !== userId) return;\r\n    _deleteCombatant(combatant);\r\n  });\r\n  registerHook(feature_id, 'preUpdateCombat', _preUpdateCombat);\r\n  registerHook(feature_id, 'updateCombat', _updateCombat);\r\n  registerHook(feature_id, 'deleteCombat', (combat, options, userId) => {\r\n    if (game.userId !== userId) return;\r\n    combat.combatants.forEach((combatant) => {\r\n      _deleteCombatant(combatant);\r\n    });\r\n  });\r\n\r\n  const applicable_item_types = game.system.id === 'pf2e' ? PF2E_ITEM_TYPES : ITEM_TYPES;\r\n  // Want to track condition/effect previous name so that the config can be reverted for it\r\n  registerHook(feature_id, 'preUpdateItem', (item, change, options, userId) => {\r\n    if (game.user.id === userId && applicable_item_types.includes(item.type)) {\r\n      options['token-variants-old-name'] = item.name;\r\n    }\r\n    _preUpdateAssign(getActorParent(item), change, options);\r\n  });\r\n\r\n  registerHook(feature_id, 'createItem', (item, options, userId) => {\r\n    if (game.userId !== userId || !applicable_item_types.includes(item.type)) return;\r\n    _updateImageOnEffectChange(item.name, item, true);\r\n  });\r\n\r\n  registerHook(feature_id, 'deleteItem', (item, options, userId) => {\r\n    if (game.userId !== userId || !applicable_item_types.includes(item.type) || item.disabled) return;\r\n    _updateImageOnEffectChange(item.name, item, false);\r\n  });\r\n\r\n  // Status Effects can be applied \"stealthily\" on item equip/un-equip\r\n  registerHook(feature_id, 'updateItem', _updateItem);\r\n}\r\n\r\nasync function _refreshTokenMappings() {\r\n  for (const tkn of canvas.tokens.placeables) {\r\n    await updateWithEffectMapping(tkn);\r\n  }\r\n}\r\n\r\nfunction _createCombatant(combatant, options, userId) {\r\n  if (game.userId !== userId) return;\r\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\r\n  if (!token || !token.actor) return;\r\n\r\n  updateWithEffectMapping(token, {\r\n    added: ['token-variants-combat'],\r\n  });\r\n}\r\n\r\nfunction _preUpdateActiveEffect(activeEffect, change, options, userId) {\r\n  if (game.userId !== userId || !getActorParent(activeEffect)) return;\r\n\r\n  if ('name' in change) {\r\n    options['token-variants-old-name'] = activeEffect.name;\r\n  }\r\n}\r\n\r\nfunction _updateActiveEffect(activeEffect, change, options, userId) {\r\n  if (game.userId !== userId || !getActorParent(activeEffect)) return;\r\n\r\n  const added = [];\r\n  const removed = [];\r\n\r\n  if ('disabled' in change) {\r\n    if (change.disabled) removed.push(activeEffect.name);\r\n    else added.push(activeEffect.name);\r\n  }\r\n  if ('name' in change) {\r\n    removed.push(options['token-variants-old-name']);\r\n    added.push(change.name);\r\n  }\r\n\r\n  if (added.length || removed.length) {\r\n    _updateImageOnMultiEffectChange(getActorParent(activeEffect), added, removed);\r\n  }\r\n}\r\n\r\nfunction _preUpdateToken(token, change, options, userId) {\r\n  if (game.user.id !== userId || (change.actorId && token.actorId !== change.actorId)) return;\r\n  const preUpdateEffects = getTokenEffects(token, true);\r\n  if (preUpdateEffects.length) {\r\n    foundry.utils.setProperty(options, 'token-variants.preUpdateEffects', preUpdateEffects);\r\n  }\r\n\r\n  if (game.system.id === 'dnd5e' && token.actor?.isPolymorphed) {\r\n    foundry.utils.setProperty(options, 'token-variants.wasPolymorphed', true);\r\n  }\r\n}\r\n\r\nasync function _updateToken(token, change, options, userId) {\r\n  if (game.user.id !== userId || change.actorId) return;\r\n\r\n  // TODO\r\n  token.object?.tvaOverlays?.forEach((ov) => ov.htmlOverlay?.render());\r\n\r\n  const addedEffects = new Set();\r\n  const removedEffects = new Set();\r\n  const preUpdateEffects = foundry.utils.getProperty(options, 'token-variants.preUpdateEffects') || [];\r\n  const postUpdateEffects = getTokenEffects(token, true);\r\n  determineAddedRemovedEffects(addedEffects, removedEffects, postUpdateEffects, preUpdateEffects);\r\n\r\n  if (addedEffects.size || removedEffects.size || 'actorLink' in change) {\r\n    updateWithEffectMapping(token, { added: Array.from(addedEffects), removed: Array.from(removedEffects) });\r\n  } else if (foundry.utils.getProperty(options, 'token-variants.wasPolymorphed') && !token.actor?.isPolymorphed) {\r\n    updateWithEffectMapping(token);\r\n  }\r\n\r\n  if (game.userId === userId && 'hidden' in change) {\r\n    updateWithEffectMapping(token, {\r\n      added: change.hidden ? ['token-variants-visibility'] : [],\r\n      removed: !change.hidden ? ['token-variants-visibility'] : [],\r\n    });\r\n  }\r\n}\r\n\r\nfunction _preUpdateActor(actor, change, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n  _preUpdateAssign(actor, change, options);\r\n}\r\n\r\nasync function _updateActor(actor, change, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n\r\n  if ('flags' in change && 'token-variants' in change.flags) {\r\n    const tokenVariantFlags = change.flags['token-variants'];\r\n    if ('effectMappings' in tokenVariantFlags || '-=effectMappings' in tokenVariantFlags) {\r\n      const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\r\n      tokens.forEach((tkn) => updateWithEffectMapping(tkn));\r\n      for (const tkn of tokens) {\r\n        if (tkn.object && TVA_CONFIG.filterEffectIcons) {\r\n          await tkn.object.drawEffects();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  _preUpdateCheck(actor, options);\r\n}\r\n\r\nfunction _preUpdateAssign(actor, change, options) {\r\n  if (!actor) return;\r\n\r\n  // Determine which comparators are applicable so that we can compare after the\r\n  // actor update\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\r\n  if (TVA_CONFIG.internalEffects.hpChange.enabled && tokens.length) {\r\n    applyHpChangeEffect(actor, change, tokens);\r\n  }\r\n  for (const tkn of tokens) {\r\n    const preUpdateEffects = getTokenEffects(tkn, true);\r\n\r\n    if (preUpdateEffects.length) {\r\n      foundry.utils.setProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects', preUpdateEffects);\r\n    }\r\n  }\r\n}\r\n\r\nfunction _preUpdateCheck(actor, options, pAdded = [], pRemoved = []) {\r\n  if (!actor) return;\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\r\n  for (const tkn of tokens) {\r\n    // Check if effects changed by comparing them against the ones calculated in preUpdate*\r\n    const added = new Set([...pAdded]);\r\n    const removed = new Set([...pRemoved]);\r\n    const postUpdateEffects = getTokenEffects(tkn, true);\r\n    const preUpdateEffects = foundry.utils.getProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects') ?? [];\r\n\r\n    determineAddedRemovedEffects(added, removed, postUpdateEffects, preUpdateEffects);\r\n    if (added.size || removed.size)\r\n      updateWithEffectMapping(tkn, { added: Array.from(added), removed: Array.from(removed) });\r\n  }\r\n}\r\n\r\nfunction _createToken(token, options, userId) {\r\n  if (userId && userId === game.user.id) updateWithEffectMapping(token);\r\n}\r\n\r\nfunction _preUpdateCombat(combat, round, options, userId) {\r\n  if (game.userId !== userId) return;\r\n  options['token-variants'] = {\r\n    combatantId: combat?.combatant?.token?.id,\r\n    nextCombatantId: combat?.nextCombatant?.token?.id,\r\n  };\r\n}\r\n\r\nfunction _updateCombat(combat, round, options, userId) {\r\n  if (game.userId !== userId) return;\r\n\r\n  const previousCombatantId = options['token-variants']?.combatantId;\r\n  const previousNextCombatantId = options['token-variants']?.nextCombatantId;\r\n\r\n  const currentCombatantId = combat?.combatant?.token?.id;\r\n  const currentNextCombatantId = combat?.nextCombatant?.token?.id;\r\n\r\n  const updateCombatant = function (id, added = [], removed = []) {\r\n    if (game.user.isGM) {\r\n      const token = canvas.tokens.get(id);\r\n      if (token) updateWithEffectMapping(token, { added, removed });\r\n    } else {\r\n      const message = {\r\n        handlerName: 'effectMappings',\r\n        args: { tokenId: id, sceneId: canvas.scene.id, added, removed },\r\n        type: 'UPDATE',\r\n      };\r\n      game.socket?.emit('module.token-variants', message);\r\n    }\r\n  };\r\n\r\n  if (previousCombatantId !== currentCombatantId) {\r\n    if (previousCombatantId) updateCombatant(previousCombatantId, [], ['combat-turn']);\r\n    if (currentCombatantId) updateCombatant(currentCombatantId, ['combat-turn'], []);\r\n  }\r\n  if (previousNextCombatantId !== currentNextCombatantId) {\r\n    if (previousNextCombatantId) updateCombatant(previousNextCombatantId, [], ['combat-turn-next']);\r\n    if (currentNextCombatantId) updateCombatant(currentNextCombatantId, ['combat-turn-next'], []);\r\n  }\r\n}\r\n\r\nfunction _updateItem(item, change, options, userId) {\r\n  const added = [];\r\n  const removed = [];\r\n\r\n  if (game.user.id === userId) {\r\n    // Handle condition/effect name change\r\n    if (options['token-variants-old-name'] != null && options['token-variants-old-name'] !== item.name) {\r\n      added.push(item.name);\r\n      removed.push(options['token-variants-old-name']);\r\n    }\r\n\r\n    _preUpdateCheck(getActorParent(item), options, added, removed);\r\n  }\r\n}\r\n\r\nlet EFFECT_M_QUEUES = {};\r\nlet EFFECT_M_TIMER;\r\n\r\nexport async function updateWithEffectMapping(token, { added = [], removed = [] } = {}) {\r\n  const callUpdateWithEffectMapping = function () {\r\n    for (const id of Object.keys(EFFECT_M_QUEUES)) {\r\n      const m = EFFECT_M_QUEUES[id];\r\n      _updateWithEffectMapping(m.token, m.opts.added, m.opts.removed);\r\n    }\r\n    EFFECT_M_QUEUES = {};\r\n  };\r\n\r\n  clearTimeout(EFFECT_M_TIMER);\r\n\r\n  if (token.id in EFFECT_M_QUEUES) {\r\n    const opts = EFFECT_M_QUEUES[token.id].opts;\r\n    added.forEach((a) => opts.added.add(a));\r\n    removed.forEach((a) => opts.removed.add(a));\r\n  } else {\r\n    EFFECT_M_QUEUES[token.id] = {\r\n      token,\r\n      opts: { added: new Set(added), removed: new Set(removed) },\r\n    };\r\n  }\r\n  EFFECT_M_TIMER = setTimeout(callUpdateWithEffectMapping, 100);\r\n}\r\n\r\nasync function _updateWithEffectMapping(token, added, removed) {\r\n  const placeable = token.object ?? token._object ?? token;\r\n  token = token.document ?? token;\r\n\r\n  const tokenImgName = token.getFlag('token-variants', 'name') || getFileName(token.texture.src);\r\n  let tokenDefaultImg = token.getFlag('token-variants', 'defaultImg');\r\n  const animate = !TVA_CONFIG.disableTokenUpdateAnimation;\r\n  const tokenUpdateObj = {};\r\n  const hadActiveHUD = token.object?.hasActiveHUD;\r\n  const toggleStatus = canvas.tokens.hud.object?.id === token.id ? canvas.tokens.hud._statusEffects : false;\r\n\r\n  let effects = getTokenEffects(token);\r\n\r\n  // If effect is included in `added` or `removed` we need to:\r\n  // 1. Insert it into `effects` if it's not there in case of 'added' and place it on top of the list\r\n  // 2. Remove it in case of 'removed'\r\n  for (const ef of added) {\r\n    const i = effects.findIndex((s) => s === ef);\r\n    if (i === -1) {\r\n      effects.push(ef);\r\n    } else if (i < effects.length - 1) {\r\n      effects.splice(i, 1);\r\n      effects.push(ef);\r\n    }\r\n  }\r\n  for (const ef of removed) {\r\n    const i = effects.findIndex((s) => s === ef);\r\n    if (i !== -1) {\r\n      effects.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n\r\n  // 3. Configurations may contain effect names in a form of a logical expressions\r\n  //    We need to evaluate them and insert them into effects/added/removed if needed\r\n  for (const mapping of mappings) {\r\n    evaluateMappingExpression(mapping, effects, token, added, removed);\r\n  }\r\n\r\n  // Accumulate all scripts that will need to be run after the update\r\n  const executeOnCallback = [];\r\n  const deferredUpdateScripts = [];\r\n  for (const ef of removed) {\r\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\r\n    if (script) {\r\n      if (script.onRemove) {\r\n        if (script.onRemove.includes('tvaUpdate')) deferredUpdateScripts.push(script.onRemove);\r\n        else executeOnCallback.push({ script: script.onRemove, token });\r\n      }\r\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'remove' });\r\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'remove' });\r\n      if (script.macroOnApply) executeOnCallback.push({ macro: script.macroOnApply, token });\r\n    }\r\n  }\r\n  for (const ef of added) {\r\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\r\n    if (script) {\r\n      if (script.onApply) {\r\n        if (script.onApply.includes('tvaUpdate')) deferredUpdateScripts.push(script.onApply);\r\n        else executeOnCallback.push({ script: script.onApply, token });\r\n      }\r\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'apply' });\r\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'apply' });\r\n      if (script.macroOnRemove) executeOnCallback.push({ macro: script.macroOnRemove, token });\r\n    }\r\n  }\r\n\r\n  // Next we're going to determine what configs need to be applied and in what order\r\n  // Filter effects that do not have a mapping and sort based on priority\r\n  effects = mappings.filter((m) => effects.includes(m.id)).sort((ef1, ef2) => ef1.priority - ef2.priority);\r\n\r\n  // Check if image update should be prevented based on module settings\r\n  let disableImageUpdate = false;\r\n  if (TVA_CONFIG.disableImageChangeOnPolymorphed && token.actor?.isPolymorphed) {\r\n    disableImageUpdate = true;\r\n  } else if (\r\n    TVA_CONFIG.disableImageUpdateOnNonPrototype &&\r\n    token.actor?.prototypeToken?.texture?.src !== token.texture.src\r\n  ) {\r\n    disableImageUpdate = true;\r\n    const tknImg = token.texture.src;\r\n    for (const m of mappings) {\r\n      if (m.imgSrc === tknImg) {\r\n        disableImageUpdate = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (disableImageUpdate) {\r\n    tokenDefaultImg = '';\r\n  }\r\n\r\n  let updateCall;\r\n\r\n  if (effects.length > 0) {\r\n    // Some effect mappings may not have images, find a mapping with one if it exists\r\n    const newImg = { imgSrc: '', imgName: '' };\r\n\r\n    if (!disableImageUpdate) {\r\n      for (let i = effects.length - 1; i >= 0; i--) {\r\n        if (effects[i].imgSrc) {\r\n          let iSrc = effects[i].imgSrc;\r\n          if (iSrc.includes('*') || (iSrc.includes('{') && iSrc.includes('}'))) {\r\n            // wildcard image, if this effect hasn't been newly applied we do not want to randomize the image again\r\n            if (!added.has(effects[i].overlayConfig?.effect)) {\r\n              newImg.imgSrc = token.texture.src;\r\n              newImg.imgName = getFileName(newImg.imgSrc);\r\n              break;\r\n            }\r\n          }\r\n          newImg.imgSrc = effects[i].imgSrc;\r\n          newImg.imgName = effects[i].imgName;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Collect custom configs to be applied to the token\r\n    let config;\r\n    if (TVA_CONFIG.stackStatusConfig) {\r\n      config = {};\r\n      for (const ef of effects) {\r\n        config = foundry.utils.mergeObject(config, ef.config);\r\n      }\r\n    } else {\r\n      for (let i = effects.length - 1; i >= 0; i--) {\r\n        if (effects[i].config && Object.keys(effects[i].config).length !== 0) {\r\n          config = effects[i].config;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Use or update the default (original) token image\r\n    if (!newImg.imgSrc && tokenDefaultImg) {\r\n      delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\r\n      newImg.imgSrc = tokenDefaultImg.imgSrc;\r\n      newImg.imgName = tokenDefaultImg.imgName;\r\n    } else if (!tokenDefaultImg && newImg.imgSrc) {\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultImg', {\r\n        imgSrc: token.texture.src,\r\n        imgName: tokenImgName,\r\n      });\r\n    }\r\n\r\n    updateCall = () =>\r\n      updateTokenImage(newImg.imgSrc ?? null, {\r\n        token,\r\n        imgName: newImg.imgName ? newImg.imgName : tokenImgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        config: config,\r\n        animate,\r\n      });\r\n  }\r\n\r\n  // If no mapping has been found and the default image (image prior to effect triggered update) is different from current one\r\n  // reset the token image back to default\r\n  if (effects.length === 0 && tokenDefaultImg) {\r\n    delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\r\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\r\n\r\n    updateCall = () =>\r\n      updateTokenImage(tokenDefaultImg.imgSrc, {\r\n        token,\r\n        imgName: tokenDefaultImg.imgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        animate,\r\n      });\r\n    // If no default image exists but a custom effect is applied, we still want to perform an update to\r\n    // clear it\r\n  } else if (effects.length === 0 && token.getFlag('token-variants', 'usingCustomConfig')) {\r\n    updateCall = () =>\r\n      updateTokenImage(token.texture.src, {\r\n        token,\r\n        imgName: tokenImgName,\r\n        tokenUpdate: tokenUpdateObj,\r\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\r\n        animate,\r\n      });\r\n  }\r\n\r\n  if (updateCall) {\r\n    if (deferredUpdateScripts.length) {\r\n      for (let i = 0; i < deferredUpdateScripts.length; i++) {\r\n        if (i === deferredUpdateScripts.length - 1) {\r\n          await tv_executeScript(deferredUpdateScripts[i], {\r\n            token,\r\n            tvaUpdate: () => {\r\n              updateCall();\r\n            },\r\n          });\r\n        } else {\r\n          await tv_executeScript(deferredUpdateScripts[i], {\r\n            token,\r\n            tvaUpdate: () => {},\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      updateCall();\r\n    }\r\n  } else {\r\n    if (executeOnCallback.length || deferredUpdateScripts.length) {\r\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, executeOnCallback);\r\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, deferredUpdateScripts);\r\n    }\r\n  }\r\n  broadcastDrawOverlays(placeable);\r\n}\r\n\r\nasync function _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, scripts) {\r\n  if (hadActiveHUD && token.object) {\r\n    canvas.tokens.hud.bind(token.object);\r\n    if (toggleStatus) canvas.tokens.hud._toggleStatusEffects(true);\r\n  }\r\n  for (const scr of scripts) {\r\n    if (scr.script) {\r\n      await tv_executeScript(scr.script, { token: scr.token });\r\n    } else if (scr.tmfxPreset) {\r\n      await applyTMFXPreset(scr.token, scr.tmfxPreset, scr.action);\r\n    } else if (scr.ceEffect) {\r\n      await applyCEEffect(scr.token, scr.ceEffect, scr.action);\r\n    } else if (scr.macro) {\r\n      await executeMacro(scr.macro, token);\r\n    }\r\n  }\r\n}\r\n\r\nexport function getAllEffectMappings(token = null, includeDisabled = false) {\r\n  let allMappings = getFlagMappings(token);\r\n  const unique = new Set();\r\n\r\n  // TODO: replace with a setting\r\n  allMappings.forEach((m) => unique.add(TVA_CONFIG.mergeGroup ? m.group : m.label));\r\n\r\n  // Sort out global mappings that do not apply to this actor\r\n  let applicableGlobal = TVA_CONFIG.globalMappings;\r\n  if (token?.actor?.type) {\r\n    const actorType = token.actor.type;\r\n    applicableGlobal = applicableGlobal.filter((m) => {\r\n      if (!m.targetActors || m.targetActors.includes(actorType)) {\r\n        return !unique.has(TVA_CONFIG.mergeGroup ? m.group : m.label);\r\n      }\r\n      return false;\r\n    });\r\n  }\r\n  allMappings = allMappings.concat(applicableGlobal);\r\n\r\n  if (!includeDisabled) allMappings = allMappings.filter((m) => !m.disabled);\r\n\r\n  return allMappings;\r\n}\r\n\r\nexport async function setOverlayVisibility({\r\n  userName = null,\r\n  userId = null,\r\n  label = null,\r\n  group = null,\r\n  token = null,\r\n  visible = true,\r\n} = {}) {\r\n  if (!label && !group) return;\r\n  if (userName) userId = game.users.find((u) => u.name === userName)?.id;\r\n  if (!userId) return;\r\n\r\n  let tokenMappings = getFlagMappings(token);\r\n  let globalMappings = TVA_CONFIG.globalMappings;\r\n\r\n  let updateToken = false;\r\n  let updateGlobal = false;\r\n\r\n  const updateMappings = function (mappings) {\r\n    mappings = mappings.filter((m) => m.overlay && (m.label === label || m.group === group));\r\n    let found = false;\r\n    if (mappings.length) found = true;\r\n\r\n    mappings.forEach((m) => {\r\n      const overlayConfig = m.overlayConfig;\r\n      if (visible) {\r\n        if (!overlayConfig.limitedUsers) overlayConfig.limitedUsers = [];\r\n        if (!overlayConfig.limitedUsers.find((u) => u === userId)) overlayConfig.limitedUsers.push(userId);\r\n      } else if (overlayConfig.limitedUsers) {\r\n        overlayConfig.limitedUsers = overlayConfig.limitedUsers.filter((u) => u !== userId);\r\n      }\r\n    });\r\n    return found;\r\n  };\r\n\r\n  updateToken = updateMappings(tokenMappings);\r\n  updateGlobal = updateMappings(globalMappings);\r\n\r\n  if (updateGlobal) await updateSettings({ globalMappings: globalMappings });\r\n  if (updateToken) {\r\n    const actor = game.actors.get(token.document.actorId);\r\n    if (actor) await actor.setFlag('token-variants', 'effectMappings', tokenMappings);\r\n  }\r\n  if (updateToken || updateGlobal) drawOverlays(token);\r\n}\r\n\r\nfunction _getTemplateMappings(templateName) {\r\n  return (\r\n    TVA_CONFIG.templateMappings.find((t) => t.name === templateName) ??\r\n    CORE_TEMPLATES.find((t) => t.name === templateName)\r\n  )?.mappings;\r\n}\r\n\r\nexport async function applyTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n  const templateMappings = foundry.utils.deepClone(mappings);\r\n  templateMappings.forEach((tm) => (tm.tokens = [token.id]));\r\n\r\n  const actMappings = mergeMappings(templateMappings, getFlagMappings(actor));\r\n  await actor.setFlag('token-variants', 'effectMappings', actMappings);\r\n  await updateWithEffectMapping(token);\r\n  drawOverlays(token);\r\n}\r\n\r\nexport async function removeTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n\r\n  let actMappings = getFlagMappings(actor);\r\n  mappings.forEach((m) => {\r\n    let i = actMappings.findIndex((m2) => m2.id === m.id);\r\n    if (i !== -1) {\r\n      actMappings[i].tokens = actMappings[i].tokens.filter((t) => t !== token.id);\r\n      if (actMappings[i].tokens.length === 0) actMappings.splice(i, 1);\r\n    }\r\n  });\r\n\r\n  if (actMappings.length) await actor.setFlag('token-variants', 'effectMappings', actMappings);\r\n  else await actor.unsetFlag('token-variants', 'effectMappings');\r\n  await updateWithEffectMapping(token);\r\n  drawOverlays(token);\r\n}\r\n\r\nexport function toggleTemplate(token, templateName = null, mappings = null) {\r\n  if (templateName) mappings = _getTemplateMappings(templateName);\r\n  if (!token || !mappings) return;\r\n\r\n  const actor = game.actors.get(token.actor.id);\r\n  if (!actor) return;\r\n\r\n  const actMappings = getFlagMappings(actor);\r\n  if (actMappings.some((m) => mappings.some((m2) => m2.id === m.id && m.tokens?.includes(token.id)))) {\r\n    removeTemplate(token, null, mappings);\r\n  } else {\r\n    applyTemplate(token, null, mappings);\r\n  }\r\n}\r\n\r\nexport function toggleTemplateOnSelected(templateName = null, mappings = null) {\r\n  canvas.tokens.controlled.forEach((t) => toggleTemplate(t, templateName, mappings));\r\n}\r\n\r\nfunction getHPChangeEffect(token, effects) {\r\n  const internals = token.actor?.getFlag('token-variants', 'internalEffects') || {};\r\n  const delta = foundry.utils.getProperty(token, 'delta.flags.token-variants.internalEffects');\r\n  if (delta) foundry.utils.mergeObject(internals, delta);\r\n  if (internals['hp--'] != null) effects.push('hp--');\r\n  if (internals['hp++'] != null) effects.push('hp++');\r\n}\r\n\r\nfunction applyHpChangeEffect(actor, change, tokens) {\r\n  let duration = Number(TVA_CONFIG.internalEffects.hpChange.duration);\r\n\r\n  const newHpValue = foundry.utils.getProperty(change, `system.${TVA_CONFIG.systemHpPath}.value`);\r\n  if (newHpValue != null) {\r\n    const { val } = getTokenHP(tokens[0]);\r\n    const currentHpVal = val;\r\n    if (currentHpVal !== newHpValue) {\r\n      if (currentHpVal < newHpValue) {\r\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.-=hp--', null);\r\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.hp++', newHpValue - currentHpVal);\r\n        if (duration) {\r\n          setTimeout(() => {\r\n            actor.update({\r\n              'flags.token-variants.internalEffects.-=hp++': null,\r\n            });\r\n          }, duration * 1000);\r\n        }\r\n      } else {\r\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.-=hp++', null);\r\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.hp--', newHpValue - currentHpVal);\r\n        if (duration) {\r\n          setTimeout(() => {\r\n            actor.update({\r\n              'flags.token-variants.internalEffects.-=hp--': null,\r\n            });\r\n          }, duration * 1000);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function getTokenEffects(token, includeExpressions = false) {\r\n  const tokenDoc = token.document ?? token;\r\n  let effects = [];\r\n\r\n  // TVA Effects\r\n  const tokenInCombat = game.combats.some((combat) => {\r\n    return combat.combatants.some((c) => c.tokenId === tokenDoc.id);\r\n  });\r\n  if (tokenInCombat) {\r\n    effects.push('token-variants-combat');\r\n  }\r\n\r\n  if (game.combat?.started) {\r\n    if (game.combat?.combatant?.token?.id === tokenDoc.id) {\r\n      effects.push('combat-turn');\r\n    } else if (game.combat?.nextCombatant?.token?.id === tokenDoc.id) {\r\n      effects.push('combat-turn-next');\r\n    }\r\n  }\r\n  if (tokenDoc.hidden) {\r\n    effects.push('token-variants-visibility');\r\n  }\r\n\r\n  if (TVA_CONFIG.internalEffects.hpChange.enabled) {\r\n    getHPChangeEffect(tokenDoc, effects);\r\n  }\r\n\r\n  // Actor/Token effects\r\n  if (tokenDoc.actorLink) {\r\n    getEffectsFromActor(tokenDoc.actor, effects);\r\n  } else {\r\n    if (game.system.id === 'pf2e') {\r\n      (tokenDoc.delta?.items || []).forEach((item) => {\r\n        if (_activePF2EItem(item)) {\r\n          effects.push(item.name);\r\n        }\r\n      });\r\n    } else {\r\n      (tokenDoc.actor?.effects || [])\r\n        .filter((ef) => !ef.disabled && !ef.isSuppressed)\r\n        .forEach((ef) => effects.push(ef.name));\r\n      getEffectsFromActor(tokenDoc.actor, effects);\r\n    }\r\n  }\r\n\r\n  // Expression/Mapping effects\r\n  evaluateComparatorEffects(tokenDoc, effects);\r\n  evaluateStateEffects(tokenDoc, effects);\r\n\r\n  // Include mappings marked as always applicable\r\n  // as well as the ones defined as logical expressions if needed\r\n  const mappings = getAllEffectMappings(tokenDoc);\r\n\r\n  for (const m of mappings) {\r\n    if (m.tokens?.length && !m.tokens.includes(data.id)) continue;\r\n    if (m.alwaysOn) effects.unshift(m.id);\r\n    else if (includeExpressions) {\r\n      const evaluation = evaluateMappingExpression(m, effects, tokenDoc);\r\n      if (evaluation) effects.unshift(m.id);\r\n    }\r\n  }\r\n\r\n  return effects;\r\n}\r\n\r\nexport function getEffectsFromActor(actor, effects = []) {\r\n  if (!actor) return effects;\r\n\r\n  if (game.system.id === 'pf2e') {\r\n    (actor.items || []).forEach((item, id) => {\r\n      if (_activePF2EItem(item)) effects.push(item.name);\r\n    });\r\n  } else {\r\n    (actor.effects || []).forEach((activeEffect, id) => {\r\n      if (!activeEffect.disabled && !activeEffect.isSuppressed) effects.push(activeEffect.name ?? activeEffect.label);\r\n    });\r\n\r\n    if (game.system.id === 'dnd5e') {\r\n      (actor.temporaryEffects || []).forEach((activeEffect, id) => {\r\n        if (!activeEffect.disabled && !activeEffect.isSuppressed) effects.push(activeEffect.name ?? activeEffect.label);\r\n      });\r\n    }\r\n\r\n    if (game.system.id === 'shadowrun5e') {\r\n      (actor.items || []).forEach((item) => {\r\n        if (\r\n          ['weapon', 'armor', 'bioware', 'cyberware', 'device', 'equipment'].includes(item.type) &&\r\n          item.system.technology.equipped\r\n        )\r\n          effects.push(item.name);\r\n      });\r\n    } else {\r\n      (actor.items || []).forEach((item) => {\r\n        if (ITEM_TYPES.includes(item.type) && item.system.equipped) effects.push(item.name ?? item.label);\r\n      });\r\n    }\r\n  }\r\n\r\n  return effects;\r\n}\r\n\r\nfunction _activePF2EItem(item) {\r\n  if (PF2E_ITEM_TYPES.includes(item.type)) {\r\n    if ('active' in item) {\r\n      return item.active;\r\n    } else if ('isEquipped' in item) {\r\n      return item.isEquipped;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport const VALID_EXPRESSION = new RegExp('([a-zA-Z0-9\\\\-\\\\.\\\\+]+)([><=]+)([^ ]+)');\r\n\r\n// TODO: Take into account arithmetic operations?\r\nfunction getPropertyValue(token, property) {\r\n  let val;\r\n  let maxVal;\r\n\r\n  if (property.startsWith('\"') && property.endsWith('\"')) {\r\n    val = property.substring(1, property.length - 1);\r\n    if (val === 'true') val = true;\r\n    else if (val === 'false') val = true;\r\n    return { val, boolean: true };\r\n  } else if (property.endsWith('%')) {\r\n    val = Number(property.substring(property.length - 1));\r\n    return { val, percentage: true };\r\n  } else if (property === 'hp') {\r\n    return getTokenHP(token);\r\n  } else if (property === 'hp++' || property === 'hp--') {\r\n    ({ val, maxVal } = getTokenHP(token));\r\n    val = foundry.utils.getProperty(token, `actor.flags.token-variants.internalEffects.${property}`) ?? 0;\r\n    return { val, maxVal };\r\n  }\r\n\r\n  val = Number(property);\r\n  if (isNaN(val)) {\r\n    val = foundry.utils.getProperty(token._source, property);\r\n    if (val == null) val = foundry.utils.getProperty(token, property);\r\n\r\n    if (property === 'rotation') maxVal = 360;\r\n    else if (maxVal == null) maxVal = 999999;\r\n\r\n    return { val, maxVal };\r\n  }\r\n\r\n  return { val };\r\n}\r\n\r\nexport function evaluateComparator(token, expression) {\r\n  const match = expression.match(VALID_EXPRESSION);\r\n  if (match) {\r\n    const property1 = match[1];\r\n    const sign = match[2];\r\n    const property2 = match[3];\r\n\r\n    const val1 = getPropertyValue(token, property1);\r\n    const val2 = getPropertyValue(token, property2);\r\n\r\n    if (val1.percentage) val2.val = (val2.val / val2.maxVal) * 100;\r\n    else if (val2.percentage) val1.val = (val1.val / val2.maxVal) * 100;\r\n    else if (val1.boolean) val2.val = foundry.utils.isEmpty(val2.val) ? false : Boolean(val2.val);\r\n    else if (val2.boolean) val1.val = foundry.utils.isEmpty(val1.val) ? false : Boolean(val1.val);\r\n\r\n    let passed = false;\r\n    if (sign === '=') {\r\n      passed = val1.val == val2.val;\r\n    } else if (sign === '>') {\r\n      passed = val1.val > val2.val;\r\n    } else if (sign === '<') {\r\n      passed = val1.val < val2.val;\r\n    } else if (sign === '>=') {\r\n      passed = val1.val >= val2.val;\r\n    } else if (sign === '<=') {\r\n      passed = val1.val <= val2.val;\r\n    } else if (sign === '<>') {\r\n      passed = val1.val < val2.val || val1.val > val2.val;\r\n    }\r\n    return passed;\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function evaluateComparatorEffects(token, effects = []) {\r\n  token = token.document ?? token;\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n\r\n  const matched = new Set();\r\n\r\n  for (const m of mappings) {\r\n    const expressions = m.expression\r\n      .split(EXPRESSION_MATCH_RE)\r\n      .filter(Boolean)\r\n      .map((exp) => exp.trim())\r\n      .filter(Boolean);\r\n    for (let i = 0; i < expressions.length; i++) {\r\n      if (evaluateComparator(token, expressions[i])) {\r\n        matched.add(expressions[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Remove duplicate expressions and insert into effects\r\n  matched.forEach((exp) => effects.unshift(exp));\r\n\r\n  return effects;\r\n}\r\n\r\nexport function evaluateStateEffects(token, effects) {\r\n  if (game.system.id === 'pf2e') {\r\n    if ((token.document ?? token).actor?.effects.some((ef) => ef.statuses.has('dead'))) effects.push('Dead');\r\n  }\r\n}\r\n\r\n/**\r\n * Replaces {1,a,5,b} type string in the expressions with (1|a|5|b)\r\n * @param {*} exp\r\n * @returns\r\n */\r\nfunction _findReplaceBracketWildcard(exp) {\r\n  let nExp = '';\r\n  let lIndex = 0;\r\n  while (lIndex >= 0) {\r\n    let i1 = exp.indexOf('\\\\\\\\\\\\{', lIndex);\r\n    if (i1 !== -1) {\r\n      let i2 = exp.indexOf('\\\\\\\\\\\\}', i1);\r\n      if (i2 !== -1) {\r\n        nExp += exp.substring(lIndex, i1);\r\n        nExp +=\r\n          '(' +\r\n          exp\r\n            .substring(i1 + 4, i2)\r\n            .split(',')\r\n            .join('|') +\r\n          ')';\r\n      }\r\n      lIndex = i2 + 4;\r\n    } else {\r\n      return nExp + exp.substring(lIndex, exp.length);\r\n    }\r\n  }\r\n  return nExp ?? exp;\r\n}\r\n\r\nfunction _testRegExEffect(effect, effects) {\r\n  let re = effect.replace(/[/\\-\\\\^$+?.()|[\\]{}]/g, '\\\\$&').replaceAll('\\\\\\\\*', '.*');\r\n  re = _findReplaceBracketWildcard(re);\r\n  re = new RegExp('^' + re + '$');\r\n  return effects.find((ef) => re.test(ef));\r\n}\r\n\r\nexport function evaluateMappingExpression(mapping, effects, token, added = new Set(), removed = new Set()) {\r\n  let arrExpression = mapping.expression\r\n    .split(EXPRESSION_MATCH_RE)\r\n    .filter(Boolean)\r\n    .map((s) => s.trim())\r\n    .filter(Boolean);\r\n\r\n  let temp = '';\r\n  let hasAdded = false;\r\n  let hasRemoved = false;\r\n  for (let exp of arrExpression) {\r\n    if (EXPRESSION_OPERATORS.includes(exp)) {\r\n      temp += exp.replace('\\\\', '');\r\n      continue;\r\n    }\r\n\r\n    if (/\\\\\\*|\\\\{.*\\\\}/g.test(exp)) {\r\n      let rExp = _testRegExEffect(exp, effects);\r\n      if (rExp) {\r\n        temp += 'true';\r\n      } else {\r\n        temp += 'false';\r\n      }\r\n\r\n      if (_testRegExEffect(exp, added)) hasAdded = true;\r\n      else if (_testRegExEffect(exp, removed)) hasRemoved = true;\r\n      continue;\r\n    } else if (effects.includes(exp)) {\r\n      temp += 'true';\r\n    } else {\r\n      temp += 'false';\r\n    }\r\n\r\n    if (!hasAdded && added.has(exp)) hasAdded = true;\r\n    if (!hasRemoved && removed.has(exp)) hasRemoved = true;\r\n  }\r\n\r\n  try {\r\n    let evaluation = eval(temp);\r\n\r\n    // Evaluate JS code\r\n    if (mapping.codeExp) {\r\n      try {\r\n        token = token.document ?? token;\r\n        if (!eval(mapping.codeExp)) evaluation = false;\r\n        else if (!mapping.expression) evaluation = true;\r\n      } catch (e) {\r\n        evaluation = false;\r\n      }\r\n    }\r\n\r\n    if (evaluation) {\r\n      if (hasAdded || hasRemoved) {\r\n        added.add(mapping.id);\r\n        effects.push(mapping.id);\r\n      } else effects.unshift(mapping.id);\r\n    } else if (hasRemoved || hasAdded) {\r\n      removed.add(mapping.id);\r\n    }\r\n    return evaluation;\r\n  } catch (e) {}\r\n  return false;\r\n}\r\n\r\nexport function getTokenHP(token) {\r\n  let attributes;\r\n\r\n  if (token.actorLink) {\r\n    attributes = foundry.utils.getProperty(token.actor?.system, TVA_CONFIG.systemHpPath);\r\n  } else {\r\n    attributes = foundry.utils.mergeObject(\r\n      foundry.utils.getProperty(token.actor?.system, TVA_CONFIG.systemHpPath) || {},\r\n      foundry.utils.getProperty(token.delta?.system) || {},\r\n      {\r\n        inplace: false,\r\n      }\r\n    );\r\n  }\r\n\r\n  return { val: attributes?.value, maxVal: attributes?.max };\r\n}\r\n\r\nasync function _updateImageOnEffectChange(effectName, source, added = true) {\r\n  const actor = getActorParent(source);\r\n  if (!actor) return;\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\r\n  for (const token of tokens) {\r\n    await updateWithEffectMapping(token, {\r\n      added: added ? [effectName] : [],\r\n      removed: !added ? [effectName] : [],\r\n    });\r\n  }\r\n}\r\n\r\nfunction getActorParent(ent) {\r\n  while (ent && !(ent instanceof Actor)) ent = ent.parent;\r\n  return ent;\r\n}\r\n\r\nasync function _updateImageOnMultiEffectChange(actor, added = [], removed = []) {\r\n  if (!actor) return;\r\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\r\n  for (const token of tokens) {\r\n    await updateWithEffectMapping(token, {\r\n      added: added,\r\n      removed: removed,\r\n    });\r\n  }\r\n}\r\n\r\nasync function _deleteCombatant(combatant) {\r\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\r\n  if (!token || !token.actor) return;\r\n  await updateWithEffectMapping(token, {\r\n    removed: ['token-variants-combat'],\r\n  });\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'EffectIcons';\r\n\r\nexport function registerEffectIconHooks() {\r\n  // OnHover settings specific hooks\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerHook(feature_id, 'hoverToken', (token, hoverIn) => {\r\n      if (token.effects) token.effects.meVisible = hoverIn;\r\n    });\r\n  } else {\r\n    unregisterHook(feature_id, 'hoverToken');\r\n  }\r\n\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerHook(feature_id, 'highlightObjects', (active) => {\r\n      if (canvas.tokens.active) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.effects) tkn.effects.meVisible = active || tkn.hover;\r\n        }\r\n      }\r\n    });\r\n  } else {\r\n    unregisterHook(feature_id, 'highlightObjects');\r\n  }\r\n\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerHook(feature_id, 'refreshToken', (token) => {\r\n      if (token.visible && token.effects) token.effects.visible = Boolean(token.effects.meVisible);\r\n    });\r\n  } else {\r\n    unregisterHook(feature_id, 'refreshToken');\r\n  }\r\n}\r\n","import { insertArtSelectButton } from '../../applications/artSelect.js';\r\nimport { showArtSelect } from '../../token-variants.mjs';\r\nimport { TVA_CONFIG } from '../settings.js';\r\nimport { SEARCH_TYPE, updateActorImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'ArtSelect';\r\n\r\nexport function registerArtSelectButtonHooks() {\r\n  // Insert right-click listeners to open up ArtSelect forms from various contexts\r\n  if (TVA_CONFIG.permissions.portrait_right_click[game.user.role]) {\r\n    registerHook(feature_id, 'renderActorSheet', _modActorSheet);\r\n    registerHook(feature_id, 'renderItemSheet', _modItemSheet);\r\n    registerHook(feature_id, 'renderItemActionSheet', _modItemSheet);\r\n    registerHook(feature_id, 'renderJournalSheet', _modJournalSheet);\r\n    registerHook(feature_id, 'renderRollTableConfig', _modRollTableSheet);\r\n  } else {\r\n    [\r\n      'renderActorSheet',\r\n      'renderItemSheet',\r\n      'renderItemActionSheet',\r\n      'renderJournalSheet',\r\n      'renderRollTableConfig',\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n\r\n  // Insert buttons\r\n  if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\r\n    registerHook(feature_id, 'renderTileConfig', _modTileConfig);\r\n    registerHook(feature_id, 'renderMeasuredTemplateConfig', _modTemplateConfig);\r\n    registerHook(feature_id, 'renderTokenConfig', _modTokenConfig);\r\n    registerHook(feature_id, 'renderDrawingConfig', _modDrawingConfig);\r\n    registerHook(feature_id, 'renderNoteConfig', _modNoteConfig);\r\n    registerHook(feature_id, 'renderSceneConfig', _modSceneConfig);\r\n    registerHook(feature_id, 'renderMacroConfig', _modMacroConfig);\r\n    registerHook(feature_id, 'renderActiveEffectConfig', _modActiveEffectConfig);\r\n  } else {\r\n    [\r\n      'renderTileConfig',\r\n      'renderMeasuredTemplateConfig',\r\n      'renderTokenConfig',\r\n      'renderDrawingConfig',\r\n      'renderNoteConfig',\r\n      'renderSceneConfig',\r\n      `renderActiveEffectConfig`,\r\n    ].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n}\r\n\r\nfunction _modTokenConfig(config, html) {\r\n  insertArtSelectButton($(html), 'texture.src', {\r\n    search: config.document.name,\r\n    searchType: SEARCH_TYPE.TOKEN,\r\n  });\r\n}\r\n\r\nfunction _modTemplateConfig(config, html) {\r\n  insertArtSelectButton(html, 'texture', { search: 'Template', searchType: SEARCH_TYPE.TILE });\r\n}\r\n\r\nfunction _modDrawingConfig(config, html) {\r\n  insertArtSelectButton(html, 'texture', {\r\n    search: 'Drawing',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Drawing') ? 'Drawing' : SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modNoteConfig(config, html) {\r\n  insertArtSelectButton(html, 'icon.custom', {\r\n    search: 'Note',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Note') ? 'Note' : SEARCH_TYPE.ITEM,\r\n  });\r\n}\r\n\r\nfunction _modSceneConfig(config, html) {\r\n  insertArtSelectButton(html, 'background.src', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Scene') ? 'Scene' : SEARCH_TYPE.TILE,\r\n  });\r\n  insertArtSelectButton(html, 'foreground', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Scene') ? 'Scene' : SEARCH_TYPE.TILE,\r\n  });\r\n  insertArtSelectButton(html, 'fogOverlay', {\r\n    search: config.object.name,\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Fog') ? 'Fog' : SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modTileConfig(tileConfig, html) {\r\n  insertArtSelectButton(html, 'texture.src', {\r\n    search: tileConfig.object.getFlag('token-variants', 'tileName') || 'Tile',\r\n    searchType: SEARCH_TYPE.TILE,\r\n  });\r\n}\r\n\r\nfunction _modActiveEffectConfig(effectConfig, html) {\r\n  const inserted = insertArtSelectButton(html, 'icon', {\r\n    search: effectConfig.object.name || 'Active Effect',\r\n    searchType: TVA_CONFIG.customImageCategories.includes('Active Effect') ? 'Active Effect' : SEARCH_TYPE.ITEM,\r\n  });\r\n  if (!inserted) {\r\n    const img = $(html).find('.effect-icon');\r\n    img.on('contextmenu', () => {\r\n      showArtSelect(effectConfig.object?.name ?? 'Active Effect', {\r\n        searchType: SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => img.attr('src', imgSrc),\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nfunction _modItemSheet(itemSheet, html, options) {\r\n  $(html)\r\n    .find('img.profile, .profile-img, [data-edit=\"img\"]')\r\n    .on('contextmenu', () => {\r\n      const item = itemSheet.object;\r\n      if (!item) return;\r\n      showArtSelect(item.name, {\r\n        searchType: SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => item.update({ img: imgSrc }),\r\n      });\r\n    });\r\n}\r\n\r\nfunction _modMacroConfig(macroConfig, html, options) {\r\n  const img = $(html).find('.sheet-header > img');\r\n  img.on('contextmenu', () => {\r\n    showArtSelect(macroConfig.object?.name ?? 'Macro', {\r\n      searchType: SEARCH_TYPE.MACRO,\r\n      callback: (imgSrc) => img.attr('src', imgSrc),\r\n    });\r\n  });\r\n}\r\n\r\nfunction _modJournalSheet(journalSheet, html, options) {\r\n  $(html)\r\n    .find('.header-button.entry-image')\r\n    .on('contextmenu', () => {\r\n      const journal = journalSheet.object;\r\n      if (!journal) return;\r\n      showArtSelect(journal.name, {\r\n        searchType: SEARCH_TYPE.JOURNAL,\r\n        callback: (imgSrc) => journal.update({ img: imgSrc }),\r\n      });\r\n    });\r\n}\r\n\r\nfunction _modRollTableSheet(sheet, html) {\r\n  $(html)\r\n    .find('.result-image')\r\n    .on('contextmenu', (event) => {\r\n      const table = sheet.object;\r\n      if (!table) return;\r\n      const img = $(event.target).closest('.result-image').find('img');\r\n      showArtSelect(table.name, {\r\n        searchType: TVA_CONFIG.customImageCategories.includes('RollTable') ? 'RollTable' : SEARCH_TYPE.ITEM,\r\n        callback: (imgSrc) => {\r\n          img.attr('src', imgSrc);\r\n          sheet._onSubmit(event);\r\n        },\r\n      });\r\n    });\r\n}\r\n\r\n/**\r\n * Adds right-click listener to Actor Sheet profile image to open up\r\n * the 'Art Select' screen.\r\n */\r\nfunction _modActorSheet(actorSheet, html, options) {\r\n  if (options.editable && TVA_CONFIG.permissions.portrait_right_click[game.user.role]) {\r\n    let profile = null;\r\n    let profileQueries = {\r\n      all: ['.profile', '.profile-img', '.profile-image', '.portrait'],\r\n      pf2e: ['.player-image', '.actor-icon', '.sheet-header img', '.actor-image'],\r\n    };\r\n\r\n    for (let query of profileQueries.all) {\r\n      profile = html[0].querySelector(query);\r\n      if (profile) break;\r\n    }\r\n\r\n    if (!profile && game.system.id in profileQueries) {\r\n      for (let query of profileQueries[game.system.id]) {\r\n        profile = html[0].querySelector(query);\r\n        if (profile) break;\r\n      }\r\n    }\r\n\r\n    if (!profile) {\r\n      console.warn('TVA |', game.i18n.localize('token-variants.notifications.warn.profile-image-not-found'));\r\n      return;\r\n    }\r\n\r\n    profile.addEventListener(\r\n      'contextmenu',\r\n      function (ev) {\r\n        showArtSelect(actorSheet.object.name, {\r\n          callback: (imgSrc, name) => updateActorImage(actorSheet.object, imgSrc),\r\n          searchType: SEARCH_TYPE.PORTRAIT,\r\n          object: actorSheet.object,\r\n        });\r\n      },\r\n      false\r\n    );\r\n  }\r\n}\r\n","import { renderTokenHUD } from '../../applications/tokenHUD.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'HUD';\r\n\r\nexport function registerHUDHooks() {\r\n  if (\r\n    FEATURE_CONTROL[feature_id] &&\r\n    (TVA_CONFIG.permissions.hudFullAccess[game.user.role] || TVA_CONFIG.permissions.hud[game.user.role])\r\n  ) {\r\n    registerHook(feature_id, 'renderTokenHUD', renderTokenHUD);\r\n  } else {\r\n    unregisterHook(feature_id, 'renderTokenHUD');\r\n  }\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'UserMappings';\r\n\r\nexport function registerUserMappingHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    ['updateToken', 'updateTile', 'sightRefresh'].forEach((id) => unregisterHook(feature_id, id));\r\n    return;\r\n  }\r\n\r\n  registerHook(feature_id, 'updateToken', _updateToken);\r\n  registerHook(feature_id, 'updateTile', _updateTile);\r\n  registerHook(feature_id, 'sightRefresh', _sightRefresh);\r\n}\r\n\r\nasync function _updateToken(token, change) {\r\n  // Update User Specific Image\r\n  if (change.flags?.['token-variants']) {\r\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\r\n      const t = canvas.tokens.get(token.id);\r\n      if (t) {\r\n        await t.draw();\r\n        canvas.visibility.restrictVisibility();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nasync function _updateTile(tile, change) {\r\n  // Update User Specific Image\r\n  if (change.flags?.['token-variants']) {\r\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\r\n      const t = canvas.tiles.get(tile.id);\r\n      if (t) {\r\n        await t.draw();\r\n        canvas.visibility.restrictVisibility();\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction _sightRefresh() {\r\n  if (!game.user.isGM) {\r\n    for (let t of canvas.tokens.placeables) {\r\n      if (_isInvisible(t)) t.visible = false;\r\n    }\r\n    for (let t of canvas.tiles.placeables) {\r\n      if (_isInvisible(t)) t.visible = false;\r\n    }\r\n  }\r\n}\r\n\r\nfunction _isInvisible(obj) {\r\n  const img = (obj.document.getFlag('token-variants', 'userMappings') || {})?.[game.userId];\r\n  return img === TVA_CONFIG.invisibleImage;\r\n}\r\n","import { insertArtSelectButton } from '../../applications/artSelect.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { SEARCH_TYPE, updateTokenImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'Wildcards';\r\n\r\nexport function registerWildcardHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    ['renderTokenConfig', 'preCreateToken'].forEach((name) => unregisterHook(feature_id, name));\r\n    return;\r\n  }\r\n\r\n  // Insert default random image field\r\n  registerHook(feature_id, 'renderTokenConfig', _renderTokenConfig);\r\n\r\n  // Set Default Wildcard images if needed\r\n  registerHook(feature_id, 'preCreateToken', _preCreateToken);\r\n}\r\n\r\nasync function _renderTokenConfig(config, html) {\r\n  html = $(html);\r\n  const checkboxRandomize = html.find('input[name=\"randomImg\"]');\r\n  if (checkboxRandomize.length && !html.find('.token-variants-proto').length) {\r\n    const defaultImg =\r\n      config.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n      config.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n      '';\r\n\r\n    const field = await foundry.applications.handlebars.renderTemplate(\r\n      '/modules/token-variants/templates/protoTokenElement.html',\r\n      {\r\n        defaultImg,\r\n        disableHUDButton: config.object?.getFlag('token-variants', 'disableHUDButton'),\r\n      }\r\n    );\r\n    checkboxRandomize.closest('.form-group').after(field);\r\n\r\n    const tvaFieldset = html.find('.token-variants-proto');\r\n\r\n    tvaFieldset.find('button').click((event) => {\r\n      event.preventDefault();\r\n      const input = tvaFieldset.find('input');\r\n      new foundry.applications.apps.FilePicker.implementation({ current: input.val(), field: input[0] }).browse(\r\n        defaultImg\r\n      );\r\n    });\r\n\r\n    insertArtSelectButton(tvaFieldset, 'flags.token-variants.randomImgDefault', {\r\n      search: config.object.name,\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n    });\r\n\r\n    // Hide/Show Default Img Form Group\r\n    const rdmImgFormGroup = tvaFieldset.find('.imagevideo').closest('.form-group');\r\n    const showHideGroup = function (checked) {\r\n      if (checked) {\r\n        rdmImgFormGroup.show();\r\n      } else {\r\n        rdmImgFormGroup.hide();\r\n      }\r\n      config.setPosition();\r\n    };\r\n    checkboxRandomize.on('click', (event) => showHideGroup(event.target.checked));\r\n    showHideGroup(checkboxRandomize.is(':checked'));\r\n  }\r\n}\r\n\r\nfunction _preCreateToken(tokenDocument, data, options, userId) {\r\n  if (game.user.id !== userId) return;\r\n  const update = {};\r\n  if (tokenDocument.actor?.prototypeToken?.randomImg) {\r\n    const defaultImg =\r\n      tokenDocument.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\r\n      tokenDocument.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\r\n      '';\r\n    if (defaultImg) update['texture.src'] = defaultImg;\r\n  }\r\n\r\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\r\n    updateTokenImage(update['texture.src'] ?? tokenDocument.texture.src, {\r\n      token: tokenDocument,\r\n      update,\r\n    });\r\n  }\r\n\r\n  if (!foundry.utils.isEmpty(update)) tokenDocument.updateSource(update);\r\n}\r\n","import { showArtSelect } from '../../token-variants.mjs';\r\nimport { doRandomSearch, doSyncSearch } from '../search.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { keyPressed, nameForgeRandomize, SEARCH_TYPE, updateActorImage, updateTokenImage } from '../utils.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'PopUpAndRandomize';\r\n\r\nexport function registerPopRandomizeHooks() {\r\n  if (FEATURE_CONTROL[feature_id]) {\r\n    registerHook(feature_id, 'createActor', _createActor);\r\n    registerHook(feature_id, 'createToken', _createToken);\r\n  } else {\r\n    ['createActor', 'createToken'].forEach((name) => unregisterHook(feature_id, name));\r\n  }\r\n}\r\n\r\nasync function _createToken(token, options, userId) {\r\n  if (userId && game.user.id != userId) return;\r\n\r\n  // Check if random search is enabled and if so perform it\r\n  const actorRandSettings = game.actors.get(token.actorId)?.getFlag('token-variants', 'randomizerSettings');\r\n  const randSettings = foundry.utils.mergeObject(TVA_CONFIG.randomizer, actorRandSettings ?? {}, {\r\n    inplace: false,\r\n    recursive: false,\r\n  });\r\n\r\n  let vDown = keyPressed('v');\r\n  const flagTarget = token.actor ? game.actors.get(token.actor.id) : token.document ?? token;\r\n  const popupFlag = flagTarget.getFlag('token-variants', 'popups');\r\n\r\n  if ((vDown && randSettings.tokenCopyPaste) || (!vDown && randSettings.tokenCreate)) {\r\n    let performRandomSearch = true;\r\n    if (!actorRandSettings) {\r\n      if (randSettings.representedActorDisable && token.actor) performRandomSearch = false;\r\n      if (randSettings.linkedActorDisable && token.actorLink) performRandomSearch = false;\r\n      if (_disableRandomSearchForType(randSettings, token.actor)) performRandomSearch = false;\r\n    } else {\r\n      performRandomSearch = Boolean(actorRandSettings);\r\n    }\r\n\r\n    if (performRandomSearch) {\r\n      // Randomize Token Name if need be\r\n      const randomName = await nameForgeRandomize(randSettings);\r\n      if (randomName) {\r\n        token.update({ name: randomName });\r\n      }\r\n\r\n      const img = await doRandomSearch(token.name, {\r\n        searchType: SEARCH_TYPE.TOKEN,\r\n        actor: token.actor,\r\n        randomizerOptions: randSettings,\r\n      });\r\n      if (img) {\r\n        await updateTokenImage(img[0], {\r\n          token: token,\r\n          actor: token.actor,\r\n          imgName: img[1],\r\n        });\r\n      }\r\n\r\n      if (randSettings.diffImages) {\r\n        let imgPortrait;\r\n        if (randSettings.syncImages) {\r\n          if (!img) return;\r\n          imgPortrait = await doSyncSearch(img[1], {\r\n            searchType: SEARCH_TYPE.PORTRAIT,\r\n          });\r\n        } else {\r\n          // Prevent searches via method intended purely for tokens\r\n          if (!(randSettings.tokenName || randSettings.actorName)) randSettings.tokenName = true;\r\n          randSettings.wildcard = false;\r\n          randSettings.shared = false;\r\n          imgPortrait = await doRandomSearch(token.name, {\r\n            searchType: SEARCH_TYPE.PORTRAIT,\r\n            actor: token.actor,\r\n            randomizerOptions: randSettings,\r\n          });\r\n        }\r\n\r\n        if (imgPortrait) {\r\n          await updateActorImage(token.actor, imgPortrait[0]);\r\n        }\r\n      } else if (randSettings.tokenToPortrait) {\r\n        if (!img) return;\r\n        await updateActorImage(token.actor, img[0]);\r\n      }\r\n      return;\r\n    }\r\n    if (popupFlag == null && !randSettings.popupOnDisable) {\r\n      return;\r\n    }\r\n  } else if (randSettings.tokenCreate || randSettings.tokenCopyPaste) {\r\n    return;\r\n  }\r\n\r\n  // Check if pop-up is enabled and if so open it\r\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\r\n    return;\r\n  }\r\n\r\n  let dirKeyDown = keyPressed('popupOverride');\r\n\r\n  if (vDown && TVA_CONFIG.popup.disableAutoPopupOnTokenCopyPaste) {\r\n    return;\r\n  }\r\n\r\n  if (!dirKeyDown || (dirKeyDown && vDown)) {\r\n    if (TVA_CONFIG.popup.disableAutoPopupOnTokenCreate && !vDown) {\r\n      return;\r\n    } else if (popupFlag == null && _disablePopupForType(token.actor)) {\r\n      return;\r\n    } else if (popupFlag != null && !popupFlag) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  showArtSelect(token.name, {\r\n    callback: async function (imgSrc, imgName) {\r\n      if (TVA_CONFIG.popup.twoPopups) {\r\n        await updateActorImage(token.actor, imgSrc);\r\n        _twoPopupPrompt(token.actor, imgSrc, imgName, token);\r\n      } else {\r\n        updateTokenImage(imgSrc, {\r\n          actor: token.actor,\r\n          imgName: imgName,\r\n          token: token,\r\n        });\r\n      }\r\n    },\r\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.TOKEN,\r\n    object: token,\r\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\r\n  });\r\n}\r\n\r\nasync function _createActor(actor, options, userId) {\r\n  if (userId && game.user.id != userId) return;\r\n\r\n  // Check if random search is enabled and if so perform it\r\n  const randSettings = TVA_CONFIG.randomizer;\r\n  if (randSettings.actorCreate) {\r\n    let performRandomSearch = true;\r\n    if (randSettings.linkedActorDisable && actor.prototypeToken.actorLink) performRandomSearch = false;\r\n    if (_disableRandomSearchForType(randSettings, actor)) performRandomSearch = false;\r\n    if (performRandomSearch) {\r\n      const img = await doRandomSearch(actor.name, {\r\n        searchType: SEARCH_TYPE.PORTRAIT,\r\n        actor: actor,\r\n      });\r\n      if (img) {\r\n        await updateActorImage(actor, img[0]);\r\n      }\r\n\r\n      if (!img) return;\r\n\r\n      if (randSettings.diffImages) {\r\n        let imgToken;\r\n        if (randSettings.syncImages) {\r\n          imgToken = await doSyncSearch(img[1], { searchType: SEARCH_TYPE.TOKEN });\r\n        } else {\r\n          imgToken = await doRandomSearch(actor.name, {\r\n            searchType: SEARCH_TYPE.TOKEN,\r\n            actor: actor,\r\n          });\r\n        }\r\n\r\n        if (imgToken) {\r\n          await updateTokenImage(imgToken[0], { actor: actor, imgName: imgToken[1] });\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    if (!randSettings.popupOnDisable) {\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Check if pop-up is enabled and if so open it\r\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\r\n    return;\r\n  }\r\n\r\n  if (TVA_CONFIG.popup.disableAutoPopupOnActorCreate && !keyPressed('popupOverride')) {\r\n    return;\r\n  } else if (_disablePopupForType(actor)) {\r\n    return;\r\n  }\r\n\r\n  showArtSelect(actor.name, {\r\n    callback: async function (imgSrc, name) {\r\n      const actTokens = actor.getActiveTokens();\r\n      const token = actTokens.length === 1 ? actTokens[0] : null;\r\n      await updateActorImage(actor, imgSrc);\r\n      if (TVA_CONFIG.popup.twoPopups) _twoPopupPrompt(actor, imgSrc, name, token);\r\n      else {\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          token: token,\r\n        });\r\n      }\r\n    },\r\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    object: actor,\r\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\r\n  });\r\n}\r\n\r\nfunction _disableRandomSearchForType(randSettings, actor) {\r\n  if (!actor) return false;\r\n  return randSettings[`${actor.type}Disable`] ?? false;\r\n}\r\n\r\nfunction _disablePopupForType(actor) {\r\n  if (!actor) return false;\r\n  return TVA_CONFIG.popup[`${actor.type}Disable`] ?? false;\r\n}\r\n\r\nfunction _twoPopupPrompt(actor, imgSrc, imgName, token) {\r\n  if (TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog) {\r\n    showArtSelect((token ?? actor.prototypeToken).name, {\r\n      callback: (imgSrc, name) =>\r\n        updateTokenImage(imgSrc, {\r\n          actor: actor,\r\n          imgName: name,\r\n          token: token,\r\n        }),\r\n      searchType: SEARCH_TYPE.TOKEN,\r\n      object: token ? token : actor,\r\n      force: true,\r\n    });\r\n  } else if (TVA_CONFIG.popup.twoPopups) {\r\n    let d = new Dialog({\r\n      title: 'Portrait -> Token',\r\n      content: `<p>${game.i18n.localize('token-variants.windows.art-select.apply-same-art')}</p>`,\r\n      buttons: {\r\n        one: {\r\n          icon: '<i class=\"fas fa-check\"></i>',\r\n          callback: () => {\r\n            updateTokenImage(imgSrc, {\r\n              actor: actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n            const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n            for (const app of artSelects) {\r\n              app.close();\r\n            }\r\n          },\r\n        },\r\n        two: {\r\n          icon: '<i class=\"fas fa-times\"></i>',\r\n          callback: () => {\r\n            showArtSelect((token ?? actor.prototypeToken).name, {\r\n              callback: (imgSrc, name) =>\r\n                updateTokenImage(imgSrc, {\r\n                  actor: actor,\r\n                  imgName: name,\r\n                  token: token,\r\n                }),\r\n              searchType: SEARCH_TYPE.TOKEN,\r\n              object: token ? token : actor,\r\n              force: true,\r\n            });\r\n          },\r\n        },\r\n      },\r\n      default: 'one',\r\n    });\r\n    d.render(true);\r\n  }\r\n}\r\n","import { registerEffectIconHooks } from './effectIconHooks.js';\r\nimport { registerArtSelectButtonHooks } from './artSelectButtonHooks.js';\r\nimport { registerOverlayHooks } from './overlayHooks.js';\r\nimport { registerEffectMappingHooks } from './effectMappingHooks.js';\r\nimport { registerHUDHooks } from './hudHooks.js';\r\nimport { registerUserMappingHooks } from './userMappingHooks.js';\r\nimport { registerWildcardHooks } from './wildcardHooks.js';\r\nimport { registerPopRandomizeHooks } from './popUpRandomizeHooks.js';\r\nimport { TVA_CONFIG } from '../settings.js';\r\n\r\nexport const REGISTERED_HOOKS = {};\r\n\r\nexport function registerHook(feature_id, name, fn, { once = false } = {}) {\r\n  if (!(feature_id in REGISTERED_HOOKS)) REGISTERED_HOOKS[feature_id] = {};\r\n  if (name in REGISTERED_HOOKS[feature_id]) return;\r\n  if (TVA_CONFIG.debug) console.info(`TVA | Registering Hook`, { feature_id, name, fn, once });\r\n  const num = Hooks.on(name, fn, { once });\r\n  REGISTERED_HOOKS[feature_id][name] = num;\r\n}\r\n\r\nexport function unregisterHook(feature_id, name) {\r\n  if (feature_id in REGISTERED_HOOKS && name in REGISTERED_HOOKS[feature_id]) {\r\n    if (TVA_CONFIG.debug)\r\n      console.info(`TVA | Un-Registering Hook`, {\r\n        feature_id,\r\n        name,\r\n        id: REGISTERED_HOOKS[feature_id][name],\r\n      });\r\n    Hooks.off(name, REGISTERED_HOOKS[feature_id][name]);\r\n    delete REGISTERED_HOOKS[feature_id][name];\r\n  }\r\n}\r\n\r\nexport function registerAllHooks() {\r\n  // Hide effect icons\r\n  registerEffectIconHooks();\r\n  // Display overlays\r\n  registerOverlayHooks();\r\n  // Insert Art Select buttons and contextmenu listeners\r\n  registerArtSelectButtonHooks();\r\n  // Effect Mapping related listening for state changes and applying configurations\r\n  registerEffectMappingHooks();\r\n  // Display HUD buttons for Tokens and Tiles\r\n  registerHUDHooks();\r\n  // Default Wildcard image controls\r\n  registerWildcardHooks();\r\n  // User to Image mappings for Tile and Tokens\r\n  registerUserMappingHooks();\r\n  // Handle pop-ups and randomization on token/actor create\r\n  registerPopRandomizeHooks();\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { HTMLOverlay } from '../sprite/HTMLOverlay.js';\r\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\r\nimport { drawOverlays } from '../token/overlay.js';\r\nimport { registerHook, unregisterHook } from './hooks.js';\r\n\r\nconst feature_id = 'Overlays';\r\n\r\nexport function registerOverlayHooks() {\r\n  if (!FEATURE_CONTROL[feature_id]) {\r\n    [\r\n      'refreshToken',\r\n      'destroyToken',\r\n      'updateActor',\r\n      'renderCombatTracker',\r\n      'updateToken',\r\n      'createToken',\r\n      'hoverToken',\r\n      'renderHeadsUpDisplay',\r\n    ].forEach((id) => unregisterHook(feature_id, id));\r\n    return;\r\n  } else if (!TVA_CONFIG.evaluateOverlayOnHover) {\r\n    unregisterHook(feature_id, 'hoverToken');\r\n  }\r\n\r\n  if (TVA_CONFIG.evaluateOverlayOnHover) {\r\n    registerHook(feature_id, 'hoverToken', function (token, hover) {\r\n      drawOverlays(token);\r\n    });\r\n  }\r\n\r\n  registerHook(feature_id, 'createToken', async function (token) {\r\n    if (token.object) drawOverlays(token.object);\r\n  });\r\n\r\n  registerHook(feature_id, 'updateToken', async function (token) {\r\n    if (token.object) drawOverlays(token.object);\r\n  });\r\n\r\n  registerHook(feature_id, 'refreshToken', (token) => {\r\n    if (token.tvaOverlays)\r\n      for (const child of token.tvaOverlays) {\r\n        if (child instanceof TVAOverlay) {\r\n          child.refresh(null, { preview: false, fullRefresh: false });\r\n        }\r\n      }\r\n  });\r\n\r\n  registerHook(feature_id, 'destroyToken', (token) => {\r\n    if (token.tvaOverlays)\r\n      for (const child of token.tvaOverlays) {\r\n        child.parent?.removeChild(child)?.destroy();\r\n      }\r\n  });\r\n\r\n  registerHook(feature_id, 'updateActor', async function (actor) {\r\n    if (actor.getActiveTokens)\r\n      actor.getActiveTokens(true).forEach((token) => {\r\n        drawOverlays(token);\r\n      });\r\n  });\r\n\r\n  registerHook(feature_id, 'renderCombatTracker', function () {\r\n    for (const tkn of canvas.tokens.placeables) {\r\n      drawOverlays(tkn);\r\n    }\r\n  });\r\n\r\n  registerHook(feature_id, 'renderHeadsUpDisplay', () => {\r\n    HTMLOverlay.hudRendered();\r\n  });\r\n}\r\n\r\nconst REFRESH_HOOKS = {};\r\n\r\nexport function registerOverlayRefreshHook(tvaOverlay, hookName) {\r\n  if (!(hookName in REFRESH_HOOKS)) {\r\n    registerHook('TVAOverlayRefresh', hookName, () => {\r\n      REFRESH_HOOKS[hookName]?.forEach((s) => s.refresh());\r\n    });\r\n    REFRESH_HOOKS[hookName] = [tvaOverlay];\r\n  } else if (!REFRESH_HOOKS[hookName].find((s) => s == tvaOverlay)) {\r\n    REFRESH_HOOKS[hookName].push(tvaOverlay);\r\n  }\r\n}\r\n\r\nexport function unregisterOverlayRefreshHooks(tvaOverlay, hookName = null) {\r\n  const unregister = function (hook) {\r\n    if (REFRESH_HOOKS[hook]) {\r\n      let index = REFRESH_HOOKS[hook].findIndex((s) => s == tvaOverlay);\r\n      if (index > -1) {\r\n        REFRESH_HOOKS[hook].splice(index, 1);\r\n        if (!REFRESH_HOOKS[hook].length) {\r\n          unregisterHook('TVAOverlayRefresh', hook);\r\n          delete REFRESH_HOOKS[hook];\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  if (hookName) unregister(hookName);\r\n  else {\r\n    Object.keys(REFRESH_HOOKS).forEach((k) => unregister(k));\r\n  }\r\n}\r\n","export const CORE_TEMPLATES = [\r\n  {\r\n    name: 'Tint Red when HP is below 10%',\r\n    hint: 'Tint token red when HP falls below 10%',\r\n    img: 'https://user-images.githubusercontent.com/7693704/243428871-c52130b3-2f12-4de7-a86e-fabc67e865a9.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'MmLSOlJx',\r\n        label: 'Tint Red',\r\n        expression: 'hp<=10%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {\r\n          texture: {\r\n            tint: '#ff0000',\r\n          },\r\n        },\r\n        overlay: false,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Tint Red',\r\n        },\r\n        group: 'Low HP',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Ob9LP35K',\r\n  },\r\n  {\r\n    name: 'Health State Text Overlay',\r\n    hint: `Displays text overlay based on percentage health. \\n0% < hp <= 25% : Critical\\n25% < hp <= 50% : Bloodied\\n50% < hp <= 75% : Wounded\\n75% < hp : Healthy`,\r\n    img: 'https://user-images.githubusercontent.com/7693704/243426356-ceab629c-c16c-42b3-9004-af7dafb62eb7.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'jqaFdwkQ',\r\n        label: 'Bloodied',\r\n        expression: 'hp>25% && hp<=50%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Bloodied',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff5900',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Bloodied',\r\n          id: 'jqaFdwkQ',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'm4GQVz5O',\r\n        label: 'Critical',\r\n        expression: 'hp>0 && hp<=25%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Critical',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Critical',\r\n          id: 'm4GQVz5O',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'H1wrS5N1',\r\n        label: 'Healthy',\r\n        expression: 'hp>75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Healthy',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#2bff00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Healthy',\r\n          id: 'H1wrS5N1',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'IojJZS7v',\r\n        label: 'Wounded',\r\n        expression: 'hp>50% && hp<=75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Wounded',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ffbb00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Wounded',\r\n          id: 'IojJZS7v',\r\n        },\r\n        group: 'Health State Overlay',\r\n        i: 3,\r\n      },\r\n    ],\r\n    id: 'JNClkgGU',\r\n  },\r\n  {\r\n    name: 'Health State Text Overlay - Passed Check',\r\n    hint: 'Same as Health State Text Overlay except also requiring the Token actor to have Reveal Health active effect applied to it.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/243429385-f62b111c-3d9c-4cd8-9c27-f5b13e09fea2.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'k0XbFE7a',\r\n        label: 'Bloodied',\r\n        expression: 'Reveal Health && hp>25% && hp<=50%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Bloodied',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff5900',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Bloodied',\r\n          id: 'k0XbFE7a',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'a1VxhnWK',\r\n        label: 'Critical',\r\n        expression: 'Reveal Health && hp>0 && hp<=25%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Critical',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Critical',\r\n          id: 'a1VxhnWK',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'DNuBTXe8',\r\n        label: 'Healthy',\r\n        expression: 'Reveal Health && hp>75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Healthy',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#2bff00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Healthy',\r\n          id: 'DNuBTXe8',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'ROPjrvLu',\r\n        label: 'Wounded',\r\n        expression: 'Reveal Health && hp>50% && hp<=75%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.51,\r\n          scaleX: 0.76,\r\n          scaleY: 0.76,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Wounded',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ffbb00',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: null,\r\n            },\r\n          },\r\n          label: 'Wounded',\r\n          id: 'ROPjrvLu',\r\n        },\r\n        group: 'Health State Overlay - Passed Check',\r\n        i: 3,\r\n      },\r\n    ],\r\n    id: '0ZJQiOdD',\r\n  },\r\n  {\r\n    name: 'Fancy Nameplate',\r\n    hint: 'Displays a curved red nameplate underneath the token.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244439674-12510686-2f72-44b3-8a1d-e6cc7fbb00c6.png',\r\n    mappings: [\r\n      {\r\n        id: 'DTbwvQiG',\r\n        label: 'Token Nameplate',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          parent: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionX: false,\r\n          linkDimensionY: false,\r\n          linkOpacity: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.51,\r\n          scaleX: 0.68,\r\n          scaleY: 0.68,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '{{name}}',\r\n            fontFamily: 'Modesto Condensed',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 3,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 450,\r\n              invert: true,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              line: {\r\n                width: 1,\r\n                color: '#111111',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#111111',\r\n                alpha: 1,\r\n              },\r\n            },\r\n          ],\r\n          label: 'Token Nameplate',\r\n        },\r\n        group: 'Nameplate',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Ik1uNcWU',\r\n  },\r\n  {\r\n    name: 'Info Box #1',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244441852-b50f3ca6-e0c3-4ce0-b498-ddd00edcbdca.png',\r\n    system: 'dnd5e',\r\n    group: 'Info',\r\n    mappings: [\r\n      {\r\n        id: 'W8BPK9hv',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'W8BPK9hv',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 0.73,\r\n          scaleY: 0.73,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'DropShadowFilter',\r\n          filterOptions: {\r\n            rotation: 45,\r\n            distance: 16.9,\r\n            color: '#000000',\r\n            alpha: 0.52,\r\n            shadowOnly: false,\r\n            blur: 2,\r\n            quality: 3,\r\n          },\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '450',\r\n                height: '200',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#508fe2',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.55,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'bkoP4Qpo',\r\n        label: 'Legendary Actions',\r\n        expression: 'actor.system.resources.legact.max>0',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'bkoP4Qpo',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: -0.02,\r\n          scaleX: 0.5,\r\n          scaleY: 0.5,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Legendary: Action {{actor.system.resources.legact.value}}/{{actor.system.resources.legact.max}} Resistance {{actor.system.resources.legres.value}}/{{actor.system.resources.legres.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Legendary Actions',\r\n        },\r\n        group: 'Info Box',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'OvcWUW13',\r\n        label: 'Mods',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'OvcWUW13',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.38,\r\n          scaleX: 0.57,\r\n          scaleY: 0.57,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR {{actor.system.abilities.str.mod}}  DEX {{actor.system.abilities.dex.mod}}  CON {{actor.system.abilities.con.mod}}  INT {{actor.system.abilities.int.mod}}  WIS {{actor.system.abilities.wis.mod}}  CHA {{actor.system.abilities.cha.mod}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Mods',\r\n        },\r\n        group: 'Info Box',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'jybTYLTB',\r\n        label: 'Token Name',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'jybTYLTB',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.35,\r\n          scaleX: 0.77,\r\n          scaleY: 0.77,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Name: {{name}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Token Name',\r\n        },\r\n        group: 'Info Box',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'bGbHPbw6',\r\n        label: 'HP',\r\n        expression: 'hp>40%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'bGbHPbw6',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.23,\r\n          scaleX: 0.82,\r\n          scaleY: 0.82,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#6b6b6b',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'S9gXdyGY',\r\n        label: 'Low HP',\r\n        expression: 'hp<=40%',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'S9gXdyGY',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0.23,\r\n          scaleX: 0.82,\r\n          scaleY: 0.82,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#6b6b6b',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Low HP',\r\n        },\r\n        group: 'Info Box',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'k9Ws74Hc',\r\n        label: 'Actor AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'k9Ws74Hc',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.25,\r\n          offsetY: 0.46,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'AC: {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Actor AC',\r\n        },\r\n        group: 'Info Box',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: 'eIxjLZmy',\r\n        label: 'Movement Label',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 54,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'eIxjLZmy',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.25,\r\n          offsetY: 0.2,\r\n          scaleX: 0.61,\r\n          scaleY: 0.61,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Movement',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Label',\r\n        },\r\n        group: 'Info Box',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: 'k5xYpZAZ',\r\n        label: 'Movement Walk',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'k5xYpZAZ',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.36,\r\n          offsetY: -0.03,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '{{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Walk',\r\n        },\r\n        group: 'Info Box',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'dHHZRQXG',\r\n        label: 'Movement Fly',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'dHHZRQXG',\r\n          parentID: 'W8BPK9hv',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.36,\r\n          offsetY: -0.16,\r\n          scaleX: 0.33,\r\n          scaleY: 0.33,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Fly {{actor.system.attributes.movement.fly}}, Swim {{actor.system.attributes.movement.swim}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Movement Fly',\r\n        },\r\n        group: 'Info Box',\r\n        i: 9,\r\n      },\r\n    ],\r\n    id: 'wuMcLy3T',\r\n  },\r\n  {\r\n    name: 'Info Box #2',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244750685-81988600-5153-4d29-acb0-2c62111bed14.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: 'f0pV6Pnl',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'f0pV6Pnl',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '200',\r\n                height: '300',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#2e5a94',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.9,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'n2Adi1fi',\r\n        label: 'HP',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'n2Adi1fi',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.42,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'hCKVzw3Z',\r\n        label: ' AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'hCKVzw3Z',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.31,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'AC: {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: ' AC',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: '2nYmUTwu',\r\n        label: ' Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '2nYmUTwu',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.2,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Speed: {{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: ' Speed',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 's1NtDiUV',\r\n        label: 'Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 54,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 's1NtDiUV',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0.15,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Perception',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'jYeRIoG2',\r\n        label: 'Passive Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'jYeRIoG2',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.47,\r\n          offsetY: 0,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Passive: {{actor.system.skills.prc.passive}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Passive Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'KYMdkTVI',\r\n        label: 'Active Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'KYMdkTVI',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.48,\r\n          offsetY: 0,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 1,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Active: {{actor.system.skills.prc.total}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Active Perception',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: 'Ewbg54II',\r\n        label: 'CHA',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'Ewbg54II',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}} {{actor.system.abilities.cha.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CHA',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: '2le1Nagp',\r\n        label: 'CON',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '2le1Nagp',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}} {{actor.system.abilities.con.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CON',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'ahKmjzLj',\r\n        label: 'DEX',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'ahKmjzLj',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}} {{actor.system.abilities.dex.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'DEX',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 9,\r\n      },\r\n      {\r\n        id: 'gQzyq0zm',\r\n        label: 'INT',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'gQzyq0zm',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}} {{actor.system.abilities.int.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'INT',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 10,\r\n      },\r\n      {\r\n        id: 'hYGg1oAt',\r\n        label: 'STR',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'hYGg1oAt',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}} {{actor.system.abilities.str.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'STR',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 11,\r\n      },\r\n      {\r\n        id: 'uQ5zS3K6',\r\n        label: 'WIS',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'uQ5zS3K6',\r\n          parentID: 'f0pV6Pnl',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}} {{actor.system.abilities.wis.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'WIS',\r\n        },\r\n        group: 'Info Box #2',\r\n        i: 12,\r\n      },\r\n    ],\r\n    id: 'Wtq9HDsX',\r\n  },\r\n  {\r\n    name: 'Info Box #3',\r\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244750246-794625b9-9e1d-4322-9265-fc295f02ca2b.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: 'Gt11vjXV',\r\n        label: 'Box Background',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'Gt11vjXV',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: true,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.55,\r\n          offsetY: 0,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: true,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '240',\r\n                height: '300',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 2,\r\n                color: '#ffffff',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#2e5a94',\r\n                color2: '',\r\n                prc: '',\r\n                alpha: 0.9,\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Box Background',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'o4XWzdDM',\r\n        label: 'HP',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 51,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'o4XWzdDM',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.44,\r\n          offsetY: 0.42,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'HP',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 1,\r\n      },\r\n      {\r\n        id: 'eAv2dSV6',\r\n        label: 'AC',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 52,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'eAv2dSV6',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.43,\r\n          offsetY: 0.28,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.ac.value}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'AC',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'SCfkWTni',\r\n        label: 'Fly Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'SCfkWTni',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.04,\r\n          offsetY: 0.13,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.movement.fly}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Fly Speed',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'e5LPzVta',\r\n        label: 'Walk Speed',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 53,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'e5LPzVta',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: 0.13,\r\n          scaleX: 0.84,\r\n          scaleY: 0.84,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.attributes.movement.walk}}ft',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Walk Speed',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'XlopagaT',\r\n        label: 'Passive Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 55,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'XlopagaT',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.45,\r\n          offsetY: -0.02,\r\n          scaleX: 0.83,\r\n          scaleY: 0.83,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.skills.prc.passive}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Passive Perception',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 5,\r\n      },\r\n      {\r\n        id: 'CeXgVxA0',\r\n        label: 'Active Perception',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 56,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'CeXgVxA0',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.03,\r\n          offsetY: -0.02,\r\n          scaleX: 0.83,\r\n          scaleY: 0.83,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' {{actor.system.skills.prc.total}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Active Perception',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 6,\r\n      },\r\n      {\r\n        id: '0WWf1iGM',\r\n        label: 'CHA',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0WWf1iGM',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}}  {{actor.system.abilities.cha.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CHA',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 7,\r\n      },\r\n      {\r\n        id: 'AU8tTXat',\r\n        label: 'CON',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'AU8tTXat',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.31,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}}  {{actor.system.abilities.con.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'CON',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 8,\r\n      },\r\n      {\r\n        id: 'JZKNmgvY',\r\n        label: 'DEX',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'JZKNmgvY',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}}  {{actor.system.abilities.dex.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'DEX',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 9,\r\n      },\r\n      {\r\n        id: 'AUGurJtx',\r\n        label: 'INT',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'AUGurJtx',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}}  {{actor.system.abilities.int.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'INT',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 10,\r\n      },\r\n      {\r\n        id: 'z0PMTFxo',\r\n        label: 'STR',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'z0PMTFxo',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0.32,\r\n          offsetY: -0.11,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}}  {{actor.system.abilities.str.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'STR',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 11,\r\n      },\r\n      {\r\n        id: 'YXUiGPBv',\r\n        label: 'WIS',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 57,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'YXUiGPBv',\r\n          parentID: 'Gt11vjXV',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: true,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: -0.3,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}}  {{actor.system.abilities.wis.save}}',\r\n            fontFamily: 'Signika',\r\n            fontSize: 36,\r\n            letterSpacing: 0,\r\n            fill: '#FFFFFF',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'WIS',\r\n        },\r\n        group: 'Info Box #3',\r\n        i: 12,\r\n      },\r\n    ],\r\n    id: 'vQJ3coCJ',\r\n  },\r\n  {\r\n    name: 'Facing Direction',\r\n    hint: 'Displays an arrow in the top-right corner of the token showing the direction it is facing.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/244647284-2213caf5-6d49-4413-ab5f-83901ffbc8e6.png',\r\n    mappings: [\r\n      {\r\n        id: '9UEOkJ1J',\r\n        label: 'Arrow',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '9UEOkJ1J',\r\n          parentID: '',\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: true,\r\n          animation: {\r\n            relative: true,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.5,\r\n          offsetY: 0.5,\r\n          scaleX: 0.51,\r\n          scaleY: 0.51,\r\n          angle: 90,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            fontFamily: 'Signika',\r\n            fontSize: 63,\r\n            letterSpacing: 0,\r\n            fill: '#ff0000',\r\n            dropShadow: null,\r\n            strokeThickness: 3,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Arrow',\r\n        },\r\n        group: 'Facing Direction',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'Z8CTgmOg',\r\n  },\r\n  {\r\n    name: 'Combat Markers',\r\n    hint: 'Displays rotating markers for tokens in combat.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257478593-81b9192d-1ffe-4f0b-8e5d-806218d7e25f.png',\r\n    mappings: [\r\n      {\r\n        id: '9R3glzOK',\r\n        label: 'Your Turn is Next!',\r\n        expression: 'combat-turn-next',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Your Turn is Next!',\r\n          parent: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: true,\r\n            duration: 30000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: false,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.6,\r\n          scaleY: 1.6,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: 'Next Turn  =  = =  =  =  = Next turn =  =  =  =  = ',\r\n            fontFamily: 'Signika',\r\n            fontSize: 41,\r\n            letterSpacing: 0,\r\n            fill: '#e6a800',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 125,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n        },\r\n        group: 'Combat',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: 'qoWG5AD0',\r\n        label: 'Your Turn!',\r\n        expression: 'combat-turn',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          label: 'Your Turn!',\r\n          parent: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: true,\r\n            duration: 30000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: true,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: false,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.6,\r\n          scaleY: 1.6,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '= Your Turn  =  = =  =  =  = Your turn =  =  =  =  =  ',\r\n            fontFamily: 'Signika',\r\n            fontSize: 41,\r\n            letterSpacing: 0,\r\n            fill: '#00ace6',\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 125,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n        },\r\n        group: 'Combat',\r\n        i: 1,\r\n      },\r\n    ],\r\n    id: 'YpoX5zxO',\r\n  },\r\n  {\r\n    name: 'Disposition Markers',\r\n    hint: 'Displays circles underneath tokens coloured based on their disposition.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/246497702-5de47dc9-21ef-43a1-86db-b3f85eb8ddb1.png',\r\n    mappings: [\r\n      {\r\n        id: 'TzP6MBC1',\r\n        label: 'Friendly',\r\n        expression: 'disposition=1',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'TzP6MBC1',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#1acb2f',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Friendly',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 2,\r\n      },\r\n      {\r\n        id: 'oIsQWISB',\r\n        label: 'Hostile',\r\n        expression: 'disposition=-1',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'oIsQWISB',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#eb0000',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Hostile',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 3,\r\n      },\r\n      {\r\n        id: 'fYxJ9Bbc',\r\n        label: 'Neutral',\r\n        expression: 'disposition=0',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'fYxJ9Bbc',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Neutral',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 4,\r\n      },\r\n      {\r\n        id: 'PyEXXb5J',\r\n        label: 'Secret',\r\n        expression: 'disposition=-2',\r\n        codeExp: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: false,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'PyEXXb5J',\r\n          parentID: '',\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          imgLinked: false,\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '#ba24ff',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '',\r\n          height: '',\r\n          scaleX: '0.24',\r\n          scaleY: '0.24',\r\n          angle: '0',\r\n          pOffsetX: '',\r\n          pOffsetY: '',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnHUD: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'center',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * @scale',\r\n                height: '{{object.h}} * @scale',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffffff',\r\n                alpha: '0.75',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '{{object.w}} * @inner',\r\n                y: '{{object.w}} * @inner',\r\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\r\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: '0',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#b8b8b8',\r\n                alpha: '0.7',\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'scale',\r\n              value: '2.3',\r\n            },\r\n            {\r\n              name: 'inner',\r\n              value: '0.3',\r\n            },\r\n          ],\r\n          effect: '',\r\n          interactivity: [],\r\n          label: 'Secret',\r\n        },\r\n        group: 'Disposition Markers',\r\n        i: 5,\r\n      },\r\n    ],\r\n    id: 'yjqfAagB',\r\n  },\r\n  {\r\n    name: 'Health Bar',\r\n    hint: 'A recreation of the standard health bar using Overlays.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257246890-d41894a0-7f40-4e91-a47a-bc10d6f198e6.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'dgIBKbcU',\r\n        label: 'Health Bar',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'dgIBKbcU',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: true,\r\n          bottom: true,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: 0,\r\n          offsetY: -0.5,\r\n          scaleX: 1,\r\n          scaleY: 1,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 1,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#FFFFFF',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}}',\r\n                height: '{{object.h}} * @height',\r\n                radius: '3',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#5c5c5c',\r\n                alpha: 0.65,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '{{object.w}} * ( {{hp}} / {{hpMax}} )',\r\n                height: '{{object.h}} * @height',\r\n                radius: '3',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'height',\r\n              value: '0.079',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Bar',\r\n        },\r\n        group: 'Health Bar',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'GDyvkEB4',\r\n  },\r\n  {\r\n    name: 'Health Ring',\r\n    hint: 'A ring shaped health bar.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257246432-a339394f-489a-4436-9d4b-427c285d4f27.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: 'erOTHzIc',\r\n        label: 'Health Ring',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: 'erOTHzIc',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: 0,\r\n          offsetY: 0,\r\n          scaleX: 1.02,\r\n          scaleY: 1.02,\r\n          angle: -90,\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'Background',\r\n              line: {\r\n                width: 0,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#b0b0b0',\r\n                alpha: 0.6,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '{{hp}} / {{hpMax}} * 360',\r\n              },\r\n              label: 'Health Tracker',\r\n              line: {\r\n                width: 0,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\r\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'Outline',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#b0b0b0',\r\n                alpha: 0,\r\n                interpolateColor: {\r\n                  color2: '',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'ringScale',\r\n              value: '1.8',\r\n            },\r\n            {\r\n              name: 'innerRadius',\r\n              value: '0.9',\r\n            },\r\n            {\r\n              name: 'outerRadius',\r\n              value: '1.0',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Ring',\r\n        },\r\n        group: 'Health Ring',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'yITi94hC',\r\n  },\r\n  {\r\n    name: 'Health Hearts',\r\n    hint: 'Displays up to 10 hearts to the right of the token based on their current health. Each heart is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257349483-1864d4ca-a2de-468d-872d-6d8c2847434a.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '4uCpbtHY',\r\n        label: 'Hearts',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '4uCpbtHY',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          alpha: 1,\r\n          tint: '',\r\n          offsetX: -0.53,\r\n          offsetY: 0.5,\r\n          scaleX: 0.5,\r\n          scaleY: 0.5,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: ' ',\r\n            repeating: true,\r\n            repeat: {\r\n              value: '{{hp}}',\r\n              increment: '10',\r\n              isPercentage: true,\r\n              maxValue: '{{hpMax}}',\r\n              perRow: '2',\r\n              maxRows: '',\r\n            },\r\n            fontFamily: 'Signika',\r\n            fill: '#ff0000',\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: null,\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          effect: '',\r\n          label: 'Hearts',\r\n        },\r\n        group: 'Health Hearts',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'T2DrD0Em',\r\n  },\r\n  {\r\n    name: 'Health Circles',\r\n    hint: 'Displays up to 10 circles to the right of the token based on their current health. Each circle is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257476414-c42bdbc0-c57b-4367-8207-3e2e4273094f.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '0vETg18v',\r\n        label: 'Health Circles',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0vETg18v',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: -0.52,\r\n          offsetY: 0.6,\r\n          scaleX: 0.46,\r\n          scaleY: 0.46,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'ellipse',\r\n                x: '0',\r\n                y: '0',\r\n                width: '25',\r\n                height: '25',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: true,\r\n              repeat: {\r\n                value: '{{hp}}',\r\n                increment: '10',\r\n                isPercentage: true,\r\n                maxValue: '{{hpMax}}',\r\n                perRow: '2',\r\n                maxRows: '',\r\n                paddingX: '3',\r\n                paddingY: '3',\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Circles',\r\n        },\r\n        group: 'Health Circles',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'kJ0Fi54w',\r\n  },\r\n  {\r\n    name: 'Health Squares',\r\n    hint: 'Displays up to 10 squares to the right of the token based on their current health. Each square is representative of 10% of the health.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/257477099-689cd23a-0e4a-4d9a-aaa2-bf88b169ede8.png',\r\n    group: 'Health',\r\n    mappings: [\r\n      {\r\n        id: '0vETg18v',\r\n        label: 'Health Squares',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '0vETg18v',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: false,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: 5000,\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: true,\r\n          linkDimensionsY: true,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: 1,\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          offsetX: -0.52,\r\n          offsetY: 0.6,\r\n          scaleX: 0.46,\r\n          scaleY: 0.46,\r\n          angle: 0,\r\n          anchor: {\r\n            x: 0,\r\n            y: 0,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedUsers: [],\r\n          limitOnHover: false,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: 36,\r\n            align: 'left',\r\n            letterSpacing: 0,\r\n            dropShadow: 'true',\r\n            strokeThickness: 1,\r\n            stroke: '#111111',\r\n            curve: {\r\n              radius: 0,\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'rectangle',\r\n                x: '0',\r\n                y: '0',\r\n                width: '50',\r\n                height: '50',\r\n                radius: '0',\r\n              },\r\n              label: '',\r\n              line: {\r\n                width: 1,\r\n                color: '#000000',\r\n                alpha: 1,\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: 1,\r\n                interpolateColor: {\r\n                  color2: '#74da0e',\r\n                  prc: '{{hp}} / {{hpMax}}',\r\n                },\r\n              },\r\n              repeating: true,\r\n              repeat: {\r\n                value: '{{hp}}',\r\n                increment: '10',\r\n                isPercentage: true,\r\n                maxValue: '{{hpMax}}',\r\n                perRow: '2',\r\n                maxRows: '',\r\n                paddingX: '3',\r\n                paddingY: '3',\r\n              },\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Health Squares',\r\n        },\r\n        group: 'Health Squares',\r\n        i: 0,\r\n      },\r\n    ],\r\n    id: 'zzeRhmmk',\r\n  },\r\n  {\r\n    name: 'Spell Slot Ring',\r\n    hint: 'Remaining spell slots represented as a ring.',\r\n    img: 'https://user-images.githubusercontent.com/7693704/261663740-444d86b9-ee9f-4a2f-963f-6886a2af29cc.png',\r\n    system: 'dnd5e',\r\n    mappings: [\r\n      {\r\n        id: '1SS3KhwM',\r\n        label: 'Spell Slot Ring',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 50,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '1SS3KhwM',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '{{object.w}} * @Scale',\r\n          height: '{{object.w}} * @Scale',\r\n          scaleX: '1',\r\n          scaleY: '1',\r\n          angle: '0',\r\n          offsetX: '0',\r\n          offsetY: '0',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: true,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '36',\r\n            align: 'left',\r\n            letterSpacing: '0',\r\n            dropShadow: 'true',\r\n            strokeThickness: '1',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '0',\r\n              radius: '0',\r\n              invert: false,\r\n            },\r\n          },\r\n          shapes: [\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer ',\r\n                startAngle: '0',\r\n                endAngle: '360',\r\n              },\r\n              label: 'BaseLayer',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#3b3b3b',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90',\r\n                endAngle: '-90 + ( {{actor.system.spells.spell1.value}} * @Tick )',\r\n              },\r\n              label: '1st level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff0000',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 4 * @Tick )',\r\n                endAngle: '-90 + ( 4 * @Tick ) + ( {{actor.system.spells.spell2.value}} * @Tick )',\r\n              },\r\n              label: '2nd Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff8800',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 7 * @Tick )',\r\n                endAngle: '-90 + ( 7 * @Tick ) + ( {{actor.system.spells.spell3.value}} * @Tick )',\r\n              },\r\n              label: '3rd Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ffdd00',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 10 * @Tick )',\r\n                endAngle: '-90 + ( 10 * @Tick ) + ( {{actor.system.spells.spell4.value}} * @Tick )',\r\n              },\r\n              label: '4th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#37ff00',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 13 * @Tick )',\r\n                endAngle: '-90 + ( 13 * @Tick ) + ( {{actor.system.spells.spell5.value}} * @Tick )',\r\n              },\r\n              label: '5th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#00ffcc',\r\n                alpha: '0.95',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 16 * @Tick )',\r\n                endAngle: '-90 + ( 16 * @Tick ) + ( {{actor.system.spells.spell6.value}} * @Tick )',\r\n              },\r\n              label: '6th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#00b3ff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 18 * @Tick )',\r\n                endAngle: '-90 + ( 18 * @Tick ) + ( {{actor.system.spells.spell7.value}} * @Tick )',\r\n              },\r\n              label: '7th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#001eff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 20 * @Tick )',\r\n                endAngle: '-90 + ( 20 * @Tick ) + ( {{actor.system.spells.spell8.value}} * @Tick )',\r\n              },\r\n              label: '8th Level',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ae00ff',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 21 * @Tick )',\r\n                endAngle: '-90 + ( 21 * @Tick ) + ( {{actor.system.spells.spell9.value}} * @Tick )',\r\n              },\r\n              label: '9th Level - Copy',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '1',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90',\r\n                endAngle: '-90 + ( 1 * @Tick )',\r\n              },\r\n              label: 'Outline 1',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 1 * @Tick )',\r\n                endAngle: '-90 + ( 2 * @Tick )',\r\n              },\r\n              label: 'Outline 2',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 2 * @Tick )',\r\n                endAngle: '-90 + ( 3 * @Tick )',\r\n              },\r\n              label: 'Outline 3',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 3 * @Tick )',\r\n                endAngle: '-90 + ( 4 * @Tick )',\r\n              },\r\n              label: 'Outline 4',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 4 * @Tick )',\r\n                endAngle: '-90 + ( 5 * @Tick )',\r\n              },\r\n              label: 'Outline 5',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 5 * @Tick )',\r\n                endAngle: '-90 + ( 6 * @Tick )',\r\n              },\r\n              label: 'Outline 6',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 6 * @Tick )',\r\n                endAngle: '-90 + ( 7 * @Tick )',\r\n              },\r\n              label: 'Outline 7',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 7 * @Tick )',\r\n                endAngle: '-90 + ( 8 * @Tick )',\r\n              },\r\n              label: 'Outline 8',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 8 * @Tick )',\r\n                endAngle: '-90 + ( 9 * @Tick )',\r\n              },\r\n              label: 'Outline 9',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 9 * @Tick )',\r\n                endAngle: '-90 + ( 10 * @Tick )',\r\n              },\r\n              label: 'Outline 10',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 10 * @Tick )',\r\n                endAngle: '-90 + ( 11 * @Tick )',\r\n              },\r\n              label: 'Outline 11',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 11 * @Tick )',\r\n                endAngle: '-90 + ( 12 * @Tick )',\r\n              },\r\n              label: 'Outline 12',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 12 * @Tick )',\r\n                endAngle: '-90 + ( 13 * @Tick )',\r\n              },\r\n              label: 'Outline 13',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 13 * @Tick )',\r\n                endAngle: '-90 + ( 14 * @Tick )',\r\n              },\r\n              label: 'Outline 14',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 14 * @Tick )',\r\n                endAngle: '-90 + ( 15 * @Tick )',\r\n              },\r\n              label: 'Outline 15',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 15 * @Tick )',\r\n                endAngle: '-90 + ( 16 * @Tick )',\r\n              },\r\n              label: 'Outline 16',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 16 * @Tick )',\r\n                endAngle: '-90 + ( 17 * @Tick )',\r\n              },\r\n              label: 'Outline 17',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 17 * @Tick )',\r\n                endAngle: '-90 + ( 18 * @Tick )',\r\n              },\r\n              label: 'Outline 18',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 18 * @Tick )',\r\n                endAngle: '-90 + ( 19 * @Tick )',\r\n              },\r\n              label: 'Outline 19',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 19 * @Tick )',\r\n                endAngle: '-90 + ( 20 * @Tick )',\r\n              },\r\n              label: 'Outline 20',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 20 * @Tick )',\r\n                endAngle: '-90 + ( 21 * @Tick )',\r\n              },\r\n              label: 'Outline 21',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n            {\r\n              shape: {\r\n                type: 'torus',\r\n                x: '0',\r\n                y: '0',\r\n                innerRadius: '@Inner',\r\n                outerRadius: '@Outer',\r\n                startAngle: '-90 + ( 21 * @Tick )',\r\n                endAngle: '-90 + ( 22 * @Tick )',\r\n              },\r\n              label: 'Outline 22',\r\n              line: {\r\n                width: '1',\r\n                color: '#000000',\r\n                alpha: '1',\r\n              },\r\n              fill: {\r\n                color: '#ff00ea',\r\n                alpha: '0',\r\n                interpolateColor: {\r\n                  color2: '#ffffff',\r\n                  prc: '',\r\n                },\r\n              },\r\n              repeating: false,\r\n            },\r\n          ],\r\n          variables: [\r\n            {\r\n              name: 'Tick',\r\n              value: '16.3636363636363636',\r\n            },\r\n            {\r\n              name: 'Inner',\r\n              value: '66',\r\n            },\r\n            {\r\n              name: 'Outer',\r\n              value: '80',\r\n            },\r\n            {\r\n              name: 'Scale',\r\n              value: '1.8',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Spell Slot Ring',\r\n        },\r\n        group: 'Spell Slot Ring',\r\n        i: 0,\r\n      },\r\n      {\r\n        id: '3IAo8ZUu',\r\n        label: 'Spell Slot Numbers',\r\n        expression: '',\r\n        imgName: '',\r\n        imgSrc: '',\r\n        priority: 60,\r\n        config: {},\r\n        overlay: true,\r\n        alwaysOn: true,\r\n        disabled: false,\r\n        overlayConfig: {\r\n          id: '3IAo8ZUu',\r\n          parentID: '',\r\n          ui: true,\r\n          underlay: false,\r\n          bottom: false,\r\n          top: true,\r\n          inheritTint: false,\r\n          linkRotation: false,\r\n          animation: {\r\n            relative: false,\r\n            rotate: false,\r\n            duration: '5000',\r\n            clockwise: true,\r\n          },\r\n          linkMirror: false,\r\n          linkScale: false,\r\n          linkDimensionsX: false,\r\n          linkDimensionsY: false,\r\n          linkOpacity: false,\r\n          linkStageScale: false,\r\n          loop: true,\r\n          playOnce: false,\r\n          img: '',\r\n          repeating: false,\r\n          alpha: '1',\r\n          tint: '',\r\n          interpolateColor: {\r\n            color2: '',\r\n            prc: '',\r\n          },\r\n          width: '{{object.w}} * @Scale',\r\n          height: '{{object.w}} * @Scale',\r\n          scaleX: '1',\r\n          scaleY: '1',\r\n          angle: '1',\r\n          offsetX: '0',\r\n          offsetY: '0.009',\r\n          anchor: {\r\n            x: 0.5,\r\n            y: 0.5,\r\n          },\r\n          filter: 'NONE',\r\n          alwaysVisible: false,\r\n          limitedToOwner: true,\r\n          limitedUsers: [],\r\n          limitOnHover: true,\r\n          limitOnHighlight: false,\r\n          limitOnControl: false,\r\n          limitOnEffect: '',\r\n          limitOnProperty: '',\r\n          text: {\r\n            text: '4455566778911112223334',\r\n            repeating: false,\r\n            fontFamily: 'Signika',\r\n            fill: '#ffffff',\r\n            interpolateColor: {\r\n              color2: '',\r\n              prc: '',\r\n            },\r\n            fontSize: '45',\r\n            align: 'left',\r\n            letterSpacing: '41.5',\r\n            dropShadow: null,\r\n            strokeThickness: '4',\r\n            stroke: '#111111',\r\n            wordWrap: false,\r\n            wordWrapWidth: '200',\r\n            breakWords: false,\r\n            maxHeight: '0',\r\n            curve: {\r\n              angle: '360',\r\n              radius: '220',\r\n              invert: false,\r\n            },\r\n          },\r\n          variables: [\r\n            {\r\n              name: 'Scale',\r\n              value: '1.85',\r\n            },\r\n          ],\r\n          effect: '',\r\n          label: 'Spell Slot Numbers',\r\n        },\r\n        group: 'Spell Slot Ring',\r\n        i: 1,\r\n      },\r\n    ],\r\n    id: 'FeFzTjjE',\r\n  },\r\n];\r\n","export const DEFAULT_ACTIVE_EFFECT_CONFIG = {\r\n  id: '',\r\n  label: '',\r\n  expression: '',\r\n  codeExp: '',\r\n  imgName: '',\r\n  imgSrc: '',\r\n  priority: 50,\r\n  config: null,\r\n  overlay: false,\r\n  alwaysOn: false,\r\n  tokens: undefined,\r\n  disabled: false,\r\n  overlayConfig: null,\r\n  targetActors: null,\r\n  group: 'Default',\r\n};\r\n\r\nexport const DEFAULT_OVERLAY_CONFIG = {\r\n  img: '',\r\n  imgLinked: false,\r\n  alpha: 1,\r\n  scaleX: 1,\r\n  scaleY: 1,\r\n  offsetX: 0,\r\n  offsetY: 0,\r\n  angle: 0,\r\n  filter: 'NONE',\r\n  filterOptions: {},\r\n  inheritTint: false,\r\n  top: false,\r\n  bottom: false,\r\n  underlay: false,\r\n  linkRotation: true,\r\n  linkMirror: true,\r\n  linkOpacity: false,\r\n  linkScale: true,\r\n  linkDimensionX: false,\r\n  linkDimensionY: false,\r\n  linkStageScale: false,\r\n  mirror: false,\r\n  tint: null,\r\n  loop: true,\r\n  playOnce: false,\r\n  animation: {\r\n    rotate: false,\r\n    duration: 5000,\r\n    clockwise: true,\r\n    relative: false,\r\n  },\r\n  limitedUsers: [],\r\n  limitedToOwner: false,\r\n  limitOnProperty: '',\r\n  alwaysVisible: false,\r\n  text: {\r\n    text: '',\r\n    align: CONFIG.canvasTextStyle.align,\r\n    fontSize: CONFIG.canvasTextStyle.fontSize,\r\n    fontFamily: CONFIG.canvasTextStyle.fontFamily,\r\n    fill: CONFIG.canvasTextStyle.fill,\r\n    dropShadow: CONFIG.canvasTextStyle.dropShadow,\r\n    strokeThickness: CONFIG.canvasTextStyle.strokeThickness,\r\n    stroke: CONFIG.canvasTextStyle.stroke,\r\n    curve: { angle: 0, radius: 0, invert: false },\r\n    letterSpacing: CONFIG.canvasTextStyle.letterSpacing,\r\n    repeating: false,\r\n    wordWrap: false,\r\n    wordWrapWidth: 200,\r\n    breakWords: false,\r\n    maxHeight: 0,\r\n  },\r\n  parentID: '',\r\n  id: null,\r\n  anchor: { x: 0.5, y: 0.5 },\r\n  shapes: [],\r\n  variables: [],\r\n  interactivity: [],\r\n  ui: false,\r\n};\r\n\r\nexport const OVERLAY_SHAPES = {\r\n  Rectangle: {\r\n    type: 'rectangle',\r\n    x: 0,\r\n    y: 0,\r\n    width: 100,\r\n    height: 100,\r\n    radius: 0,\r\n    repeating: false,\r\n  },\r\n  Ellipse: {\r\n    type: 'ellipse',\r\n    x: 0,\r\n    y: 0,\r\n    width: 50,\r\n    height: 50,\r\n    repeating: false,\r\n  },\r\n  Polygon: {\r\n    type: 'polygon',\r\n    x: 0,\r\n    y: 0,\r\n    points: '0,1,0.95,0.31,0.59,-0.81,-0.59,-0.81,-0.95,0.31',\r\n    scale: 50,\r\n    repeating: false,\r\n  },\r\n  Torus: {\r\n    type: 'torus',\r\n    x: 0,\r\n    y: 0,\r\n    innerRadius: 50,\r\n    outerRadius: 100,\r\n    startAngle: 0,\r\n    endAngle: 180,\r\n    repeating: false,\r\n  },\r\n  CutCircle: {\r\n    type: 'cutCircle',\r\n    x: 0,\r\n    y: 0,\r\n    radius: 50,\r\n    cut: 0.5,\r\n    rotation: 0,\r\n    repeating: false,\r\n  },\r\n};\r\n\r\nexport const CORE_SHAPE = {\r\n  line: {\r\n    width: 1,\r\n    color: '#000000',\r\n    alpha: 1,\r\n  },\r\n  fill: { color: '#ffffff', color2: '', prc: '', alpha: 1 },\r\n};\r\n","import EffectMappingForm from '../applications/effectMappingForm.js';\r\nimport { OverlayConfig } from '../applications/overlayConfig.js';\r\nimport { TVAOverlay } from './sprite/TVAOverlay.js';\r\nimport { evaluateOverlayExpressions } from './token/overlay.js';\r\n\r\nexport class Reticle {\r\n  static app;\r\n  static fields;\r\n  static reticleOverlay;\r\n  static active = false;\r\n  static hitTest;\r\n  static token = null;\r\n  static dialog = null;\r\n\r\n  // Offset calculation controls\r\n  static mode = 'tooltip';\r\n  static increment = 1;\r\n\r\n  static _onReticleMove(event) {\r\n    if (this.reticleOverlay.isMouseDown) {\r\n      let pos = event.data.getLocalPosition(this.reticleOverlay);\r\n\r\n      this.config.pOffsetX = 0;\r\n      this.config.pOffsetY = 0;\r\n      this.config.offsetX = 0;\r\n      this.config.offsetY = 0;\r\n\r\n      if (this.mode === 'token') {\r\n        this.config.linkRotation = true;\r\n        this.config.linkMirror = true;\r\n      }\r\n\r\n      this.tvaOverlay.refresh(this.config, { preview: true });\r\n\r\n      const tCoord = { x: this.tvaOverlay.x, y: this.tvaOverlay.y };\r\n\r\n      if (this.tvaOverlay.overlayConfig.parentID) {\r\n        let parent = this.tvaOverlay;\r\n        do {\r\n          parent = parent.parent;\r\n          tCoord.x += parent.x;\r\n          tCoord.y += parent.y;\r\n        } while (!(parent instanceof TVAOverlay));\r\n      }\r\n\r\n      let dx = pos.x - tCoord.x;\r\n      let dy = pos.y - tCoord.y;\r\n\r\n      let angle = 0;\r\n      if (!this.config.animation.relative) {\r\n        angle = this.config.angle;\r\n        if (this.config.linkRotation) angle += this.tvaOverlay.object.document.rotation;\r\n      }\r\n\r\n      [dx, dy] = rotate(0, 0, dx, dy, angle);\r\n      dx = round(dx, this.increment);\r\n      dy = round(dy, this.increment);\r\n\r\n      // let lPos = event.data.getLocalPosition(this.tvaOverlay);\r\n      // console.log(lPos);\r\n      // // let dx = lPos.x;\r\n      // // let dy = lPos.y;\r\n\r\n      if (this.mode === 'static') {\r\n        this.config.pOffsetX = dx;\r\n        this.config.pOffsetY = dy;\r\n      } else if (this.mode === 'token') {\r\n        this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n        this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n      } else {\r\n        let token = this.tvaOverlay.object;\r\n\r\n        let pWidth;\r\n        let pHeight;\r\n\r\n        if (this.tvaOverlay.overlayConfig.parentID) {\r\n          pWidth =\r\n            (this.tvaOverlay.parent.shapesWidth ?? this.tvaOverlay.parent.width) / this.tvaOverlay.parent.scale.x;\r\n          pHeight =\r\n            (this.tvaOverlay.parent.shapesHeight ?? this.tvaOverlay.parent.height) / this.tvaOverlay.parent.scale.y;\r\n        } else {\r\n          pWidth = token.w;\r\n          pHeight = token.h;\r\n        }\r\n\r\n        if (this.mode === 'tooltip') {\r\n          if (Math.abs(dx) >= pWidth / 2) {\r\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\r\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n            dx = 0;\r\n          }\r\n\r\n          if (Math.abs(dy) >= pHeight / 2) {\r\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\r\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n            dy = 0;\r\n          }\r\n        } else {\r\n          if (Math.abs(dx) >= pWidth / 2) {\r\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\r\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\r\n          } else if (Math.abs(dy) >= pHeight / 2) {\r\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\r\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\r\n          } else {\r\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\r\n            dx = 0;\r\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\r\n            dy = 0;\r\n          }\r\n        }\r\n\r\n        this.config.pOffsetX = dx;\r\n        this.config.pOffsetY = dy;\r\n      }\r\n\r\n      this.tvaOverlay.refresh(this.config, { preview: true });\r\n    }\r\n  }\r\n\r\n  static minimizeApps() {\r\n    Object.values(ui.windows).forEach((app) => {\r\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\r\n        app.minimize();\r\n      }\r\n    });\r\n  }\r\n\r\n  static maximizeApps() {\r\n    Object.values(ui.windows).forEach((app) => {\r\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\r\n        app.maximize();\r\n      }\r\n    });\r\n  }\r\n\r\n  static activate({ tvaOverlay = null, config = {} } = {}) {\r\n    if (this.deactivate() || !canvas.ready) return false;\r\n    if (!tvaOverlay || !config) return false;\r\n\r\n    if (this.reticleOverlay) {\r\n      this.reticleOverlay.destroy(true);\r\n    }\r\n\r\n    const interaction = canvas.app.renderer.events;\r\n    if (!interaction.cursorStyles['reticle']) {\r\n      interaction.cursorStyles['reticle'] = \"url('modules/token-variants/img/reticle.webp'), auto\";\r\n    }\r\n\r\n    this.tvaOverlay = tvaOverlay;\r\n\r\n    this.minimizeApps();\r\n    this.config = evaluateOverlayExpressions(foundry.utils.deepClone(config), this.tvaOverlay.object, {\r\n      overlayConfig: config,\r\n    });\r\n\r\n    // Setup the overlay to be always visible while we're adjusting its position\r\n    this.config.alwaysVisible = true;\r\n\r\n    this.active = true;\r\n\r\n    // Create the reticle overlay\r\n    this.reticleOverlay = new PIXI.Container();\r\n    this.reticleOverlay.hitArea = canvas.dimensions.rect;\r\n    this.reticleOverlay.cursor = 'reticle';\r\n    this.reticleOverlay.interactive = true;\r\n    this.reticleOverlay.zIndex = Infinity;\r\n\r\n    const stopEvent = function (event) {\r\n      event.preventDefault();\r\n      // event.stopPropagation();\r\n    };\r\n\r\n    this.reticleOverlay.on('mousedown', (event) => {\r\n      event.preventDefault();\r\n\r\n      if (event.data.originalEvent.which != 2 && event.data.originalEvent.nativeEvent.which != 2) {\r\n        this.reticleOverlay.isMouseDown = true;\r\n        this._onReticleMove(event);\r\n      }\r\n    });\r\n    this.reticleOverlay.on('pointermove', (event) => {\r\n      event.preventDefault();\r\n      // event.stopPropagation();\r\n      this._onReticleMove(event);\r\n    });\r\n    this.reticleOverlay.on('mouseup', (event) => {\r\n      event.preventDefault();\r\n      this.reticleOverlay.isMouseDown = false;\r\n    });\r\n    this.reticleOverlay.on('click', (event) => {\r\n      event.preventDefault();\r\n      if (event.data.originalEvent.which == 2 || event.data.originalEvent.nativeEvent.which == 2) {\r\n        this.deactivate();\r\n      }\r\n    });\r\n\r\n    canvas.stage.addChild(this.reticleOverlay);\r\n    this.dialog = displayControlDialog();\r\n    return true;\r\n  }\r\n\r\n  static deactivate() {\r\n    if (this.active) {\r\n      if (this.reticleOverlay) this.reticleOverlay.parent?.removeChild(this.reticleOverlay);\r\n      this.active = false;\r\n      this.tvaOverlay = null;\r\n      if (this.dialog && this.dialog._state !== Application.RENDER_STATES.CLOSED) this.dialog.close(true);\r\n      this.dialog = null;\r\n      this.maximizeApps();\r\n\r\n      const app = Object.values(ui.windows).find((app) => app instanceof OverlayConfig);\r\n      if (!app) {\r\n        this.config = null;\r\n        return;\r\n      }\r\n      const form = $(app.form);\r\n\r\n      ['pOffsetX', 'pOffsetY', 'offsetX', 'offsetY'].forEach((field) => {\r\n        if (field in this.config) {\r\n          form.find(`[name=\"${field}\"]`).val(this.config[field]);\r\n        }\r\n      });\r\n\r\n      if (this.mode === 'token') {\r\n        ['linkRotation', 'linkMirror'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', true);\r\n        });\r\n        ['linkDimensionsX', 'linkDimensionsY'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', false);\r\n        });\r\n      } else {\r\n        ['linkRotation', 'linkMirror'].forEach((field) => {\r\n          form.find(`[name=\"${field}\"]`).prop('checked', false);\r\n        });\r\n      }\r\n\r\n      if (this.mode === 'hud') {\r\n        form.find('[name=\"ui\"]').prop('checked', true).trigger('change');\r\n      }\r\n\r\n      form.find('[name=\"anchor.x\"]').val(this.config.anchor.x);\r\n      form.find('[name=\"anchor.y\"]').val(this.config.anchor.y).trigger('change');\r\n      this.config = null;\r\n\r\n      return true;\r\n    }\r\n  }\r\n}\r\n\r\nfunction displayControlDialog() {\r\n  const d = new Dialog({\r\n    title: 'Set Overlay Position',\r\n    content: `\r\n      <style>\r\n        .images { display: flex; }\r\n        .images a { flex: 20%; width: 50px; margin: 2px; }\r\n        .images a.active img { border-color: orange; border-width: 2px; }\r\n        .anchorlbl {margin: auto; display: table; }\r\n      </style>\r\n      <div class=\"images\">\r\n        <a data-id=\"token\"><img src=\"modules/token-variants/img/token_mode.png\"></img></a>\r\n        <a data-id=\"tooltip\"><img src=\"modules/token-variants/img/tooltip_mode.png\"></img></a>\r\n        <a data-id=\"hud\"><img src=\"modules/token-variants/img/hud_mode.png\"></img></a>\r\n        <a data-id=\"static\"><img src=\"modules/token-variants/img/static_mode.png\"></img></a>\r\n      </div>\r\n     <br>\r\n      <label class=\"anchorlbl\">Anchor</label>\r\n      <div class=\"tva-anchor\">\r\n        <input type=\"radio\" class=\"top left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"top center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"top right\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"mid right\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot left\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot center\" name=\"anchor\">\r\n        <input type=\"radio\" class=\"bot right\" name=\"anchor\">\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <label>Step Size</label>\r\n        <div class=\"form-fields\">\r\n          <input type=\"number\" name=\"step\" min=\"0\" step=\"1\" value=\"${Reticle.increment}\">\r\n        </div>\r\n      </div>\r\n      <p class=\"notes\"><b>Left-Click</b> to move the overlay</p>\r\n      <p class=\"notes\"><b>Middle-Click</b> or <b>Close Dialog</b> to exit overlay positioning</p>\r\n     `,\r\n    buttons: {},\r\n    render: (html) => {\r\n      // Mode Images\r\n      const images = html.find('.images a');\r\n      html.find('.images a').on('click', (event) => {\r\n        images.removeClass('active');\r\n        const target = $(event.target).closest('a');\r\n        target.addClass('active');\r\n        Reticle.mode = target.data('id');\r\n      });\r\n      html.find(`[data-id=\"${Reticle.mode}\"]`).addClass('active');\r\n\r\n      // Anchor\r\n      let anchorX = Reticle.config?.anchor?.x || 0;\r\n      let anchorY = Reticle.config?.anchor?.y || 0;\r\n\r\n      let classes = '';\r\n      if (anchorX < 0.5) classes += '.left';\r\n      else if (anchorX > 0.5) classes += '.right';\r\n      else classes += '.center';\r\n\r\n      if (anchorY < 0.5) classes += '.top';\r\n      else if (anchorY > 0.5) classes += '.bot';\r\n      else classes += '.mid';\r\n\r\n      html.find('.tva-anchor').find(classes).prop('checked', true);\r\n      // end -  Pre-select anchor\r\n\r\n      html.find('input[name=\"anchor\"]').on('change', (event) => {\r\n        const anchor = $(event.target);\r\n        let x;\r\n        let y;\r\n        if (anchor.hasClass('left')) x = 0;\r\n        else if (anchor.hasClass('center')) x = 0.5;\r\n        else x = 1;\r\n\r\n        if (anchor.hasClass('top')) y = 0;\r\n        else if (anchor.hasClass('mid')) y = 0.5;\r\n        else y = 1;\r\n\r\n        Reticle.config.anchor.x = x;\r\n        Reticle.config.anchor.y = y;\r\n      });\r\n\r\n      html.find('[name=\"step\"]').on('input', (event) => {\r\n        Reticle.increment = $(event.target).val() || 1;\r\n      });\r\n    },\r\n    close: () => Reticle.deactivate(),\r\n  });\r\n  d.render(true);\r\n  setTimeout(() => d.setPosition({ left: 200, top: window.innerHeight / 2, height: 'auto' }), 100);\r\n  return d;\r\n}\r\n\r\nfunction round(number, increment, offset = 0) {\r\n  return Math.ceil((number - offset) / increment) * increment + offset;\r\n}\r\n\r\nfunction rotate(cx, cy, x, y, angle) {\r\n  var radians = (Math.PI / 180) * angle,\r\n    cos = Math.cos(radians),\r\n    sin = Math.sin(radians),\r\n    nx = cos * (x - cx) + sin * (y - cy) + cx,\r\n    ny = cos * (y - cy) - sin * (x - cx) + cy;\r\n  return [nx, ny];\r\n}\r\n","/**\r\n * Fuse.js v6.5.3 - Lightweight fuzzy-search (http://fusejs.io)\r\n *\r\n * Copyright (c) 2021 Kiro Risk (http://kiro.me)\r\n * All Rights Reserved. Apache Software License 2.0\r\n *\r\n * http://www.apache.org/licenses/LICENSE-2.0\r\n */\r\n\r\nfunction ownKeys(object, enumerableOnly) {\r\n  var keys = Object.keys(object);\r\n\r\n  if (Object.getOwnPropertySymbols) {\r\n    var symbols = Object.getOwnPropertySymbols(object);\r\n    enumerableOnly &&\r\n      (symbols = symbols.filter(function (sym) {\r\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\r\n      })),\r\n      keys.push.apply(keys, symbols);\r\n  }\r\n\r\n  return keys;\r\n}\r\n\r\nfunction _objectSpread2(target) {\r\n  for (var i = 1; i < arguments.length; i++) {\r\n    var source = null != arguments[i] ? arguments[i] : {};\r\n    i % 2\r\n      ? ownKeys(Object(source), !0).forEach(function (key) {\r\n          _defineProperty(target, key, source[key]);\r\n        })\r\n      : Object.getOwnPropertyDescriptors\r\n      ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source))\r\n      : ownKeys(Object(source)).forEach(function (key) {\r\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\r\n        });\r\n  }\r\n\r\n  return target;\r\n}\r\n\r\nfunction _typeof(obj) {\r\n  '@babel/helpers - typeof';\r\n\r\n  return (\r\n    (_typeof =\r\n      'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator\r\n        ? function (obj) {\r\n            return typeof obj;\r\n          }\r\n        : function (obj) {\r\n            return obj &&\r\n              'function' == typeof Symbol &&\r\n              obj.constructor === Symbol &&\r\n              obj !== Symbol.prototype\r\n              ? 'symbol'\r\n              : typeof obj;\r\n          }),\r\n    _typeof(obj)\r\n  );\r\n}\r\n\r\nfunction _classCallCheck(instance, Constructor) {\r\n  if (!(instance instanceof Constructor)) {\r\n    throw new TypeError('Cannot call a class as a function');\r\n  }\r\n}\r\n\r\nfunction _defineProperties(target, props) {\r\n  for (var i = 0; i < props.length; i++) {\r\n    var descriptor = props[i];\r\n    descriptor.enumerable = descriptor.enumerable || false;\r\n    descriptor.configurable = true;\r\n    if ('value' in descriptor) descriptor.writable = true;\r\n    Object.defineProperty(target, descriptor.key, descriptor);\r\n  }\r\n}\r\n\r\nfunction _createClass(Constructor, protoProps, staticProps) {\r\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\r\n  if (staticProps) _defineProperties(Constructor, staticProps);\r\n  Object.defineProperty(Constructor, 'prototype', {\r\n    writable: false,\r\n  });\r\n  return Constructor;\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n  if (key in obj) {\r\n    Object.defineProperty(obj, key, {\r\n      value: value,\r\n      enumerable: true,\r\n      configurable: true,\r\n      writable: true,\r\n    });\r\n  } else {\r\n    obj[key] = value;\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nfunction _inherits(subClass, superClass) {\r\n  if (typeof superClass !== 'function' && superClass !== null) {\r\n    throw new TypeError('Super expression must either be null or a function');\r\n  }\r\n\r\n  Object.defineProperty(subClass, 'prototype', {\r\n    value: Object.create(superClass && superClass.prototype, {\r\n      constructor: {\r\n        value: subClass,\r\n        writable: true,\r\n        configurable: true,\r\n      },\r\n    }),\r\n    writable: false,\r\n  });\r\n  if (superClass) _setPrototypeOf(subClass, superClass);\r\n}\r\n\r\nfunction _getPrototypeOf(o) {\r\n  _getPrototypeOf = Object.setPrototypeOf\r\n    ? Object.getPrototypeOf\r\n    : function _getPrototypeOf(o) {\r\n        return o.__proto__ || Object.getPrototypeOf(o);\r\n      };\r\n  return _getPrototypeOf(o);\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n  _setPrototypeOf =\r\n    Object.setPrototypeOf ||\r\n    function _setPrototypeOf(o, p) {\r\n      o.__proto__ = p;\r\n      return o;\r\n    };\r\n\r\n  return _setPrototypeOf(o, p);\r\n}\r\n\r\nfunction _isNativeReflectConstruct() {\r\n  if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\r\n  if (Reflect.construct.sham) return false;\r\n  if (typeof Proxy === 'function') return true;\r\n\r\n  try {\r\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\r\n    return true;\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction _assertThisInitialized(self) {\r\n  if (self === void 0) {\r\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\r\n  }\r\n\r\n  return self;\r\n}\r\n\r\nfunction _possibleConstructorReturn(self, call) {\r\n  if (call && (typeof call === 'object' || typeof call === 'function')) {\r\n    return call;\r\n  } else if (call !== void 0) {\r\n    throw new TypeError('Derived constructors may only return object or undefined');\r\n  }\r\n\r\n  return _assertThisInitialized(self);\r\n}\r\n\r\nfunction _createSuper(Derived) {\r\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\r\n\r\n  return function _createSuperInternal() {\r\n    var Super = _getPrototypeOf(Derived),\r\n      result;\r\n\r\n    if (hasNativeReflectConstruct) {\r\n      var NewTarget = _getPrototypeOf(this).constructor;\r\n\r\n      result = Reflect.construct(Super, arguments, NewTarget);\r\n    } else {\r\n      result = Super.apply(this, arguments);\r\n    }\r\n\r\n    return _possibleConstructorReturn(this, result);\r\n  };\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n  return (\r\n    _arrayWithoutHoles(arr) ||\r\n    _iterableToArray(arr) ||\r\n    _unsupportedIterableToArray(arr) ||\r\n    _nonIterableSpread()\r\n  );\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n  if (\r\n    (typeof Symbol !== 'undefined' && iter[Symbol.iterator] != null) ||\r\n    iter['@@iterator'] != null\r\n  )\r\n    return Array.from(iter);\r\n}\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) {\r\n  if (!o) return;\r\n  if (typeof o === 'string') return _arrayLikeToArray(o, minLen);\r\n  var n = Object.prototype.toString.call(o).slice(8, -1);\r\n  if (n === 'Object' && o.constructor) n = o.constructor.name;\r\n  if (n === 'Map' || n === 'Set') return Array.from(o);\r\n  if (n === 'Arguments' || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))\r\n    return _arrayLikeToArray(o, minLen);\r\n}\r\n\r\nfunction _arrayLikeToArray(arr, len) {\r\n  if (len == null || len > arr.length) len = arr.length;\r\n\r\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\r\n\r\n  return arr2;\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n  throw new TypeError(\r\n    'Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'\r\n  );\r\n}\r\n\r\nfunction isArray(value) {\r\n  return !Array.isArray ? getTag(value) === '[object Array]' : Array.isArray(value);\r\n} // Adapted from: https://github.com/lodash/lodash/blob/master/.internal/baseToString.js\r\n\r\nvar INFINITY = 1 / 0;\r\nfunction baseToString(value) {\r\n  // Exit early for strings to avoid a performance hit in some environments.\r\n  if (typeof value == 'string') {\r\n    return value;\r\n  }\r\n\r\n  var result = value + '';\r\n  return result == '0' && 1 / value == -INFINITY ? '-0' : result;\r\n}\r\nfunction toString(value) {\r\n  return value == null ? '' : baseToString(value);\r\n}\r\nfunction isString(value) {\r\n  return typeof value === 'string';\r\n}\r\nfunction isNumber(value) {\r\n  return typeof value === 'number';\r\n} // Adapted from: https://github.com/lodash/lodash/blob/master/isBoolean.js\r\n\r\nfunction isBoolean(value) {\r\n  return (\r\n    value === true ||\r\n    value === false ||\r\n    (isObjectLike(value) && getTag(value) == '[object Boolean]')\r\n  );\r\n}\r\nfunction isObject(value) {\r\n  return _typeof(value) === 'object';\r\n} // Checks if `value` is object-like.\r\n\r\nfunction isObjectLike(value) {\r\n  return isObject(value) && value !== null;\r\n}\r\nfunction isDefined(value) {\r\n  return value !== undefined && value !== null;\r\n}\r\nfunction isBlank(value) {\r\n  return !value.trim().length;\r\n} // Gets the `toStringTag` of `value`.\r\n// Adapted from: https://github.com/lodash/lodash/blob/master/.internal/getTag.js\r\n\r\nfunction getTag(value) {\r\n  return value == null\r\n    ? value === undefined\r\n      ? '[object Undefined]'\r\n      : '[object Null]'\r\n    : Object.prototype.toString.call(value);\r\n}\r\n\r\nvar EXTENDED_SEARCH_UNAVAILABLE = 'Extended search is not available';\r\nvar INCORRECT_INDEX_TYPE = \"Incorrect 'index' type\";\r\nvar LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY = function LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key) {\r\n  return 'Invalid value for key '.concat(key);\r\n};\r\nvar PATTERN_LENGTH_TOO_LARGE = function PATTERN_LENGTH_TOO_LARGE(max) {\r\n  return 'Pattern length exceeds max of '.concat(max, '.');\r\n};\r\nvar MISSING_KEY_PROPERTY = function MISSING_KEY_PROPERTY(name) {\r\n  return 'Missing '.concat(name, ' property in key');\r\n};\r\nvar INVALID_KEY_WEIGHT_VALUE = function INVALID_KEY_WEIGHT_VALUE(key) {\r\n  return \"Property 'weight' in key '\".concat(key, \"' must be a positive integer\");\r\n};\r\n\r\nvar hasOwn = Object.prototype.hasOwnProperty;\r\n\r\nvar KeyStore = /*#__PURE__*/ (function () {\r\n  function KeyStore(keys) {\r\n    var _this = this;\r\n\r\n    _classCallCheck(this, KeyStore);\r\n\r\n    this._keys = [];\r\n    this._keyMap = {};\r\n    var totalWeight = 0;\r\n    keys.forEach(function (key) {\r\n      var obj = createKey(key);\r\n      totalWeight += obj.weight;\r\n\r\n      _this._keys.push(obj);\r\n\r\n      _this._keyMap[obj.id] = obj;\r\n      totalWeight += obj.weight;\r\n    }); // Normalize weights so that their sum is equal to 1\r\n\r\n    this._keys.forEach(function (key) {\r\n      key.weight /= totalWeight;\r\n    });\r\n  }\r\n\r\n  _createClass(KeyStore, [\r\n    {\r\n      key: 'get',\r\n      value: function get(keyId) {\r\n        return this._keyMap[keyId];\r\n      },\r\n    },\r\n    {\r\n      key: 'keys',\r\n      value: function keys() {\r\n        return this._keys;\r\n      },\r\n    },\r\n    {\r\n      key: 'toJSON',\r\n      value: function toJSON() {\r\n        return JSON.stringify(this._keys);\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return KeyStore;\r\n})();\r\nfunction createKey(key) {\r\n  var path = null;\r\n  var id = null;\r\n  var src = null;\r\n  var weight = 1;\r\n\r\n  if (isString(key) || isArray(key)) {\r\n    src = key;\r\n    path = createKeyPath(key);\r\n    id = createKeyId(key);\r\n  } else {\r\n    if (!hasOwn.call(key, 'name')) {\r\n      throw new Error(MISSING_KEY_PROPERTY('name'));\r\n    }\r\n\r\n    var name = key.name;\r\n    src = name;\r\n\r\n    if (hasOwn.call(key, 'weight')) {\r\n      weight = key.weight;\r\n\r\n      if (weight <= 0) {\r\n        throw new Error(INVALID_KEY_WEIGHT_VALUE(name));\r\n      }\r\n    }\r\n\r\n    path = createKeyPath(name);\r\n    id = createKeyId(name);\r\n  }\r\n\r\n  return {\r\n    path: path,\r\n    id: id,\r\n    weight: weight,\r\n    src: src,\r\n  };\r\n}\r\nfunction createKeyPath(key) {\r\n  return isArray(key) ? key : key.split('.');\r\n}\r\nfunction createKeyId(key) {\r\n  return isArray(key) ? key.join('.') : key;\r\n}\r\n\r\nfunction get(obj, path) {\r\n  var list = [];\r\n  var arr = false;\r\n\r\n  var deepGet = function deepGet(obj, path, index) {\r\n    if (!isDefined(obj)) {\r\n      return;\r\n    }\r\n\r\n    if (!path[index]) {\r\n      // If there's no path left, we've arrived at the object we care about.\r\n      list.push(obj);\r\n    } else {\r\n      var key = path[index];\r\n      var value = obj[key];\r\n\r\n      if (!isDefined(value)) {\r\n        return;\r\n      } // If we're at the last value in the path, and if it's a string/number/bool,\r\n      // add it to the list\r\n\r\n      if (index === path.length - 1 && (isString(value) || isNumber(value) || isBoolean(value))) {\r\n        list.push(toString(value));\r\n      } else if (isArray(value)) {\r\n        arr = true; // Search each item in the array.\r\n\r\n        for (var i = 0, len = value.length; i < len; i += 1) {\r\n          deepGet(value[i], path, index + 1);\r\n        }\r\n      } else if (path.length) {\r\n        // An object. Recurse further.\r\n        deepGet(value, path, index + 1);\r\n      }\r\n    }\r\n  }; // Backwards compatibility (since path used to be a string)\r\n\r\n  deepGet(obj, isString(path) ? path.split('.') : path, 0);\r\n  return arr ? list : list[0];\r\n}\r\n\r\nvar MatchOptions = {\r\n  // Whether the matches should be included in the result set. When `true`, each record in the result\r\n  // set will include the indices of the matched characters.\r\n  // These can consequently be used for highlighting purposes.\r\n  includeMatches: false,\r\n  // When `true`, the matching function will continue to the end of a search pattern even if\r\n  // a perfect match has already been located in the string.\r\n  findAllMatches: false,\r\n  // Minimum number of characters that must be matched before a result is considered a match\r\n  minMatchCharLength: 1,\r\n};\r\nvar BasicOptions = {\r\n  // When `true`, the algorithm continues searching to the end of the input even if a perfect\r\n  // match is found before the end of the same input.\r\n  isCaseSensitive: false,\r\n  // When true, the matching function will continue to the end of a search pattern even if\r\n  includeScore: false,\r\n  // List of properties that will be searched. This also supports nested properties.\r\n  keys: [],\r\n  // Whether to sort the result list, by score\r\n  shouldSort: true,\r\n  // Default sort function: sort by ascending score, ascending index\r\n  sortFn: function sortFn(a, b) {\r\n    return a.score === b.score ? (a.idx < b.idx ? -1 : 1) : a.score < b.score ? -1 : 1;\r\n  },\r\n};\r\nvar FuzzyOptions = {\r\n  // Approximately where in the text is the pattern expected to be found?\r\n  location: 0,\r\n  // At what point does the match algorithm give up. A threshold of '0.0' requires a perfect match\r\n  // (of both letters and location), a threshold of '1.0' would match anything.\r\n  threshold: 0.6,\r\n  // Determines how close the match must be to the fuzzy location (specified above).\r\n  // An exact letter match which is 'distance' characters away from the fuzzy location\r\n  // would score as a complete mismatch. A distance of '0' requires the match be at\r\n  // the exact location specified, a threshold of '1000' would require a perfect match\r\n  // to be within 800 characters of the fuzzy location to be found using a 0.8 threshold.\r\n  distance: 100,\r\n};\r\nvar AdvancedOptions = {\r\n  // When `true`, it enables the use of unix-like search commands\r\n  useExtendedSearch: false,\r\n  // The get function to use when fetching an object's properties.\r\n  // The default will search nested paths *ie foo.bar.baz*\r\n  getFn: get,\r\n  // When `true`, search will ignore `location` and `distance`, so it won't matter\r\n  // where in the string the pattern appears.\r\n  // More info: https://fusejs.io/concepts/scoring-theory.html#fuzziness-score\r\n  ignoreLocation: false,\r\n  // When `true`, the calculation for the relevance score (used for sorting) will\r\n  // ignore the field-length norm.\r\n  // More info: https://fusejs.io/concepts/scoring-theory.html#field-length-norm\r\n  ignoreFieldNorm: false,\r\n  // The weight to determine how much field length norm effects scoring.\r\n  fieldNormWeight: 1,\r\n};\r\nvar Config = _objectSpread2(\r\n  _objectSpread2(_objectSpread2(_objectSpread2({}, BasicOptions), MatchOptions), FuzzyOptions),\r\n  AdvancedOptions\r\n);\r\n\r\nvar SPACE = /[^ ]+/g; // Field-length norm: the shorter the field, the higher the weight.\r\n// Set to 3 decimals to reduce index size.\r\n\r\nfunction norm() {\r\n  var weight = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\r\n  var mantissa = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\r\n  var cache = new Map();\r\n  var m = Math.pow(10, mantissa);\r\n  return {\r\n    get: function get(value) {\r\n      var numTokens = value.match(SPACE).length;\r\n\r\n      if (cache.has(numTokens)) {\r\n        return cache.get(numTokens);\r\n      } // Default function is 1/sqrt(x), weight makes that variable\r\n\r\n      var norm = 1 / Math.pow(numTokens, 0.5 * weight); // In place of `toFixed(mantissa)`, for faster computation\r\n\r\n      var n = parseFloat(Math.round(norm * m) / m);\r\n      cache.set(numTokens, n);\r\n      return n;\r\n    },\r\n    clear: function clear() {\r\n      cache.clear();\r\n    },\r\n  };\r\n}\r\n\r\nvar FuseIndex = /*#__PURE__*/ (function () {\r\n  function FuseIndex() {\r\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\r\n      _ref$getFn = _ref.getFn,\r\n      getFn = _ref$getFn === void 0 ? Config.getFn : _ref$getFn,\r\n      _ref$fieldNormWeight = _ref.fieldNormWeight,\r\n      fieldNormWeight =\r\n        _ref$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref$fieldNormWeight;\r\n\r\n    _classCallCheck(this, FuseIndex);\r\n\r\n    this.norm = norm(fieldNormWeight, 3);\r\n    this.getFn = getFn;\r\n    this.isCreated = false;\r\n    this.setIndexRecords();\r\n  }\r\n\r\n  _createClass(FuseIndex, [\r\n    {\r\n      key: 'setSources',\r\n      value: function setSources() {\r\n        var docs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.docs = docs;\r\n      },\r\n    },\r\n    {\r\n      key: 'setIndexRecords',\r\n      value: function setIndexRecords() {\r\n        var records = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.records = records;\r\n      },\r\n    },\r\n    {\r\n      key: 'setKeys',\r\n      value: function setKeys() {\r\n        var _this = this;\r\n\r\n        var keys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n        this.keys = keys;\r\n        this._keysMap = {};\r\n        keys.forEach(function (key, idx) {\r\n          _this._keysMap[key.id] = idx;\r\n        });\r\n      },\r\n    },\r\n    {\r\n      key: 'create',\r\n      value: function create() {\r\n        var _this2 = this;\r\n\r\n        if (this.isCreated || !this.docs.length) {\r\n          return;\r\n        }\r\n\r\n        this.isCreated = true; // List is Array<String>\r\n\r\n        if (isString(this.docs[0])) {\r\n          this.docs.forEach(function (doc, docIndex) {\r\n            _this2._addString(doc, docIndex);\r\n          });\r\n        } else {\r\n          // List is Array<Object>\r\n          this.docs.forEach(function (doc, docIndex) {\r\n            _this2._addObject(doc, docIndex);\r\n          });\r\n        }\r\n\r\n        this.norm.clear();\r\n      }, // Adds a doc to the end of the index\r\n    },\r\n    {\r\n      key: 'add',\r\n      value: function add(doc) {\r\n        var idx = this.size();\r\n\r\n        if (isString(doc)) {\r\n          this._addString(doc, idx);\r\n        } else {\r\n          this._addObject(doc, idx);\r\n        }\r\n      }, // Removes the doc at the specified index of the index\r\n    },\r\n    {\r\n      key: 'removeAt',\r\n      value: function removeAt(idx) {\r\n        this.records.splice(idx, 1); // Change ref index of every subsquent doc\r\n\r\n        for (var i = idx, len = this.size(); i < len; i += 1) {\r\n          this.records[i].i -= 1;\r\n        }\r\n      },\r\n    },\r\n    {\r\n      key: 'getValueForItemAtKeyId',\r\n      value: function getValueForItemAtKeyId(item, keyId) {\r\n        return item[this._keysMap[keyId]];\r\n      },\r\n    },\r\n    {\r\n      key: 'size',\r\n      value: function size() {\r\n        return this.records.length;\r\n      },\r\n    },\r\n    {\r\n      key: '_addString',\r\n      value: function _addString(doc, docIndex) {\r\n        if (!isDefined(doc) || isBlank(doc)) {\r\n          return;\r\n        }\r\n\r\n        var record = {\r\n          v: doc,\r\n          i: docIndex,\r\n          n: this.norm.get(doc),\r\n        };\r\n        this.records.push(record);\r\n      },\r\n    },\r\n    {\r\n      key: '_addObject',\r\n      value: function _addObject(doc, docIndex) {\r\n        var _this3 = this;\r\n\r\n        var record = {\r\n          i: docIndex,\r\n          $: {},\r\n        }; // Iterate over every key (i.e, path), and fetch the value at that key\r\n\r\n        this.keys.forEach(function (key, keyIndex) {\r\n          var value = _this3.getFn(doc, key.path);\r\n\r\n          if (!isDefined(value)) {\r\n            return;\r\n          }\r\n\r\n          if (isArray(value)) {\r\n            (function () {\r\n              var subRecords = [];\r\n              var stack = [\r\n                {\r\n                  nestedArrIndex: -1,\r\n                  value: value,\r\n                },\r\n              ];\r\n\r\n              while (stack.length) {\r\n                var _stack$pop = stack.pop(),\r\n                  nestedArrIndex = _stack$pop.nestedArrIndex,\r\n                  _value = _stack$pop.value;\r\n\r\n                if (!isDefined(_value)) {\r\n                  continue;\r\n                }\r\n\r\n                if (isString(_value) && !isBlank(_value)) {\r\n                  var subRecord = {\r\n                    v: _value,\r\n                    i: nestedArrIndex,\r\n                    n: _this3.norm.get(_value),\r\n                  };\r\n                  subRecords.push(subRecord);\r\n                } else if (isArray(_value)) {\r\n                  _value.forEach(function (item, k) {\r\n                    stack.push({\r\n                      nestedArrIndex: k,\r\n                      value: item,\r\n                    });\r\n                  });\r\n                } else;\r\n              }\r\n\r\n              record.$[keyIndex] = subRecords;\r\n            })();\r\n          } else if (!isBlank(value)) {\r\n            var subRecord = {\r\n              v: value,\r\n              n: _this3.norm.get(value),\r\n            };\r\n            record.$[keyIndex] = subRecord;\r\n          }\r\n        });\r\n        this.records.push(record);\r\n      },\r\n    },\r\n    {\r\n      key: 'toJSON',\r\n      value: function toJSON() {\r\n        return {\r\n          keys: this.keys,\r\n          records: this.records,\r\n        };\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return FuseIndex;\r\n})();\r\nfunction createIndex(keys, docs) {\r\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref2$getFn = _ref2.getFn,\r\n    getFn = _ref2$getFn === void 0 ? Config.getFn : _ref2$getFn,\r\n    _ref2$fieldNormWeight = _ref2.fieldNormWeight,\r\n    fieldNormWeight =\r\n      _ref2$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref2$fieldNormWeight;\r\n\r\n  var myIndex = new FuseIndex({\r\n    getFn: getFn,\r\n    fieldNormWeight: fieldNormWeight,\r\n  });\r\n  myIndex.setKeys(keys.map(createKey));\r\n  myIndex.setSources(docs);\r\n  myIndex.create();\r\n  return myIndex;\r\n}\r\nfunction parseIndex(data) {\r\n  var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n    _ref3$getFn = _ref3.getFn,\r\n    getFn = _ref3$getFn === void 0 ? Config.getFn : _ref3$getFn,\r\n    _ref3$fieldNormWeight = _ref3.fieldNormWeight,\r\n    fieldNormWeight =\r\n      _ref3$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref3$fieldNormWeight;\r\n\r\n  var keys = data.keys,\r\n    records = data.records;\r\n  var myIndex = new FuseIndex({\r\n    getFn: getFn,\r\n    fieldNormWeight: fieldNormWeight,\r\n  });\r\n  myIndex.setKeys(keys);\r\n  myIndex.setIndexRecords(records);\r\n  return myIndex;\r\n}\r\n\r\nfunction computeScore$1(pattern) {\r\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n    _ref$errors = _ref.errors,\r\n    errors = _ref$errors === void 0 ? 0 : _ref$errors,\r\n    _ref$currentLocation = _ref.currentLocation,\r\n    currentLocation = _ref$currentLocation === void 0 ? 0 : _ref$currentLocation,\r\n    _ref$expectedLocation = _ref.expectedLocation,\r\n    expectedLocation = _ref$expectedLocation === void 0 ? 0 : _ref$expectedLocation,\r\n    _ref$distance = _ref.distance,\r\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n    _ref$ignoreLocation = _ref.ignoreLocation,\r\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n  var accuracy = errors / pattern.length;\r\n\r\n  if (ignoreLocation) {\r\n    return accuracy;\r\n  }\r\n\r\n  var proximity = Math.abs(expectedLocation - currentLocation);\r\n\r\n  if (!distance) {\r\n    // Dodge divide by zero error.\r\n    return proximity ? 1.0 : accuracy;\r\n  }\r\n\r\n  return accuracy + proximity / distance;\r\n}\r\n\r\nfunction convertMaskToIndices() {\r\n  var matchmask = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\r\n  var minMatchCharLength =\r\n    arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Config.minMatchCharLength;\r\n  var indices = [];\r\n  var start = -1;\r\n  var end = -1;\r\n  var i = 0;\r\n\r\n  for (var len = matchmask.length; i < len; i += 1) {\r\n    var match = matchmask[i];\r\n\r\n    if (match && start === -1) {\r\n      start = i;\r\n    } else if (!match && start !== -1) {\r\n      end = i - 1;\r\n\r\n      if (end - start + 1 >= minMatchCharLength) {\r\n        indices.push([start, end]);\r\n      }\r\n\r\n      start = -1;\r\n    }\r\n  } // (i-1 - start) + 1 => i - start\r\n\r\n  if (matchmask[i - 1] && i - start >= minMatchCharLength) {\r\n    indices.push([start, i - 1]);\r\n  }\r\n\r\n  return indices;\r\n}\r\n\r\n// Machine word size\r\nvar MAX_BITS = 32;\r\n\r\nfunction search(text, pattern, patternAlphabet) {\r\n  var _ref = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},\r\n    _ref$location = _ref.location,\r\n    location = _ref$location === void 0 ? Config.location : _ref$location,\r\n    _ref$distance = _ref.distance,\r\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n    _ref$threshold = _ref.threshold,\r\n    threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n    _ref$findAllMatches = _ref.findAllMatches,\r\n    findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n    _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n    minMatchCharLength =\r\n      _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n    _ref$includeMatches = _ref.includeMatches,\r\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n    _ref$ignoreLocation = _ref.ignoreLocation,\r\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n  if (pattern.length > MAX_BITS) {\r\n    throw new Error(PATTERN_LENGTH_TOO_LARGE(MAX_BITS));\r\n  }\r\n\r\n  var patternLen = pattern.length; // Set starting location at beginning text and initialize the alphabet.\r\n\r\n  var textLen = text.length; // Handle the case when location > text.length\r\n\r\n  var expectedLocation = Math.max(0, Math.min(location, textLen)); // Highest score beyond which we give up.\r\n\r\n  var currentThreshold = threshold; // Is there a nearby exact match? (speedup)\r\n\r\n  var bestLocation = expectedLocation; // Performance: only computer matches when the minMatchCharLength > 1\r\n  // OR if `includeMatches` is true.\r\n\r\n  var computeMatches = minMatchCharLength > 1 || includeMatches; // A mask of the matches, used for building the indices\r\n\r\n  var matchMask = computeMatches ? Array(textLen) : [];\r\n  var index; // Get all exact matches, here for speed up\r\n\r\n  while ((index = text.indexOf(pattern, bestLocation)) > -1) {\r\n    var score = computeScore$1(pattern, {\r\n      currentLocation: index,\r\n      expectedLocation: expectedLocation,\r\n      distance: distance,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n    currentThreshold = Math.min(score, currentThreshold);\r\n    bestLocation = index + patternLen;\r\n\r\n    if (computeMatches) {\r\n      var i = 0;\r\n\r\n      while (i < patternLen) {\r\n        matchMask[index + i] = 1;\r\n        i += 1;\r\n      }\r\n    }\r\n  } // Reset the best location\r\n\r\n  bestLocation = -1;\r\n  var lastBitArr = [];\r\n  var finalScore = 1;\r\n  var binMax = patternLen + textLen;\r\n  var mask = 1 << (patternLen - 1);\r\n\r\n  for (var _i = 0; _i < patternLen; _i += 1) {\r\n    // Scan for the best match; each iteration allows for one more error.\r\n    // Run a binary search to determine how far from the match location we can stray\r\n    // at this error level.\r\n    var binMin = 0;\r\n    var binMid = binMax;\r\n\r\n    while (binMin < binMid) {\r\n      var _score2 = computeScore$1(pattern, {\r\n        errors: _i,\r\n        currentLocation: expectedLocation + binMid,\r\n        expectedLocation: expectedLocation,\r\n        distance: distance,\r\n        ignoreLocation: ignoreLocation,\r\n      });\r\n\r\n      if (_score2 <= currentThreshold) {\r\n        binMin = binMid;\r\n      } else {\r\n        binMax = binMid;\r\n      }\r\n\r\n      binMid = Math.floor((binMax - binMin) / 2 + binMin);\r\n    } // Use the result from this iteration as the maximum for the next.\r\n\r\n    binMax = binMid;\r\n    var start = Math.max(1, expectedLocation - binMid + 1);\r\n    var finish = findAllMatches\r\n      ? textLen\r\n      : Math.min(expectedLocation + binMid, textLen) + patternLen; // Initialize the bit array\r\n\r\n    var bitArr = Array(finish + 2);\r\n    bitArr[finish + 1] = (1 << _i) - 1;\r\n\r\n    for (var j = finish; j >= start; j -= 1) {\r\n      var currentLocation = j - 1;\r\n      var charMatch = patternAlphabet[text.charAt(currentLocation)];\r\n\r\n      if (computeMatches) {\r\n        // Speed up: quick bool to int conversion (i.e, `charMatch ? 1 : 0`)\r\n        matchMask[currentLocation] = +!!charMatch;\r\n      } // First pass: exact match\r\n\r\n      bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch; // Subsequent passes: fuzzy match\r\n\r\n      if (_i) {\r\n        bitArr[j] |= ((lastBitArr[j + 1] | lastBitArr[j]) << 1) | 1 | lastBitArr[j + 1];\r\n      }\r\n\r\n      if (bitArr[j] & mask) {\r\n        finalScore = computeScore$1(pattern, {\r\n          errors: _i,\r\n          currentLocation: currentLocation,\r\n          expectedLocation: expectedLocation,\r\n          distance: distance,\r\n          ignoreLocation: ignoreLocation,\r\n        }); // This match will almost certainly be better than any existing match.\r\n        // But check anyway.\r\n\r\n        if (finalScore <= currentThreshold) {\r\n          // Indeed it is\r\n          currentThreshold = finalScore;\r\n          bestLocation = currentLocation; // Already passed `loc`, downhill from here on in.\r\n\r\n          if (bestLocation <= expectedLocation) {\r\n            break;\r\n          } // When passing `bestLocation`, don't exceed our current distance from `expectedLocation`.\r\n\r\n          start = Math.max(1, 2 * expectedLocation - bestLocation);\r\n        }\r\n      }\r\n    } // No hope for a (better) match at greater error levels.\r\n\r\n    var _score = computeScore$1(pattern, {\r\n      errors: _i + 1,\r\n      currentLocation: expectedLocation,\r\n      expectedLocation: expectedLocation,\r\n      distance: distance,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n\r\n    if (_score > currentThreshold) {\r\n      break;\r\n    }\r\n\r\n    lastBitArr = bitArr;\r\n  }\r\n\r\n  var result = {\r\n    isMatch: bestLocation >= 0,\r\n    // Count exact matches (those with a score of 0) to be \"almost\" exact\r\n    score: Math.max(0.001, finalScore),\r\n  };\r\n\r\n  if (computeMatches) {\r\n    var indices = convertMaskToIndices(matchMask, minMatchCharLength);\r\n\r\n    if (!indices.length) {\r\n      result.isMatch = false;\r\n    } else if (includeMatches) {\r\n      result.indices = indices;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction createPatternAlphabet(pattern) {\r\n  var mask = {};\r\n\r\n  for (var i = 0, len = pattern.length; i < len; i += 1) {\r\n    var _char = pattern.charAt(i);\r\n\r\n    mask[_char] = (mask[_char] || 0) | (1 << (len - i - 1));\r\n  }\r\n\r\n  return mask;\r\n}\r\n\r\nvar BitapSearch = /*#__PURE__*/ (function () {\r\n  function BitapSearch(pattern) {\r\n    var _this = this;\r\n\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n    _classCallCheck(this, BitapSearch);\r\n\r\n    this.options = {\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n      includeMatches: includeMatches,\r\n      findAllMatches: findAllMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      isCaseSensitive: isCaseSensitive,\r\n      ignoreLocation: ignoreLocation,\r\n    };\r\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\r\n    this.chunks = [];\r\n\r\n    if (!this.pattern.length) {\r\n      return;\r\n    }\r\n\r\n    var addChunk = function addChunk(pattern, startIndex) {\r\n      _this.chunks.push({\r\n        pattern: pattern,\r\n        alphabet: createPatternAlphabet(pattern),\r\n        startIndex: startIndex,\r\n      });\r\n    };\r\n\r\n    var len = this.pattern.length;\r\n\r\n    if (len > MAX_BITS) {\r\n      var i = 0;\r\n      var remainder = len % MAX_BITS;\r\n      var end = len - remainder;\r\n\r\n      while (i < end) {\r\n        addChunk(this.pattern.substr(i, MAX_BITS), i);\r\n        i += MAX_BITS;\r\n      }\r\n\r\n      if (remainder) {\r\n        var startIndex = len - MAX_BITS;\r\n        addChunk(this.pattern.substr(startIndex), startIndex);\r\n      }\r\n    } else {\r\n      addChunk(this.pattern, 0);\r\n    }\r\n  }\r\n\r\n  _createClass(BitapSearch, [\r\n    {\r\n      key: 'searchIn',\r\n      value: function searchIn(text) {\r\n        var _this$options = this.options,\r\n          isCaseSensitive = _this$options.isCaseSensitive,\r\n          includeMatches = _this$options.includeMatches;\r\n\r\n        if (!isCaseSensitive) {\r\n          text = text.toLowerCase();\r\n        } // Exact match\r\n\r\n        if (this.pattern === text) {\r\n          var _result = {\r\n            isMatch: true,\r\n            score: 0,\r\n          };\r\n\r\n          if (includeMatches) {\r\n            _result.indices = [[0, text.length - 1]];\r\n          }\r\n\r\n          return _result;\r\n        } // Otherwise, use Bitap algorithm\r\n\r\n        var _this$options2 = this.options,\r\n          location = _this$options2.location,\r\n          distance = _this$options2.distance,\r\n          threshold = _this$options2.threshold,\r\n          findAllMatches = _this$options2.findAllMatches,\r\n          minMatchCharLength = _this$options2.minMatchCharLength,\r\n          ignoreLocation = _this$options2.ignoreLocation;\r\n        var allIndices = [];\r\n        var totalScore = 0;\r\n        var hasMatches = false;\r\n        this.chunks.forEach(function (_ref2) {\r\n          var pattern = _ref2.pattern,\r\n            alphabet = _ref2.alphabet,\r\n            startIndex = _ref2.startIndex;\r\n\r\n          var _search = search(text, pattern, alphabet, {\r\n              location: location + startIndex,\r\n              distance: distance,\r\n              threshold: threshold,\r\n              findAllMatches: findAllMatches,\r\n              minMatchCharLength: minMatchCharLength,\r\n              includeMatches: includeMatches,\r\n              ignoreLocation: ignoreLocation,\r\n            }),\r\n            isMatch = _search.isMatch,\r\n            score = _search.score,\r\n            indices = _search.indices;\r\n\r\n          if (isMatch) {\r\n            hasMatches = true;\r\n          }\r\n\r\n          totalScore += score;\r\n\r\n          if (isMatch && indices) {\r\n            allIndices = [].concat(_toConsumableArray(allIndices), _toConsumableArray(indices));\r\n          }\r\n        });\r\n        var result = {\r\n          isMatch: hasMatches,\r\n          score: hasMatches ? totalScore / this.chunks.length : 1,\r\n        };\r\n\r\n        if (hasMatches && includeMatches) {\r\n          result.indices = allIndices;\r\n        }\r\n\r\n        return result;\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return BitapSearch;\r\n})();\r\n\r\nvar BaseMatch = /*#__PURE__*/ (function () {\r\n  function BaseMatch(pattern) {\r\n    _classCallCheck(this, BaseMatch);\r\n\r\n    this.pattern = pattern;\r\n  }\r\n\r\n  _createClass(\r\n    BaseMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function /*text*/ search() {},\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'isMultiMatch',\r\n        value: function isMultiMatch(pattern) {\r\n          return getMatch(pattern, this.multiRegex);\r\n        },\r\n      },\r\n      {\r\n        key: 'isSingleMatch',\r\n        value: function isSingleMatch(pattern) {\r\n          return getMatch(pattern, this.singleRegex);\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return BaseMatch;\r\n})();\r\n\r\nfunction getMatch(pattern, exp) {\r\n  var matches = pattern.match(exp);\r\n  return matches ? matches[1] : null;\r\n}\r\n\r\nvar ExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(ExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(ExactMatch);\r\n\r\n  function ExactMatch(pattern) {\r\n    _classCallCheck(this, ExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    ExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text === this.pattern;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, this.pattern.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^=\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^=(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return ExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InverseExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InverseExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InverseExactMatch);\r\n\r\n  function InverseExactMatch(pattern) {\r\n    _classCallCheck(this, InverseExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InverseExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var index = text.indexOf(this.pattern);\r\n          var isMatch = index === -1;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InverseExactMatch;\r\n})(BaseMatch);\r\n\r\nvar PrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(PrefixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(PrefixExactMatch);\r\n\r\n  function PrefixExactMatch(pattern) {\r\n    _classCallCheck(this, PrefixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    PrefixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text.startsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, this.pattern.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'prefix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\\^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^\\^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return PrefixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InversePrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InversePrefixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InversePrefixExactMatch);\r\n\r\n  function InversePrefixExactMatch(pattern) {\r\n    _classCallCheck(this, InversePrefixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InversePrefixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = !text.startsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-prefix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\\^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!\\^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InversePrefixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar SuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(SuffixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(SuffixExactMatch);\r\n\r\n  function SuffixExactMatch(pattern) {\r\n    _classCallCheck(this, SuffixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    SuffixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = text.endsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [text.length - this.pattern.length, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'suffix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\"(.*)\"\\$$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^(.*)\\$$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return SuffixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar InverseSuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(InverseSuffixExactMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(InverseSuffixExactMatch);\r\n\r\n  function InverseSuffixExactMatch(pattern) {\r\n    _classCallCheck(this, InverseSuffixExactMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    InverseSuffixExactMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var isMatch = !text.endsWith(this.pattern);\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: [0, text.length - 1],\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'inverse-suffix-exact';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^!\"(.*)\"\\$$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^!(.*)\\$$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return InverseSuffixExactMatch;\r\n})(BaseMatch);\r\n\r\nvar FuzzyMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(FuzzyMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(FuzzyMatch);\r\n\r\n  function FuzzyMatch(pattern) {\r\n    var _this;\r\n\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\r\n\r\n    _classCallCheck(this, FuzzyMatch);\r\n\r\n    _this = _super.call(this, pattern);\r\n    _this._bitapSearch = new BitapSearch(pattern, {\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n      includeMatches: includeMatches,\r\n      findAllMatches: findAllMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      isCaseSensitive: isCaseSensitive,\r\n      ignoreLocation: ignoreLocation,\r\n    });\r\n    return _this;\r\n  }\r\n\r\n  _createClass(\r\n    FuzzyMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          return this._bitapSearch.searchIn(text);\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'fuzzy';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return FuzzyMatch;\r\n})(BaseMatch);\r\n\r\nvar IncludeMatch = /*#__PURE__*/ (function (_BaseMatch) {\r\n  _inherits(IncludeMatch, _BaseMatch);\r\n\r\n  var _super = _createSuper(IncludeMatch);\r\n\r\n  function IncludeMatch(pattern) {\r\n    _classCallCheck(this, IncludeMatch);\r\n\r\n    return _super.call(this, pattern);\r\n  }\r\n\r\n  _createClass(\r\n    IncludeMatch,\r\n    [\r\n      {\r\n        key: 'search',\r\n        value: function search(text) {\r\n          var location = 0;\r\n          var index;\r\n          var indices = [];\r\n          var patternLen = this.pattern.length; // Get all exact matches\r\n\r\n          while ((index = text.indexOf(this.pattern, location)) > -1) {\r\n            location = index + patternLen;\r\n            indices.push([index, location - 1]);\r\n          }\r\n\r\n          var isMatch = !!indices.length;\r\n          return {\r\n            isMatch: isMatch,\r\n            score: isMatch ? 0 : 1,\r\n            indices: indices,\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'type',\r\n        get: function get() {\r\n          return 'include';\r\n        },\r\n      },\r\n      {\r\n        key: 'multiRegex',\r\n        get: function get() {\r\n          return /^'\"(.*)\"$/;\r\n        },\r\n      },\r\n      {\r\n        key: 'singleRegex',\r\n        get: function get() {\r\n          return /^'(.*)$/;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return IncludeMatch;\r\n})(BaseMatch);\r\n\r\nvar searchers = [\r\n  ExactMatch,\r\n  IncludeMatch,\r\n  PrefixExactMatch,\r\n  InversePrefixExactMatch,\r\n  InverseSuffixExactMatch,\r\n  SuffixExactMatch,\r\n  InverseExactMatch,\r\n  FuzzyMatch,\r\n];\r\nvar searchersLen = searchers.length; // Regex to split by spaces, but keep anything in quotes together\r\n\r\nvar SPACE_RE = / +(?=([^\\\"]*\\\"[^\\\"]*\\\")*[^\\\"]*$)/;\r\nvar OR_TOKEN = '|'; // Return a 2D array representation of the query, for simpler parsing.\r\n// Example:\r\n// \"^core go$ | rb$ | py$ xy$\" => [[\"^core\", \"go$\"], [\"rb$\"], [\"py$\", \"xy$\"]]\r\n\r\nfunction parseQuery(pattern) {\r\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n  return pattern.split(OR_TOKEN).map(function (item) {\r\n    var query = item\r\n      .trim()\r\n      .split(SPACE_RE)\r\n      .filter(function (item) {\r\n        return item && !!item.trim();\r\n      });\r\n    var results = [];\r\n\r\n    for (var i = 0, len = query.length; i < len; i += 1) {\r\n      var queryItem = query[i]; // 1. Handle multiple query match (i.e, once that are quoted, like `\"hello world\"`)\r\n\r\n      var found = false;\r\n      var idx = -1;\r\n\r\n      while (!found && ++idx < searchersLen) {\r\n        var searcher = searchers[idx];\r\n        var token = searcher.isMultiMatch(queryItem);\r\n\r\n        if (token) {\r\n          results.push(new searcher(token, options));\r\n          found = true;\r\n        }\r\n      }\r\n\r\n      if (found) {\r\n        continue;\r\n      } // 2. Handle single query matches (i.e, once that are *not* quoted)\r\n\r\n      idx = -1;\r\n\r\n      while (++idx < searchersLen) {\r\n        var _searcher = searchers[idx];\r\n\r\n        var _token = _searcher.isSingleMatch(queryItem);\r\n\r\n        if (_token) {\r\n          results.push(new _searcher(_token, options));\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return results;\r\n  });\r\n}\r\n\r\n// to a singl match\r\n\r\nvar MultiMatchSet = new Set([FuzzyMatch.type, IncludeMatch.type]);\r\n/**\r\n * Command-like searching\r\n * ======================\r\n *\r\n * Given multiple search terms delimited by spaces.e.g. `^jscript .python$ ruby !java`,\r\n * search in a given text.\r\n *\r\n * Search syntax:\r\n *\r\n * | Token       | Match type                 | Description                            |\r\n * | ----------- | -------------------------- | -------------------------------------- |\r\n * | `jscript`   | fuzzy-match                | Items that fuzzy match `jscript`       |\r\n * | `=scheme`   | exact-match                | Items that are `scheme`                |\r\n * | `'python`   | include-match              | Items that include `python`            |\r\n * | `!ruby`     | inverse-exact-match        | Items that do not include `ruby`       |\r\n * | `^java`     | prefix-exact-match         | Items that start with `java`           |\r\n * | `!^earlang` | inverse-prefix-exact-match | Items that do not start with `earlang` |\r\n * | `.js$`      | suffix-exact-match         | Items that end with `.js`              |\r\n * | `!.go$`     | inverse-suffix-exact-match | Items that do not end with `.go`       |\r\n *\r\n * A single pipe character acts as an OR operator. For example, the following\r\n * query matches entries that start with `core` and end with either`go`, `rb`,\r\n * or`py`.\r\n *\r\n * ```\r\n * ^core go$ | rb$ | py$\r\n * ```\r\n */\r\n\r\nvar ExtendedSearch = /*#__PURE__*/ (function () {\r\n  function ExtendedSearch(pattern) {\r\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\r\n      isCaseSensitive =\r\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\r\n      _ref$includeMatches = _ref.includeMatches,\r\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\r\n      minMatchCharLength =\r\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\r\n      _ref$ignoreLocation = _ref.ignoreLocation,\r\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation,\r\n      _ref$findAllMatches = _ref.findAllMatches,\r\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\r\n      _ref$location = _ref.location,\r\n      location = _ref$location === void 0 ? Config.location : _ref$location,\r\n      _ref$threshold = _ref.threshold,\r\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\r\n      _ref$distance = _ref.distance,\r\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance;\r\n\r\n    _classCallCheck(this, ExtendedSearch);\r\n\r\n    this.query = null;\r\n    this.options = {\r\n      isCaseSensitive: isCaseSensitive,\r\n      includeMatches: includeMatches,\r\n      minMatchCharLength: minMatchCharLength,\r\n      findAllMatches: findAllMatches,\r\n      ignoreLocation: ignoreLocation,\r\n      location: location,\r\n      threshold: threshold,\r\n      distance: distance,\r\n    };\r\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\r\n    this.query = parseQuery(this.pattern, this.options);\r\n  }\r\n\r\n  _createClass(\r\n    ExtendedSearch,\r\n    [\r\n      {\r\n        key: 'searchIn',\r\n        value: function searchIn(text) {\r\n          var query = this.query;\r\n\r\n          if (!query) {\r\n            return {\r\n              isMatch: false,\r\n              score: 1,\r\n            };\r\n          }\r\n\r\n          var _this$options = this.options,\r\n            includeMatches = _this$options.includeMatches,\r\n            isCaseSensitive = _this$options.isCaseSensitive;\r\n          text = isCaseSensitive ? text : text.toLowerCase();\r\n          var numMatches = 0;\r\n          var allIndices = [];\r\n          var totalScore = 0; // ORs\r\n\r\n          for (var i = 0, qLen = query.length; i < qLen; i += 1) {\r\n            var searchers = query[i]; // Reset indices\r\n\r\n            allIndices.length = 0;\r\n            numMatches = 0; // ANDs\r\n\r\n            for (var j = 0, pLen = searchers.length; j < pLen; j += 1) {\r\n              var searcher = searchers[j];\r\n\r\n              var _searcher$search = searcher.search(text),\r\n                isMatch = _searcher$search.isMatch,\r\n                indices = _searcher$search.indices,\r\n                score = _searcher$search.score;\r\n\r\n              if (isMatch) {\r\n                numMatches += 1;\r\n                totalScore += score;\r\n\r\n                if (includeMatches) {\r\n                  var type = searcher.constructor.type;\r\n\r\n                  if (MultiMatchSet.has(type)) {\r\n                    allIndices = [].concat(\r\n                      _toConsumableArray(allIndices),\r\n                      _toConsumableArray(indices)\r\n                    );\r\n                  } else {\r\n                    allIndices.push(indices);\r\n                  }\r\n                }\r\n              } else {\r\n                totalScore = 0;\r\n                numMatches = 0;\r\n                allIndices.length = 0;\r\n                break;\r\n              }\r\n            } // OR condition, so if TRUE, return\r\n\r\n            if (numMatches) {\r\n              var result = {\r\n                isMatch: true,\r\n                score: totalScore / numMatches,\r\n              };\r\n\r\n              if (includeMatches) {\r\n                result.indices = allIndices;\r\n              }\r\n\r\n              return result;\r\n            }\r\n          } // Nothing was matched\r\n\r\n          return {\r\n            isMatch: false,\r\n            score: 1,\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    [\r\n      {\r\n        key: 'condition',\r\n        value: function condition(_, options) {\r\n          return options.useExtendedSearch;\r\n        },\r\n      },\r\n    ]\r\n  );\r\n\r\n  return ExtendedSearch;\r\n})();\r\n\r\nvar registeredSearchers = [];\r\nfunction register() {\r\n  registeredSearchers.push.apply(registeredSearchers, arguments);\r\n}\r\nfunction createSearcher(pattern, options) {\r\n  for (var i = 0, len = registeredSearchers.length; i < len; i += 1) {\r\n    var searcherClass = registeredSearchers[i];\r\n\r\n    if (searcherClass.condition(pattern, options)) {\r\n      return new searcherClass(pattern, options);\r\n    }\r\n  }\r\n\r\n  return new BitapSearch(pattern, options);\r\n}\r\n\r\nvar LogicalOperator = {\r\n  AND: '$and',\r\n  OR: '$or',\r\n};\r\nvar KeyType = {\r\n  PATH: '$path',\r\n  PATTERN: '$val',\r\n};\r\n\r\nvar isExpression = function isExpression(query) {\r\n  return !!(query[LogicalOperator.AND] || query[LogicalOperator.OR]);\r\n};\r\n\r\nvar isPath = function isPath(query) {\r\n  return !!query[KeyType.PATH];\r\n};\r\n\r\nvar isLeaf = function isLeaf(query) {\r\n  return !isArray(query) && isObject(query) && !isExpression(query);\r\n};\r\n\r\nvar convertToExplicit = function convertToExplicit(query) {\r\n  return _defineProperty(\r\n    {},\r\n    LogicalOperator.AND,\r\n    Object.keys(query).map(function (key) {\r\n      return _defineProperty({}, key, query[key]);\r\n    })\r\n  );\r\n}; // When `auto` is `true`, the parse function will infer and initialize and add\r\n// the appropriate `Searcher` instance\r\n\r\nfunction parse(query, options) {\r\n  var _ref3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref3$auto = _ref3.auto,\r\n    auto = _ref3$auto === void 0 ? true : _ref3$auto;\r\n\r\n  var next = function next(query) {\r\n    var keys = Object.keys(query);\r\n    var isQueryPath = isPath(query);\r\n\r\n    if (!isQueryPath && keys.length > 1 && !isExpression(query)) {\r\n      return next(convertToExplicit(query));\r\n    }\r\n\r\n    if (isLeaf(query)) {\r\n      var key = isQueryPath ? query[KeyType.PATH] : keys[0];\r\n      var pattern = isQueryPath ? query[KeyType.PATTERN] : query[key];\r\n\r\n      if (!isString(pattern)) {\r\n        throw new Error(LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key));\r\n      }\r\n\r\n      var obj = {\r\n        keyId: createKeyId(key),\r\n        pattern: pattern,\r\n      };\r\n\r\n      if (auto) {\r\n        obj.searcher = createSearcher(pattern, options);\r\n      }\r\n\r\n      return obj;\r\n    }\r\n\r\n    var node = {\r\n      children: [],\r\n      operator: keys[0],\r\n    };\r\n    keys.forEach(function (key) {\r\n      var value = query[key];\r\n\r\n      if (isArray(value)) {\r\n        value.forEach(function (item) {\r\n          node.children.push(next(item));\r\n        });\r\n      }\r\n    });\r\n    return node;\r\n  };\r\n\r\n  if (!isExpression(query)) {\r\n    query = convertToExplicit(query);\r\n  }\r\n\r\n  return next(query);\r\n}\r\n\r\nfunction computeScore(results, _ref) {\r\n  var _ref$ignoreFieldNorm = _ref.ignoreFieldNorm,\r\n    ignoreFieldNorm =\r\n      _ref$ignoreFieldNorm === void 0 ? Config.ignoreFieldNorm : _ref$ignoreFieldNorm;\r\n  results.forEach(function (result) {\r\n    var totalScore = 1;\r\n    result.matches.forEach(function (_ref2) {\r\n      var key = _ref2.key,\r\n        norm = _ref2.norm,\r\n        score = _ref2.score;\r\n      var weight = key ? key.weight : null;\r\n      totalScore *= Math.pow(\r\n        score === 0 && weight ? Number.EPSILON : score,\r\n        (weight || 1) * (ignoreFieldNorm ? 1 : norm)\r\n      );\r\n    });\r\n    result.score = totalScore;\r\n  });\r\n}\r\n\r\nfunction transformMatches(result, data) {\r\n  var matches = result.matches;\r\n  data.matches = [];\r\n\r\n  if (!isDefined(matches)) {\r\n    return;\r\n  }\r\n\r\n  matches.forEach(function (match) {\r\n    if (!isDefined(match.indices) || !match.indices.length) {\r\n      return;\r\n    }\r\n\r\n    var indices = match.indices,\r\n      value = match.value;\r\n    var obj = {\r\n      indices: indices,\r\n      value: value,\r\n    };\r\n\r\n    if (match.key) {\r\n      obj.key = match.key.src;\r\n    }\r\n\r\n    if (match.idx > -1) {\r\n      obj.refIndex = match.idx;\r\n    }\r\n\r\n    data.matches.push(obj);\r\n  });\r\n}\r\n\r\nfunction transformScore(result, data) {\r\n  data.score = result.score;\r\n}\r\n\r\nfunction format(results, docs) {\r\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\r\n    _ref$includeMatches = _ref.includeMatches,\r\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\r\n    _ref$includeScore = _ref.includeScore,\r\n    includeScore = _ref$includeScore === void 0 ? Config.includeScore : _ref$includeScore;\r\n\r\n  var transformers = [];\r\n  if (includeMatches) transformers.push(transformMatches);\r\n  if (includeScore) transformers.push(transformScore);\r\n  return results.map(function (result) {\r\n    var idx = result.idx;\r\n    var data = {\r\n      item: docs[idx],\r\n      refIndex: idx,\r\n    };\r\n\r\n    if (transformers.length) {\r\n      transformers.forEach(function (transformer) {\r\n        transformer(result, data);\r\n      });\r\n    }\r\n\r\n    return data;\r\n  });\r\n}\r\n\r\nvar Fuse$1 = /*#__PURE__*/ (function () {\r\n  function Fuse(docs) {\r\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\r\n    var index = arguments.length > 2 ? arguments[2] : undefined;\r\n\r\n    _classCallCheck(this, Fuse);\r\n\r\n    this.options = _objectSpread2(_objectSpread2({}, Config), options);\r\n\r\n    if (this.options.useExtendedSearch && !true) {\r\n      throw new Error(EXTENDED_SEARCH_UNAVAILABLE);\r\n    }\r\n\r\n    this._keyStore = new KeyStore(this.options.keys);\r\n    this.setCollection(docs, index);\r\n  }\r\n\r\n  _createClass(Fuse, [\r\n    {\r\n      key: 'setCollection',\r\n      value: function setCollection(docs, index) {\r\n        this._docs = docs;\r\n\r\n        if (index && !(index instanceof FuseIndex)) {\r\n          throw new Error(INCORRECT_INDEX_TYPE);\r\n        }\r\n\r\n        this._myIndex =\r\n          index ||\r\n          createIndex(this.options.keys, this._docs, {\r\n            getFn: this.options.getFn,\r\n            fieldNormWeight: this.options.fieldNormWeight,\r\n          });\r\n      },\r\n    },\r\n    {\r\n      key: 'add',\r\n      value: function add(doc) {\r\n        if (!isDefined(doc)) {\r\n          return;\r\n        }\r\n\r\n        this._docs.push(doc);\r\n\r\n        this._myIndex.add(doc);\r\n      },\r\n    },\r\n    {\r\n      key: 'remove',\r\n      value: function remove() {\r\n        var predicate =\r\n          arguments.length > 0 && arguments[0] !== undefined\r\n            ? arguments[0]\r\n            : function () /* doc, idx */\r\n              {\r\n                return false;\r\n              };\r\n        var results = [];\r\n\r\n        for (var i = 0, len = this._docs.length; i < len; i += 1) {\r\n          var doc = this._docs[i];\r\n\r\n          if (predicate(doc, i)) {\r\n            this.removeAt(i);\r\n            i -= 1;\r\n            len -= 1;\r\n            results.push(doc);\r\n          }\r\n        }\r\n\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: 'removeAt',\r\n      value: function removeAt(idx) {\r\n        this._docs.splice(idx, 1);\r\n\r\n        this._myIndex.removeAt(idx);\r\n      },\r\n    },\r\n    {\r\n      key: 'getIndex',\r\n      value: function getIndex() {\r\n        return this._myIndex;\r\n      },\r\n    },\r\n    {\r\n      key: 'search',\r\n      value: function search(query) {\r\n        var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\r\n          _ref$limit = _ref.limit,\r\n          limit = _ref$limit === void 0 ? -1 : _ref$limit;\r\n\r\n        var _this$options = this.options,\r\n          includeMatches = _this$options.includeMatches,\r\n          includeScore = _this$options.includeScore,\r\n          shouldSort = _this$options.shouldSort,\r\n          sortFn = _this$options.sortFn,\r\n          ignoreFieldNorm = _this$options.ignoreFieldNorm;\r\n        var results = isString(query)\r\n          ? isString(this._docs[0])\r\n            ? this._searchStringList(query)\r\n            : this._searchObjectList(query)\r\n          : this._searchLogical(query);\r\n        computeScore(results, {\r\n          ignoreFieldNorm: ignoreFieldNorm,\r\n        });\r\n\r\n        if (shouldSort) {\r\n          results.sort(sortFn);\r\n        }\r\n\r\n        if (isNumber(limit) && limit > -1) {\r\n          results = results.slice(0, limit);\r\n        }\r\n\r\n        return format(results, this._docs, {\r\n          includeMatches: includeMatches,\r\n          includeScore: includeScore,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      key: '_searchStringList',\r\n      value: function _searchStringList(query) {\r\n        var searcher = createSearcher(query, this.options);\r\n        var records = this._myIndex.records;\r\n        var results = []; // Iterate over every string in the index\r\n\r\n        records.forEach(function (_ref2) {\r\n          var text = _ref2.v,\r\n            idx = _ref2.i,\r\n            norm = _ref2.n;\r\n\r\n          if (!isDefined(text)) {\r\n            return;\r\n          }\r\n\r\n          var _searcher$searchIn = searcher.searchIn(text),\r\n            isMatch = _searcher$searchIn.isMatch,\r\n            score = _searcher$searchIn.score,\r\n            indices = _searcher$searchIn.indices;\r\n\r\n          if (isMatch) {\r\n            results.push({\r\n              item: text,\r\n              idx: idx,\r\n              matches: [\r\n                {\r\n                  score: score,\r\n                  value: text,\r\n                  norm: norm,\r\n                  indices: indices,\r\n                },\r\n              ],\r\n            });\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_searchLogical',\r\n      value: function _searchLogical(query) {\r\n        var _this = this;\r\n\r\n        var expression = parse(query, this.options);\r\n\r\n        var evaluate = function evaluate(node, item, idx) {\r\n          if (!node.children) {\r\n            var keyId = node.keyId,\r\n              searcher = node.searcher;\r\n\r\n            var matches = _this._findMatches({\r\n              key: _this._keyStore.get(keyId),\r\n              value: _this._myIndex.getValueForItemAtKeyId(item, keyId),\r\n              searcher: searcher,\r\n            });\r\n\r\n            if (matches && matches.length) {\r\n              return [\r\n                {\r\n                  idx: idx,\r\n                  item: item,\r\n                  matches: matches,\r\n                },\r\n              ];\r\n            }\r\n\r\n            return [];\r\n          }\r\n\r\n          var res = [];\r\n\r\n          for (var i = 0, len = node.children.length; i < len; i += 1) {\r\n            var child = node.children[i];\r\n            var result = evaluate(child, item, idx);\r\n\r\n            if (result.length) {\r\n              res.push.apply(res, _toConsumableArray(result));\r\n            } else if (node.operator === LogicalOperator.AND) {\r\n              return [];\r\n            }\r\n          }\r\n\r\n          return res;\r\n        };\r\n\r\n        var records = this._myIndex.records;\r\n        var resultMap = {};\r\n        var results = [];\r\n        records.forEach(function (_ref3) {\r\n          var item = _ref3.$,\r\n            idx = _ref3.i;\r\n\r\n          if (isDefined(item)) {\r\n            var expResults = evaluate(expression, item, idx);\r\n\r\n            if (expResults.length) {\r\n              // Dedupe when adding\r\n              if (!resultMap[idx]) {\r\n                resultMap[idx] = {\r\n                  idx: idx,\r\n                  item: item,\r\n                  matches: [],\r\n                };\r\n                results.push(resultMap[idx]);\r\n              }\r\n\r\n              expResults.forEach(function (_ref4) {\r\n                var _resultMap$idx$matche;\r\n\r\n                var matches = _ref4.matches;\r\n\r\n                (_resultMap$idx$matche = resultMap[idx].matches).push.apply(\r\n                  _resultMap$idx$matche,\r\n                  _toConsumableArray(matches)\r\n                );\r\n              });\r\n            }\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_searchObjectList',\r\n      value: function _searchObjectList(query) {\r\n        var _this2 = this;\r\n\r\n        var searcher = createSearcher(query, this.options);\r\n        var _this$_myIndex = this._myIndex,\r\n          keys = _this$_myIndex.keys,\r\n          records = _this$_myIndex.records;\r\n        var results = []; // List is Array<Object>\r\n\r\n        records.forEach(function (_ref5) {\r\n          var item = _ref5.$,\r\n            idx = _ref5.i;\r\n\r\n          if (!isDefined(item)) {\r\n            return;\r\n          }\r\n\r\n          var matches = []; // Iterate over every key (i.e, path), and fetch the value at that key\r\n\r\n          keys.forEach(function (key, keyIndex) {\r\n            matches.push.apply(\r\n              matches,\r\n              _toConsumableArray(\r\n                _this2._findMatches({\r\n                  key: key,\r\n                  value: item[keyIndex],\r\n                  searcher: searcher,\r\n                })\r\n              )\r\n            );\r\n          });\r\n\r\n          if (matches.length) {\r\n            results.push({\r\n              idx: idx,\r\n              item: item,\r\n              matches: matches,\r\n            });\r\n          }\r\n        });\r\n        return results;\r\n      },\r\n    },\r\n    {\r\n      key: '_findMatches',\r\n      value: function _findMatches(_ref6) {\r\n        var key = _ref6.key,\r\n          value = _ref6.value,\r\n          searcher = _ref6.searcher;\r\n\r\n        if (!isDefined(value)) {\r\n          return [];\r\n        }\r\n\r\n        var matches = [];\r\n\r\n        if (isArray(value)) {\r\n          value.forEach(function (_ref7) {\r\n            var text = _ref7.v,\r\n              idx = _ref7.i,\r\n              norm = _ref7.n;\r\n\r\n            if (!isDefined(text)) {\r\n              return;\r\n            }\r\n\r\n            var _searcher$searchIn2 = searcher.searchIn(text),\r\n              isMatch = _searcher$searchIn2.isMatch,\r\n              score = _searcher$searchIn2.score,\r\n              indices = _searcher$searchIn2.indices;\r\n\r\n            if (isMatch) {\r\n              matches.push({\r\n                score: score,\r\n                key: key,\r\n                value: text,\r\n                idx: idx,\r\n                norm: norm,\r\n                indices: indices,\r\n              });\r\n            }\r\n          });\r\n        } else {\r\n          var text = value.v,\r\n            norm = value.n;\r\n\r\n          var _searcher$searchIn3 = searcher.searchIn(text),\r\n            isMatch = _searcher$searchIn3.isMatch,\r\n            score = _searcher$searchIn3.score,\r\n            indices = _searcher$searchIn3.indices;\r\n\r\n          if (isMatch) {\r\n            matches.push({\r\n              score: score,\r\n              key: key,\r\n              value: text,\r\n              norm: norm,\r\n              indices: indices,\r\n            });\r\n          }\r\n        }\r\n\r\n        return matches;\r\n      },\r\n    },\r\n  ]);\r\n\r\n  return Fuse;\r\n})();\r\n\r\nFuse$1.version = '6.5.3';\r\nFuse$1.createIndex = createIndex;\r\nFuse$1.parseIndex = parseIndex;\r\nFuse$1.config = Config;\r\n\r\n{\r\n  Fuse$1.parseQuery = parse;\r\n}\r\n\r\n{\r\n  register(ExtendedSearch);\r\n}\r\n\r\nexport var Fuse = Fuse$1;\r\n","import { isInitialized } from '../token-variants.mjs';\r\nimport { Fuse } from './fuse/fuse.js';\r\nimport { getSearchOptions, TVA_CONFIG } from './settings.js';\r\nimport {\r\n  callForgeVTT,\r\n  decodeURIComponentSafely,\r\n  decodeURISafely,\r\n  flattenSearchResults,\r\n  getFileName,\r\n  getFileNameWithExt,\r\n  getFilePath,\r\n  getFilters,\r\n  isImage,\r\n  isVideo,\r\n  parseKeywords,\r\n  SEARCH_TYPE,\r\n  simplifyName,\r\n  simplifyPath,\r\n} from './utils.js';\r\n\r\n// True if in the middle of caching image paths\r\nlet caching = false;\r\nexport function isCaching() {\r\n  return caching;\r\n}\r\n\r\n// Cached images\r\nlet CACHED_IMAGES = {};\r\n\r\n/**\r\n * @param {string} search Text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Boolean} [options.simpleResults] Results will be returned as an array of all image paths found\r\n * @param {Function[]} [options.callback] Function to be called with the found images\r\n * @param {object} [options.searchOptions] Override search settings\r\n * @returns {Promise<Map<string, Array<object>|Array<string>>} All images found split by original criteria and keywords\r\n */\r\nexport async function doImageSearch(\r\n  search,\r\n  { searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN, simpleResults = false, callback = null, searchOptions = {} } = {}\r\n) {\r\n  if (caching) return;\r\n\r\n  searchOptions = foundry.utils.mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\r\n\r\n  search = search.trim();\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Art Search', search, searchType, searchOptions);\r\n\r\n  let searches = [search];\r\n  let allImages = new Map();\r\n  const keywords = parseKeywords(searchOptions.excludedKeywords);\r\n\r\n  if (searchOptions.keywordSearch) {\r\n    searches = searches.concat(\r\n      search\r\n        .split(/[_\\- :,\\|\\(\\)\\[\\]]/)\r\n        .filter((word) => word.length > 2 && !keywords.includes(word.toLowerCase()))\r\n        .reverse()\r\n    );\r\n  }\r\n\r\n  let usedImages = new Set();\r\n  for (const search of searches) {\r\n    if (allImages.get(search) !== undefined) continue;\r\n\r\n    let results = await findImages(search, searchType, searchOptions);\r\n    results = results.filter((pathObj) => !usedImages.has(pathObj));\r\n\r\n    allImages.set(search, results);\r\n    results.forEach(usedImages.add, usedImages);\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Art Search');\r\n\r\n  if (simpleResults) {\r\n    allImages = Array.from(usedImages).map((obj) => obj.path);\r\n  }\r\n\r\n  if (callback) callback(allImages);\r\n  return allImages;\r\n}\r\n\r\n/**\r\n * @param {*} search Text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Actor} [options.actor] Used to retrieve 'shared' images from if enabled in the Randomizer Settings\r\n * @param {Function[]} [options.callback] Function to be called with the random image\r\n * @param {object} [options.searchOptions] Override search settings\r\n * @param {object} [options.randomizerOptions] Override randomizer settings. These take precedence over searchOptions\r\n * @returns Array<string>|null} Image path and name\r\n */\r\nexport async function doRandomSearch(\r\n  search,\r\n  {\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    actor = null,\r\n    callback = null,\r\n    randomizerOptions = {},\r\n    searchOptions = {},\r\n  } = {}\r\n) {\r\n  if (caching) return null;\r\n\r\n  let results = flattenSearchResults(\r\n    await _randSearchUtil(search, {\r\n      searchType: searchType,\r\n      actor: actor,\r\n      randomizerOptions: randomizerOptions,\r\n      searchOptions: searchOptions,\r\n    })\r\n  );\r\n  if (results.length === 0) return null;\r\n\r\n  let result;\r\n\r\n  // If `nonRepeat` option is enabled keep attempting random selection until a unique token image is found\r\n  // in case of no such image, just pick a random one\r\n  if (results.length !== 1 && randomizerOptions.nonRepeat && searchType === SEARCH_TYPE.TOKEN) {\r\n    const tokens = canvas.tokens?.placeables || [];\r\n    const placedImages = new Set(tokens.map((t) => t.document.texture.src));\r\n    let checkedImages = [];\r\n    let tmpResult = results[Math.floor(Math.random() * results.length)];\r\n\r\n    while (results.length && !result) {\r\n      if (placedImages.has(tmpResult.path)) {\r\n        checkedImages.push(tmpResult);\r\n        results.splice(results.indexOf(tmpResult), 1);\r\n        tmpResult = results[Math.floor(Math.random() * results.length)];\r\n      } else {\r\n        result = tmpResult;\r\n      }\r\n    }\r\n\r\n    if (!result) results = checkedImages;\r\n  }\r\n\r\n  if (!result) {\r\n    result = results[Math.floor(Math.random() * results.length)];\r\n  }\r\n\r\n  // Pick random image\r\n  if (callback) callback([result.path, result.name]);\r\n  return [result.path, result.name];\r\n}\r\n\r\nexport async function doSyncSearch(target, { searchType = SEARCH_TYPE.TOKEN } = {}) {\r\n  if (caching) return null;\r\n\r\n  const fResults = await findImages(target, searchType, { algorithm: { fuzzy: true } });\r\n\r\n  if (fResults && fResults.length !== 0) {\r\n    return [fResults[0].path, fResults[0].name];\r\n  } else {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function _randSearchUtil(\r\n  search,\r\n  { searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN, actor = null, randomizerOptions = {}, searchOptions = {} } = {}\r\n) {\r\n  const randSettings = foundry.utils.mergeObject(randomizerOptions, TVA_CONFIG.randomizer, { overwrite: false });\r\n  if (\r\n    !(\r\n      randSettings.tokenName ||\r\n      randSettings.actorName ||\r\n      randSettings.keywords ||\r\n      randSettings.shared ||\r\n      randSettings.wildcard\r\n    )\r\n  )\r\n    return null;\r\n\r\n  // Randomizer settings take precedence\r\n  searchOptions.keywordSearch = randSettings.keywords;\r\n\r\n  // Swap search to the actor name if need be\r\n  if (randSettings.actorName && actor) {\r\n    search = actor.name;\r\n  }\r\n\r\n  // Gather all images\r\n  let results =\r\n    randSettings.actorName || randSettings.tokenName || randSettings.keywords\r\n      ? await doImageSearch(search, {\r\n          searchType: searchType,\r\n          searchOptions: searchOptions,\r\n        })\r\n      : new Map();\r\n\r\n  if (!randSettings.tokenName && !randSettings.actorName) {\r\n    results.delete(search);\r\n  }\r\n  if (randSettings.shared && actor) {\r\n    let sharedVariants = actor.getFlag('token-variants', 'variants') || [];\r\n    if (sharedVariants.length != 0) {\r\n      const sv = [];\r\n      sharedVariants.forEach((variant) => {\r\n        variant.names.forEach((name) => {\r\n          sv.push({ path: variant.imgSrc, name: name });\r\n        });\r\n      });\r\n      results.set('variants95436723', sv);\r\n    }\r\n  }\r\n  if (randSettings.wildcard && actor) {\r\n    let protoImg = actor.prototypeToken.texture.src;\r\n    if (protoImg.includes('*') || (protoImg.includes('{') && protoImg.includes('}'))) {\r\n      // Modified version of Actor.getTokenImages()\r\n      const getTokenImages = async (actor) => {\r\n        if (actor._tokenImages) return actor._tokenImages;\r\n        let source = 'data';\r\n        const browseOptions = { wildcard: true };\r\n\r\n        // Support non-user sources\r\n        if (/\\.s3\\./.test(protoImg)) {\r\n          source = 's3';\r\n          const { bucket, keyPrefix } = foundry.applications.apps.FilePicker.implementation.parseS3URL(protoImg);\r\n          if (bucket) {\r\n            browseOptions.bucket = bucket;\r\n            protoImg = keyPrefix;\r\n          }\r\n        } else if (protoImg.startsWith('icons/')) source = 'public';\r\n\r\n        // Retrieve wildcard content\r\n        try {\r\n          const content = await foundry.applications.apps.FilePicker.implementation.browse(\r\n            source,\r\n            protoImg,\r\n            browseOptions\r\n          );\r\n          return content.files;\r\n        } catch (err) {\r\n          return [];\r\n        }\r\n      };\r\n\r\n      const wildcardImages = (await getTokenImages(actor))\r\n        .filter((img) => !img.includes('*') && (isImage(img) || isVideo(img)))\r\n        .map((variant) => {\r\n          return { path: variant, name: getFileName(variant) };\r\n        });\r\n      results.set('variants95436623', wildcardImages);\r\n    }\r\n  }\r\n\r\n  return results;\r\n}\r\n\r\n/**\r\n * Recursive image search through a directory\r\n * @param {*} path starting path\r\n * @param {*} options.apiKey ForgeVTT AssetLibrary API key\r\n * @param {*} found_images all the images found\r\n * @returns void\r\n */\r\nasync function walkFindImages(path, { apiKey = '' } = {}, found_images) {\r\n  let files = {};\r\n  if (!path.source) {\r\n    path.source = 'data';\r\n  }\r\n  const typeKey = path.types.sort().join(',');\r\n  try {\r\n    if (path.source.startsWith('s3:')) {\r\n      files = await foundry.applications.apps.FilePicker.implementation.browse('s3', path.text, {\r\n        bucket: path.source.replace('s3:', ''),\r\n      });\r\n    } else if (path.source.startsWith('forgevtt')) {\r\n      if (apiKey) {\r\n        const response = await callForgeVTT(path.text, apiKey);\r\n        files.files = response.files.map((f) => f.url);\r\n      } else {\r\n        files = await foundry.applications.apps.FilePicker.implementation.browse('forgevtt', path.text, {\r\n          recursive: true,\r\n        });\r\n      }\r\n    } else if (path.source.startsWith('forge-bazaar')) {\r\n      files = await foundry.applications.apps.FilePicker.implementation.browse('forge-bazaar', path.text, {\r\n        recursive: true,\r\n      });\r\n    } else if (path.source.startsWith('imgur')) {\r\n      await fetch('https://api.imgur.com/3/gallery/album/' + path.text, {\r\n        headers: {\r\n          Authorization: 'Client-ID ' + (TVA_CONFIG.imgurClientId ? TVA_CONFIG.imgurClientId : 'df9d991443bb222'),\r\n          Accept: 'application/json',\r\n        },\r\n      })\r\n        .then((response) => response.json())\r\n        .then(async function (result) {\r\n          if (!result.success) {\r\n            return;\r\n          }\r\n          result.data.images.forEach((img) => {\r\n            const rtName = img.title ?? img.description ?? getFileName(img.link);\r\n            _addToFound({ path: decodeURISafely(img.link), name: rtName }, typeKey, found_images);\r\n          });\r\n        })\r\n        .catch((error) => console.warn('TVA |', error));\r\n      return;\r\n    } else if (path.source.startsWith('rolltable')) {\r\n      const table = game.tables.contents.find((t) => t.name === path.text);\r\n      if (!table) {\r\n        const rollTableName = path.text;\r\n        ui.notifications.warn(\r\n          game.i18n.format('token-variants.notifications.warn.invalid-table', {\r\n            rollTableName,\r\n          })\r\n        );\r\n      } else {\r\n        for (let baseTableData of table.results) {\r\n          const rtPath = baseTableData.img;\r\n          const rtName = baseTableData.text || getFileName(rtPath);\r\n          _addToFound({ path: decodeURISafely(rtPath), name: rtName }, typeKey, found_images);\r\n        }\r\n      }\r\n      return;\r\n    } else if (path.source.startsWith('json')) {\r\n      await fetch(path.text, {\r\n        headers: {\r\n          Accept: 'application/json',\r\n        },\r\n      })\r\n        .then((response) => response.json())\r\n        .then(async function (result) {\r\n          if (!result.length > 0) {\r\n            return;\r\n          }\r\n          result.forEach((img) => {\r\n            const rtName = img.name ?? getFileName(img.path);\r\n            _addToFound({ path: decodeURISafely(img.path), name: rtName, tags: img.tags }, typeKey, found_images);\r\n          });\r\n        })\r\n        .catch((error) => console.warn('TVA |', error));\r\n      return;\r\n    } else {\r\n      files = await foundry.applications.apps.FilePicker.implementation.browse(path.source, path.text);\r\n    }\r\n  } catch (err) {\r\n    console.warn(\r\n      `TVA | ${game.i18n.localize('token-variants.notifications.warn.path-not-found')} ${path.source}:${path.text}`\r\n    );\r\n    return;\r\n  }\r\n\r\n  if (files.target == '.') return;\r\n\r\n  if (files.files) {\r\n    files.files.forEach((tokenSrc) => {\r\n      _addToFound({ path: decodeURISafely(tokenSrc), name: getFileName(tokenSrc) }, typeKey, found_images);\r\n    });\r\n  }\r\n\r\n  // ForgeVTT requires special treatment\r\n  // Bazaar paths fail recursive search if one level above root\r\n  if (path.source.startsWith('forgevtt')) return;\r\n  else if (\r\n    path.source.startsWith('forge-bazaar') &&\r\n    !['modules', 'systems', 'worlds', 'assets'].includes(path.text.replaceAll(/[\\/\\\\]/g, ''))\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  for (let f_dir of files.dirs) {\r\n    await walkFindImages({ text: f_dir, source: path.source, types: path.types }, { apiKey: apiKey }, found_images);\r\n  }\r\n}\r\n\r\nfunction _addToFound(img, typeKey, found_images) {\r\n  if (isImage(img.path) || isVideo(img.path)) {\r\n    if (found_images[typeKey] == null) {\r\n      found_images[typeKey] = [img];\r\n    } else {\r\n      found_images[typeKey].push(img);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Recursive walks through all paths exposed to the module and caches them\r\n * @param {*} searchType\r\n * @returns\r\n */\r\nasync function walkAllPaths(searchType) {\r\n  const found_images = {};\r\n  const paths = _filterPathsByType(TVA_CONFIG.searchPaths, searchType);\r\n\r\n  for (const path of paths) {\r\n    if ((path.cache && caching) || (!path.cache && !caching)) await walkFindImages(path, {}, found_images);\r\n  }\r\n\r\n  // ForgeVTT specific path handling\r\n  const userId = typeof ForgeAPI !== 'undefined' ? await ForgeAPI.getUserId() : '';\r\n  for (const uid in TVA_CONFIG.forgeSearchPaths) {\r\n    const apiKey = TVA_CONFIG.forgeSearchPaths[uid].apiKey;\r\n    const paths = _filterPathsByType(TVA_CONFIG.forgeSearchPaths[uid].paths, searchType);\r\n    if (uid === userId) {\r\n      for (const path of paths) {\r\n        if ((path.cache && caching) || (!path.cache && !caching)) await walkFindImages(path, {}, found_images);\r\n      }\r\n    } else if (apiKey) {\r\n      for (const path of paths) {\r\n        if ((path.cache && caching) || (!path.cache && !caching)) {\r\n          if (path.share) await walkFindImages(path, { apiKey: apiKey }, found_images);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return found_images;\r\n}\r\n\r\nfunction _filterPathsByType(paths, searchType) {\r\n  if (!searchType) return paths;\r\n  return paths.filter((p) => p.types.includes(searchType));\r\n}\r\n\r\nexport async function findImagesFuzzy(name, searchType, searchOptions, forceSearchName = false) {\r\n  if (TVA_CONFIG.debug)\r\n    console.info('TVA | STARTING: Fuzzy Image Search', name, searchType, searchOptions, forceSearchName);\r\n\r\n  const filters = getFilters(searchType, searchOptions.searchFilters);\r\n\r\n  const fuse = new Fuse([], {\r\n    keys: [!forceSearchName && searchOptions.runSearchOnPath ? 'path' : 'name', 'tags'],\r\n    includeScore: true,\r\n    includeMatches: true,\r\n    minMatchCharLength: 1,\r\n    ignoreLocation: true,\r\n    threshold: searchOptions.algorithm.fuzzyThreshold,\r\n  });\r\n\r\n  const found_images = await walkAllPaths(searchType);\r\n\r\n  for (const container of [CACHED_IMAGES, found_images]) {\r\n    for (const typeKey in container) {\r\n      const types = typeKey.split(',');\r\n      if (types.includes(searchType)) {\r\n        for (const imgObj of container[typeKey]) {\r\n          if (_imagePassesFilter(imgObj.name, imgObj.path, filters, searchOptions.runSearchOnPath)) {\r\n            fuse.add(imgObj);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  let results;\r\n  if (name === '') {\r\n    results = fuse.getIndex().docs.slice(0, searchOptions.algorithm.fuzzyLimit);\r\n  } else {\r\n    results = fuse.search(name).slice(0, searchOptions.algorithm.fuzzyLimit);\r\n    results = results.map((r) => {\r\n      r.item.indices = r.matches[0].indices;\r\n      r.item.score = r.score;\r\n      return r.item;\r\n    });\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Fuzzy Image Search', results);\r\n\r\n  return results;\r\n}\r\n\r\nasync function findImagesExact(name, searchType, searchOptions) {\r\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Exact Image Search', name, searchType, searchOptions);\r\n\r\n  const found_images = await walkAllPaths(searchType);\r\n\r\n  const simpleName = simplifyName(name);\r\n  const filters = getFilters(searchType, searchOptions.searchFilters);\r\n\r\n  const matchedImages = [];\r\n\r\n  for (const container of [CACHED_IMAGES, found_images]) {\r\n    for (const typeKey in container) {\r\n      const types = typeKey.split(',');\r\n      if (types.includes(searchType)) {\r\n        for (const imgOBj of container[typeKey]) {\r\n          if (_exactSearchMatchesImage(simpleName, imgOBj.path, imgOBj.name, filters, searchOptions.runSearchOnPath)) {\r\n            matchedImages.push(imgOBj);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Exact Image Search', matchedImages);\r\n  return matchedImages;\r\n}\r\n\r\nasync function findImages(name, searchType = '', searchOptions = {}) {\r\n  const sOptions = foundry.utils.mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\r\n  if (sOptions.algorithm.exact) {\r\n    return await findImagesExact(name, searchType, sOptions);\r\n  } else {\r\n    return await findImagesFuzzy(name, searchType, sOptions);\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if image path and name match the provided search text and filters\r\n * @param imagePath image path\r\n * @param imageName image name\r\n * @param filters filters to be applied\r\n * @returns true|false\r\n */\r\nfunction _exactSearchMatchesImage(simplifiedSearch, imagePath, imageName, filters, runSearchOnPath) {\r\n  // Is the search text contained in the name/path\r\n  const simplified = runSearchOnPath ? simplifyPath(imagePath) : simplifyName(imageName);\r\n  if (!simplified.includes(simplifiedSearch)) {\r\n    return false;\r\n  }\r\n\r\n  if (!filters) return true;\r\n  return _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath);\r\n}\r\n\r\nfunction _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath) {\r\n  // Filters are applied to path depending on the 'runSearchOnPath' setting, and actual or custom rolltable name\r\n  let text;\r\n  if (runSearchOnPath) {\r\n    text = decodeURIComponentSafely(imagePath);\r\n  } else if (getFileName(imagePath) === imageName) {\r\n    text = getFileNameWithExt(imagePath);\r\n  } else {\r\n    text = imageName;\r\n  }\r\n\r\n  if (filters.regex) {\r\n    return filters.regex.test(text);\r\n  }\r\n  if (filters.include) {\r\n    if (!text.includes(filters.include)) return false;\r\n  }\r\n  if (filters.exclude) {\r\n    if (text.includes(filters.exclude)) return false;\r\n  }\r\n  return true;\r\n}\r\n\r\n// ===================================\r\n// ==== CACHING RELATED FUNCTIONS ====\r\n// ===================================\r\n\r\nexport async function saveCache(cacheFile) {\r\n  const data = {};\r\n\r\n  const caches = Object.keys(CACHED_IMAGES);\r\n  for (const c of caches) {\r\n    if (!(c in data)) data[c] = [];\r\n    for (const img of CACHED_IMAGES[c]) {\r\n      if (img.tags) {\r\n        data[c].push([img.path, img.name, img.tags]);\r\n      } else if (getFileName(img.path) === img.name) {\r\n        data[c].push(img.path);\r\n      } else {\r\n        data[c].push([img.path, img.name]);\r\n      }\r\n    }\r\n  }\r\n\r\n  let file = new File([JSON.stringify(data)], getFileNameWithExt(cacheFile), {\r\n    type: 'text/plain',\r\n  });\r\n  foundry.applications.apps.FilePicker.implementation.upload('data', getFilePath(cacheFile), file);\r\n}\r\n\r\n/**\r\n * Search for and cache all the found token art\r\n */\r\nexport async function cacheImages({\r\n  staticCache = TVA_CONFIG.staticCache,\r\n  staticCacheFile = TVA_CONFIG.staticCacheFile,\r\n} = {}) {\r\n  if (caching) return;\r\n  caching = true;\r\n\r\n  if (!isInitialized() && staticCache) {\r\n    if (await _readCacheFromFile(staticCacheFile)) {\r\n      caching = false;\r\n      return;\r\n    }\r\n  }\r\n\r\n  if (!TVA_CONFIG.disableNotifs)\r\n    ui.notifications.info(game.i18n.format('token-variants.notifications.info.caching-started'));\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Token Caching');\r\n  const found_images = await walkAllPaths();\r\n  CACHED_IMAGES = found_images;\r\n\r\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Token Caching');\r\n\r\n  caching = false;\r\n  if (!TVA_CONFIG.disableNotifs)\r\n    ui.notifications.info(\r\n      game.i18n.format('token-variants.notifications.info.caching-finished', {\r\n        imageCount: Object.keys(CACHED_IMAGES).reduce((count, types) => count + CACHED_IMAGES[types].length, 0),\r\n      })\r\n    );\r\n\r\n  if (staticCache && game.user.isGM) {\r\n    saveCache(staticCacheFile);\r\n  }\r\n}\r\n\r\nasync function _readCacheFromFile(fileName) {\r\n  CACHED_IMAGES = {};\r\n  try {\r\n    await jQuery.getJSON(fileName, (json) => {\r\n      for (let category in json) {\r\n        CACHED_IMAGES[category] = [];\r\n\r\n        for (const img of json[category]) {\r\n          if (Array.isArray(img)) {\r\n            if (img.length === 3) {\r\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1], tags: img[2] });\r\n            } else {\r\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1] });\r\n            }\r\n          } else {\r\n            CACHED_IMAGES[category].push({ path: img, name: getFileName(img) });\r\n          }\r\n        }\r\n      }\r\n      if (!TVA_CONFIG.disableNotifs)\r\n        ui.notifications.info(\r\n          `Token Variant Art: Using Static Cache (${Object.keys(CACHED_IMAGES).reduce(\r\n            (count, c) => count + CACHED_IMAGES[c].length,\r\n            0\r\n          )} images)`\r\n        );\r\n    });\r\n  } catch (error) {\r\n    ui.notifications.warn(`Token Variant Art: Static Cache not found`);\r\n    CACHED_IMAGES = {};\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\r\nimport { showPathSelectCategoryDialog, showPathSelectConfigForm } from './dialogs.js';\r\n\r\nexport class ForgeSearchPaths extends FormApplication {\r\n  constructor() {\r\n    super({}, {});\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-search-paths',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/forgeSearchPaths.html',\r\n      resizable: true,\r\n      minimizable: false,\r\n      closeOnSubmit: false,\r\n      title: game.i18n.localize('token-variants.settings.search-paths.Name'),\r\n      width: 592,\r\n      height: 'auto',\r\n      scrollY: ['ol.token-variant-table'],\r\n      dragDrop: [{ dragSelector: null, dropSelector: null }],\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    if (!this.object.paths) this.object.paths = await this._getPaths();\r\n\r\n    const paths = this.object.paths.map((path) => {\r\n      const r = {};\r\n      r.text = path.text;\r\n      r.cache = path.cache;\r\n      r.share = path.share;\r\n      r.types = path.types.join(',');\r\n      r.config = JSON.stringify(path.config ?? {});\r\n      return r;\r\n    });\r\n\r\n    const data = super.getData(options);\r\n    data.paths = paths;\r\n    data.apiKey = this.apiKey;\r\n    return data;\r\n  }\r\n\r\n  async _getPaths() {\r\n    const forgePaths = foundry.utils.deepClone(TVA_CONFIG.forgeSearchPaths) || {};\r\n    this.userId = typeof ForgeAPI !== 'undefined' ? await ForgeAPI.getUserId() : 'tempUser'; // TODO\r\n    this.apiKey = forgePaths[this.userId]?.apiKey;\r\n    return forgePaths[this.userId]?.paths || [];\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('a.create-path').click(this._onCreatePath.bind(this));\r\n    $(html).on('click', 'a.select-category', showPathSelectCategoryDialog.bind(this));\r\n    $(html).on('click', 'a.select-config', showPathSelectConfigForm.bind(this));\r\n    html.find('a.delete-path').click(this._onDeletePath.bind(this));\r\n    html.find('button.reset').click(this._onReset.bind(this));\r\n    html.find('button.update').click(this._onUpdate.bind(this));\r\n    $(html).on('click', '.path-image.source-icon a', this._onBrowseFolder.bind(this));\r\n  }\r\n\r\n  /**\r\n   * Open a FilePicker so the user can select a local folder to use as an image source\r\n   */\r\n  async _onBrowseFolder(event) {\r\n    const pathInput = $(event.target).closest('.table-row').find('.path-text input');\r\n\r\n    new foundry.applications.apps.FilePicker.implementation({\r\n      type: 'folder',\r\n      activeSource: 'forgevtt',\r\n      current: pathInput.val(),\r\n      callback: (path, fp) => {\r\n        if (fp.activeSource !== 'forgevtt') {\r\n          ui.notifications.warn(\"Token Variant Art: Only 'Assets Library' paths are supported\");\r\n        } else {\r\n          pathInput.val(fp.result.target);\r\n        }\r\n      },\r\n    }).render(true);\r\n  }\r\n\r\n  async _onCreatePath(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n\r\n    this.object.paths.push({\r\n      text: '',\r\n      cache: true,\r\n      share: true,\r\n      types: ['Portrait', 'Token', 'PortraitAndToken'],\r\n    });\r\n    this.render();\r\n  }\r\n\r\n  async _onDeletePath(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n\r\n    const li = event.currentTarget.closest('.table-row');\r\n    this.object.paths.splice(li.dataset.index, 1);\r\n    this.render();\r\n  }\r\n\r\n  _onReset(event) {\r\n    event.preventDefault();\r\n    this.object.paths = this._getPaths();\r\n    this.render();\r\n  }\r\n\r\n  async _onUpdate(event) {\r\n    event.preventDefault();\r\n    await this._onSubmit(event);\r\n    this._updatePaths();\r\n  }\r\n\r\n  async _updateObject(event, formData) {\r\n    const expanded = foundry.utils.expandObject(formData);\r\n    expanded.paths = expanded.hasOwnProperty('paths') ? Object.values(expanded.paths) : [];\r\n    expanded.paths.forEach((path, index) => {\r\n      this.object.paths[index] = {\r\n        text: path.text,\r\n        cache: path.cache,\r\n        share: path.share,\r\n        source: path.source,\r\n        types: path.types.split(','),\r\n      };\r\n      if (path.config) {\r\n        try {\r\n          path.config = JSON.parse(path.config);\r\n          if (!foundry.utils.isEmpty(path.config)) {\r\n            this.object.paths[index].config = path.config;\r\n          }\r\n        } catch (e) {}\r\n      }\r\n    });\r\n    this.apiKey = expanded.apiKey;\r\n  }\r\n\r\n  _cleanPaths() {\r\n    // Cleanup empty and duplicate paths\r\n    let uniquePaths = new Set();\r\n    let paths = this.object.paths.filter((path) => {\r\n      if (!path.text || uniquePaths.has(path.text)) return false;\r\n      uniquePaths.add(path.text);\r\n      return true;\r\n    });\r\n    return paths;\r\n  }\r\n\r\n  _updatePaths() {\r\n    if (this.userId) {\r\n      const forgePaths = foundry.utils.deepClone(TVA_CONFIG.forgeSearchPaths) || {};\r\n      forgePaths[this.userId] = {\r\n        paths: this._cleanPaths(),\r\n        apiKey: this.apiKey,\r\n      };\r\n\r\n      if (game.user.isGM) {\r\n        updateSettings({ forgeSearchPaths: forgePaths });\r\n      } else {\r\n        // Workaround for forgeSearchPaths setting to be updated by non-GM clients\r\n        const message = {\r\n          handlerName: 'forgeSearchPaths',\r\n          args: forgePaths,\r\n          type: 'UPDATE',\r\n        };\r\n        game.socket?.emit('module.token-variants', message);\r\n      }\r\n    }\r\n  }\r\n\r\n  async close(options = {}) {\r\n    await this._onSubmit(event);\r\n    this._updatePaths();\r\n    return super.close(options);\r\n  }\r\n}\r\n","import { TVA_CONFIG } from '../scripts/settings.js';\r\n\r\nexport default class TokenHUDClientSettings extends FormApplication {\r\n  constructor() {\r\n    super({}, { title: `Token HUD Settings` });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-hud-settings',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/tokenHUDClientSettings.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: '',\r\n      width: 500,\r\n    });\r\n  }\r\n\r\n  async getData(options) {\r\n    const data = super.getData(options);\r\n    return foundry.utils.mergeObject(data, TVA_CONFIG.hud);\r\n  }\r\n\r\n  /**\r\n   * @param {Event} event\r\n   * @param {Object} formData\r\n   */\r\n  async _updateObject(event, formData) {\r\n    game.settings.set('token-variants', 'hudSettings', foundry.utils.mergeObject(TVA_CONFIG.hud, formData));\r\n  }\r\n}\r\n","import { importSettingsFromJSON, exportSettingsToJSON } from '../scripts/settings.js';\r\n\r\nexport default class ImportExport extends FormApplication {\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      id: 'token-variants-import-export',\r\n      classes: ['sheet'],\r\n      template: 'modules/token-variants/templates/importExport.html',\r\n      resizable: false,\r\n      minimizable: false,\r\n      title: 'Import/Export',\r\n      width: 250,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {JQuery} html\r\n   */\r\n  activateListeners(html) {\r\n    super.activateListeners(html);\r\n    html.find('.import').click(this._importFromJSONDialog.bind(this));\r\n    html.find('.export').click(() => {\r\n      exportSettingsToJSON();\r\n      this.close();\r\n    });\r\n  }\r\n\r\n  async _importFromJSONDialog() {\r\n    const content = await foundry.applications.handlebars.renderTemplate('templates/apps/import-data.html', {\r\n      entity: 'token-variants',\r\n      name: 'settings',\r\n    });\r\n    let dialog = new Promise((resolve, reject) => {\r\n      new Dialog(\r\n        {\r\n          title: game.i18n.localize('token-variants.settings.import-export.window.import-dialog'),\r\n          content: content,\r\n          buttons: {\r\n            import: {\r\n              icon: '<i class=\"fas fa-file-import\"></i>',\r\n              label: game.i18n.localize('token-variants.common.import'),\r\n              callback: (html) => {\r\n                const form = html.find('form')[0];\r\n                if (!form.data.files.length) return ui.notifications?.error('You did not upload a data file!');\r\n                readTextFromFile(form.data.files[0]).then((json) => {\r\n                  importSettingsFromJSON(json);\r\n                  resolve(true);\r\n                });\r\n              },\r\n            },\r\n            no: {\r\n              icon: '<i class=\"fas fa-times\"></i>',\r\n              label: 'Cancel',\r\n              callback: (html) => resolve(false),\r\n            },\r\n          },\r\n          default: 'import',\r\n        },\r\n        {\r\n          width: 400,\r\n        }\r\n      ).render(true);\r\n    });\r\n    this.close();\r\n    return await dialog;\r\n  }\r\n}\r\n","import { BASE_IMAGE_CATEGORIES, userRequiresImageCache, waitForTokenTexture } from './utils.js';\r\nimport { ForgeSearchPaths } from '../applications/forgeSearchPaths.js';\r\nimport TokenHUDClientSettings from '../applications/tokenHUDClientSettings.js';\r\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\r\nimport ImportExport from '../applications/importExport.js';\r\nimport ConfigureSettings from '../applications/configureSettings.js';\r\nimport { cacheImages, saveCache } from './search.js';\r\nimport { registerAllHooks } from './hooks/hooks.js';\r\nimport { registerAllWrappers } from './wrappers/wrappers.js';\r\n\r\nexport const TVA_CONFIG = {\r\n  debug: false,\r\n  disableNotifs: false,\r\n  searchPaths: [\r\n    {\r\n      text: 'modules/caeora-maps-tokens-assets/assets/tokens',\r\n      cache: true,\r\n      source: typeof ForgeAPI === 'undefined' ? 'data' : 'forge-bazaar',\r\n      types: ['Portrait', 'Token', 'PortraitAndToken'],\r\n    },\r\n  ],\r\n  forgeSearchPaths: {},\r\n  worldHud: {\r\n    displayOnlySharedImages: false,\r\n    disableIfTHWEnabled: false,\r\n    includeKeywords: false,\r\n    updateActorImage: false,\r\n    useNameSimilarity: false,\r\n    includeWildcard: true,\r\n    showFullPath: false,\r\n    animate: true,\r\n  },\r\n  hud: {\r\n    enableSideMenu: true,\r\n    imageOpacity: 50,\r\n  },\r\n  keywordSearch: true,\r\n  excludedKeywords: 'and,for',\r\n  runSearchOnPath: false,\r\n  searchFilters: {},\r\n  algorithm: {\r\n    exact: false,\r\n    fuzzy: true,\r\n    fuzzyLimit: 100,\r\n    fuzzyThreshold: 0.3,\r\n    fuzzyArtSelectPercentSlider: true,\r\n  },\r\n  tokenConfigs: [],\r\n  randomizer: {\r\n    actorCreate: false,\r\n    tokenCreate: false,\r\n    tokenCopyPaste: false,\r\n    tokenName: true,\r\n    keywords: false,\r\n    shared: false,\r\n    wildcard: false,\r\n    representedActorDisable: false,\r\n    linkedActorDisable: true,\r\n    popupOnDisable: false,\r\n    diffImages: false,\r\n    syncImages: false,\r\n    nonRepeat: false,\r\n  },\r\n  popup: {\r\n    disableAutoPopupOnActorCreate: true,\r\n    disableAutoPopupOnTokenCreate: true,\r\n    disableAutoPopupOnTokenCopyPaste: true,\r\n    twoPopups: false,\r\n    twoPopupsNoDialog: false,\r\n  },\r\n  imgurClientId: '',\r\n  stackStatusConfig: true,\r\n  mergeGroup: false,\r\n  staticCache: false,\r\n  staticCacheFile: 'modules/token-variants/token-variants-cache.json',\r\n  compendiumMapper: {\r\n    missingOnly: false,\r\n    diffImages: false,\r\n    showImages: true,\r\n    cache: false,\r\n    autoDisplayArtSelect: true,\r\n    syncImages: false,\r\n    overrideCategory: false,\r\n    category: 'Token',\r\n    missingImages: [{ document: 'all', image: CONST.DEFAULT_TOKEN }],\r\n    searchOptions: {},\r\n  },\r\n  permissions: {\r\n    popups: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    portrait_right_click: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    image_path_button: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    hud: {\r\n      1: true,\r\n      2: true,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    hudFullAccess: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n    statusConfig: {\r\n      1: false,\r\n      2: false,\r\n      3: true,\r\n      4: true,\r\n    },\r\n  },\r\n  globalMappings: [],\r\n  templateMappings: [],\r\n  customImageCategories: [],\r\n  displayEffectIconsOnHover: false,\r\n  disableEffectIcons: false,\r\n  filterEffectIcons: false,\r\n  filterCustomEffectIcons: true,\r\n  filterIconList: [],\r\n  updateTokenProto: false,\r\n  imgNameContainsDimensions: false,\r\n  imgNameContainsFADimensions: false,\r\n  playVideoOnHover: true,\r\n  pauseVideoOnHoverOut: false,\r\n  disableImageChangeOnPolymorphed: false,\r\n  disableImageUpdateOnNonPrototype: false,\r\n  disableTokenUpdateAnimation: false,\r\n  evaluateOverlayOnHover: true,\r\n  invisibleImage: '',\r\n  systemHpPath: '',\r\n  internalEffects: {\r\n    hpChange: { enabled: false, duration: null },\r\n  },\r\n  hideElevationTooltip: false,\r\n  hideTokenBorder: false,\r\n};\r\n\r\nexport const FEATURE_CONTROL = {\r\n  EffectMappings: true,\r\n  EffectIcons: true,\r\n  Overlays: true,\r\n  UserMappings: true,\r\n  Wildcards: true,\r\n  PopUpAndRandomize: true,\r\n  HUD: true,\r\n  HideElement: true,\r\n};\r\n\r\nexport function registerSettings() {\r\n  game.settings.register('token-variants', 'featureControl', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: FEATURE_CONTROL,\r\n    onChange: async (val) => {\r\n      foundry.utils.mergeObject(FEATURE_CONTROL, val);\r\n      registerAllHooks();\r\n      registerAllWrappers();\r\n    },\r\n  });\r\n  foundry.utils.mergeObject(FEATURE_CONTROL, game.settings.get('token-variants', 'featureControl'));\r\n\r\n  game.settings.registerMenu('token-variants', 'settings', {\r\n    name: 'Configure Settings',\r\n    hint: 'Configure Token Variant Art settings',\r\n    label: 'Settings',\r\n    scope: 'world',\r\n    icon: 'fas fa-cog',\r\n    type: ConfigureSettings,\r\n    restricted: true,\r\n  });\r\n\r\n  const systemHpPaths = {\r\n    'cyberpunk-red-core': 'derivedStats.hp',\r\n    lfg: 'health',\r\n    worldbuilding: 'health',\r\n    twodsix: 'hits',\r\n  };\r\n  TVA_CONFIG.systemHpPath = systemHpPaths[game.system.id] ?? 'attributes.hp';\r\n\r\n  game.settings.register('token-variants', 'effectMappingToggleGroups', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: { Default: true },\r\n  });\r\n\r\n  game.settings.register('token-variants', 'settings', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG,\r\n    onChange: async (val) => {\r\n      // Generate a diff, it will be required when doing post-processing of the modified settings\r\n      const diff = _arrayAwareDiffObject(TVA_CONFIG, val);\r\n\r\n      // Check image re-cache required due to permission changes\r\n      let requiresImageCache = false;\r\n      if ('permissions' in diff) {\r\n        if (!userRequiresImageCache(TVA_CONFIG.permissions) && userRequiresImageCache(val.permissions))\r\n          requiresImageCache = true;\r\n      }\r\n\r\n      // Update live settings\r\n      foundry.utils.mergeObject(TVA_CONFIG, val);\r\n\r\n      if (TVA_CONFIG.filterEffectIcons && ('filterCustomEffectIcons' in diff || 'filterIconList' in diff)) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.drawEffects();\r\n          });\r\n        }\r\n      }\r\n\r\n      // Check image re-cache required due to search path changes\r\n      if ('searchPaths' in diff || 'forgeSearchPaths' in diff) {\r\n        if (userRequiresImageCache(TVA_CONFIG.permissions)) requiresImageCache = true;\r\n      }\r\n\r\n      // Cache/re-cache images if necessary\r\n      if (requiresImageCache) {\r\n        await cacheImages();\r\n      }\r\n\r\n      if (diff.staticCache) {\r\n        const cacheFile = diff.staticCacheFile ? diff.staticCacheFile : TVA_CONFIG.staticCacheFile;\r\n        saveCache(cacheFile);\r\n      }\r\n\r\n      TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\r\n\r\n      registerAllHooks();\r\n      registerAllWrappers();\r\n\r\n      if ('displayEffectIconsOnHover' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.effects) tkn.effects.visible = !diff.displayEffectIconsOnHover;\r\n        }\r\n      }\r\n\r\n      if ('hideElevationTooltip' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.tooltip) tkn.tooltip.text = tkn._getTooltipText();\r\n        }\r\n      }\r\n\r\n      if ('hideTokenBorder' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          if (tkn.border) tkn.border.visible = !diff.hideTokenBorder;\r\n        }\r\n      }\r\n\r\n      if ('filterEffectIcons' in diff || 'disableEffectIcons' in diff) {\r\n        for (const tkn of canvas.tokens.placeables) {\r\n          tkn.drawEffects();\r\n        }\r\n      }\r\n    },\r\n  });\r\n\r\n  game.settings.register('token-variants', 'debug', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Boolean,\r\n    default: TVA_CONFIG.debug,\r\n    onChange: (val) => (TVA_CONFIG.debug = val),\r\n  });\r\n\r\n  if (typeof ForgeAPI !== 'undefined') {\r\n    game.settings.registerMenu('token-variants', 'forgeSearchPaths', {\r\n      name: game.i18n.localize('token-variants.settings.forge-search-paths.Name'),\r\n      hint: game.i18n.localize('token-variants.settings.forge-search-paths.Hint'),\r\n      icon: 'fas fa-search',\r\n      type: ForgeSearchPaths,\r\n      scope: 'client',\r\n      restricted: false,\r\n    });\r\n  }\r\n\r\n  game.settings.register('token-variants', 'tokenConfigs', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Array,\r\n    default: TVA_CONFIG.tokenConfigs,\r\n    onChange: (val) => (TVA_CONFIG.tokenConfigs = val),\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'tokenHUDSettings', {\r\n    name: game.i18n.localize('token-variants.settings.token-hud.Name'),\r\n    hint: game.i18n.localize('token-variants.settings.token-hud.Hint'),\r\n    scope: 'client',\r\n    icon: 'fas fa-images',\r\n    type: TokenHUDClientSettings,\r\n    restricted: false,\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'compendiumMapper', {\r\n    name: game.i18n.localize('token-variants.settings.compendium-mapper.Name'),\r\n    hint: game.i18n.localize('token-variants.settings.compendium-mapper.Hint'),\r\n    scope: 'world',\r\n    icon: 'fas fa-cogs',\r\n    type: CompendiumMapConfig,\r\n    restricted: true,\r\n  });\r\n\r\n  game.settings.register('token-variants', 'compendiumMapper', {\r\n    scope: 'world',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG.compendiumMapper,\r\n    onChange: (val) => (TVA_CONFIG.compendiumMapper = val),\r\n  });\r\n\r\n  game.settings.register('token-variants', 'hudSettings', {\r\n    scope: 'client',\r\n    config: false,\r\n    type: Object,\r\n    default: TVA_CONFIG.hud,\r\n    onChange: (val) => (TVA_CONFIG.hud = val),\r\n  });\r\n\r\n  game.settings.registerMenu('token-variants', 'importExport', {\r\n    name: `Import/Export`,\r\n    hint: game.i18n.localize('token-variants.settings.import-export.Hint'),\r\n    scope: 'world',\r\n    icon: 'fas fa-toolbox',\r\n    type: ImportExport,\r\n    restricted: true,\r\n  });\r\n\r\n  // Read settings\r\n  const settings = game.settings.get('token-variants', 'settings');\r\n  foundry.utils.mergeObject(TVA_CONFIG, settings);\r\n\r\n  if (foundry.utils.isEmpty(TVA_CONFIG.searchFilters)) {\r\n    BASE_IMAGE_CATEGORIES.forEach((cat) => {\r\n      TVA_CONFIG.searchFilters[cat] = {\r\n        include: '',\r\n        exclude: '',\r\n        regex: '',\r\n      };\r\n    });\r\n  }\r\n\r\n  for (let uid in TVA_CONFIG.forgeSearchPaths) {\r\n    TVA_CONFIG.forgeSearchPaths[uid].paths = TVA_CONFIG.forgeSearchPaths[uid].paths.map((p) => {\r\n      if (!p.source) {\r\n        p.source = 'forgevtt';\r\n      }\r\n      if (!p.types) {\r\n        if (p.tiles) p.types = ['Tile'];\r\n        else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\r\n      }\r\n      return p;\r\n    });\r\n  }\r\n\r\n  // 20/07/2023 Convert globalMappings to a new format\r\n  if (foundry.utils.getType(settings.globalMappings) === 'Object') {\r\n    Hooks.once('ready', () => {\r\n      TVA_CONFIG.globalMappings = migrateMappings(settings.globalMappings);\r\n      setTimeout(() => updateSettings({ globalMappings: TVA_CONFIG.globalMappings }), 10000);\r\n    });\r\n  }\r\n\r\n  // Read client settings\r\n  TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\r\n}\r\n\r\nexport function migrateMappings(mappings, globalMappings = []) {\r\n  if (!mappings) return [];\r\n  if (foundry.utils.getType(mappings) === 'Object') {\r\n    let nMappings = [];\r\n    for (const [effect, mapping] of Object.entries(mappings)) {\r\n      if (!mapping.label) mapping.label = effect.replaceAll('', '.');\r\n      if (!mapping.expression) mapping.expression = effect.replaceAll('', '.');\r\n      if (!mapping.id) mapping.id = foundry.utils.randomID(8);\r\n      delete mapping.effect;\r\n      if (mapping.overlayConfig) mapping.overlayConfig.id = mapping.id;\r\n      delete mapping.overlayConfig?.effect;\r\n      nMappings.push(mapping);\r\n    }\r\n    // Convert parents to parentIDs\r\n    let combMappings = nMappings.concat(globalMappings);\r\n    for (const mapping of nMappings) {\r\n      if (mapping.overlayConfig?.parent) {\r\n        if (mapping.overlayConfig.parent === 'Token (Placeable)') {\r\n          mapping.overlayConfig.parentID = 'TOKEN';\r\n        } else {\r\n          const parent = combMappings.find((m) => m.label === mapping.overlayConfig.parent);\r\n          if (parent) mapping.overlayConfig.parentID = parent.id;\r\n          else mapping.overlayConfig.parentID = '';\r\n        }\r\n        delete mapping.overlayConfig.parent;\r\n      }\r\n    }\r\n    mappings = nMappings;\r\n  }\r\n  // If overlay enabled but no image, text, or shape is being rendered, assume that imgSrs if available should be\r\n  // used as the image\r\n  for (const m of mappings) {\r\n    if (m.overlay && m.overlayConfig) {\r\n      if (m.imgSrc && !m.overlayConfig.img && !m.overlayConfig.text?.text && !m.overlayConfig.shapes?.length) {\r\n        m.overlayConfig.img = m.imgSrc;\r\n        m.imgSrc = '';\r\n        m.imgName = '';\r\n      }\r\n    }\r\n  }\r\n  return mappings;\r\n}\r\n\r\nexport function getFlagMappings(object) {\r\n  if (!object) return [];\r\n  let doc = object.document ?? object;\r\n  const actorId = doc.actor?.id;\r\n  if (actorId) {\r\n    doc = game.actors.get(actorId);\r\n    if (!doc) return [];\r\n  }\r\n\r\n  // 23/07/2023\r\n  let mappings = doc.getFlag('token-variants', 'effectMappings') ?? [];\r\n  if (foundry.utils.getType(mappings) === 'Object') {\r\n    mappings = migrateMappings(mappings, TVA_CONFIG.globalMappings);\r\n    doc.setFlag('token-variants', 'effectMappings', mappings);\r\n  }\r\n  return mappings;\r\n}\r\n\r\nexport function exportSettingsToJSON() {\r\n  const settings = foundry.utils.deepClone(TVA_CONFIG);\r\n  const filename = `token-variants-settings.json`;\r\n  saveDataToFile(JSON.stringify(settings, null, 2), 'text/json', filename);\r\n}\r\n\r\nexport async function importSettingsFromJSON(json) {\r\n  if (typeof json === 'string') json = JSON.parse(json);\r\n\r\n  if (json.forgeSearchPaths)\r\n    for (let uid in json.forgeSearchPaths) {\r\n      json.forgeSearchPaths[uid].paths = json.forgeSearchPaths[uid].paths.map((p) => {\r\n        if (!p.source) {\r\n          p.source = 'forgevtt';\r\n        }\r\n        if (!p.types) {\r\n          if (p.tiles) p.types = ['Tile'];\r\n          else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\r\n        }\r\n        return p;\r\n      });\r\n    }\r\n\r\n  // 09/07/2022 Convert filters to new format if old one is still in use\r\n  if (json.searchFilters && json.searchFilters.portraitFilterInclude != null) {\r\n    const filters = json.searchFilters;\r\n    json.searchFilters = {\r\n      Portrait: {\r\n        include: filters.portraitFilterInclude ?? '',\r\n        exclude: filters.portraitFilterExclude ?? '',\r\n        regex: filters.portraitFilterRegex ?? '',\r\n      },\r\n      Token: {\r\n        include: filters.tokenFilterInclude ?? '',\r\n        exclude: filters.tokenFilterExclude ?? '',\r\n        regex: filters.tokenFilterRegex ?? '',\r\n      },\r\n      PortraitAndToken: {\r\n        include: filters.generalFilterInclude ?? '',\r\n        exclude: filters.generalFilterExclude ?? '',\r\n        regex: filters.generalFilterRegex ?? '',\r\n      },\r\n    };\r\n    if (json.compendiumMapper) delete json.compendiumMapper.searchFilters;\r\n  }\r\n\r\n  // Global Mappings need special merge\r\n  if (json.globalMappings) {\r\n    const nMappings = migrateMappings(json.globalMappings);\r\n    for (const m of nMappings) {\r\n      const i = TVA_CONFIG.globalMappings.findIndex((mapping) => m.label === mapping.label);\r\n      if (i === -1) TVA_CONFIG.globalMappings.push(m);\r\n      else TVA_CONFIG.globalMappings[i] = m;\r\n    }\r\n    json.globalMappings = TVA_CONFIG.globalMappings;\r\n  }\r\n\r\n  updateSettings(json);\r\n}\r\n\r\nfunction _refreshFilters(filters, customCategories, updateTVAConfig = false) {\r\n  const categories = BASE_IMAGE_CATEGORIES.concat(customCategories ?? TVA_CONFIG.customImageCategories);\r\n  for (const filter in filters) {\r\n    if (!categories.includes(filter)) {\r\n      delete filters[filter];\r\n      if (updateTVAConfig) delete TVA_CONFIG.searchFilters[filter];\r\n    }\r\n  }\r\n  for (const category of customCategories) {\r\n    if (filters[category] == null) {\r\n      filters[category] = {\r\n        include: '',\r\n        exclude: '',\r\n        regex: '',\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport async function updateSettings(newSettings) {\r\n  const settings = foundry.utils.mergeObject(foundry.utils.deepClone(TVA_CONFIG), newSettings, { insertKeys: false });\r\n  // Custom image categories might have changed, meaning we may have filters that are no longer relevant\r\n  // or need to be added\r\n  if ('customImageCategories' in newSettings) {\r\n    _refreshFilters(settings.searchFilters, newSettings.customImageCategories, true);\r\n    if (settings.compendiumMapper?.searchOptions?.searchFilters != null) {\r\n      _refreshFilters(settings.compendiumMapper.searchOptions.searchFilters, newSettings.customImageCategories);\r\n      TVA_CONFIG.compendiumMapper.searchOptions.searchFilters = settings.compendiumMapper.searchOptions.searchFilters;\r\n    }\r\n  }\r\n  await game.settings.set('token-variants', 'settings', settings);\r\n}\r\n\r\nexport function _arrayAwareDiffObject(original, other, { inner = false } = {}) {\r\n  function _difference(v0, v1) {\r\n    let t0 = foundry.utils.getType(v0);\r\n    let t1 = foundry.utils.getType(v1);\r\n    if (t0 !== t1) return [true, v1];\r\n    if (t0 === 'Array') return [!_arrayEquality(v0, v1), v1];\r\n    if (t0 === 'Object') {\r\n      if (foundry.utils.isEmpty(v0) !== foundry.utils.isEmpty(v1)) return [true, v1];\r\n      let d = _arrayAwareDiffObject(v0, v1, { inner });\r\n      return [!foundry.utils.isEmpty(d), d];\r\n    }\r\n    return [v0 !== v1, v1];\r\n  }\r\n\r\n  // Recursively call the _difference function\r\n  return Object.keys(other).reduce((obj, key) => {\r\n    if (inner && !(key in original)) return obj;\r\n    let [isDifferent, difference] = _difference(original[key], other[key]);\r\n    if (isDifferent) obj[key] = difference;\r\n    return obj;\r\n  }, {});\r\n}\r\n\r\nfunction _arrayEquality(a1, a2) {\r\n  if (!(a2 instanceof Array) || a2.length !== a1.length) return false;\r\n  return a1.every((v, i) => {\r\n    if (foundry.utils.getType(v) === 'Object') return Object.keys(_arrayAwareDiffObject(v, a2[i])).length === 0;\r\n    return a2[i] === v;\r\n  });\r\n}\r\n\r\nexport function getSearchOptions() {\r\n  return {\r\n    keywordSearch: TVA_CONFIG.keywordSearch,\r\n    excludedKeywords: TVA_CONFIG.excludedKeywords,\r\n    runSearchOnPath: TVA_CONFIG.runSearchOnPath,\r\n    algorithm: TVA_CONFIG.algorithm,\r\n    searchFilters: TVA_CONFIG.searchFilters,\r\n  };\r\n}\r\n","export class HTMLOverlay {\r\n  static container = null;\r\n  static renderQueue = [];\r\n  static hudReady = false;\r\n\r\n  static hudRendered() {\r\n    HTMLOverlay.hudReady = true;\r\n    HTMLOverlay.renderQueue.forEach((ov) => ov.render());\r\n    HTMLOverlay.renderQueue = [];\r\n  }\r\n\r\n  constructor(overlayConfig, token) {\r\n    this.overlayConfig = overlayConfig;\r\n    this.token = token;\r\n    this.render();\r\n  }\r\n\r\n  render(overlayConfig = null, force = false) {\r\n    if (!HTMLOverlay.hudReady) {\r\n      HTMLOverlay.renderQueue.push(this);\r\n      return;\r\n    }\r\n\r\n    if (!HTMLOverlay.container) {\r\n      HTMLOverlay.container = $('<div id=\"tva-html-overlays\"></div>');\r\n      $('#hud').append(HTMLOverlay.container);\r\n    }\r\n\r\n    if (this.element) this.remove();\r\n    if (overlayConfig) this.overlayConfig = overlayConfig;\r\n\r\n    this.element = $(renderTemplate(this.overlayConfig, this.getData(), force));\r\n    HTMLOverlay.container.append(this.element);\r\n    this.activateListeners(this.element);\r\n    this.setPosition();\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) this.element.remove();\r\n    this.element = null;\r\n  }\r\n\r\n  getData(options = {}) {\r\n    const data = this.token.document.toObject();\r\n    return foundry.utils.mergeObject(data, {\r\n      isGM: game.user.isGM,\r\n    });\r\n  }\r\n\r\n  setPosition({ left, top, width, height, scale, angle, origin } = {}) {\r\n    if (!HTMLOverlay.hudReady) return;\r\n    const ratio = canvas.dimensions.size / 100;\r\n    const position = {\r\n      width: width || this.token.document.width * 100,\r\n      height: height || this.token.document.height * 100,\r\n      left: left ?? this.token.document.x,\r\n      top: top ?? this.token.document.y,\r\n    };\r\n    if (ratio !== 1) position.transform = `scale(${ratio})`;\r\n    this.element.css(position);\r\n    if (angle != null) {\r\n      this.element.css({ transform: 'rotate(' + angle + 'deg)' });\r\n    }\r\n    if (origin != null) {\r\n      this.element.css({ 'transform-origin': origin.x + 'px ' + origin.y + 'px' });\r\n    }\r\n  }\r\n\r\n  /** @override */\r\n  activateListeners(html) {\r\n    try {\r\n      eval(this.overlayConfig.html.listeners);\r\n    } catch (e) {}\r\n  }\r\n}\r\n\r\nconst _templateCache = {};\r\n\r\nfunction _compile(html, id) {\r\n  //      <style scoped>${html.style}</style>\r\n  return Handlebars.compile(\r\n    `<div class=\"tva-html-overlay overlay-${id}\">\r\n      <section class=\"window-content\">\r\n        <form>${html.template}</form>\r\n      </section>\r\n    </div>`\r\n  );\r\n}\r\n\r\nfunction constructTemplate(ovConfig, force = false) {\r\n  if (!_templateCache.hasOwnProperty(ovConfig.id)) {\r\n    const compiled = _compile(ovConfig.html, ovConfig.id);\r\n    Handlebars.registerPartial(ovConfig.id, compiled);\r\n    _templateCache[ovConfig.id] = compiled;\r\n  } else if (force) {\r\n    return _compile(ovConfig.html, ovConfig.id);\r\n  }\r\n  return _templateCache[ovConfig.id];\r\n}\r\n\r\nfunction renderTemplate(ovConfig, data, force = false) {\r\n  const template = constructTemplate(ovConfig, force);\r\n  return template(data || {}, {\r\n    allowProtoMethodsByDefault: true,\r\n    allowProtoPropertiesByDefault: true,\r\n  });\r\n}\r\n","import { FILTERS } from '../../applications/overlayConfig.js';\r\nimport { evaluateComparator, getTokenEffects } from '../hooks/effectMappingHooks.js';\r\nimport { registerOverlayRefreshHook, unregisterOverlayRefreshHooks } from '../hooks/overlayHooks.js';\r\nimport { DEFAULT_OVERLAY_CONFIG } from '../models.js';\r\nimport { interpolateColor, removeMarkedOverlays } from '../token/overlay.js';\r\nimport { executeMacro, toggleCEEffect, toggleTMFXPreset, tv_executeScript } from '../utils.js';\r\nimport { HTMLOverlay } from './HTMLOverlay.js';\r\n\r\nexport class TVAOverlay extends foundry.canvas.primary.PrimarySpriteMesh {\r\n  constructor(pTexture, token, config) {\r\n    super({ name: 'TVAOverlay', object: token });\r\n    if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\r\n\r\n    this.pseudoTexture = pTexture;\r\n    this.texture = pTexture.texture;\r\n    //this.setTexture(pTexture, { refresh: false });\r\n    this.occludedAlpha = 1; // Prevent overlay from fading when occluded\r\n\r\n    this.ready = false;\r\n    this.overlaySort = 0;\r\n    this.filtersApplied = false;\r\n\r\n    this.overlayConfig = foundry.utils.mergeObject(DEFAULT_OVERLAY_CONFIG, config, { inplace: false });\r\n    if (pTexture.html) this.addHTMLOverlay();\r\n\r\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\r\n    // Make sure we're using the latest fields\r\n    // 20/07/2023\r\n    if (!('linkDimensionsX' in this.overlayConfig) && this.overlayConfig.linkDimensions) {\r\n      this.overlayConfig.linkDimensionsX = true;\r\n      this.overlayConfig.linkDimensionsY = true;\r\n    }\r\n\r\n    this._registerHooks(this.overlayConfig);\r\n    this._tvaPlay().then(() => this.refresh());\r\n\r\n    // Workaround needed for v12 visible property\r\n    Object.defineProperty(this, 'visible', {\r\n      get: this._customVisible,\r\n      set: function () {},\r\n      configurable: true,\r\n    });\r\n\r\n    this.eventMode = 'none';\r\n  }\r\n\r\n  enableInteractivity() {\r\n    if (this.mouseInteractionManager && !this.overlayConfig.interactivity?.length) {\r\n      this.removeAllListeners();\r\n      this.mouseInteractionManager = null;\r\n      this.cursor = null;\r\n      this.eventMode = 'none';\r\n      return;\r\n    } else if (this.mouseInteractionManager || !this.overlayConfig.interactivity?.length) return;\r\n\r\n    if (!this.overlayConfig.ui) {\r\n      if (canvas.primary.eventMode === 'passive') {\r\n        canvas.primary.eventMode = 'passive';\r\n      }\r\n    }\r\n\r\n    this.eventMode = 'static';\r\n\r\n    // If this overlay iss interactable all of its parents need to be set as interactable too\r\n    let parent = this.parent;\r\n    while (parent instanceof TVAOverlay || parent?.parent instanceof TVAOverlay) {\r\n      parent.eventMode = 'passive';\r\n      parent = parent.parent;\r\n    }\r\n\r\n    this.cursor = 'pointer';\r\n    const token = this.object;\r\n    const sprite = this;\r\n\r\n    const runInteraction = function (event, listener) {\r\n      sprite.overlayConfig.interactivity.forEach((i) => {\r\n        if (i.listener === listener) {\r\n          event.preventDefault();\r\n          event.stopPropagation();\r\n          if (i.script) tv_executeScript(i.script, { token });\r\n          if (i.macro) executeMacro(i.macro, token);\r\n          if (i.ceEffect) toggleCEEffect(token, i.ceEffect);\r\n          if (i.tmfxPreset) toggleTMFXPreset(token, i.tmfxPreset);\r\n        }\r\n      });\r\n    };\r\n\r\n    const permissions = {\r\n      hoverIn: () => true,\r\n      hoverOut: () => true,\r\n      clickLeft: () => true,\r\n      clickLeft2: () => true,\r\n      clickRight: () => true,\r\n      clickRight2: () => true,\r\n      dragStart: () => false,\r\n    };\r\n\r\n    const callbacks = {\r\n      hoverIn: (event) => runInteraction(event, 'hoverIn'),\r\n      hoverOut: (event) => runInteraction(event, 'hoverOut'),\r\n      clickLeft: (event) => runInteraction(event, 'clickLeft'),\r\n      clickLeft2: (event) => runInteraction(event, 'clickLeft2'),\r\n      clickRight: (event) => runInteraction(event, 'clickRight'),\r\n      clickRight2: (event) => runInteraction(event, 'clickRight2'),\r\n      dragLeftStart: null,\r\n      dragLeftMove: null,\r\n      dragLeftDrop: null,\r\n      dragLeftCancel: null,\r\n      dragRightStart: null,\r\n      dragRightMove: null,\r\n      dragRightDrop: null,\r\n      dragRightCancel: null,\r\n      longPress: null,\r\n    };\r\n\r\n    const options = { target: null };\r\n\r\n    // Create the interaction manager\r\n    const mgr = new MouseInteractionManager(this, canvas.stage, permissions, callbacks, options);\r\n    this.mouseInteractionManager = mgr.activate();\r\n  }\r\n\r\n  /**\r\n   * Override\r\n   */\r\n  _onAdded() {\r\n    // do nothing\r\n    // foundry throws inconsequential errors within this method\r\n  }\r\n\r\n  _customVisible() {\r\n    const ov = this.overlayConfig;\r\n    if (!this.ready || !(this.object.visible || ov.alwaysVisible)) return false;\r\n\r\n    if (ov.limitedToOwner && !this.object.isOwner) return false;\r\n    if (ov.limitedUsers?.length && !ov.limitedUsers.includes(game.user.id)) return false;\r\n\r\n    if (ov.limitOnEffect || ov.limitOnProperty) {\r\n      const speaker = ChatMessage.getSpeaker();\r\n      let token = canvas.ready ? canvas.tokens.get(speaker.token) : null;\r\n      if (!token) return false;\r\n      if (ov.limitOnEffect) {\r\n        if (!getTokenEffects(token).includes(ov.limitOnEffect)) return false;\r\n      }\r\n      if (ov.limitOnProperty) {\r\n        if (!evaluateComparator(token.document, ov.limitOnProperty)) return false;\r\n      }\r\n    }\r\n\r\n    if (this.object.detectionLevel === 1) return Boolean(ov.impreciseVisible);\r\n\r\n    if (\r\n      ov.limitOnHover ||\r\n      ov.limitOnControl ||\r\n      ov.limitOnHighlight ||\r\n      ov.limitOnHUD ||\r\n      ov.limitOnTarget ||\r\n      ov.limitOnAnyTarget\r\n    ) {\r\n      if (ov.limitOnHover && canvas.controls.ruler._state === Ruler.STATES.INACTIVE && this.object.hover) return true;\r\n      if (ov.limitOnControl && this.object.controlled) return true;\r\n      if (ov.limitOnHighlight && (canvas.tokens.highlightObjects ?? canvas.tokens._highlight)) return true;\r\n      if (ov.limitOnHUD && this.object.hasActiveHUD) return true;\r\n      if (ov.limitOnAnyTarget && this.object.targeted.size) return true;\r\n      if (ov.limitOnTarget && this.object.targeted.some((u) => u.id === game.userId)) return true;\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  get sortLayer() {\r\n    return this.object.mesh?.sortLayer || 0;\r\n  }\r\n\r\n  get zIndex() {\r\n    let zIndex = this.object.mesh.zIndex;\r\n    if (this.overlayConfig.ui && this.overlayConfig.bottom) zIndex -= 9999;\r\n    return zIndex;\r\n  }\r\n\r\n  // Overlays have the same sort order as the parent\r\n  get sort() {\r\n    const sort = this.object.mesh.sort;\r\n    if (this.overlayConfig.top) return sort + 9999;\r\n    else if (this.overlayConfig.bottom) return sort - 9999;\r\n    return sort;\r\n  }\r\n\r\n  get _lastSortedIndex() {\r\n    return (this.object.mesh._lastSortedIndex || 0) + this.overlaySort;\r\n  }\r\n\r\n  get elevation() {\r\n    const elevation = this.object.mesh?.elevation;\r\n    if (this.overlayConfig.bottom && elevation > 0) return 0;\r\n    else if (this.overlayConfig.top) return elevation + 9999;\r\n    return elevation;\r\n  }\r\n\r\n  set _lastSortedIndex(val) {}\r\n\r\n  async _tvaPlay() {\r\n    // Ensure playback state for video\r\n    const source = this.texture?.baseTexture?.resource?.source;\r\n    if (source?.tagName === 'VIDEO') {\r\n      // Detach video from others\r\n      const s = source.cloneNode(true);\r\n      if (this.overlayConfig.playOnce) {\r\n        s.onended = () => {\r\n          this.alpha = 0;\r\n          this.tvaVideoEnded = true;\r\n        };\r\n      }\r\n\r\n      await new Promise((resolve) => (s.oncanplay = resolve));\r\n      this.texture = PIXI.Texture.from(s, { resourceOptions: { autoPlay: false } });\r\n\r\n      const options = {\r\n        loop: this.overlayConfig.loop && !this.overlayConfig.playOnce,\r\n        volume: 0,\r\n        offset: 0,\r\n        playing: true,\r\n      };\r\n      game.video.play(s, options);\r\n    }\r\n  }\r\n\r\n  addChildAuto(...children) {\r\n    if (this.pseudoTexture?.shapes) {\r\n      return this.pseudoTexture.shapes.addChild(...children);\r\n    } else {\r\n      return this.addChild(...children);\r\n    }\r\n  }\r\n\r\n  setTexture(pTexture, { preview = false, refresh = true, configuration = null, refreshFilters = false } = {}) {\r\n    // Text preview handling\r\n    if (preview) {\r\n      this._swapChildren(pTexture);\r\n      if (this.originalTexture) this._destroyTexture();\r\n      else {\r\n        this.originalTexture = this.pseudoTexture;\r\n        if (this.originalTexture.shapes) this.removeChild(this.originalTexture.shapes);\r\n      }\r\n      this.pseudoTexture = pTexture;\r\n      this.texture = pTexture.texture;\r\n      if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\r\n    } else if (this.originalTexture) {\r\n      this._swapChildren(this.originalTexture);\r\n      this._destroyTexture();\r\n      this.pseudoTexture = this.originalTexture;\r\n      this.texture = this.originalTexture.texture;\r\n      if (this.originalTexture.shapes) this.pseudoTexture.shapes = this.addChild(this.originalTexture.shapes);\r\n      delete this.originalTexture;\r\n    } else {\r\n      this._swapChildren(pTexture);\r\n      this._destroyTexture();\r\n      this.pseudoTexture = pTexture;\r\n      this.texture = pTexture.texture;\r\n      if (pTexture.shapes) this.pseudoTexture.shapes = this.addChild(pTexture.shapes);\r\n    }\r\n\r\n    if (this.pseudoTexture.html) this.addHTMLOverlay();\r\n    if (refresh) this.refresh(configuration, { fullRefresh: !preview, refreshFilters });\r\n  }\r\n\r\n  refresh(configuration, { preview = false, fullRefresh = true, previewTexture = null, refreshFilters = false } = {}) {\r\n    if (!this.overlayConfig || !this.texture) return;\r\n\r\n    // Text preview handling\r\n    if (previewTexture || this.originalTexture) {\r\n      this.setTexture(previewTexture, { preview: Boolean(previewTexture), refresh: false });\r\n    }\r\n\r\n    // Register/Unregister hooks that should refresh this overlay\r\n    if (configuration) {\r\n      this._registerHooks(configuration);\r\n    }\r\n\r\n    const config = foundry.utils.mergeObject(this.overlayConfig, configuration ?? {}, { inplace: !preview });\r\n\r\n    if (preview && this.htmlOverlay) this.htmlOverlay.render(config, true);\r\n\r\n    this.enableInteractivity(config);\r\n\r\n    if (fullRefresh) {\r\n      const source = foundry.utils.getProperty(this.texture, 'baseTexture.resource.source');\r\n      if (source && source.tagName === 'VIDEO') {\r\n        if (!source.loop && config.loop) {\r\n          game.video.play(source);\r\n        } else if (source.loop && !config.loop) {\r\n          game.video.stop(source);\r\n        }\r\n        source.loop = config.loop;\r\n      }\r\n    }\r\n\r\n    const shapes = this.pseudoTexture.shapes;\r\n\r\n    // Scale the image using the same logic as the token\r\n    const dimensions = shapes ?? this.texture;\r\n    if (config.linkScale && !config.parentID) {\r\n      const scale = this.scale;\r\n      const aspect = dimensions.width / dimensions.height;\r\n      if (aspect >= 1) {\r\n        scale.x = (this.object.w * Math.abs(this.object.document.texture.scaleX)) / dimensions.width;\r\n        scale.y = Number(scale.x);\r\n      } else {\r\n        scale.y = (this.object.h * Math.abs(this.object.document.texture.scaleY)) / dimensions.height;\r\n        scale.x = Number(scale.y);\r\n      }\r\n    } else if (config.linkStageScale) {\r\n      this.scale.x = 1 / canvas.stage.scale.x;\r\n      this.scale.y = 1 / canvas.stage.scale.y;\r\n    } else if (config.linkDimensionsX || config.linkDimensionsY) {\r\n      if (config.linkDimensionsX) {\r\n        this.scale.x = this.object.document.width;\r\n      }\r\n      if (config.linkDimensionsY) {\r\n        this.scale.y = this.object.document.height;\r\n      }\r\n    } else {\r\n      this.scale.x = config.width ? config.width / dimensions.width : 1;\r\n      this.scale.y = config.height ? config.height / dimensions.height : 1;\r\n    }\r\n\r\n    // Adjust scale according to config\r\n    this.scale.x = this.scale.x * config.scaleX;\r\n    this.scale.y = this.scale.y * config.scaleY;\r\n\r\n    // Check if mirroring should be inherited from the token and if so apply it\r\n    if (config.linkMirror && !config.parentID) {\r\n      this.scale.x = Math.abs(this.scale.x) * (this.object.document.texture.scaleX < 0 ? -1 : 1);\r\n      this.scale.y = Math.abs(this.scale.y) * (this.object.document.texture.scaleY < 0 ? -1 : 1);\r\n    }\r\n\r\n    if (this.anchor) {\r\n      if (!config.anchor) this.anchor.set(0.5, 0.5);\r\n      else this.anchor.set(config.anchor.x, config.anchor.y);\r\n    }\r\n\r\n    let xOff = 0;\r\n    let yOff = 0;\r\n    if (shapes) {\r\n      shapes.position.x = -this.anchor.x * shapes.width;\r\n      shapes.position.y = -this.anchor.y * shapes.height;\r\n      if (config.animation.relative) {\r\n        this.pivot.set(0, 0);\r\n        shapes.pivot.set((0.5 - this.anchor.x) * shapes.width, (0.5 - this.anchor.y) * shapes.height);\r\n        xOff = shapes.pivot.x * this.scale.x;\r\n        yOff = shapes.pivot.y * this.scale.y;\r\n      }\r\n    } else if (config.animation.relative) {\r\n      xOff = (0.5 - this.anchor.x) * this.width;\r\n      yOff = (0.5 - this.anchor.y) * this.height;\r\n      this.pivot.set((0.5 - this.anchor.x) * this.texture.width, (0.5 - this.anchor.y) * this.texture.height);\r\n    }\r\n\r\n    // Position\r\n    const pOffsetX = config.pOffsetX || 0;\r\n    const pOffsetY = config.pOffsetY || 0;\r\n    if (config.parentID) {\r\n      const anchor = this.parent.anchor ?? { x: 0, y: 0 };\r\n      const pWidth = (this.parent.shapesWidth ?? this.parent.width) / this.parent.scale.x;\r\n      const pHeight = (this.parent.shapesHeight ?? this.parent.height) / this.parent.scale.y;\r\n      this.position.set(\r\n        pOffsetX + -config.offsetX * pWidth - anchor.x * pWidth + pWidth / 2,\r\n        pOffsetY + -config.offsetY * pHeight - anchor.y * pHeight + pHeight / 2\r\n      );\r\n    } else {\r\n      if (config.animation.relative) {\r\n        this.position.set(\r\n          this.object.document.x + this.object.w / 2 + pOffsetX + -config.offsetX * this.object.w + xOff,\r\n          this.object.document.y + this.object.h / 2 + pOffsetY + -config.offsetY * this.object.h + yOff\r\n        );\r\n      } else {\r\n        this.position.set(this.object.document.x + this.object.w / 2, this.object.document.y + this.object.h / 2);\r\n        this.pivot.set(\r\n          -pOffsetX / this.scale.x + (config.offsetX * this.object.w) / this.scale.x,\r\n          -pOffsetY / this.scale.y + (config.offsetY * this.object.h) / this.scale.y\r\n        );\r\n      }\r\n    }\r\n\r\n    // Set alpha but only if playOnce is disabled and the video hasn't\r\n    // finished playing yet. Otherwise we want to keep alpha as 0 to keep the video hidden\r\n    if (!this.tvaVideoEnded) {\r\n      this.alpha = config.linkOpacity ? this.object.document.alpha : config.alpha;\r\n    }\r\n\r\n    // Angle in degrees\r\n    if (fullRefresh) {\r\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\r\n      else this.angle = config.angle;\r\n    } else if (!config.animation.rotate) {\r\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\r\n    }\r\n\r\n    // Apply color tinting\r\n    const tint = config.inheritTint\r\n      ? this.object.document.texture.tint\r\n      : interpolateColor(config.tint, config.interpolateColor, true);\r\n    this.tint = tint ? Color.from(tint) : 0xffffff;\r\n    if (shapes) {\r\n      shapes.tint = this.tint;\r\n      shapes.alpha = this.alpha;\r\n    }\r\n\r\n    if (fullRefresh) {\r\n      if (config.animation.rotate) {\r\n        this.animate(config);\r\n      } else {\r\n        this.stopAnimation();\r\n      }\r\n    }\r\n\r\n    // Apply filters\r\n    if (fullRefresh && (refreshFilters || !this.filtersApplied)) this._applyFilters(config);\r\n    //if (fullRefresh) this.filters = this._getFilters(config);\r\n\r\n    if (preview && this.children) {\r\n      this.children.forEach((ch) => {\r\n        if (ch instanceof TVAOverlay) ch.refresh(null, { preview: true });\r\n      });\r\n    }\r\n\r\n    if (this.htmlOverlay) {\r\n      this.htmlOverlay.setPosition({\r\n        left: this.x - this.pivot.x * this.scale.x - this.width * this.anchor.x,\r\n        top: this.y - this.pivot.y * this.scale.y - this.height * this.anchor.y,\r\n        width: this.width,\r\n        height: this.height,\r\n        angle: this.angle,\r\n      });\r\n    }\r\n\r\n    this.ready = true;\r\n  }\r\n\r\n  _activateTicker() {\r\n    this._deactivateTicker();\r\n    canvas.app.ticker.add(this.updatePosition, this, PIXI.UPDATE_PRIORITY.HIGH);\r\n  }\r\n\r\n  _deactivateTicker() {\r\n    canvas.app.ticker.remove(this.updatePosition, this);\r\n  }\r\n\r\n  updatePosition() {\r\n    let coord = canvas.canvasCoordinatesFromClient({\r\n      x: window.innerWidth / 2 + this.overlayConfig.offsetX * window.innerWidth,\r\n      y: window.innerHeight / 2 + this.overlayConfig.offsetY * window.innerHeight,\r\n    });\r\n    this.position.set(coord.x, coord.y);\r\n  }\r\n\r\n  async _applyFilters(config) {\r\n    this.filtersApplied = true;\r\n    const filterName = config.filter;\r\n    const FilterClass = PIXI.filters[filterName];\r\n    const options = foundry.utils.mergeObject(FILTERS[filterName]?.defaultValues || {}, config.filterOptions);\r\n    let filter;\r\n    if (FilterClass) {\r\n      if (FILTERS[filterName]?.argType === 'args') {\r\n        let args = [];\r\n        const controls = FILTERS[filterName]?.controls;\r\n        if (controls) {\r\n          controls.forEach((c) => args.push(options[c.name]));\r\n        }\r\n        filter = new FilterClass(...args);\r\n      } else if (FILTERS[filterName]?.argType === 'options') {\r\n        filter = new FilterClass(options);\r\n      } else {\r\n        filter = new FilterClass();\r\n      }\r\n    } else if (filterName === 'OutlineOverlayFilter') {\r\n      filter = OutlineFilter.create(options);\r\n      filter.thickness = options.trueThickness ?? 1;\r\n      filter.animated = options.animate ?? false;\r\n    } else if (filterName === 'Token Magic FX') {\r\n      this.applyTVAFilters(await constructTMFXFilters(options.params || [], this));\r\n      return;\r\n    }\r\n\r\n    if (filter) {\r\n      this.applyTVAFilters([filter]);\r\n      this.filters = [filter];\r\n    } else {\r\n      this.removeTVAFilters();\r\n    }\r\n  }\r\n\r\n  applyTVAFilters(filters) {\r\n    if (filters?.length) {\r\n      this.removeTVAFilters();\r\n      this.filters = (this.filters || []).concat(filters);\r\n    }\r\n  }\r\n\r\n  removeTVAFilters() {\r\n    if (this.filters) this.filters = this.filters.filter((f) => !f.tvaFilter);\r\n  }\r\n\r\n  async stopAnimation() {\r\n    if (this.animationName) {\r\n      CanvasAnimation.terminateAnimation(this.animationName);\r\n    }\r\n  }\r\n\r\n  async animate(config) {\r\n    if (!this.animationName) this.animationName = this.object.sourceId + '.' + foundry.utils.randomID(5);\r\n\r\n    let newAngle = this.angle + (config.animation.clockwise ? 360 : -360);\r\n    const rotate = [{ parent: this, attribute: 'angle', to: newAngle }];\r\n\r\n    const completed = await CanvasAnimation.animate(rotate, {\r\n      duration: config.animation.duration,\r\n      name: this.animationName,\r\n    });\r\n    if (completed) {\r\n      this.animate(config);\r\n    }\r\n  }\r\n\r\n  _registerHooks(configuration) {\r\n    if (configuration.linkStageScale) registerOverlayRefreshHook(this, 'canvasPan');\r\n    else unregisterOverlayRefreshHooks(this, 'canvasPan');\r\n  }\r\n\r\n  _swapChildren(to) {\r\n    const from = this.pseudoTexture;\r\n    if (from.shapes) {\r\n      this.removeChild(this.pseudoTexture.shapes);\r\n      const children = from.shapes.removeChildren();\r\n      if (to?.shapes) children.forEach((c) => to.shapes.addChild(c)?.refresh());\r\n      else children.forEach((c) => this.addChild(c)?.refresh());\r\n    } else if (to?.shapes) {\r\n      const children = this.removeChildren();\r\n      children.forEach((c) => to.shapes.addChild(c)?.refresh());\r\n    }\r\n  }\r\n\r\n  _destroyTexture() {\r\n    if (this.texture.textLabel || this.texture.destroyable) {\r\n      this.texture.destroy(true);\r\n    }\r\n\r\n    if (this.pseudoTexture?.shapes) {\r\n      this.removeChild(this.pseudoTexture.shapes);\r\n      this.pseudoTexture.shapes.destroy();\r\n    } else if (this.pseudoTexture?.html) {\r\n      this.removeHTMLOverlay();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    this.stopAnimation();\r\n    unregisterOverlayRefreshHooks(this);\r\n\r\n    if (this.children) {\r\n      for (const ch of this.children) {\r\n        if (ch instanceof TVAOverlay) ch.tvaRemove = true;\r\n      }\r\n      removeMarkedOverlays(this.object);\r\n      if (this.pseudoTexture.shapes) {\r\n        this.pseudoTexture.shapes.children.forEach((c) => c.destroy());\r\n        this.removeChild(this.pseudoTexture.shapes)?.destroy();\r\n        //  this.pseudoTexture.shapes.destroy();\r\n      }\r\n    }\r\n\r\n    if (this.texture.textLabel || this.texture.destroyable) {\r\n      return super.destroy(true);\r\n    } else if (this.texture?.baseTexture.resource?.source?.tagName === 'VIDEO') {\r\n      this.texture.baseTexture.destroy();\r\n    }\r\n\r\n    this.removeHTMLOverlay();\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  // Foundry BUG Fix\r\n  calculateTrimmedVertices() {\r\n    return PIXI.Sprite.prototype.calculateTrimmedVertices.call(this);\r\n  }\r\n\r\n  addHTMLOverlay() {\r\n    if (!this.htmlOverlay) this.htmlOverlay = new HTMLOverlay(this.overlayConfig, this.object);\r\n  }\r\n\r\n  removeHTMLOverlay() {\r\n    if (this.htmlOverlay) this.htmlOverlay.remove();\r\n    this.htmlOverlay = null;\r\n  }\r\n}\r\n\r\nasync function constructTMFXFilters(paramsArray, sprite) {\r\n  if (typeof TokenMagic === 'undefined' || !('filterTypes' in TokenMagic)) return [];\r\n\r\n  try {\r\n    paramsArray = eval(paramsArray);\r\n  } catch (e) {\r\n    return [];\r\n  }\r\n\r\n  if (!Array.isArray(paramsArray)) {\r\n    paramsArray = TokenMagic.getPreset(paramsArray);\r\n  }\r\n  if (!(paramsArray instanceof Array && paramsArray.length > 0)) return [];\r\n\r\n  let filters = [];\r\n  for (const params of paramsArray) {\r\n    if (!params.hasOwnProperty('filterType') || !TokenMagic.filterTypes.hasOwnProperty(params.filterType)) {\r\n      // one invalid ? all rejected.\r\n      return [];\r\n    }\r\n\r\n    if (!params.hasOwnProperty('rank')) {\r\n      params.rank = 5000;\r\n    }\r\n\r\n    if (!params.hasOwnProperty('filterId') || params.filterId == null) {\r\n      params.filterId = foundry.utils.randomID();\r\n    }\r\n\r\n    if (!params.hasOwnProperty('enabled') || !(typeof params.enabled === 'boolean')) {\r\n      params.enabled = true;\r\n    }\r\n\r\n    params.filterInternalId = foundry.utils.randomID();\r\n\r\n    const gms = game.users.filter((user) => user.isGM);\r\n    params.filterOwner = gms.length ? gms[0].id : game.data.userId;\r\n    // params.placeableType = placeable._TMFXgetPlaceableType();\r\n    params.updateId = foundry.utils.randomID();\r\n\r\n    const filterClass = TokenMagic.filterTypes[params.filterType];\r\n    if (filterClass) {\r\n      class ModTMFX extends filterClass {\r\n        assignPlaceable() {\r\n          this.targetPlaceable = sprite.object;\r\n          this.placeableImg = sprite;\r\n        }\r\n\r\n        async _TMFXsetAnimeFlag() {}\r\n      }\r\n\r\n      const filter = new ModTMFX(params);\r\n      if (filter) {\r\n        // Patch fixes\r\n        filter.placeableImg = sprite;\r\n        filter.targetPlaceable = sprite.object;\r\n        // end of fixes\r\n        filter.tvaFilter = true;\r\n        filters.unshift(filter);\r\n      }\r\n    }\r\n  }\r\n  return filters;\r\n}\r\n\r\nclass OutlineFilter extends foundry.canvas.rendering.filters.OutlineOverlayFilter {\r\n  /** @inheritdoc */\r\n  static createFragmentShader() {\r\n    return `\r\n    varying vec2 vTextureCoord;\r\n    varying vec2 vFilterCoord;\r\n    uniform sampler2D uSampler;\r\n    \r\n    uniform vec2 thickness;\r\n    uniform vec4 outlineColor;\r\n    uniform vec4 filterClamp;\r\n    uniform float alphaThreshold;\r\n    uniform float time;\r\n    uniform bool knockout;\r\n    uniform bool wave;\r\n    \r\n    ${this.CONSTANTS}\r\n    ${this.WAVE()}\r\n    \r\n    void main(void) {\r\n        float dist = distance(vFilterCoord, vec2(0.5)) * 2.0;\r\n        vec4 ownColor = texture2D(uSampler, vTextureCoord);\r\n        vec4 wColor = wave ? outlineColor * \r\n                             wcos(0.0, 1.0, dist * 75.0, \r\n                                  -time * 0.01 + 3.0 * dot(vec4(1.0), ownColor)) \r\n                             * 0.33 * (1.0 - dist) : vec4(0.0);\r\n        float texAlpha = smoothstep(alphaThreshold, 1.0, ownColor.a);\r\n        vec4 curColor;\r\n        float maxAlpha = 0.;\r\n        vec2 displaced;\r\n        for ( float angle = 0.0; angle <= TWOPI; angle += ${this.#quality.toFixed(7)} ) {\r\n            displaced.x = vTextureCoord.x + thickness.x * cos(angle);\r\n            displaced.y = vTextureCoord.y + thickness.y * sin(angle);\r\n            curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\r\n            curColor.a = clamp((curColor.a - 0.6) * 2.5, 0.0, 1.0);\r\n            maxAlpha = max(maxAlpha, curColor.a);\r\n        }\r\n        float resultAlpha = max(maxAlpha, texAlpha);\r\n        vec3 result = (ownColor.rgb + outlineColor.rgb * (1.0 - texAlpha)) * resultAlpha;\r\n        gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\r\n    }\r\n    `;\r\n  }\r\n\r\n  static get #quality() {\r\n    switch (canvas.performance.mode) {\r\n      case CONST.CANVAS_PERFORMANCE_MODES.LOW:\r\n        return (Math.PI * 2) / 10;\r\n      case CONST.CANVAS_PERFORMANCE_MODES.MED:\r\n        return (Math.PI * 2) / 20;\r\n      default:\r\n        return (Math.PI * 2) / 30;\r\n    }\r\n  }\r\n}\r\n","import { TVA_CONFIG } from '../settings.js';\r\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\r\nimport { string2Hex, waitForTokenTexture } from '../utils.js';\r\nimport { getAllEffectMappings, getTokenEffects, getTokenHP } from '../hooks/effectMappingHooks.js';\r\n\r\nexport const FONT_LOADING = {};\r\n\r\nexport async function drawOverlays(token) {\r\n  if (token.tva_drawing_overlays) return;\r\n  token.tva_drawing_overlays = true;\r\n\r\n  const mappings = getAllEffectMappings(token);\r\n  const effects = getTokenEffects(token, true);\r\n  let processedMappings = mappings\r\n    .filter((m) => m.overlay && effects.includes(m.id))\r\n    .sort(\r\n      (m1, m2) =>\r\n        m1.priority - (m1.overlayConfig?.parentID ? 0 : 999) - (m2.priority - (m2.overlayConfig?.parentID ? 0 : 999))\r\n    );\r\n\r\n  // See if the whole stack or just top of the stack should be used according to settings\r\n  if (processedMappings.length) {\r\n    processedMappings = TVA_CONFIG.stackStatusConfig\r\n      ? processedMappings\r\n      : [processedMappings[processedMappings.length - 1]];\r\n  }\r\n\r\n  // Process strings as expressions\r\n  const overlays = processedMappings.map((m) => {\r\n    m.overlayConfig.id = m.id; // TODO: For some reason ID can get de-synced between mapping and overlay\r\n    return evaluateOverlayExpressions(foundry.utils.deepClone(m.overlayConfig), token, m);\r\n  });\r\n\r\n  if (overlays.length) {\r\n    waitForTokenTexture(token, async (token) => {\r\n      if (!token.tvaOverlays) token.tvaOverlays = [];\r\n      // Temporarily mark every overlay for removal.\r\n      // We'll only keep overlays that are still applicable to the token\r\n      _markAllOverlaysForRemoval(token);\r\n\r\n      // To keep track of the overlay order\r\n      let overlaySort = 0;\r\n      let underlaySort = 0;\r\n\r\n      // Process overlays\r\n      for (const ov of overlays) {\r\n        let sprite = _findTVAOverlay(ov.id, token);\r\n        if (sprite) {\r\n          _evaluateLinkedImages(ov, token.document.texture.src);\r\n\r\n          const diff = foundry.utils.diffObject(sprite.overlayConfig, ov);\r\n\r\n          // Check if we need to create a new texture or simply refresh the overlay\r\n          if (!foundry.utils.isEmpty(diff)) {\r\n            const refreshFilters = Boolean(diff.filter || diff.filterOptions);\r\n            if (ov.img instanceof Array && ov.img.length > 1) {\r\n              sprite.refresh(ov, { refreshFilters });\r\n            } else if (diff.img || diff.text || diff.shapes || diff.repeat || diff.html) {\r\n              sprite.setTexture(await genTexture(token, ov), { configuration: ov, refreshFilters });\r\n            } else if (diff.parentID) {\r\n              sprite.parent?.removeChild(sprite)?.destroy();\r\n              sprite = null;\r\n            } else {\r\n              sprite.refresh(ov, { refreshFilters });\r\n            }\r\n          } else if (diff.text?.text || diff.shapes) {\r\n            sprite.setTexture(await genTexture(token, ov), { configuration: ov, refreshFilters });\r\n          }\r\n\r\n          if ('ui' in diff) {\r\n            sprite.parent.removeChild(sprite);\r\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n            sprite = layer.addChild(sprite);\r\n          }\r\n        }\r\n        if (!sprite) {\r\n          if (ov.parentID) {\r\n            const parent = _findTVAOverlay(ov.parentID, token);\r\n            if (parent && !parent.tvaRemove)\r\n              sprite = parent.addChildAuto(new TVAOverlay(await genTexture(token, ov), token, ov));\r\n          } else {\r\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n            sprite = layer.addChild(new TVAOverlay(await genTexture(token, ov), token, ov));\r\n          }\r\n          if (sprite) token.tvaOverlays.push(sprite);\r\n        }\r\n\r\n        // If the sprite has a parent confirm that the parent has not been removed\r\n        if (sprite?.overlayConfig.parentID) {\r\n          const parent = _findTVAOverlay(sprite.overlayConfig.parentID, token);\r\n          if (!parent || parent.tvaRemove) sprite = null;\r\n        }\r\n\r\n        if (sprite) {\r\n          sprite.tvaRemove = false; // Sprite in use, do not remove\r\n\r\n          // Assign order to the overlay\r\n          if (sprite.overlayConfig.underlay) {\r\n            underlaySort -= 0.01;\r\n            sprite.overlaySort = underlaySort;\r\n          } else {\r\n            overlaySort += 0.01;\r\n            sprite.overlaySort = overlaySort;\r\n          }\r\n\r\n          sprite.parent.sortableChildren = true;\r\n          sprite.parent.sortDirty = true;\r\n        }\r\n      }\r\n\r\n      removeMarkedOverlays(token);\r\n      token.tva_drawing_overlays = false;\r\n    });\r\n  } else {\r\n    _removeAllOverlays(token);\r\n    token.tva_drawing_overlays = false;\r\n  }\r\n}\r\n\r\nfunction _evaluateLinkedImages(ov, tokenImage) {\r\n  if (ov.img instanceof Array) {\r\n    for (const img of ov.img) {\r\n      if (img.linked) img.src = tokenImage;\r\n    }\r\n  } else if (ov.imgLinked) ov.img = tokenImage;\r\n}\r\n\r\n// function _getLayer(ov) {\r\n//   const layer = ov.ui ? canvas.tokens : canvas.primary;\r\n//   if (!layer.tvaOverlay) layer.tvaOverlays = layer.addChild(new PIXI.Container());\r\n//   return layer.tvaOverlays;\r\n// }\r\n\r\nexport async function genTexture(token, conf) {\r\n  if (conf.img) {\r\n    return await generateImage(token, conf);\r\n  } else if (conf.text?.text != null) {\r\n    return await generateTextTexture(token, conf);\r\n  } else if (conf.shapes?.length) {\r\n    return await generateShapeTexture(token, conf.shapes);\r\n  } else if (conf.html?.template) {\r\n    return { html: true, texture: await loadTexture('modules\\\\token-variants\\\\img\\\\html_bg.webp') };\r\n  } else {\r\n    return {\r\n      texture: await loadTexture('modules/token-variants/img/token-images.svg'),\r\n    };\r\n  }\r\n}\r\n\r\nasync function generateImage(token, conf) {\r\n  _evaluateLinkedImages(conf, token.document.texture.src);\r\n\r\n  let img = conf.img;\r\n\r\n  if (img instanceof Array) {\r\n    img = img[Math.floor(Math.random() * img.length)].src;\r\n  }\r\n\r\n  let texture = await loadTexture(img, {\r\n    fallback: 'modules/token-variants/img/token-images.svg',\r\n  });\r\n\r\n  // Repeat image if needed\r\n  // Repeating the shape if necessary\r\n  if (conf.repeating && conf.repeat) {\r\n    const repeat = conf.repeat;\r\n    let numRepeats;\r\n    if (repeat.isPercentage) {\r\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n    } else {\r\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n    }\r\n    let n = 0;\r\n    let rows = 0;\r\n    const maxRows = repeat.maxRows ?? Infinity;\r\n    let xOffset = 0;\r\n    let yOffset = 0;\r\n    const paddingX = repeat.paddingX ?? 0;\r\n    const paddingY = repeat.paddingY ?? 0;\r\n    let container = new PIXI.Container();\r\n    while (numRepeats > 0) {\r\n      let img = new PIXI.Sprite(texture);\r\n      img.x = xOffset;\r\n      img.y = yOffset;\r\n      container.addChild(img);\r\n      xOffset += texture.width + paddingX;\r\n      numRepeats--;\r\n      n++;\r\n      if (numRepeats != 0 && n >= repeat.perRow) {\r\n        rows += 1;\r\n        if (rows >= maxRows) break;\r\n        yOffset += texture.height + paddingY;\r\n        xOffset = 0;\r\n        n = 0;\r\n      }\r\n    }\r\n\r\n    texture = _renderContainer(container, texture.resolution);\r\n  }\r\n\r\n  return { texture };\r\n}\r\n\r\nfunction _renderContainer(container, resolution, { width = null, height = null } = {}) {\r\n  const bounds = container.getLocalBounds();\r\n  const matrix = new PIXI.Matrix();\r\n  matrix.tx = -bounds.x;\r\n  matrix.ty = -bounds.y;\r\n\r\n  const renderTexture = PIXI.RenderTexture.create({\r\n    width: width ?? bounds.width,\r\n    height: height ?? bounds.height,\r\n    resolution: resolution,\r\n  });\r\n\r\n  canvas.app.renderer.render(container, {\r\n    renderTexture,\r\n    clear: true,\r\n    transform: matrix,\r\n    skipUpdateTransform: false,\r\n  });\r\n\r\n  renderTexture.destroyable = true;\r\n  return renderTexture;\r\n}\r\n\r\n// Return width and height of the drawn shape\r\nfunction _drawShape(graphics, shape, xOffset = 0, yOffset = 0) {\r\n  if (shape.type === 'rectangle') {\r\n    graphics.drawRoundedRect(shape.x + xOffset, shape.y + yOffset, shape.width, shape.height, shape.radius);\r\n    return [shape.width, shape.height];\r\n  } else if (shape.type === 'ellipse') {\r\n    graphics.drawEllipse(shape.x + xOffset + shape.width, shape.y + yOffset + shape.height, shape.width, shape.height);\r\n    return [shape.width * 2, shape.height * 2];\r\n  } else if (shape.type === 'polygon') {\r\n    graphics.drawPolygon(\r\n      shape.points.split(',').map((p, i) => Number(p) * shape.scale + (i % 2 === 0 ? shape.x : shape.y))\r\n    );\r\n  } else if (shape.type === 'torus') {\r\n    drawTorus(\r\n      graphics,\r\n      shape.x + xOffset + shape.outerRadius,\r\n      shape.y + yOffset + shape.outerRadius,\r\n      shape.innerRadius,\r\n      shape.outerRadius,\r\n      Math.toRadians(shape.startAngle),\r\n      shape.endAngle >= 360 ? Math.PI * 2 : Math.toRadians(shape.endAngle)\r\n    );\r\n    return [shape.outerRadius * 2, shape.outerRadius * 2];\r\n  } else if (shape.type === 'cutCircle') {\r\n    drawCutCircle(\r\n      graphics,\r\n      shape.x + xOffset + shape.radius,\r\n      shape.y + yOffset + shape.radius,\r\n      shape.radius,\r\n      shape.rotation,\r\n      shape.cut\r\n    );\r\n  }\r\n}\r\n\r\nexport async function generateShapeTexture(token, shapes) {\r\n  let graphics = new PIXI.Graphics();\r\n\r\n  for (const obj of shapes) {\r\n    graphics.beginFill(interpolateColor(obj.fill.color, obj.fill.interpolateColor), obj.fill.alpha);\r\n    graphics.lineStyle(obj.line.width, string2Hex(obj.line.color), obj.line.alpha);\r\n\r\n    const shape = obj.shape;\r\n\r\n    // Repeating the shape if necessary\r\n    if (obj.repeating && obj.repeat) {\r\n      const repeat = obj.repeat;\r\n      let numRepeats;\r\n      if (repeat.isPercentage) {\r\n        numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n      } else {\r\n        numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n      }\r\n      let n = 0;\r\n      let rows = 0;\r\n      const maxRows = repeat.maxRows ?? Infinity;\r\n      let xOffset = 0;\r\n      let yOffset = 0;\r\n      const paddingX = repeat.paddingX ?? 0;\r\n      const paddingY = repeat.paddingY ?? 0;\r\n      while (numRepeats > 0) {\r\n        const [width, height] = _drawShape(graphics, shape, xOffset, yOffset);\r\n        xOffset += width + paddingX;\r\n        numRepeats--;\r\n        n++;\r\n        if (numRepeats != 0 && n >= repeat.perRow) {\r\n          rows += 1;\r\n          if (rows >= maxRows) break;\r\n          yOffset += height + paddingY;\r\n          xOffset = 0;\r\n          n = 0;\r\n        }\r\n      }\r\n    } else {\r\n      _drawShape(graphics, shape);\r\n    }\r\n  }\r\n\r\n  // Store original graphics dimensions as these may change when children are added\r\n  graphics.shapesWidth = Number(graphics.width);\r\n  graphics.shapesHeight = Number(graphics.height);\r\n\r\n  return { texture: PIXI.Texture.EMPTY, shapes: graphics };\r\n}\r\n\r\nfunction drawTorus(graphics, x, y, innerRadius, outerRadius, startArc = 0, endArc = Math.PI * 2) {\r\n  if (Math.abs(endArc - startArc) >= Math.PI * 2) {\r\n    return graphics.drawCircle(x, y, outerRadius).beginHole().drawCircle(x, y, innerRadius).endHole();\r\n  }\r\n\r\n  graphics.finishPoly();\r\n  graphics.arc(x, y, innerRadius, endArc, startArc, true).arc(x, y, outerRadius, startArc, endArc, false).finishPoly();\r\n}\r\n\r\nfunction drawCutCircle(graphics, x, y, radius, rotation, cut) {\r\n  if (cut >= 1) return;\r\n  else if (cut <= 0) return graphics.drawCircle(x, y, radius);\r\n\r\n  let startAngle = -90 + 180 * cut + rotation;\r\n  let endAngle = 270 - 180 * cut + rotation;\r\n\r\n  graphics.arc(x, y, radius, Math.toRadians(startAngle), Math.toRadians(endAngle), false).closePath().finishPoly();\r\n}\r\n\r\nexport function interpolateColor(minColor, interpolate, rString = false) {\r\n  if (!interpolate || !interpolate.color2 || !interpolate.prc) return rString ? minColor : string2Hex(minColor);\r\n\r\n  if (!PIXI.Color) return _interpolateV10(minColor, interpolate, rString);\r\n\r\n  const percentage = interpolate.prc;\r\n  minColor = new PIXI.Color(minColor);\r\n  const maxColor = new PIXI.Color(interpolate.color2);\r\n\r\n  let minHsv = rgb2hsv(minColor.red, minColor.green, minColor.blue);\r\n  let maxHsv = rgb2hsv(maxColor.red, maxColor.green, maxColor.blue);\r\n\r\n  let deltaHue = maxHsv[0] - minHsv[0];\r\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\r\n\r\n  let targetHue = minHsv[0] + deltaAngle * percentage;\r\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\r\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\r\n\r\n  let result = new PIXI.Color({ h: targetHue, s: targetSaturation * 100, v: targetValue * 100 });\r\n  return rString ? result.toHex() : result.toNumber();\r\n}\r\n\r\nfunction _interpolateV10(minColor, interpolate, rString = false) {\r\n  const percentage = interpolate.prc;\r\n  minColor = PIXI.utils.hex2rgb(string2Hex(minColor));\r\n  const maxColor = PIXI.utils.hex2rgb(string2Hex(interpolate.color2));\r\n\r\n  let minHsv = rgb2hsv(minColor[0], minColor[1], minColor[2]);\r\n  let maxHsv = rgb2hsv(maxColor[0], maxColor[1], maxColor[2]);\r\n\r\n  let deltaHue = maxHsv[0] - minHsv[0];\r\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\r\n\r\n  let targetHue = minHsv[0] + deltaAngle * percentage;\r\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\r\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\r\n\r\n  let result = Color.fromHSV([targetHue / 360, targetSaturation, targetValue]);\r\n  return rString ? result.toString() : Number(result);\r\n}\r\n\r\n/**\r\n * Converts a color from RGB to HSV space.\r\n * Source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620\r\n */\r\nfunction rgb2hsv(r, g, b) {\r\n  let v = Math.max(r, g, b),\r\n    c = v - Math.min(r, g, b);\r\n  let h = c && (v == r ? (g - b) / c : v == g ? 2 + (b - r) / c : 4 + (r - g) / c);\r\n  return [60 * (h < 0 ? h + 6 : h), v && c / v, v];\r\n}\r\n\r\nconst CORE_VARIABLES = {\r\n  '@hp': (token) => getTokenHP(token)?.val,\r\n  '@hpMax': (token) => getTokenHP(token)?.maxVal,\r\n  '@gridSize': () => canvas.grid?.size,\r\n  '@label': (_, conf) => conf.label,\r\n};\r\n\r\nfunction _evaluateString(str, token, conf) {\r\n  let variables = conf.overlayConfig?.variables;\r\n  const re2 = new RegExp('@\\\\w+', 'gi');\r\n  str = str.replace(re2, function replace(match) {\r\n    let name = match.substr(1, match.length);\r\n    let v = variables?.find((v) => v.name === name);\r\n    if (v) return v.value;\r\n    else if (match in CORE_VARIABLES) return CORE_VARIABLES[match](token, conf);\r\n    return match;\r\n  });\r\n\r\n  const re = new RegExp('{{.*?}}', 'gi');\r\n  str = str\r\n    .replace(re, function replace(match) {\r\n      const property = match.substring(2, match.length - 2);\r\n      if (conf && property === 'effect') {\r\n        return conf.expression;\r\n      }\r\n      if (token && property === 'hp') return getTokenHP(token)?.val;\r\n      else if (token && property === 'hpMax') return getTokenHP(token)?.maxVal;\r\n      const val = foundry.utils.getProperty(token.document ?? token, property);\r\n      return val ?? 0;\r\n    })\r\n    .replace('\\\\n', '\\n');\r\n\r\n  return str;\r\n}\r\n\r\nfunction _executeString(evalString, token) {\r\n  try {\r\n    const actor = token.actor; // So that actor is easily accessible within eval() scope\r\n    const result = eval(evalString);\r\n    if (foundry.utils.getType(result) === 'Object') evalString;\r\n    return result;\r\n  } catch (e) {}\r\n  return evalString;\r\n}\r\n\r\nexport function evaluateOverlayExpressions(obj, token, conf) {\r\n  for (const [k, v] of Object.entries(obj)) {\r\n    if (\r\n      ![\r\n        'label',\r\n        'interactivity',\r\n        'variables',\r\n        'id',\r\n        'parentID',\r\n        'limitedUsers',\r\n        'filter',\r\n        //'filterOptions',\r\n        'limitOnProperty',\r\n        'html',\r\n      ].includes(k)\r\n    ) {\r\n      obj[k] = _evaluateObjExpressions(v, token, conf);\r\n    }\r\n  }\r\n  return obj;\r\n}\r\n\r\n// Evaluate provided object values substituting in {{path.to.property}} with token properties, and performing eval() on strings\r\nfunction _evaluateObjExpressions(obj, token, conf) {\r\n  const t = foundry.utils.getType(obj);\r\n  if (t === 'string') {\r\n    const str = _evaluateString(obj, token, conf);\r\n    return _executeString(str, token);\r\n  } else if (t === 'Array') {\r\n    for (let i = 0; i < obj.length; i++) {\r\n      obj[i] = _evaluateObjExpressions(obj[i], token, conf);\r\n    }\r\n  } else if (t === 'Object') {\r\n    for (const [k, v] of Object.entries(obj)) {\r\n      // Exception for text overlay\r\n      if (k === 'text' && foundry.utils.getType(v) === 'string' && v) {\r\n        const evalString = _evaluateString(v, token, conf);\r\n        const result = _executeString(evalString, token);\r\n        if (foundry.utils.getType(result) !== 'string') obj[k] = evalString;\r\n        else obj[k] = result;\r\n      } else obj[k] = _evaluateObjExpressions(v, token, conf);\r\n    }\r\n  }\r\n  return obj;\r\n}\r\n\r\nexport async function generateTextTexture(token, conf) {\r\n  await FONT_LOADING.loading;\r\n  let label = conf.text.text;\r\n\r\n  // Repeating the string if necessary\r\n  if (conf.text.repeating && conf.text.repeat) {\r\n    let tmp = '';\r\n    const repeat = conf.text.repeat;\r\n    let numRepeats;\r\n    if (repeat.isPercentage) {\r\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\r\n    } else {\r\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\r\n    }\r\n    let n = 0;\r\n    let rows = 0;\r\n    let maxRows = repeat.maxRows ?? Infinity;\r\n    while (numRepeats > 0) {\r\n      tmp += label;\r\n      numRepeats--;\r\n      n++;\r\n      if (numRepeats != 0 && n >= repeat.perRow) {\r\n        rows += 1;\r\n        if (rows >= maxRows) break;\r\n        tmp += '\\n';\r\n        n = 0;\r\n      }\r\n    }\r\n    label = tmp;\r\n  }\r\n\r\n  let style = foundry.canvas.containers.PreciseText.getTextStyle({\r\n    ...conf.text,\r\n    fontFamily: [conf.text.fontFamily, 'fontAwesome'].join(','),\r\n    fill: interpolateColor(conf.text.fill, conf.text.interpolateColor, true),\r\n  });\r\n  const text = new foundry.canvas.containers.PreciseText(label, style);\r\n  text.updateText(false);\r\n\r\n  const texture = text.texture;\r\n  const height = conf.text.maxHeight ? Math.min(texture.height, conf.text.maxHeight) : null;\r\n  const curve = conf.text.curve;\r\n\r\n  if (!height && !curve?.radius && !curve?.angle) {\r\n    texture.textLabel = label;\r\n    return { texture };\r\n  }\r\n\r\n  const container = new PIXI.Container();\r\n\r\n  if (curve?.radius || curve?.angle) {\r\n    // Curve the text\r\n    const letterSpacing = conf.text.letterSpacing ?? 0;\r\n    const radius = curve.angle ? (texture.width + letterSpacing) / (Math.PI * 2) / (curve.angle / 360) : curve.radius;\r\n    const maxRopePoints = 100;\r\n    const step = Math.PI / maxRopePoints;\r\n\r\n    let ropePoints = maxRopePoints - Math.round((texture.width / (radius * Math.PI)) * maxRopePoints);\r\n    ropePoints /= 2;\r\n\r\n    const points = [];\r\n    for (let i = maxRopePoints - ropePoints; i > ropePoints; i--) {\r\n      const x = radius * Math.cos(step * i);\r\n      const y = radius * Math.sin(step * i);\r\n      points.push(new PIXI.Point(x, curve.invert ? y : -y));\r\n    }\r\n    const rope = new PIXI.SimpleRope(texture, points);\r\n    container.addChild(rope);\r\n  } else {\r\n    container.addChild(new PIXI.Sprite(texture));\r\n  }\r\n\r\n  const renderTexture = _renderContainer(container, 2, { height });\r\n  text.destroy();\r\n\r\n  renderTexture.textLabel = label;\r\n  return { texture: renderTexture };\r\n}\r\n\r\nfunction _markAllOverlaysForRemoval(token) {\r\n  for (const child of token.tvaOverlays) {\r\n    if (child instanceof TVAOverlay) {\r\n      child.tvaRemove = true;\r\n    }\r\n  }\r\n}\r\n\r\nexport function removeMarkedOverlays(token) {\r\n  const sprites = [];\r\n  for (const child of token.tvaOverlays) {\r\n    if (child.tvaRemove) {\r\n      child.parent?.removeChild(child)?.destroy();\r\n    } else {\r\n      sprites.push(child);\r\n    }\r\n  }\r\n  token.tvaOverlays = sprites;\r\n}\r\n\r\nfunction _findTVAOverlay(id, token) {\r\n  for (const child of token.tvaOverlays) {\r\n    if (child.overlayConfig?.id === id) {\r\n      return child;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction _removeAllOverlays(token) {\r\n  if (token.tvaOverlays)\r\n    for (const child of token.tvaOverlays) {\r\n      child.parent?.removeChild(child)?.destroy();\r\n    }\r\n  token.tvaOverlays = null;\r\n}\r\n\r\nexport function broadcastDrawOverlays(token) {\r\n  // Need to broadcast to other users to re-draw the overlay\r\n  if (token) drawOverlays(token);\r\n  const actorId = token.document?.actorLink ? token.actor?.id : null;\r\n  const message = {\r\n    handlerName: 'drawOverlays',\r\n    args: { tokenId: token.id, actorId },\r\n    type: 'UPDATE',\r\n  };\r\n  game.socket?.emit('module.token-variants', message);\r\n}\r\n","import { TVA_CONFIG, updateSettings, _arrayAwareDiffObject } from './settings.js';\r\nimport { showArtSelect } from '../token-variants.mjs';\r\nimport EffectMappingForm from '../applications/effectMappingForm.js';\r\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\r\nimport { toggleTemplateDialog } from '../applications/dialogs.js';\r\n\r\nconst simplifyRegex = new RegExp(/[^A-Za-z0-9/\\\\]/g);\r\n\r\nexport const SUPPORTED_COMP_ATTRIBUTES = ['rotation', 'elevation'];\r\nexport const EXPRESSION_OPERATORS = ['\\\\(', '\\\\)', '&&', '||', '\\\\!'];\r\n\r\n// Types of searches\r\nexport const SEARCH_TYPE = {\r\n  PORTRAIT: 'Portrait',\r\n  TOKEN: 'Token',\r\n  PORTRAIT_AND_TOKEN: 'PortraitAndToken',\r\n  TILE: 'Tile',\r\n  ITEM: 'Item',\r\n  JOURNAL: 'JournalEntry',\r\n  MACRO: 'Macro',\r\n};\r\n\r\nexport const BASE_IMAGE_CATEGORIES = [\r\n  'Portrait',\r\n  'Token',\r\n  'PortraitAndToken',\r\n  'Tile',\r\n  'Item',\r\n  'JournalEntry',\r\n  'Macro',\r\n  'RollTable',\r\n];\r\n\r\nexport const PRESSED_KEYS = {\r\n  popupOverride: false,\r\n  config: false,\r\n};\r\n\r\nconst BATCH_UPDATES = {\r\n  TOKEN: [],\r\n  TOKEN_CALLBACKS: [],\r\n  TOKEN_CONTEXT: { animate: true },\r\n  ACTOR: [],\r\n  ACTOR_CONTEXT: null,\r\n};\r\n\r\nexport function startBatchUpdater() {\r\n  canvas.app.ticker.add(() => {\r\n    if (BATCH_UPDATES.TOKEN.length) {\r\n      canvas.scene.updateEmbeddedDocuments('Token', BATCH_UPDATES.TOKEN, BATCH_UPDATES.TOKEN_CONTEXT).then(() => {\r\n        for (const cb of BATCH_UPDATES.TOKEN_CALLBACKS) {\r\n          cb();\r\n        }\r\n        BATCH_UPDATES.TOKEN_CALLBACKS = [];\r\n      });\r\n      BATCH_UPDATES.TOKEN = [];\r\n    }\r\n    if (BATCH_UPDATES.ACTOR.length !== 0) {\r\n      if (BATCH_UPDATES.ACTOR_CONTEXT) Actor.updateDocuments(BATCH_UPDATES.ACTOR, BATCH_UPDATES.ACTOR_CONTEXT);\r\n      else Actor.updateDocuments(BATCH_UPDATES.ACTOR);\r\n      BATCH_UPDATES.ACTOR = [];\r\n      BATCH_UPDATES.ACTOR_CONTEXT = null;\r\n    }\r\n  });\r\n}\r\n\r\nexport function queueTokenUpdate(id, update, callback = null, animate = true) {\r\n  update._id = id;\r\n  BATCH_UPDATES.TOKEN.push(update);\r\n  BATCH_UPDATES.TOKEN_CONTEXT = { animate };\r\n  if (callback) BATCH_UPDATES.TOKEN_CALLBACKS.push(callback);\r\n}\r\n\r\nexport function queueActorUpdate(id, update, context = null) {\r\n  update._id = id;\r\n  BATCH_UPDATES.ACTOR.push(update);\r\n  BATCH_UPDATES.ACTOR_CONTEXT = context;\r\n}\r\n\r\n/**\r\n * Updates Token and/or Proto Token  with the new image and custom configuration if one exists.\r\n * @param {string} imgSrc Image source path/url\r\n * @param {object} [options={}] Update options\r\n * @param {Token[]} [options.token] Token to be updated with the new image\r\n * @param {Actor} [options.actor] Actor with Proto Token to be updated with the new image\r\n * @param {string} [options.imgName] Image name if it differs from the file name. Relevant for rolltable sourced images.\r\n * @param {object} [options.tokenUpdate] Token update to be merged and performed at the same time as image update\r\n * @param {object} [options.actorUpdate] Actor update to be merged and performed at the same time as image update\r\n * @param {string} [options.pack] Compendium pack of the Actor being updated\r\n * @param {func} [options.callback] Callback to be executed when a batch update has been performed\r\n * @param {object} [options.config] Token Configuration settings to be applied to the token\r\n */\r\nexport async function updateTokenImage(\r\n  imgSrc,\r\n  {\r\n    token = null,\r\n    actor = null,\r\n    imgName = null,\r\n    tokenUpdate = {},\r\n    actorUpdate = {},\r\n    pack = '',\r\n    callback = null,\r\n    config = undefined,\r\n    animate = true,\r\n    update = null,\r\n    applyDefaultConfig = true,\r\n  } = {}\r\n) {\r\n  if (!(token || actor)) {\r\n    console.warn(game.i18n.localize('token-variants.notifications.warn.update-image-no-token-actor'));\r\n    return;\r\n  }\r\n\r\n  token = token?.document ?? token;\r\n\r\n  // Check if it's a wildcard image\r\n  if ((imgSrc && imgSrc.includes('*')) || (imgSrc.includes('{') && imgSrc.includes('}'))) {\r\n    const images = await wildcardImageSearch(imgSrc);\r\n    if (images.length) {\r\n      imgSrc = images[Math.floor(Math.random() * images.length)];\r\n    }\r\n  }\r\n\r\n  if (!actor && token.actor) {\r\n    actor = game.actors.get(token.actor.id);\r\n  }\r\n\r\n  const getDefaultConfig = (token, actor) => {\r\n    let configEntries = [];\r\n    if (token) configEntries = token.getFlag('token-variants', 'defaultConfig') || [];\r\n    else if (actor) {\r\n      const tokenData = actor.prototypeToken;\r\n      if ('token-variants' in tokenData.flags && 'defaultConfig' in tokenData['token-variants'])\r\n        configEntries = tokenData['token-variants']['defaultConfig'];\r\n    }\r\n    return foundry.utils.expandObject(Object.fromEntries(configEntries));\r\n  };\r\n\r\n  const constructDefaultConfig = (origData, customConfig) => {\r\n    const flatOrigData = foundry.utils.flattenObject(origData);\r\n    TokenDataAdapter.dataToForm(flatOrigData);\r\n    const flatCustomConfig = foundry.utils.flattenObject(customConfig);\r\n    let filtered = foundry.utils.filterObject(flatOrigData, flatCustomConfig);\r\n\r\n    // Flags need special treatment as once set they are not removed via absence of them in the update\r\n    for (let [k, v] of Object.entries(flatCustomConfig)) {\r\n      if (k.startsWith('flags.')) {\r\n        if (!(k in flatOrigData)) {\r\n          let splitK = k.split('.');\r\n          splitK[splitK.length - 1] = '-=' + splitK[splitK.length - 1];\r\n          filtered[splitK.join('.')] = null;\r\n        }\r\n      }\r\n    }\r\n\r\n    return Object.entries(filtered);\r\n  };\r\n\r\n  let tokenUpdateObj = tokenUpdate;\r\n  if (imgSrc) {\r\n    foundry.utils.setProperty(tokenUpdateObj, 'texture.src', imgSrc);\r\n    if (imgName && getFileName(imgSrc) === imgName)\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=name', null);\r\n    else foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.name', imgName);\r\n  }\r\n\r\n  const tokenCustomConfig = foundry.utils.mergeObject(\r\n    getTokenConfigForUpdate(imgSrc || token?.texture.src, imgName, token),\r\n    config ?? {}\r\n  );\r\n  const usingCustomConfig = token?.getFlag('token-variants', 'usingCustomConfig');\r\n  const defaultConfig = getDefaultConfig(token);\r\n  if (!foundry.utils.isEmpty(tokenCustomConfig) || usingCustomConfig) {\r\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, defaultConfig);\r\n  }\r\n\r\n  if (!foundry.utils.isEmpty(tokenCustomConfig)) {\r\n    if (token) {\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\r\n      let doc = token.document ?? token;\r\n      const tokenData = doc.toObject ? doc.toObject() : foundry.utils.deepClone(doc);\r\n\r\n      const defConf = constructDefaultConfig(foundry.utils.mergeObject(tokenData, defaultConfig), tokenCustomConfig);\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\r\n    } else if (actor && !token) {\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\r\n      const tokenData = actor.prototypeToken instanceof Object ? actor.prototypeToken : actor.prototypeToken.toObject();\r\n      const defConf = constructDefaultConfig(tokenData, tokenCustomConfig);\r\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\r\n    }\r\n\r\n    // Fix, an empty flag may be passed which would overwrite any current flags in the updateObj\r\n    // Remove it before doing the merge\r\n    if (!tokenCustomConfig.flags) {\r\n      delete tokenCustomConfig.flags;\r\n    }\r\n\r\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, tokenCustomConfig);\r\n  } else if (usingCustomConfig) {\r\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\r\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\r\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\r\n  }\r\n\r\n  if (!applyDefaultConfig) {\r\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\r\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\r\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\r\n  }\r\n\r\n  if (!foundry.utils.isEmpty(tokenUpdateObj)) {\r\n    if (actor && !token) {\r\n      TokenDataAdapter.formToData(actor.prototypeToken, tokenUpdateObj);\r\n      actorUpdate.prototypeToken = tokenUpdateObj;\r\n      if (pack) {\r\n        queueActorUpdate(actor.id, actorUpdate, { pack: pack });\r\n      } else {\r\n        await (actor.document ?? actor).update(actorUpdate);\r\n      }\r\n    }\r\n\r\n    if (token) {\r\n      TokenDataAdapter.formToData(token, tokenUpdateObj);\r\n      if (TVA_CONFIG.updateTokenProto && token.actor) {\r\n        if (update) {\r\n          foundry.utils.mergeObject(update, { prototypeToken: tokenUpdateObj });\r\n        } else {\r\n          // Timeout to prevent race conditions with other modules namely MidiQOL\r\n          // this is a low priority update so it should be Ok to do\r\n          if (token.actorLink) {\r\n            setTimeout(() => queueActorUpdate(token.actor.id, { prototypeToken: tokenUpdateObj }), 500);\r\n          } else if (token.baseActor) {\r\n            setTimeout(() => token.baseActor.update({ prototypeToken: tokenUpdateObj }), 500);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (update) {\r\n        foundry.utils.mergeObject(update, tokenUpdateObj);\r\n      } else {\r\n        if (token.object) queueTokenUpdate(token.id, tokenUpdateObj, callback, animate);\r\n        else {\r\n          await token.update(tokenUpdateObj, { animate });\r\n          callback();\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Assign new artwork to the actor\r\n */\r\nexport async function updateActorImage(actor, imgSrc, directUpdate = true, pack = '') {\r\n  if (!actor) return;\r\n  if (directUpdate) {\r\n    await (actor.document ?? actor).update({\r\n      img: imgSrc,\r\n    });\r\n  } else {\r\n    queueActorUpdate(\r\n      actor.id,\r\n      {\r\n        img: imgSrc,\r\n      },\r\n      pack ? { pack: pack } : null\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Checks if a key is pressed taking into account current game version.\r\n * @param {string} key v/Ctrl/Shift/Alt\r\n * @returns\r\n */\r\nexport function keyPressed(key) {\r\n  if (key === 'v') return game.keyboard.downKeys.has('KeyV');\r\n  return PRESSED_KEYS[key];\r\n}\r\n\r\nexport function registerKeybinds() {\r\n  game.keybindings.register('token-variants', 'popupOverride', {\r\n    name: 'Popup Override',\r\n    hint: 'When held will trigger popups even when they are disabled.',\r\n    editable: [\r\n      {\r\n        key: 'ShiftLeft',\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      PRESSED_KEYS.popupOverride = true;\r\n    },\r\n    onUp: () => {\r\n      PRESSED_KEYS.popupOverride = false;\r\n    },\r\n    restricted: false,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'config', {\r\n    name: 'Config',\r\n    hint: 'When held during a mouse Left-Click of an Image or an Active Affect will display a configuration window.',\r\n    editable: [\r\n      {\r\n        key: 'ShiftLeft',\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      PRESSED_KEYS.config = true;\r\n    },\r\n    onUp: () => {\r\n      PRESSED_KEYS.config = false;\r\n    },\r\n    restricted: false,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectPortrait', {\r\n    name: 'Show Art Select: Portrait',\r\n    hint: 'Brings up an Art Select pop-up to change the portrait images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit1',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        const actor = token.actor;\r\n        if (!actor) continue;\r\n        showArtSelect(actor.name, {\r\n          callback: async function (imgSrc, name) {\r\n            await updateActorImage(actor, imgSrc);\r\n          },\r\n          searchType: SEARCH_TYPE.PORTRAIT,\r\n          object: actor,\r\n        });\r\n      }\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectToken', {\r\n    name: 'Show Art Select: Token',\r\n    hint: 'Brings up an Art Select pop-up to change the token images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit2',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        showArtSelect(token.name, {\r\n          callback: async function (imgSrc, imgName) {\r\n            updateTokenImage(imgSrc, {\r\n              actor: token.actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n          },\r\n          searchType: SEARCH_TYPE.TOKEN,\r\n          object: token,\r\n        });\r\n      }\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'showArtSelectGeneral', {\r\n    name: 'Show Art Select: Portrait+Token',\r\n    hint: 'Brings up an Art Select pop-up to change both Portrait and Token images of the selected tokens.',\r\n    editable: [\r\n      {\r\n        key: 'Digit3',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      for (const token of canvas.tokens.controlled) {\r\n        const actor = token.actor;\r\n        showArtSelect(token.name, {\r\n          callback: async function (imgSrc, imgName) {\r\n            if (actor) await updateActorImage(actor, imgSrc);\r\n            updateTokenImage(imgSrc, {\r\n              actor: token.actor,\r\n              imgName: imgName,\r\n              token: token,\r\n            });\r\n          },\r\n          searchType: SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n          object: token,\r\n        });\r\n      }\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n  game.keybindings.register('token-variants', 'openGlobalMappings', {\r\n    name: 'Open Global Effect Configurations',\r\n    hint: 'Brings up the settings window for Global Effect Configurations',\r\n    editable: [\r\n      {\r\n        key: 'KeyG',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      const token = new TokenDocument();\r\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n\r\n  game.keybindings.register('token-variants', 'compendiumMapper', {\r\n    name: 'Compendium Mapper',\r\n    hint: 'Opens Compendium Mapper',\r\n    editable: [\r\n      {\r\n        key: 'KeyM',\r\n        modifiers: ['Shift'],\r\n      },\r\n    ],\r\n    onDown: () => {\r\n      new CompendiumMapConfig().render(true);\r\n    },\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n\r\n  game.keybindings.register('token-variants', 'toggleTemplate', {\r\n    name: 'Toggle Template Dialog',\r\n    hint: 'Brings up a dialog from which you can toggle templates on currently selected tokens.',\r\n    editable: [],\r\n    onDown: toggleTemplateDialog,\r\n    restricted: true,\r\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves a custom token configuration if one exists for the given image\r\n */\r\nexport function getTokenConfig(imgSrc, imgName) {\r\n  imgSrc = decodeURISafely(imgSrc);\r\n  if (!imgName) imgName = getFileName(imgSrc);\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  return tokenConfigs.find((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName) ?? {};\r\n}\r\n\r\n/**\r\n * Retrieves a custom token configuration if one exists for the given image and removes control keys\r\n * returning a clean config that can be used in token update.\r\n */\r\nexport function getTokenConfigForUpdate(imgSrc, imgName, token) {\r\n  if (!imgSrc) return {};\r\n\r\n  let tokenConfig = {};\r\n  for (const path of TVA_CONFIG.searchPaths) {\r\n    if (path.config && imgSrc.startsWith(path.text)) {\r\n      foundry.utils.mergeObject(tokenConfig, path.config);\r\n    }\r\n  }\r\n\r\n  let imgConfig = getTokenConfig(imgSrc, imgName ?? getFileName(imgSrc));\r\n  if (!foundry.utils.isEmpty(imgConfig)) {\r\n    imgConfig = foundry.utils.deepClone(imgConfig);\r\n    delete imgConfig.tvImgSrc;\r\n    delete imgConfig.tvImgName;\r\n    if (token) TokenDataAdapter.formToData(token, imgConfig);\r\n\r\n    for (var key in imgConfig) {\r\n      if (!key.startsWith('tvTab_')) {\r\n        tokenConfig[key] = imgConfig[key];\r\n      }\r\n    }\r\n  }\r\n\r\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\r\n    extractDimensionsFromImgName(imgSrc, tokenConfig);\r\n  }\r\n\r\n  return tokenConfig;\r\n}\r\n\r\n/**\r\n * Adds or removes a custom token configuration\r\n */\r\nexport function setTokenConfig(imgSrc, imgName, tokenConfig) {\r\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\r\n  const tcIndex = tokenConfigs.findIndex((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName);\r\n\r\n  let deleteConfig = !tokenConfig || Object.keys(tokenConfig).length === 0;\r\n  if (!deleteConfig) {\r\n    tokenConfig['tvImgSrc'] = imgSrc;\r\n    tokenConfig['tvImgName'] = imgName;\r\n  }\r\n\r\n  if (tcIndex != -1 && !deleteConfig) {\r\n    tokenConfigs[tcIndex] = tokenConfig;\r\n  } else if (tcIndex != -1 && deleteConfig) {\r\n    tokenConfigs.splice(tcIndex, 1);\r\n  } else if (!deleteConfig) {\r\n    tokenConfigs.push(tokenConfig);\r\n  }\r\n  updateSettings({ tokenConfigs: tokenConfigs });\r\n  return !deleteConfig;\r\n}\r\n\r\n/**\r\n * Extracts the file name from the given path.\r\n */\r\nexport function getFileName(path) {\r\n  if (!path) return '';\r\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop().split('.').slice(0, -1).join('.');\r\n}\r\n\r\n/**\r\n * Extracts the file name including the extension from the given path.\r\n */\r\nexport function getFileNameWithExt(path) {\r\n  if (!path) return '';\r\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop();\r\n}\r\n\r\n/**\r\n * Extract the directory path excluding the file name.\r\n */\r\nexport function getFilePath(path) {\r\n  return decodeURISafely(path).match(/(.*)[\\/\\\\]/)[1] || '';\r\n}\r\n\r\n/**\r\n * Simplify name.\r\n */\r\nexport function simplifyName(name) {\r\n  return name.replace(simplifyRegex, '').toLowerCase();\r\n}\r\n\r\nexport function simplifyPath(path) {\r\n  return decodeURIComponentSafely(path).replace(simplifyRegex, '').toLowerCase();\r\n}\r\n\r\n/**\r\n * Parses the 'excludedKeyword' setting (a comma separated string) into a Set\r\n */\r\nexport function parseKeywords(keywords) {\r\n  return keywords\r\n    .split(/\\W/)\r\n    .map((word) => simplifyName(word))\r\n    .filter((word) => word != '');\r\n}\r\n\r\n/**\r\n * Returns true of provided path points to an image\r\n */\r\nexport function isImage(path) {\r\n  var extension = path.split('.');\r\n  extension = extension[extension.length - 1].toLowerCase();\r\n  return ['jpg', 'jpeg', 'png', 'svg', 'webp', 'gif'].includes(extension);\r\n}\r\n\r\n/**\r\n * Returns true of provided path points to a video\r\n */\r\nexport function isVideo(path) {\r\n  var extension = path.split('.');\r\n  extension = extension[extension.length - 1].toLowerCase();\r\n  return ['mp4', 'ogg', 'webm', 'm4v'].includes(extension);\r\n}\r\n\r\n/**\r\n * Send a recursive HTTP asset browse request to ForgeVTT\r\n * @param {string} path Asset Library path\r\n * @param {string} apiKey Key with read access to the Asset Library\r\n * @returns\r\n */\r\nexport async function callForgeVTT(path, apiKey) {\r\n  return new Promise(async (resolve, reject) => {\r\n    if (typeof ForgeVTT === 'undefined' || !ForgeVTT.usingTheForge) return resolve({});\r\n\r\n    const url = `${ForgeVTT.FORGE_URL}/api/assets/browse`;\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.withCredentials = true;\r\n    xhr.open('POST', url);\r\n    xhr.setRequestHeader('Access-Key', apiKey);\r\n    xhr.setRequestHeader('X-XSRF-TOKEN', await ForgeAPI.getXSRFToken());\r\n    xhr.responseType = 'json';\r\n\r\n    xhr.onreadystatechange = () => {\r\n      if (xhr.readyState !== 4) return;\r\n      resolve(xhr.response);\r\n    };\r\n    xhr.onerror = (err) => {\r\n      resolve({ code: 500, error: err.message });\r\n    };\r\n    let formData = {\r\n      path: path,\r\n      options: {\r\n        recursive: true,\r\n      },\r\n    };\r\n    formData = JSON.stringify(formData);\r\n    xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\r\n    xhr.send(formData);\r\n  });\r\n}\r\n\r\n/**\r\n * Retrieves filters based on the type of search.\r\n * @param {SEARCH_TYPE} searchType\r\n */\r\nexport function getFilters(searchType, filters) {\r\n  // Select filters based on type of search\r\n  filters = filters ? filters : TVA_CONFIG.searchFilters;\r\n\r\n  if (filters[searchType]) {\r\n    filters = filters[searchType];\r\n  } else {\r\n    filters = {\r\n      include: '',\r\n      exclude: '',\r\n      regex: '',\r\n    };\r\n  }\r\n\r\n  if (filters.regex) filters.regex = new RegExp(filters.regex);\r\n  return filters;\r\n}\r\n\r\nexport function userRequiresImageCache(perm) {\r\n  const permissions = perm ? perm : TVA_CONFIG.permissions;\r\n  const role = game.user.role;\r\n  return (\r\n    permissions.popups[role] ||\r\n    permissions.portrait_right_click[role] ||\r\n    permissions.image_path_button[role] ||\r\n    permissions.hudFullAccess[role]\r\n  );\r\n}\r\n\r\nexport async function waitForTokenTexture(token, callback, checks = 40) {\r\n  // v10/v9 compatibility\r\n\r\n  if (!token.mesh || !token.mesh.texture) {\r\n    checks--;\r\n    if (checks > 1)\r\n      new Promise((resolve) => setTimeout(resolve, 1)).then(() => waitForTokenTexture(token, callback, checks));\r\n    return;\r\n  }\r\n\r\n  callback(token);\r\n}\r\n\r\nexport function flattenSearchResults(results) {\r\n  let flattened = [];\r\n  if (!results) return flattened;\r\n  results.forEach((images) => {\r\n    flattened = flattened.concat(images);\r\n  });\r\n  return flattened;\r\n}\r\n\r\n// Slightly modified version of mergeObject; added an option to ignore -= keys\r\nexport function modMergeObject(\r\n  original,\r\n  other = {},\r\n  {\r\n    insertKeys = true,\r\n    insertValues = true,\r\n    overwrite = true,\r\n    recursive = true,\r\n    inplace = true,\r\n    enforceTypes = false,\r\n  } = {},\r\n  _d = 0\r\n) {\r\n  other = other || {};\r\n  if (!(original instanceof Object) || !(other instanceof Object)) {\r\n    throw new Error('One of original or other are not Objects!');\r\n  }\r\n  const options = {\r\n    insertKeys,\r\n    insertValues,\r\n    overwrite,\r\n    recursive,\r\n    inplace,\r\n    enforceTypes,\r\n  };\r\n\r\n  // Special handling at depth 0\r\n  if (_d === 0) {\r\n    if (!inplace) original = foundry.utils.deepClone(original);\r\n    if (Object.keys(original).some((k) => /\\./.test(k))) original = foundry.utils.expandObject(original);\r\n    if (Object.keys(other).some((k) => /\\./.test(k))) other = foundry.utils.expandObject(other);\r\n  }\r\n\r\n  // Iterate over the other object\r\n  for (let k of Object.keys(other)) {\r\n    const v = other[k];\r\n    if (original.hasOwnProperty('-=' + k)) {\r\n      original[k] = original['-=' + k];\r\n      delete original['-=' + k];\r\n    }\r\n    if (original.hasOwnProperty(k)) _modMergeUpdate(original, k, v, options, _d + 1);\r\n    else _modMergeInsert(original, k, v, options, _d + 1);\r\n  }\r\n  return original;\r\n}\r\n\r\n/**\r\n * A helper function for merging objects when the target key does not exist in the original\r\n * @private\r\n */\r\nfunction _modMergeInsert(original, k, v, { insertKeys, insertValues } = {}, _d) {\r\n  // Recursively create simple objects\r\n  if (v?.constructor === Object) {\r\n    original[k] = modMergeObject({}, v, {\r\n      insertKeys: true,\r\n      inplace: true,\r\n    });\r\n    return;\r\n  }\r\n\r\n  // Delete a key\r\n  // if (k.startsWith('-=')) {\r\n  //   delete original[k.slice(2)];\r\n  //   return;\r\n  // }\r\n\r\n  // Insert a key\r\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\r\n  if (canInsert) original[k] = v;\r\n}\r\n\r\n/**\r\n * A helper function for merging objects when the target key exists in the original\r\n * @private\r\n */\r\nfunction _modMergeUpdate(original, k, v, { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {}, _d) {\r\n  const x = original[k];\r\n  const tv = foundry.utils.getType(v);\r\n  const tx = foundry.utils.getType(x);\r\n\r\n  // Recursively merge an inner object\r\n  if (tv === 'Object' && tx === 'Object' && recursive) {\r\n    return modMergeObject(\r\n      x,\r\n      v,\r\n      {\r\n        insertKeys: insertKeys,\r\n        insertValues: insertValues,\r\n        overwrite: overwrite,\r\n        inplace: true,\r\n        enforceTypes: enforceTypes,\r\n      },\r\n      _d\r\n    );\r\n  }\r\n\r\n  // Overwrite an existing value\r\n  if (overwrite) {\r\n    if (tx !== 'undefined' && tv !== tx && enforceTypes) {\r\n      throw new Error(`Mismatched data types encountered during object merge.`);\r\n    }\r\n    original[k] = v;\r\n  }\r\n}\r\n\r\nexport async function tv_executeScript(script, { actor, token, tvaUpdate } = {}) {\r\n  // Add variables to the evaluation scope\r\n  const speaker = ChatMessage.getSpeaker();\r\n  const character = game.user.character;\r\n\r\n  token = token?.object || token || (canvas.ready ? canvas.tokens.get(speaker.token) : null);\r\n  actor = actor || token?.actor || game.actors.get(speaker.actor);\r\n\r\n  // Attempt script execution\r\n  const AsyncFunction = async function () {}.constructor;\r\n  try {\r\n    const fn = AsyncFunction('speaker', 'actor', 'token', 'character', 'tvaUpdate', `${script}`);\r\n    await fn.call(null, speaker, actor, token, character, tvaUpdate);\r\n  } catch (err) {\r\n    ui.notifications.error(`There was an error in your script syntax. See the console (F12) for details`);\r\n    console.error(err);\r\n  }\r\n}\r\n\r\nexport async function executeMacro(macroName, token) {\r\n  token = token?.object || token;\r\n  game.macros.find((m) => m.name === macroName)?.execute({ token });\r\n}\r\n\r\nexport async function applyTMFXPreset(token, presetName, action = 'apply') {\r\n  token = token.object ?? token;\r\n  if (game.modules.get('tokenmagic')?.active && token.document) {\r\n    const preset = TokenMagic.getPreset(presetName);\r\n    if (preset) {\r\n      if (action === 'apply') {\r\n        await TokenMagic.addUpdateFilters(token, preset);\r\n      } else if (action === 'remove') {\r\n        await TokenMagic.deleteFilters(token, presetName);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport async function toggleTMFXPreset(token, presetName) {\r\n  token = token.object ?? token;\r\n  if (game.modules.get('tokenmagic')?.active && token.document) {\r\n    if (TokenMagic.hasFilterId(token, presetName)) {\r\n      applyTMFXPreset(token, presetName, 'remove');\r\n    } else {\r\n      applyTMFXPreset(token, presetName, 'apply');\r\n    }\r\n  }\r\n}\r\n\r\nexport async function applyCEEffect(tokenDoc, ceEffect, action = 'apply') {\r\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\r\n    if (!ceEffect.apply && !ceEffect.remove) return;\r\n    else if (!ceEffect.apply || !ceEffect.remove) {\r\n      if (action === 'apply') {\r\n        if (ceEffect.remove) action = 'remove';\r\n      } else return;\r\n    }\r\n\r\n    let uuid = tokenDoc.actor?.uuid;\r\n    if (uuid) {\r\n      if (action === 'apply') {\r\n        await game.dfreds.effectInterface.addEffect({\r\n          effectName: ceEffect.name,\r\n          uuid,\r\n          origin: 'token-variants',\r\n          overlay: false,\r\n        });\r\n      } else {\r\n        await game.dfreds.effectInterface.removeEffect({ effectName: ceEffect.name, uuid });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport async function toggleCEEffect(token, effectName) {\r\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\r\n    let uuid = (token.document ?? token).actor?.uuid;\r\n    await game.dfreds.effectInterface.toggleEffect(effectName, {\r\n      uuids: [uuid],\r\n      overlay: false,\r\n    });\r\n  }\r\n}\r\n\r\nexport class TokenDataAdapter {\r\n  static dataToForm(data) {\r\n    if ('texture.scaleX' in data) {\r\n      data.scale = Math.abs(data['texture.scaleX']);\r\n      data.mirrorX = data['texture.scaleX'] < 0;\r\n    }\r\n    if ('texture.scaleY' in data) {\r\n      data.scale = Math.abs(data['texture.scaleY']);\r\n      data.mirrorY = data['texture.scaleY'] < 0;\r\n    }\r\n  }\r\n\r\n  static formToData(token, formData) {\r\n    // Scale/mirroring\r\n    if ('scale' in formData || 'mirrorX' in formData || 'mirrorY' in formData) {\r\n      const doc = token.document ? token.document : token;\r\n      if (!('scale' in formData)) formData.scale = Math.abs(doc.texture.scaleX);\r\n      if (!('mirrorX' in formData)) formData.mirrorX = doc.texture.scaleX < 0;\r\n      if (!('mirrorY' in formData)) formData.mirrorY = doc.texture.scaleY < 0;\r\n      foundry.utils.setProperty(formData, 'texture.scaleX', formData.scale * (formData.mirrorX ? -1 : 1));\r\n      foundry.utils.setProperty(formData, 'texture.scaleY', formData.scale * (formData.mirrorY ? -1 : 1));\r\n      ['scale', 'mirrorX', 'mirrorY'].forEach((k) => delete formData[k]);\r\n    }\r\n  }\r\n}\r\n\r\nexport function determineAddedRemovedEffects(addedEffects, removedEffects, newEffects, oldEffects) {\r\n  for (const ef of newEffects) {\r\n    if (!oldEffects.includes(ef)) {\r\n      addedEffects.add(ef);\r\n    }\r\n  }\r\n  for (const ef of oldEffects) {\r\n    if (!newEffects.includes(ef)) {\r\n      removedEffects.add(ef);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function wildcardImageSearch(imgSrc) {\r\n  let source = 'data';\r\n  const browseOptions = { wildcard: true };\r\n\r\n  // Support non-user sources\r\n  if (/\\.s3\\./.test(imgSrc)) {\r\n    source = 's3';\r\n    const { bucket, keyPrefix } = foundry.applications.apps.FilePicker.implementation.parseS3URL(imgSrc);\r\n    if (bucket) {\r\n      browseOptions.bucket = bucket;\r\n      imgSrc = keyPrefix;\r\n    }\r\n  } else if (imgSrc.startsWith('icons/')) source = 'public';\r\n\r\n  // Retrieve wildcard content\r\n  try {\r\n    const content = await foundry.applications.apps.FilePicker.implementation.browse(source, imgSrc, browseOptions);\r\n    return content.files;\r\n  } catch (err) {}\r\n  return [];\r\n}\r\n\r\n/**\r\n * Returns a random name generated using Name Forge module\r\n * @param {*} randomizerSettings\r\n * @returns\r\n */\r\nexport async function nameForgeRandomize(randomizerSettings) {\r\n  const nameForgeSettings = randomizerSettings.nameForge;\r\n  if (nameForgeSettings?.randomize && nameForgeSettings?.models) {\r\n    const nameForge = game.modules.get('nameforge');\r\n    if (nameForge?.active) {\r\n      const randomNames = [];\r\n      for (const modelKey of nameForgeSettings.models) {\r\n        const modelProp = foundry.utils.getProperty(nameForge.models, modelKey);\r\n        if (modelProp) {\r\n          const model = await nameForge.api.createModel(modelProp);\r\n          if (model) {\r\n            randomNames.push(nameForge.api.generateName(model)[0]);\r\n          }\r\n        }\r\n      }\r\n      return randomNames[Math.floor(Math.random() * randomNames.length)];\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Upload Token and associated overlays as a single image\r\n */\r\nexport async function uploadTokenImage(token, options) {\r\n  let renderTexture = captureToken(token, options);\r\n  if (renderTexture) {\r\n    const b64 = canvas.app.renderer.extract.base64(renderTexture, 'image/webp', 1);\r\n    let res = await fetch(b64);\r\n    let blob = await res.blob();\r\n    const filename = options.name + `.webp`;\r\n    let file = new File([blob], filename, { type: 'image/webp' });\r\n    await foundry.applications.apps.FilePicker.implementation.upload('data', options.path, file, {});\r\n  }\r\n}\r\n\r\n/**\r\n * Modified version of 'dev7355608' captureCanvas function. Captures combined Token and Overlay image\r\n */\r\nfunction captureToken(token, { scale = 3, width = null, height = null } = {}) {\r\n  if (!canvas.ready || !token) {\r\n    return;\r\n  }\r\n\r\n  width = width ?? token.texture.width;\r\n  height = height ?? token.texture.height;\r\n\r\n  scale = scale * Math.min(width / token.texture.width, height / token.texture.height);\r\n\r\n  const renderer = canvas.app.renderer;\r\n  const viewPosition = { ...canvas.scene._viewPosition };\r\n\r\n  renderer.resize(width ?? renderer.screen.width, height ?? renderer.screen.height);\r\n\r\n  width = canvas.screenDimensions[0] = renderer.screen.width;\r\n  height = canvas.screenDimensions[1] = renderer.screen.height;\r\n\r\n  canvas.stage.position.set(width / 2, height / 2);\r\n\r\n  canvas.pan({\r\n    x: token.center.x,\r\n    y: token.center.y,\r\n    scale,\r\n  });\r\n\r\n  const renderTexture = PIXI.RenderTexture.create({\r\n    width,\r\n    height,\r\n    resolution: token.texture.resolution,\r\n  });\r\n\r\n  const cacheParent = canvas.stage.enableTempParent();\r\n\r\n  canvas.stage.updateTransform();\r\n  canvas.stage.disableTempParent(cacheParent);\r\n\r\n  let spritesToRender = [token.mesh];\r\n  if (token.tvaOverlays) spritesToRender = spritesToRender.concat(token.tvaOverlays);\r\n  spritesToRender.sort((sprite) => sprite.sort);\r\n\r\n  for (const sprite of spritesToRender) {\r\n    renderer.render(sprite, { renderTexture, skipUpdateTransform: true, clear: false });\r\n  }\r\n\r\n  canvas._onResize();\r\n  canvas.pan(viewPosition);\r\n\r\n  return renderTexture;\r\n}\r\n\r\nexport function getAllActorTokens(actor, linked = false, document = false) {\r\n  if (actor.isToken) {\r\n    if (document) return [actor.token];\r\n    else if (actor.token.object) return [actor.token.object];\r\n    else return [];\r\n  }\r\n\r\n  const tokens = [];\r\n  game.scenes.forEach((scene) =>\r\n    scene.tokens.forEach((token) => {\r\n      if (token.actorId === actor.id) {\r\n        if (linked && token.actorLink) tokens.push(token);\r\n        else if (!linked) tokens.push(token);\r\n      }\r\n    })\r\n  );\r\n  if (document) return tokens;\r\n  else return tokens.map((token) => token.object).filter((token) => token);\r\n}\r\n\r\nexport function extractDimensionsFromImgName(img, dimensions = {}) {\r\n  const name = getFileName(img);\r\n\r\n  let scale;\r\n  if (TVA_CONFIG.imgNameContainsDimensions) {\r\n    const height = name.match(/_height(.*)_/)?.[1];\r\n    if (height) dimensions.height = parseFloat(height);\r\n    const width = name.match(/_width(.*)_/)?.[1];\r\n    if (width) dimensions.width = parseFloat(width);\r\n    scale = name.match(/_scale(.*)_/)?.[1];\r\n    if (scale) scale = Math.max(parseFloat(scale), 0.2);\r\n  }\r\n  if (TVA_CONFIG.imgNameContainsFADimensions) {\r\n    scale = name.match(/_Scale(\\d+)_/)?.[1];\r\n    if (scale) {\r\n      scale = Math.max(parseInt(scale) / 100, 0.2);\r\n    }\r\n  }\r\n  if (scale) {\r\n    dimensions['texture.scaleX'] = scale;\r\n    dimensions['texture.scaleY'] = scale;\r\n  }\r\n  return dimensions;\r\n}\r\n\r\nexport function string2Hex(hexString) {\r\n  return PIXI.utils.string2hex(hexString);\r\n}\r\n\r\nexport function decodeURISafely(uri) {\r\n  try {\r\n    return decodeURI(uri);\r\n  } catch (e) {\r\n    console.warn('URI Component not decodable: ' + uri);\r\n    return uri;\r\n  }\r\n}\r\n\r\nexport function decodeURIComponentSafely(uri) {\r\n  try {\r\n    return decodeURIComponent(uri);\r\n  } catch (e) {\r\n    console.warn('URI Component not decodable: ' + uri);\r\n    return uri;\r\n  }\r\n}\r\n\r\nexport function mergeMappings(from, to) {\r\n  const changedIDs = {};\r\n\r\n  for (const m of from) {\r\n    const i = to.findIndex((mapping) => mapping.label === m.label && mapping.group === m.group);\r\n    if (i === -1) to.push(m);\r\n    else {\r\n      changedIDs[to.id] = m.id;\r\n      if (to[i].tokens?.length) {\r\n        if (!m.tokens) m.tokens = [];\r\n        to[i].tokens.forEach((id) => {\r\n          if (!m.tokens.includes(id)) m.tokens.push(id);\r\n        });\r\n      }\r\n      to[i] = m;\r\n    }\r\n  }\r\n\r\n  // If parent's id has been changed we need to update all the children\r\n  to.forEach((m) => {\r\n    let pID = m.overlayConfig?.parentID;\r\n    if (pID && pID in changedIDs) {\r\n      m.overlayConfig.parentID = changedIDs[pID];\r\n    }\r\n  });\r\n\r\n  return to;\r\n}\r\n\r\nexport function isResponsibleGM() {\r\n  const isResponsibleGM = !game.users\r\n    .filter((user) => user.isGM && (user.active || user.isActive))\r\n    .some((other) => other.id < game.user.id);\r\n  return isResponsibleGM;\r\n}\r\n","import { TVA_CONFIG } from '../settings.js';\r\nimport { decodeURISafely } from '../utils.js';\r\nimport { registerWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'UserMappings';\r\n\r\nexport function registerUserMappingWrappers() {\r\n  registerWrapper(feature_id, 'foundry.canvas.placeables.Tile.prototype.draw', _draw);\r\n  registerWrapper(feature_id, 'foundry.canvas.placeables.Token.prototype.draw', _draw);\r\n}\r\n\r\nasync function _draw(wrapped, ...args) {\r\n  let result;\r\n\r\n  // If the Token/Tile has a UserToImage mappings momentarily set document.texture.src to it\r\n  // so that it's texture gets loaded instead of the actual Token image\r\n  const mappings = this.document.getFlag('token-variants', 'userMappings') || {};\r\n  const img = mappings[game.userId];\r\n  let previous;\r\n  if (img) {\r\n    previous = this.document.texture.src;\r\n    this.document.texture.src = img;\r\n    this.tva_iconOverride = img;\r\n    result = await wrapped(...args);\r\n    this.document.texture.src = previous;\r\n    overrideVisibility(this, img);\r\n  } else {\r\n    overrideVisibility(this);\r\n    result = await wrapped(...args);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * If the img is the same as TVA_CONFIG.invisibleImage then we'll override the isVisible\r\n * getter to return false of this client if it's not a GM. Reset it to default if not.\r\n * @param {*} obj object whose isVisible is to be overriden\r\n * @param {*} img UserToImage mapping\r\n */\r\nfunction overrideVisibility(obj, img) {\r\n  if (img && decodeURISafely(img) === TVA_CONFIG.invisibleImage && !obj.tva_customVisibility) {\r\n    const originalIsVisible = _getIsVisibleDescriptor(obj).get;\r\n    Object.defineProperty(obj, 'isVisible', {\r\n      get: function () {\r\n        const isVisible = originalIsVisible.call(this);\r\n        if (isVisible && !game.user.isGM) return false;\r\n        return isVisible;\r\n      },\r\n      configurable: true,\r\n    });\r\n    obj.tva_customVisibility = true;\r\n  } else if (!img && obj.tva_customVisibility) {\r\n    Object.defineProperty(obj, 'isVisible', _getIsVisibleDescriptor(obj));\r\n    delete obj.tva_customVisibility;\r\n  }\r\n}\r\n\r\nfunction _getIsVisibleDescriptor(obj) {\r\n  let iObj = Object.getPrototypeOf(obj);\r\n  let descriptor = null;\r\n  while (iObj) {\r\n    descriptor = Object.getOwnPropertyDescriptor(iObj, 'isVisible');\r\n    if (descriptor) break;\r\n    iObj = Object.getPrototypeOf(iObj);\r\n  }\r\n  return descriptor;\r\n}\r\n\r\n/**\r\n * Assign an image to be displayed to only that user.\r\n * @param {*} token token the image is to be applied to\r\n * @param {*} img image to be displayed, if no image is provided unassignUserSpecificImage(...) will be called\r\n * @param {*} opts.userName name of the user that the image is to be displayed to\r\n * @param {*} opts.id id of the user that the image is to be displayed to\r\n * @returns\r\n */\r\nexport function assignUserSpecificImage(token, img, { userName = null, userId = null } = {}) {\r\n  if (!img) return unassignUserSpecificImage(token, { userName, userId });\r\n\r\n  if (userName instanceof Array) {\r\n    for (const name of userName) assignUserSpecificImage(token, img, { userName: name });\r\n    return;\r\n  }\r\n\r\n  if (userId instanceof Array) {\r\n    for (const id of userId) assignUserSpecificImage(token, img, { userId: id });\r\n    return;\r\n  }\r\n\r\n  let id = userId;\r\n  if (!id && userName) {\r\n    id = game.users.find((u) => u.name === userName)?.id;\r\n  }\r\n  if (!id) return;\r\n\r\n  const doc = token.document ?? token;\r\n  const mappings = doc.getFlag('token-variants', 'userMappings') || {};\r\n\r\n  mappings[id] = img;\r\n  doc.setFlag('token-variants', 'userMappings', mappings);\r\n}\r\n\r\n/**\r\n * Calls assignUserSpecificImage passing in all currently selected tokens.\r\n * @param {*} img image to be displayed\r\n * @param {*} opts id or name of the user as per assignUserSpecificImage(...)\r\n */\r\nexport function assignUserSpecificImageToSelected(img, opts = {}) {\r\n  const selected = [...canvas.tokens.controlled];\r\n  for (const t of selected) assignUserSpecificImage(t, img, opts);\r\n}\r\n\r\n/**\r\n * Un-assign image if one has been set to be displayed to a user.\r\n * @param {*} token token the image is to be removed from\r\n * @param {*} opts.userName name of the user that the image is to be removed for\r\n * @param {*} opts.id id of the user that the image is to be removed for\r\n */\r\nexport function unassignUserSpecificImage(token, { userName = null, userId = null } = {}) {\r\n  if (userName instanceof Array) {\r\n    for (const name of userName) unassignUserSpecificImage(token, { userName: name });\r\n    return;\r\n  }\r\n\r\n  if (userId instanceof Array) {\r\n    for (const id of userId) unassignUserSpecificImage(token, { userId: id });\r\n    return;\r\n  }\r\n\r\n  let id = userId;\r\n  if (!id && userName) {\r\n    id = game.users.find((u) => u.name === userName)?.id;\r\n  }\r\n  if (!id) {\r\n    if (!userName && !userId) (token.document ?? token).unsetFlag('token-variants', 'userMappings');\r\n  } else {\r\n    const update = {};\r\n    update['flags.token-variants.userMappings.-=' + id] = null;\r\n    (token.document ?? token).update(update);\r\n  }\r\n}\r\n\r\n/**\r\n * Calls unassignUserSpecificImage passing in all currently selected tokens.\r\n * @param {*} opts id or name of the user as per unassignUserSpecificImage(...)\r\n */\r\nexport function unassignUserSpecificImageFromSelected(opts = {}) {\r\n  const selected = [...canvas.tokens.controlled];\r\n  for (const t of selected) unassignUserSpecificImage(t, opts);\r\n}\r\n","import { getAllEffectMappings } from '../hooks/effectMappingHooks.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'EffectIcons';\r\n\r\nexport function registerEffectIconWrappers() {\r\n  unregisterWrapper(feature_id, 'foundry.canvas.placeables.Token.prototype.drawEffects');\r\n  unregisterWrapper(feature_id, 'foundry.applications.sidebar.tabs.CombatTracker.prototype._prepareTurnContext');\r\n  if (!FEATURE_CONTROL[feature_id]) return;\r\n\r\n  if (!TVA_CONFIG.disableEffectIcons && TVA_CONFIG.filterEffectIcons && !['pf1e', 'pf2e'].includes(game.system.id)) {\r\n    registerWrapper(feature_id, 'foundry.canvas.placeables.Token.prototype.drawEffects', _drawEffects, 'OVERRIDE');\r\n  } else if (TVA_CONFIG.disableEffectIcons) {\r\n    registerWrapper(\r\n      feature_id,\r\n      'foundry.canvas.placeables.Token.prototype._drawEffects',\r\n      _drawEffects_fullReplace,\r\n      'OVERRIDE'\r\n    );\r\n  } else if (TVA_CONFIG.displayEffectIconsOnHover) {\r\n    registerWrapper(\r\n      feature_id,\r\n      'foundry.canvas.placeables.Token.prototype.drawEffects',\r\n      _drawEffects_hoverOnly,\r\n      'WRAPPER'\r\n    );\r\n  }\r\n\r\n  if (TVA_CONFIG.disableEffectIcons || TVA_CONFIG.filterCustomEffectIcons) {\r\n    registerWrapper(\r\n      feature_id,\r\n      'foundry.applications.sidebar.tabs.CombatTracker.prototype._prepareTurnContext',\r\n      _combatTrackerPrepareTurnContext,\r\n      'WRAPPER'\r\n    );\r\n  }\r\n}\r\n\r\nasync function _drawEffects_hoverOnly(wrapped, ...args) {\r\n  let result = await wrapped(...args);\r\n  this.effects.visible = this.hover;\r\n  return result;\r\n}\r\n\r\nasync function _drawEffects_fullReplace(...args) {\r\n  this.effects.removeChildren().forEach((c) => c.destroy());\r\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\r\n  this.effects.overlay = null;\r\n}\r\n\r\nasync function _combatTrackerPrepareTurnContext(wrapped, ...args) {\r\n  const context = await wrapped(...args);\r\n\r\n  if (TVA_CONFIG.disableEffectIcons) {\r\n    context.effects = {};\r\n  } else if (TVA_CONFIG.filterEffectIcons && context.effects?.icons) {\r\n    const restrictedEffects = _getRestrictedEffects(args[1].token);\r\n    if (!restrictedEffects.length) return;\r\n\r\n    const icons = context.effect.icons.filter((i) => !restrictedEffects.includes(i.name));\r\n    context.effects = {\r\n      icons,\r\n      tooltip: this._formatEffectsTooltip(icons),\r\n    };\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\nasync function _drawEffects(...args) {\r\n  this.effects.renderable = false;\r\n\r\n  // Clear Effects Container\r\n  this.effects.removeChildren().forEach((c) => c.destroy());\r\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\r\n  this.effects.bg.zIndex = -1;\r\n  this.effects.overlay = null;\r\n\r\n  // Categorize effects\r\n  let activeEffects = this.actor?.temporaryEffects || [];\r\n  let overlayEffect = activeEffects.findLast((e) => e.img && e.getFlag('core', 'overlay'));\r\n\r\n  // Modified from the original token.drawEffects\r\n  if (TVA_CONFIG.displayEffectIconsOnHover) this.effects.visible = this.hover;\r\n  if (activeEffects.length) {\r\n    const restrictedEffects = _getRestrictedEffects(this.document);\r\n    activeEffects = activeEffects.filter((ef) => !restrictedEffects.includes(ef.name));\r\n  }\r\n  // End of modifications\r\n\r\n  // Draw effects\r\n  const promises = [];\r\n  for (const [i, effect] of activeEffects.entries()) {\r\n    if (!effect.img) continue;\r\n    const promise =\r\n      effect === overlayEffect ? this._drawOverlay(effect.img, effect.tint) : this._drawEffect(effect.img, effect.tint);\r\n    promises.push(\r\n      promise.then((e) => {\r\n        if (e) e.zIndex = i;\r\n      })\r\n    );\r\n  }\r\n  await Promise.allSettled(promises);\r\n\r\n  this.effects.sortChildren();\r\n  this.effects.renderable = true;\r\n  this.renderFlags.set({ refreshEffects: true });\r\n}\r\n\r\nfunction _getRestrictedEffects(tokenDoc) {\r\n  let restrictedEffects = TVA_CONFIG.filterIconList;\r\n  if (TVA_CONFIG.filterCustomEffectIcons) {\r\n    const mappings = getAllEffectMappings(tokenDoc);\r\n    if (mappings) restrictedEffects = restrictedEffects.concat(mappings.map((m) => m.expression));\r\n  }\r\n  return restrictedEffects;\r\n}\r\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'HideElement';\r\n\r\nexport function registerHideElementWrappers() {\r\n  unregisterWrapper(feature_id, 'Token.prototype._getTooltipText');\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideElevationTooltip) {\r\n    registerWrapper(feature_id, 'Token.prototype._getTooltipText', _getTooltipText, 'WRAPPER');\r\n  }\r\n\r\n  unregisterWrapper(feature_id, 'Token.prototype._refreshBorder');\r\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideTokenBorder) {\r\n    registerWrapper(feature_id, 'Token.prototype._refreshBorder', _refreshVisibility, 'OVERRIDE');\r\n  }\r\n}\r\n\r\nfunction _getTooltipText(wrapped, ...args) {\r\n  wrapped(...args);\r\n  return '';\r\n}\r\n\r\nfunction _refreshVisibility(...args) {}\r\n","import { renderContextMenuPalette, renderPalette, TOKEN_HUD_VARIANTS } from '../../applications/tokenHUD.js';\r\nimport { Reticle } from '../reticle.js';\r\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\r\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\r\n\r\nconst feature_id = 'HUD';\r\n\r\nexport function registerHUDWrappers() {\r\n  unregisterWrapper(feature_id, 'foundry.applications.hud.TokenHUD.prototype.clear');\r\n  unregisterWrapper(feature_id, 'foundry.applications.hud.TokenHUD.prototype._initializeApplicationOptions');\r\n  if (FEATURE_CONTROL[feature_id]) {\r\n    registerWrapper(feature_id, 'foundry.applications.hud.TokenHUD.prototype.clear', _clear, 'MIXED');\r\n    registerWrapper(\r\n      feature_id,\r\n      'foundry.applications.hud.TokenHUD.prototype._initializeApplicationOptions',\r\n      _initializeApplicationOptions,\r\n      'WRAPPER'\r\n    );\r\n  }\r\n}\r\n\r\nfunction _clear(wrapped, ...args) {\r\n  _applyVariantFlags();\r\n\r\n  // HUD should not close if we're in assisted overlay positioning mode\r\n  if (Reticle.active && Reticle.mode === 'hud') return;\r\n  return wrapped(...args);\r\n}\r\n\r\nasync function _applyVariantFlags() {\r\n  const { actor, variants } = TOKEN_HUD_VARIANTS;\r\n  if (actor) {\r\n    if (!variants?.length) {\r\n      actor.unsetFlag('token-variants', 'variants');\r\n    } else {\r\n      actor.setFlag('token-variants', 'variants', variants);\r\n    }\r\n  }\r\n  TOKEN_HUD_VARIANTS.actor = null;\r\n  TOKEN_HUD_VARIANTS.variants = null;\r\n}\r\n\r\nfunction _initializeApplicationOptions(wrapped, options) {\r\n  const actions = options.actions ?? {};\r\n  actions.tva = tvaButtonClick;\r\n  options.actions = actions;\r\n  return wrapped(options);\r\n}\r\n\r\nasync function tvaButtonClick(event) {\r\n  const palette = this.element.querySelector(`.palette[data-palette=\"tva\"]`);\r\n\r\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\r\n\r\n  if (FULL_ACCESS && event.shiftKey) {\r\n    if (!palette || !palette.classList.contains('contextmenu')) {\r\n      palette?.remove();\r\n      this.element.querySelector('.col.right').appendChild((await renderContextMenuPalette(this.document))[0]);\r\n    }\r\n  } else if (!palette || palette.classList.contains('contextmenu')) {\r\n    palette?.remove();\r\n    this.element.querySelector('.col.right').appendChild((await renderPalette(this.document))[0]);\r\n  }\r\n\r\n  this.togglePalette('tva');\r\n}\r\n","import { registerEffectIconWrappers } from './effectIconWrappers.js';\r\nimport { registerHideElementWrappers } from './hideElementWrappers.js';\r\nimport { registerHUDWrappers } from './hudWrappers.js';\r\nimport { registerUserMappingWrappers } from './userMappingWrappers.js';\r\n\r\nexport const REGISTERED_WRAPPERS = {};\r\n\r\nexport function registerWrapper(feature_id, name, fn, method = 'WRAPPER') {\r\n  if (typeof libWrapper !== 'function') return;\r\n  if (!(feature_id in REGISTERED_WRAPPERS)) REGISTERED_WRAPPERS[feature_id] = {};\r\n  if (name in REGISTERED_WRAPPERS[feature_id]) return;\r\n\r\n  REGISTERED_WRAPPERS[feature_id][name] = libWrapper.register('token-variants', name, fn, method);\r\n}\r\n\r\nexport function unregisterWrapper(feature_id, name) {\r\n  if (typeof libWrapper !== 'function') return;\r\n  if (feature_id in REGISTERED_WRAPPERS && name in REGISTERED_WRAPPERS[feature_id]) {\r\n    libWrapper.unregister('token-variants', REGISTERED_WRAPPERS[feature_id][name]);\r\n    delete REGISTERED_WRAPPERS[feature_id][name];\r\n  }\r\n}\r\n\r\nexport function registerAllWrappers() {\r\n  // User to Image mappings for Tile and Tokens\r\n  registerUserMappingWrappers();\r\n  // Hide effect icons\r\n  registerEffectIconWrappers();\r\n  // Token HUD Variants Management\r\n  registerHUDWrappers();\r\n  // Hide Core Token Elements\r\n  registerHideElementWrappers();\r\n}\r\n","import { registerSettings, TVA_CONFIG, exportSettingsToJSON, updateSettings } from './scripts/settings.js';\r\nimport { ArtSelect, addToArtSelectQueue } from './applications/artSelect.js';\r\nimport {\r\n  SEARCH_TYPE,\r\n  registerKeybinds,\r\n  updateTokenImage,\r\n  startBatchUpdater,\r\n  userRequiresImageCache,\r\n  waitForTokenTexture,\r\n  isResponsibleGM,\r\n} from './scripts/utils.js';\r\nimport { FONT_LOADING, broadcastDrawOverlays, drawOverlays } from './scripts/token/overlay.js';\r\nimport {\r\n  getTokenEffects,\r\n  setOverlayVisibility,\r\n  toggleTemplate,\r\n  toggleTemplateOnSelected,\r\n  updateWithEffectMapping,\r\n} from './scripts/hooks/effectMappingHooks.js';\r\nimport { cacheImages, doImageSearch, doRandomSearch, isCaching } from './scripts/search.js';\r\nimport { REGISTERED_HOOKS, registerAllHooks, registerHook } from './scripts/hooks/hooks.js';\r\nimport { REGISTERED_WRAPPERS, registerAllWrappers } from './scripts/wrappers/wrappers.js';\r\nimport {\r\n  assignUserSpecificImage,\r\n  assignUserSpecificImageToSelected,\r\n  unassignUserSpecificImage,\r\n  unassignUserSpecificImageFromSelected,\r\n} from './scripts/wrappers/userMappingWrappers.js';\r\nimport { toggleTemplateDialog } from './applications/dialogs.js';\r\n\r\n// Tracks if module has been initialized\r\nlet MODULE_INITIALIZED = false;\r\nexport function isInitialized() {\r\n  return MODULE_INITIALIZED;\r\n}\r\nlet onInit = [];\r\n\r\n/**\r\n * Initialize the Token Variants module on Foundry VTT init\r\n */\r\nasync function initialize() {\r\n  // Initialization should only be performed once\r\n  if (MODULE_INITIALIZED) {\r\n    return;\r\n  }\r\n\r\n  // Font Awesome need to be loaded manually on FireFox\r\n  FONT_LOADING.loading = foundry.applications.settings.menus.FontConfig.loadFont('fontAwesome', {\r\n    editor: false,\r\n    fonts: [{ urls: ['fonts/fontawesome/webfonts/fa-solid-900.ttf'] }],\r\n  });\r\n\r\n  // Want this to be executed once the module has initialized\r\n  onInit.push(() => {\r\n    // Need to wait for icons do be drawn first however I could not find a way\r\n    // to wait until that has occurred. Instead we'll just wait for some static\r\n    // amount of time.\r\n    new Promise((resolve) => setTimeout(resolve, 500)).then(() => {\r\n      for (const tkn of canvas.tokens.placeables) {\r\n        drawOverlays(tkn); // Draw Overlays\r\n\r\n        // Disable effect icons\r\n        if (TVA_CONFIG.disableEffectIcons) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.effects.removeChildren().forEach((c) => c.destroy());\r\n            token.effects.bg = token.effects.addChild(new PIXI.Graphics());\r\n            token.effects.overlay = null;\r\n          });\r\n        } else if (TVA_CONFIG.filterEffectIcons) {\r\n          waitForTokenTexture(tkn, (token) => {\r\n            token.drawEffects();\r\n          });\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  if (userRequiresImageCache()) cacheImages();\r\n\r\n  // Register ALL Hooks\r\n  registerAllHooks();\r\n\r\n  // Startup ticker that will periodically call 'updateEmbeddedDocuments' with all the accrued updates since the last tick\r\n  startBatchUpdater();\r\n\r\n  registerHook('Search', 'renderArtSelect', () => {\r\n    ArtSelect.executing = false;\r\n  });\r\n\r\n  // Handle broadcasts\r\n  game.socket?.on(`module.token-variants`, (message) => {\r\n    if (message.handlerName === 'forgeSearchPaths' && message.type === 'UPDATE') {\r\n      // Workaround for forgeSearchPaths setting to be updated by non-GM clients\r\n      if (!game.user.isGM) return;\r\n      if (!isResponsibleGM()) return;\r\n      updateSettings({ forgeSearchPaths: message.args });\r\n    } else if (message.handlerName === 'drawOverlays' && message.type === 'UPDATE') {\r\n      if (message.args.all) {\r\n        if (canvas.scene.id !== message.args.sceneId) {\r\n          for (const tkn of canvas.tokens.placeables) {\r\n            drawOverlays(tkn);\r\n          }\r\n        }\r\n      } else if (message.args.actorId) {\r\n        const actor = game.actors.get(message.args.actorId);\r\n        if (actor) actor.getActiveTokens(true)?.forEach((tkn) => drawOverlays(tkn));\r\n      } else if (message.args.tokenId) {\r\n        const tkn = canvas.tokens.get(message.args.tokenId);\r\n        if (tkn) drawOverlays(tkn);\r\n      }\r\n    } else if (message.handlerName === 'effectMappings') {\r\n      if (!game.user.isGM) return;\r\n      if (!isResponsibleGM()) return;\r\n      const args = message.args;\r\n      const token = game.scenes.get(args.sceneId)?.tokens.get(args.tokenId);\r\n      if (token) updateWithEffectMapping(token, { added: args.added, removed: args.removed });\r\n    }\r\n  });\r\n\r\n  MODULE_INITIALIZED = true;\r\n  for (const cb of onInit) {\r\n    cb();\r\n  }\r\n  onInit = [];\r\n}\r\n\r\n/**\r\n * Performs searches and displays the Art Select pop-up with the results\r\n * @param {string} search The text to be used as the search criteria\r\n * @param {object} [options={}] Options which customize the search\r\n * @param {Function[]} [options.callback] Function to be called with the user selected image path\r\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\r\n * @param {Token|Actor} [options.object] Token/Actor used when displaying Custom Token Config prompt\r\n * @param {boolean} [options.force] If true will always override the current Art Select window if one exists instead of adding it to the queue\r\n * @param {object} [options.searchOptions] Override search and filter settings\r\n */\r\nexport async function showArtSelect(\r\n  search,\r\n  {\r\n    callback = null,\r\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\r\n    object = null,\r\n    force = false,\r\n    preventClose = false,\r\n    image1 = '',\r\n    image2 = '',\r\n    displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\r\n    multipleSelection = false,\r\n    searchOptions = {},\r\n    allImages = null,\r\n  } = {}\r\n) {\r\n  if (isCaching()) return;\r\n\r\n  const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\r\n  if (ArtSelect.executing || (!force && artSelects.length !== 0)) {\r\n    addToArtSelectQueue(search, {\r\n      callback,\r\n      searchType,\r\n      object,\r\n      preventClose,\r\n      searchOptions,\r\n      allImages,\r\n    });\r\n    return;\r\n  }\r\n\r\n  ArtSelect.executing = true;\r\n  if (!allImages)\r\n    allImages = await doImageSearch(search, {\r\n      searchType: searchType,\r\n      searchOptions: searchOptions,\r\n    });\r\n\r\n  new ArtSelect(search, {\r\n    allImages: allImages,\r\n    searchType: searchType,\r\n    callback: callback,\r\n    object: object,\r\n    preventClose: preventClose,\r\n    image1: image1,\r\n    image2: image2,\r\n    displayMode: displayMode,\r\n    multipleSelection: multipleSelection,\r\n    searchOptions: searchOptions,\r\n  }).render(true);\r\n}\r\n\r\n// Initialize module\r\nregisterHook('main', 'ready', initialize, { once: true });\r\n\r\n// Register API and Keybinds\r\nregisterHook('main', 'init', function () {\r\n  registerSettings();\r\n  registerAllWrappers();\r\n\r\n  registerKeybinds();\r\n\r\n  const api = {\r\n    cacheImages,\r\n    doImageSearch,\r\n    doRandomSearch,\r\n    getTokenEffects,\r\n    showArtSelect,\r\n    updateTokenImage,\r\n    exportSettingsToJSON,\r\n    assignUserSpecificImage,\r\n    assignUserSpecificImageToSelected,\r\n    unassignUserSpecificImage,\r\n    unassignUserSpecificImageFromSelected,\r\n    setOverlayVisibility,\r\n    toggleTemplateDialog,\r\n    toggleTemplate,\r\n    toggleTemplateOnSelected,\r\n    drawOverlays,\r\n    broadcastDrawOverlays,\r\n    TVA_CONFIG,\r\n  };\r\n\r\n  Object.defineProperty(api, 'hooks', {\r\n    get() {\r\n      return foundry.utils.deepClone(REGISTERED_HOOKS);\r\n    },\r\n    configurable: true,\r\n  });\r\n\r\n  Object.defineProperty(api, 'wrappers', {\r\n    get() {\r\n      return foundry.utils.deepClone(REGISTERED_WRAPPERS);\r\n    },\r\n    configurable: true,\r\n  });\r\n\r\n  game.modules.get('token-variants').api = api;\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(652);\n"],"names":["addToArtSelectQueue","search","options","ArtSelect","queue","push","$","html","length","show","addToQueue","renderFromQueue","force","Object","values","ui","windows","filter","app","callData","shift","execute","delay","fn","ms","timer","args","clearTimeout","setTimeout","bind","this","FormApplication","static","NONE","PORTRAIT","TOKEN","PORTRAIT_TOKEN","IMAGE","constructor","preventClose","object","callback","searchType","allImages","image1","image2","displayMode","IMAGE_DISPLAY","multipleSelection","searchOptions","title","game","i18n","localize","super","closeOnSubmit","width","WIDTH","height","HEIGHT","left","LEFT","top","TOP","doc","foundry","utils","mergeObject","overwrite","instance","defineProperty","prototype","value","defaultOptions","id","classes","template","resizable","minimizable","_getHeaderButtons","buttons","unshift","label","class","icon","onclick","async","_performSearch","applications","apps","FilePicker","implementation","type","path","close","render","_typeSelect","categories","concat","customImageCategories","c","Dialog","content","getData","data","Item","item","description","system","algorithm","tokenConfigs","flat","fuzzySearch","fuzzy","allButtons","Map","artFound","genLabel","str","indices","start","end","fillChar","fillStr","repeat","lastIndex","index","slice","genTitle","obj","percent","Math","ceil","score","runSearchOnPath","forEach","images","imageObj","vid","img","name","hasConfig","PORTRAIT_AND_TOKEN","Boolean","find","config","tvImgSrc","tvImgName","set","displaySlider","fuzzyArtSelectPercentSlider","fuzzyThreshold","toFixed","autoplay","playVideoOnHover","activateListeners","boxes","hover","siblings","play","hide","pauseVideoOnHoverOut","pause","currentTime","map","box","addEventListener","event","target","dataset","filename","toggleClass","searchInput","focus","selectionStart","selectionEnd","on","change","e","parseFloat","each","getAttribute","trim","_updateObject","formData","setPosition","artSelects","appId","insertArtSelectButton","button","imgSrc","val","input","after","MissingImageConfig","missingImages","deepClone","compendiumMapper","documents","_processFormData","Array","isArray","document","image","i","_getSubmitData","CONST","DEFAULT_TOKEN","closest","splice","attr","packs","pack","collection","yes","found","Set","duplicates","compendium","get","k","has","add","size","notifications","info","from","default","actor","typeOverride","diffImages","ignorePortrait","ignoreToken","imgName","applyDefaultConfig","_","prototypeToken","CompendiumMapConfig","_fixSearchPaths","supportedPacks","join","locked","includes","documentName","compendiums","category","_onCategoryOverride","trigger","_onAutoApply","_onDiffImages","_onSearchOptions","_onMissingImages","_onCompendiumSelect","prop","checked","css","searchPaths","searchFilters","searchAlgorithm","randomizer","features","popup","permissions","worldHud","misc","activeEffects","startMapping","originalSearchPaths","cache","console","log","endMapping","missingImageList","mi","overrideCategory","processItem","artSelectDisplayed","consoleProcessedTracking","hasPortrait","hasToken","texture","src","syncImages","includeThisActor","missingOnly","includeThisToken","showImages","autoApply","portraitFound","tokenFound","results","simpleResults","actorUpdate","autoDisplayArtSelect","defaultImg","schema","fields","initial","hasImage","imageFound","getDocuments","d","processing","stopProcessing","processed","counter","startProcessing","Promise","resolve","reject","cancel","append","spinner","removeClass","addClass","tasks","all","then","warn","isEmpty","diffObject","ConfigureSettings","dummySettings","enabledTabs","settings","insertKeys","tabs","navSelector","contentSelector","paths","r","text","_pathIcon","source","types","JSON","stringify","actorTypes","documentTypes","Actor","reduce","t","CONFIG","typeLabels","disable","tokenToPortraitDisabled","tokenCreate","tokenCopyPaste","allTypes","tempTypes","key","entries","tokenHUDWildcardActive","modules","active","internalEffects","keywordSearch","excludedKeywords","systemHpPath","imgurClientId","enableStatusConfig","disableNotifs","staticCache","staticCacheFile","stackStatusConfig","mergeGroup","disableEffectIcons","displayEffectIconsOnHover","filterEffectIcons","hideElevationTooltip","hideTokenBorder","filterCustomEffectIcons","filterIconList","updateTokenProto","imgNameContainsDimensions","imgNameContainsFADimensions","disableImageChangeOnPolymorphed","disableImageUpdateOnNonPrototype","disableTokenUpdateAnimation","evaluateOverlayOnHover","pathfinder","dnd5e","click","_onCreatePath","_onSearchSourceTextChange","_onDeletePath","_onConvertImgurPath","_onConvertJsonPath","_onBrowseFolder","_validateRegex","algorithmTab","tokenToPortrait","_toggle","is","tab","staticOn","staticFile","token","TokenDocument","globalMappings","_validRegex","style","backgroundColor","RegExp","pathInput","sourceInput","activeSource","current","startsWith","bucketName","replace","files","s3","endpoint","protocol","host","tables","rollTable","tableName","fp","result","bucket","preventDefault","albumHash","fetch","headers","Authorization","Accept","response","json","success","location","hostname","format","resultsArray","weight","range","drawn","link","RollTable","create","replacement","displayRoll","catch","error","jsonPath","table","currentTarget","row","_reIndexPaths","remove","imgur","imgurControl","jsonControl","expandObject","hasOwnProperty","split","parse","regex","fuzzyLimit","parseInt","isNaN","mergeObjectFix","original","other","insertValues","recursive","inplace","enforceTypes","_d","Error","keys","some","test","v","_mergeUpdate","_mergeInsertFix","x","tv","getType","tx","showOverlayJsonConfigDialog","overlayConfig","effect","showPathSelectCategoryDialog","typesInput","selectedTypes","splits","currSplit","showPathSelectConfigForm","configInput","conf","flags","cog","showTokenCaptureDialog","mesh","showMappingSelectDialog","mappings","title1","title2","buttonTitle","mappingGroups","group","list","mapping","Ok","selectedMappings","m","cMapping","targetActors","showUserTemplateCreateDialog","dialog","hint","templateMappings","randomID","toggleTemplateDialog","templateName","EditJsonConfig","_validateJSON","shiftKey","substring","_onRemove","_onFormat","controls","flag","submit","EditScriptConfig","script","hasScript","onApply","onRemove","macroOnApply","macroOnRemove","tmfxPreset","tmfxActive","tmfxPresets","TokenMagic","getPresets","p","ceActive","ceEffect","apply","ceEffects","dfreds","effectInterface","findEffects","ef","macros","TOGGLED_GROUPS","NO_IMAGE","EffectMappingForm","createMapping","objectToFlag","actors","actorId","Default","scrollY","scope","_processConfig","hasTokenConfig","tv_script","expression","codeExp","hasCodeExp","highlightedExpression","highlightOperators","isVideo","priority","overlay","alwaysOn","tokens","tokensString","tokenIDs","disabled","parentID","effectMappings","_getNewEffectConfig","sort","m1","m2","priorityDiff","localeCompare","sMappings","groupedMappings","sortMappingsToGroups","groups","global","_onClone","_onCreate","_onSaveMappings","_onSaveMappingsClose","image_path_button","user","role","_onImageClick","mousedown","_onImageMouseDown","_onConfigureApplicableActors","contextmenu","_onImageRightClick","_onConfigClick","_onConfigEditClick","_onConfigScriptClick","_onOverlayConfigClick","_onOverlayConfigRightClick","_onOverlayChange","_onExpressionChange","_onGroupToggle","groupName","_onDisable","_onGroupDisable","_onGroupDelete","_onGroupChange","_onExpressionSwitch","animate","focusout","_state","Application","RENDER_STATES","RENDERED","_onTokensRemove","_onSubmit","li","undefined","container","divInput","hasClass","disableGroupToggle","checkboxes","numChecked","chks","toggle","el","innerText","childNodes","sel","window","getSelection","focusNode","offset","focusOffset","ch","nodeName","setCaretPosition","gear","_toggleActiveControls","tokenConfig","configEdit","scriptEdit","_removeImage","which","clone","ev","_exportConfigs","_importConfigs","_insertMappings","_copyGlobalConfig","canvas","_id","actorName","saveDataToFile","handlebars","renderTemplate","entity","import","form","readTextFromFile","no","cMappings","enabled","act","setFlag","unsetFlag","placeables","getActiveTokens","tkn","drawEffects","message","handlerName","sceneId","scene","socket","emit","replaceAll","String","fromCharCode","re","match","op","pos","node","nodeType","createRange","setStart","collapse","removeAllRanges","addRange","OverlayConfig","imgLinked","linked","previewConfig","icons","getPreviewIcons","activate","tvaOverlay","fieldset","shapeLegends","legend","shapes","_onAddShape","_onAddImage","_onAddEvent","_onDeleteShape","_onDeleteImage","_onDeleteEvent","_onMoveShapeUp","_onMoveShapeDown","_onCloneShape","_onInputChange","parentId","empty","filterOptions","genFilterOptionControls","presetName","preset","getPreset","scaleState","lockButtons","sliderScaleWidth","sliderScaleHeight","sliderWidth","sliderHeight","textarea","params","eval","param","promptParamChoice","api","showGenericForm","filterType","inputChangeCallback","selected","underlay","bottom","linkScale","linkDimensions","linkStageScale","limitOnProperty","_onCreateVariable","_onDeleteVariable","variables","shape","listener","interactivity","macro","nShape","_swapShapes","i1","i2","temp","_convertColor","colString","Color","fromString","rgb","_applyPreviews","previewIcons","tvaOverlays","targets","preview","refresh","previewTexture","refreshFilters","_removePreviews","filters","PIXI","users","u","limitedUsers","fonts","fontDefinitions","menus","FontConfig","SETTING","fontWeights","allMappings","parents","anchor","y","shapeName","getTemplate","allShapes","textAlignmentOptions","vision5e","linkDimensionsX","linkDimensionsY","repeating","uid","limitOnEffect","outlineColor","lightColor","Number","shadowColor","color","FILTERS","OutlineOverlayFilter","defaultValues","trueThickness","min","max","step","argType","AlphaFilter","alpha","BlurFilter","strength","quality","BlurFilterPass","horizontal","NoiseFilter","noise","seed","AdjustmentFilter","gamma","saturation","contrast","brightness","red","green","blue","AdvancedBloomFilter","threshold","bloomScale","blur","AsciiFilter","BevelFilter","rotation","thickness","lightAlpha","shadowAlpha","BloomFilter","BulgePinchFilter","radius","CRTFilter","curvature","lineWidth","lineContrast","verticalLine","noiseSize","vignetting","vignettingAlpha","vignettingBlur","time","DotFilter","scale","angle","DropShadowFilter","distance","shadowOnly","EmbossFilter","GlitchFilter","slices","direction","fillMode","average","minSize","sampleSize","GlowFilter","outerStrength","innerStrength","knockout","GodrayFilter","gain","lacunarity","parallel","KawaseBlurFilter","clamp","OldFilmFilter","sepia","scratch","scratchDensity","scratchWidth","OutlineFilter","PixelateFilter","RGBSplitFilter","RadialBlurFilter","center","ReflectionFilter","mirror","boundary","amplitude","waveLength","DisplacementFilter","sprite","textureScale","displacementScale","filterName","getControlValues","controlsHTML","control","genControl","fromRGB","toString","charAt","toUpperCase","select","opt","massEdit","filterId","Templates","templates","TemplateSubmissionForm","pk","method","body","SEARCH_QUERY","ok","status","_docToTemplate","communityTemplates","allowDelete","allowCreate","allowCopy","appWindow","position","tooltip","windowPos","url","getTemplateFromFileURL","toLowerCase","createdBy","stopPropagation","fileURL","k2","systemID","systemTitle","field","stringValue","_setStringField","createTime","integerValue","Date","getTime","approved","booleanValue","submitTemplate","structuredQuery","fieldPath","where","fieldFilter","collectionId","orderBy","limit","f","TokenCustomConfig","sheets","TokenConfig","updateData","FormDataExtended","editors","flattenObject","detectionModes","filtered","tva_checkbox","saved","applyCustomConfig","_onCheckboxChange","processFormGroup","formGroup","savedField","flatConfig","checkbox","before","_onRemoveConfig","activeElement","MutationObserver","mutations","mutation","addedNodes","className","observe","characterData","attributes","childList","subtree","onInputChange","parentNode","UserList","regenStyle","getFlag","avatar","userId","invisibleImage","affectedImages","FlagsConfig","Tile","isTile","popups","disableNameSearch","directory","popupsSetFlag","disableNameSearchSetFlag","directorySource","directorySetFlag","tile","sourceEl","RandomizerConfig","hasSettings","nameForgeActive","nameForge","models","_selectNameForgeModels","tokenName","inputSelected","genCheckbox","defaultModels","userModels","selectedModels","submitter","expanded","TOKEN_HUD_VARIANTS","variants","renderTokenHUD","hud","searchText","fp_files","hudSettings","FULL_ACCESS","hudFullAccess","PARTIAL_ACCESS","enableSideMenu","disableHUDButton","tokenActor","disableIfTHWEnabled","randomImg","querySelector","appendChild","renderContextMenuPalette","contextMenu","keyCode","palette","sideSelect","renderPalette","replaceWith","_onImageSearchKeyUp","browse","worldHudSettings","actorVariants","imageDuplicates","pushImage","getVariants","variant","names","directoryFlag","dirFlagImages","err","includeWildcard","displayOnlySharedImages","protoImg","getTokenImages","_tokenImages","pattern","browseOptions","wildcard","keyPrefix","parseS3URL","artSearch","includeKeywords","tokenImageName","imagesParsed","userMappings","shared","genTitleAndStyle","route","used","unknownType","isGM","imageOpacity","tokenHud","tokenId","controlled","imgButton","toggleCog","updateActorImage","useNameSimilarity","updateActorWithSimilarName","del","updated","fNames","setVariants","showFullPath","EXPRESSION_MATCH_RE","PF2E_ITEM_TYPES","ITEM_TYPES","feature_id","registerEffectMappingHooks","_refreshTokenMappings","activeEffect","_updateImageOnEffectChange","_preUpdateActiveEffect","_updateActiveEffect","_preUpdateToken","_preUpdateActor","_updateActor","_updateToken","_createToken","_createCombatant","combatant","_deleteCombatant","_preUpdateCombat","_updateCombat","combat","combatants","applicable_item_types","_preUpdateAssign","getActorParent","_updateItem","updateWithEffectMapping","_token","added","removed","_updateImageOnMultiEffectChange","preUpdateEffects","getTokenEffects","setProperty","isPolymorphed","ov","htmlOverlay","addedEffects","removedEffects","getProperty","postUpdateEffects","hidden","tokenVariantFlags","_preUpdateCheck","hpChange","applyHpChangeEffect","pAdded","pRemoved","round","combatantId","nextCombatantId","nextCombatant","previousCombatantId","previousNextCombatantId","currentCombatantId","currentNextCombatantId","updateCombatant","EFFECT_M_QUEUES","EFFECT_M_TIMER","opts","a","_updateWithEffectMapping","placeable","_object","tokenImgName","tokenDefaultImg","tokenUpdateObj","hadActiveHUD","hasActiveHUD","toggleStatus","_statusEffects","effects","findIndex","s","getAllEffectMappings","evaluateMappingExpression","executeOnCallback","deferredUpdateScripts","action","ef1","ef2","updateCall","disableImageUpdate","tknImg","newImg","iSrc","tokenUpdate","_postTokenUpdateProcessing","tvaUpdate","scripts","_toggleStatusEffects","scr","includeDisabled","unique","applicableGlobal","actorType","setOverlayVisibility","userName","visible","tokenMappings","updateToken","updateGlobal","updateMappings","_getTemplateMappings","applyTemplate","tm","actMappings","removeTemplate","toggleTemplate","toggleTemplateOnSelected","getHPChangeEffect","internals","delta","duration","newHpValue","getTokenHP","currentHpVal","update","includeExpressions","tokenDoc","combats","started","actorLink","getEffectsFromActor","items","_activePF2EItem","isSuppressed","evaluateComparatorEffects","evaluateStateEffects","temporaryEffects","technology","equipped","isEquipped","VALID_EXPRESSION","getPropertyValue","property","maxVal","endsWith","boolean","percentage","_source","evaluateComparator","property1","sign","property2","val1","val2","passed","matched","expressions","exp","statuses","_findReplaceBracketWildcard","nExp","lIndex","indexOf","_testRegExEffect","arrExpression","hasAdded","hasRemoved","rExp","evaluation","effectName","ent","parent","_modTokenConfig","_modTemplateConfig","TILE","_modDrawingConfig","_modNoteConfig","ITEM","_modSceneConfig","_modTileConfig","tileConfig","_modActiveEffectConfig","effectConfig","_modItemSheet","itemSheet","_modMacroConfig","macroConfig","MACRO","_modJournalSheet","journalSheet","journal","JOURNAL","_modRollTableSheet","sheet","_modActorSheet","actorSheet","editable","portrait_right_click","profile","profileQueries","pf2e","query","draw","visibility","restrictVisibility","_updateTile","tiles","_sightRefresh","_isInvisible","_renderTokenConfig","checkboxRandomize","tvaFieldset","rdmImgFormGroup","showHideGroup","_preCreateToken","tokenDocument","updateSource","actorRandSettings","randSettings","vDown","popupFlag","performRandomSearch","representedActorDisable","linkedActorDisable","_disableRandomSearchForType","randomName","randomizerOptions","imgPortrait","popupOnDisable","dirKeyDown","disableAutoPopupOnTokenCopyPaste","disableAutoPopupOnTokenCreate","_disablePopupForType","twoPopups","_twoPopupPrompt","twoPopupsNoDialog","_createActor","actorCreate","imgToken","disableAutoPopupOnActorCreate","actTokens","one","two","REGISTERED_HOOKS","registerHook","once","debug","num","Hooks","unregisterHook","off","registerAllHooks","hoverIn","meVisible","registerOverlayHooks","child","fullRefresh","removeChild","destroy","hudRendered","REFRESH_HOOKS","registerOverlayRefreshHook","hookName","unregisterOverlayRefreshHooks","unregister","hook","CORE_TEMPLATES","tint","inheritTint","linkRotation","animation","relative","rotate","clockwise","linkMirror","linkDimensionX","linkDimensionY","linkOpacity","loop","playOnce","offsetX","offsetY","scaleX","scaleY","alwaysVisible","limitOnHover","limitOnControl","fontFamily","fontSize","letterSpacing","fill","dropShadow","strokeThickness","stroke","curve","invert","line","limitOnHighlight","color2","prc","interpolateColor","pOffsetX","pOffsetY","limitedToOwner","limitOnHUD","align","wordWrap","wordWrapWidth","breakWords","maxHeight","innerRadius","outerRadius","startAngle","endAngle","increment","isPercentage","maxValue","perRow","maxRows","paddingX","paddingY","DEFAULT_ACTIVE_EFFECT_CONFIG","DEFAULT_OVERLAY_CONFIG","canvasTextStyle","OVERLAY_SHAPES","Rectangle","Ellipse","Polygon","points","Torus","CutCircle","cut","CORE_SHAPE","Reticle","_onReticleMove","reticleOverlay","isMouseDown","getLocalPosition","mode","tCoord","dx","dy","cx","cy","radians","PI","cos","sin","w","h","pWidth","pHeight","shapesWidth","shapesHeight","abs","minimizeApps","minimize","maximizeApps","maximize","deactivate","ready","interaction","renderer","events","cursorStyles","Container","hitArea","dimensions","rect","cursor","interactive","zIndex","Infinity","originalEvent","nativeEvent","stage","addChild","anchorX","anchorY","innerHeight","displayControlDialog","CLOSED","number","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","enumerable","_objectSpread2","arguments","_defineProperty","getOwnPropertyDescriptors","defineProperties","_typeof","Symbol","iterator","_classCallCheck","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","_inherits","subClass","superClass","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","_possibleConstructorReturn","self","call","ReferenceError","_assertThisInitialized","_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","valueOf","_isNativeReflectConstruct","Super","NewTarget","_toConsumableArray","arr","_arrayLikeToArray","_arrayWithoutHoles","iter","_iterableToArray","minLen","n","_unsupportedIterableToArray","_nonIterableSpread","len","arr2","getTag","INFINITY","baseToString","isString","isNumber","isBoolean","isObject","isObjectLike","isDefined","isBlank","MISSING_KEY_PROPERTY","INVALID_KEY_WEIGHT_VALUE","hasOwn","KeyStore","_this","_keys","_keyMap","totalWeight","createKey","keyId","createKeyPath","createKeyId","AdvancedOptions","useExtendedSearch","getFn","deepGet","ignoreLocation","ignoreFieldNorm","fieldNormWeight","Config","isCaseSensitive","includeScore","shouldSort","sortFn","b","idx","includeMatches","findAllMatches","minMatchCharLength","SPACE","FuseIndex","_ref","_ref$getFn","_ref$fieldNormWeight","norm","mantissa","pow","numTokens","clear","isCreated","setIndexRecords","docs","records","_keysMap","_this2","docIndex","_addString","_addObject","record","_this3","keyIndex","subRecords","stack","nestedArrIndex","_stack$pop","pop","_value","subRecord","createIndex","_ref2","_ref2$getFn","_ref2$fieldNormWeight","myIndex","setKeys","setSources","computeScore$1","_ref$errors","errors","_ref$currentLocation","currentLocation","_ref$expectedLocation","expectedLocation","_ref$distance","_ref$ignoreLocation","accuracy","proximity","MAX_BITS","patternAlphabet","_ref$location","_ref$threshold","_ref$findAllMatches","_ref$minMatchCharLeng","_ref$includeMatches","patternLen","textLen","currentThreshold","bestLocation","computeMatches","matchMask","lastBitArr","finalScore","binMax","mask","_i","binMin","binMid","floor","finish","bitArr","j","charMatch","isMatch","matchmask","convertMaskToIndices","createPatternAlphabet","_char","BitapSearch","_ref$isCaseSensitive","chunks","addChunk","startIndex","alphabet","remainder","substr","_this$options","_result","_this$options2","allIndices","totalScore","hasMatches","_search","BaseMatch","getMatch","multiRegex","singleRegex","matches","ExactMatch","_BaseMatch","_super","InverseExactMatch","PrefixExactMatch","InversePrefixExactMatch","SuffixExactMatch","InverseSuffixExactMatch","FuzzyMatch","_bitapSearch","searchIn","IncludeMatch","searchers","searchersLen","SPACE_RE","MultiMatchSet","ExtendedSearch","queryItem","searcher","isMultiMatch","_searcher","isSingleMatch","parseQuery","numMatches","qLen","pLen","_searcher$search","registeredSearchers","createSearcher","searcherClass","condition","LogicalOperator","KeyType","isExpression","convertToExplicit","_ref3$auto","auto","next","isQueryPath","isPath","isLeaf","LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY","children","operator","transformMatches","refIndex","transformScore","Fuse$1","Fuse","_keyStore","setCollection","_docs","_myIndex","predicate","removeAt","_ref$limit","_searchStringList","_searchObjectList","_searchLogical","_ref$ignoreFieldNorm","EPSILON","computeScore","_ref$includeScore","transformers","transformer","_searcher$searchIn","evaluate","_findMatches","getValueForItemAtKeyId","res","resultMap","_ref3","expResults","_ref4","_resultMap$idx$matche","_this$_myIndex","_ref5","_ref6","_ref7","_searcher$searchIn2","_searcher$searchIn3","version","parseIndex","_ref3$getFn","_ref3$fieldNormWeight","register","caching","isCaching","CACHED_IMAGES","doImageSearch","searches","keywords","word","reverse","usedImages","findImages","pathObj","doRandomSearch","delete","sharedVariants","sv","wildcardImages","_randSearchUtil","nonRepeat","placedImages","checkedImages","tmpResult","random","doSyncSearch","fResults","walkFindImages","apiKey","found_images","typeKey","rtName","_addToFound","contents","baseTableData","rtPath","rollTableName","tags","tokenSrc","f_dir","dirs","walkAllPaths","_filterPathsByType","ForgeAPI","getUserId","forgeSearchPaths","share","findImagesFuzzy","forceSearchName","fuse","imgObj","_imagePassesFilter","getIndex","sOptions","exact","simpleName","matchedImages","imgOBj","_exactSearchMatchesImage","findImagesExact","simplifiedSearch","imagePath","imageName","include","exclude","saveCache","cacheFile","caches","file","File","upload","cacheImages","fileName","jQuery","getJSON","count","_readCacheFromFile","imageCount","ForgeSearchPaths","dragDrop","dragSelector","dropSelector","_getPaths","forgePaths","TVA_CONFIG","_onReset","_onUpdate","_updatePaths","_cleanPaths","uniquePaths","updateSettings","TokenHUDClientSettings","ImportExport","_importFromJSONDialog","exportSettingsToJSON","importSettingsFromJSON","statusConfig","FEATURE_CONTROL","EffectMappings","EffectIcons","Overlays","UserMappings","Wildcards","PopUpAndRandomize","HUD","HideElement","registerSettings","onChange","registerMenu","restricted","lfg","worldbuilding","twodsix","diff","_arrayAwareDiffObject","requiresImageCache","_getTooltipText","border","cat","migrateMappings","nMappings","combMappings","getFlagMappings","portraitFilterInclude","Portrait","portraitFilterExclude","portraitFilterRegex","Token","tokenFilterInclude","tokenFilterExclude","tokenFilterRegex","PortraitAndToken","generalFilterInclude","generalFilterExclude","generalFilterRegex","_refreshFilters","customCategories","updateTVAConfig","newSettings","inner","isDifferent","difference","v0","v1","t0","_arrayEquality","_difference","a1","a2","every","getSearchOptions","HTMLOverlay","hudReady","renderQueue","element","toObject","origin","ratio","transform","listeners","_templateCache","_compile","Handlebars","compile","constructTemplate","ovConfig","compiled","registerPartial","allowProtoMethodsByDefault","allowProtoPropertiesByDefault","TVAOverlay","primary","PrimarySpriteMesh","pTexture","pseudoTexture","occludedAlpha","overlaySort","filtersApplied","addHTMLOverlay","_registerHooks","_tvaPlay","_customVisible","eventMode","enableInteractivity","mouseInteractionManager","removeAllListeners","runInteraction","callbacks","hoverOut","clickLeft","clickLeft2","clickRight","clickRight2","dragLeftStart","dragLeftMove","dragLeftDrop","dragLeftCancel","dragRightStart","dragRightMove","dragRightDrop","dragRightCancel","longPress","mgr","MouseInteractionManager","dragStart","_onAdded","isOwner","speaker","ChatMessage","getSpeaker","detectionLevel","impreciseVisible","limitOnTarget","limitOnAnyTarget","ruler","Ruler","STATES","INACTIVE","highlightObjects","_highlight","targeted","sortLayer","_lastSortedIndex","elevation","baseTexture","resource","tagName","cloneNode","onended","tvaVideoEnded","oncanplay","Texture","resourceOptions","autoPlay","volume","playing","video","addChildAuto","setTexture","configuration","_swapChildren","originalTexture","_destroyTexture","stop","xOff","yOff","pivot","stopAnimation","_applyFilters","_activateTicker","_deactivateTicker","ticker","updatePosition","UPDATE_PRIORITY","HIGH","coord","canvasCoordinatesFromClient","innerWidth","FilterClass","animated","applyTVAFilters","constructTMFXFilters","removeTVAFilters","tvaFilter","animationName","CanvasAnimation","terminateAnimation","sourceId","attribute","to","removeChildren","textLabel","destroyable","removeHTMLOverlay","tvaRemove","calculateTrimmedVertices","Sprite","paramsArray","filterTypes","rank","filterInternalId","gms","filterOwner","updateId","filterClass","ModTMFX","assignPlaceable","targetPlaceable","placeableImg","_TMFXsetAnimeFlag","rendering","createFragmentShader","CONSTANTS","WAVE","performance","CANVAS_PERFORMANCE_MODES","LOW","MED","FONT_LOADING","drawOverlays","tva_drawing_overlays","processedMappings","overlays","evaluateOverlayExpressions","_markAllOverlaysForRemoval","underlaySort","_findTVAOverlay","_evaluateLinkedImages","genTexture","sortableChildren","sortDirty","removeMarkedOverlays","_removeAllOverlays","tokenImage","generateImage","generateTextTexture","generateShapeTexture","loadTexture","fallback","numRepeats","rows","xOffset","yOffset","_renderContainer","resolution","bounds","getLocalBounds","matrix","Matrix","ty","renderTexture","RenderTexture","skipUpdateTransform","_drawShape","graphics","drawRoundedRect","drawEllipse","drawPolygon","drawTorus","toRadians","drawCutCircle","Graphics","beginFill","lineStyle","EMPTY","startArc","endArc","drawCircle","beginHole","endHole","finishPoly","arc","closePath","minColor","interpolate","rString","_interpolateV10","maxColor","minHsv","rgb2hsv","maxHsv","deltaHue","deltaAngle","targetHue","targetSaturation","targetValue","toHex","toNumber","hex2rgb","fromHSV","g","CORE_VARIABLES","grid","_evaluateString","re2","_executeString","evalString","_evaluateObjExpressions","loading","tmp","containers","PreciseText","getTextStyle","updateText","maxRopePoints","ropePoints","Point","rope","SimpleRope","sprites","broadcastDrawOverlays","simplifyRegex","EXPRESSION_OPERATORS","SEARCH_TYPE","BASE_IMAGE_CATEGORIES","PRESSED_KEYS","popupOverride","BATCH_UPDATES","TOKEN_CALLBACKS","TOKEN_CONTEXT","ACTOR","ACTOR_CONTEXT","startBatchUpdater","updateEmbeddedDocuments","cb","updateDocuments","queueActorUpdate","context","updateTokenImage","wildcardImageSearch","constructDefaultConfig","origData","customConfig","flatOrigData","TokenDataAdapter","dataToForm","flatCustomConfig","filterObject","splitK","getFileName","tokenCustomConfig","imgConfig","getTokenConfig","formToData","extractDimensionsFromImgName","getTokenConfigForUpdate","usingCustomConfig","defaultConfig","configEntries","tokenData","fromEntries","getDefaultConfig","modMergeObject","defConf","baseActor","queueTokenUpdate","directUpdate","keyPressed","keyboard","downKeys","registerKeybinds","keybindings","onDown","onUp","precedence","KEYBINDING_PRECEDENCE","NORMAL","modifiers","decodeURISafely","setTokenConfig","tcIndex","deleteConfig","getFileNameWithExt","getFilePath","simplifyName","simplifyPath","decodeURIComponentSafely","parseKeywords","isImage","extension","callForgeVTT","ForgeVTT","usingTheForge","FORGE_URL","xhr","XMLHttpRequest","withCredentials","open","setRequestHeader","getXSRFToken","responseType","onreadystatechange","readyState","onerror","code","send","getFilters","userRequiresImageCache","perm","waitForTokenTexture","checks","flattenSearchResults","flattened","_modMergeUpdate","_modMergeInsert","tv_executeScript","character","AsyncFunction","executeMacro","macroName","applyTMFXPreset","addUpdateFilters","deleteFilters","toggleTMFXPreset","hasFilterId","applyCEEffect","uuid","addEffect","removeEffect","toggleCEEffect","toggleEffect","uuids","mirrorX","mirrorY","determineAddedRemovedEffects","newEffects","oldEffects","nameForgeRandomize","randomizerSettings","nameForgeSettings","randomize","randomNames","modelKey","modelProp","model","createModel","generateName","uploadTokenImage","viewPosition","_viewPosition","resize","screen","screenDimensions","pan","cacheParent","enableTempParent","updateTransform","disableTempParent","spritesToRender","_onResize","captureToken","b64","extract","base64","blob","getAllActorTokens","isToken","scenes","string2Hex","hexString","string2hex","uri","decodeURI","decodeURIComponent","mergeMappings","changedIDs","pID","isResponsibleGM","isActive","registerUserMappingWrappers","_draw","wrapped","previous","tva_iconOverride","overrideVisibility","tva_customVisibility","originalIsVisible","_getIsVisibleDescriptor","isVisible","iObj","assignUserSpecificImage","unassignUserSpecificImage","assignUserSpecificImageToSelected","unassignUserSpecificImageFromSelected","_drawEffects_hoverOnly","_drawEffects_fullReplace","bg","_combatTrackerPrepareTurnContext","restrictedEffects","_getRestrictedEffects","_formatEffectsTooltip","_drawEffects","renderable","overlayEffect","findLast","promises","promise","_drawOverlay","_drawEffect","allSettled","sortChildren","renderFlags","refreshEffects","_refreshVisibility","_clear","_applyVariantFlags","_initializeApplicationOptions","actions","tva","tvaButtonClick","classList","contains","togglePalette","REGISTERED_WRAPPERS","registerWrapper","libWrapper","unregisterWrapper","registerAllWrappers","MODULE_INITIALIZED","isInitialized","onInit","showArtSelect","executing","loadFont","editor","urls","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","__webpack_exports__"],"sourceRoot":""}