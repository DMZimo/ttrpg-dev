---
import { getCollection } from "astro:content";
import SessionCard from "@/components/journal/SessionCard.astro";

// Get the latest 3 sessions
const allSessions = (await getCollection("journal")).sort((a, b) => {
  const dateA = a.data.session_date || a.data.pubDate;
  const dateB = b.data.session_date || b.data.pubDate;

  if (!dateA && !dateB) return 0;
  if (!dateA) return 1;
  if (!dateB) return -1;

  return dateB.valueOf() - dateA.valueOf();
});

const latestSessions = allSessions.slice(0, 3);
---

<section class="py-16 bg-surface-secondary w-full">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <div class="flex items-center justify-center gap-4 mb-6">
        <div class="w-12 h-12 bg-hero-red flex items-center justify-center">
          <span class="text-white text-2xl font-bold">âš”ï¸</span>
        </div>
        <h2 class="text-4xl font-bold text-primary">Recent Chronicles</h2>
      </div>
      <p class="text-xl text-secondary max-w-3xl mx-auto">
        Dive into our latest adventures and memorable moments from the campaign
      </p>
    </div>

    {
      latestSessions.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
          {latestSessions.map((session) => (
            <SessionCard entry={session} />
          ))}
        </div>
      ) : (
        <div class="hero-card p-12 text-center max-w-2xl mx-auto">
          <div class="w-20 h-20 bg-gold-600 mx-auto mb-6 flex items-center justify-center">
            <span class="text-white text-3xl">ğŸ²</span>
          </div>
          <h3 class="text-2xl font-bold text-primary mb-4">
            Adventure Awaits!
          </h3>
          <p class="text-secondary text-lg">
            Our first session will be chronicled here soon. Check back for
            updates!
          </p>
        </div>
      )
    }

    <div class="text-center">
      <a
        href="/journal"
        class="hero-button-primary px-8 py-4 inline-flex items-center gap-3 text-lg font-semibold"
      >
        <span>ğŸ“š</span>
        <span>View All Chronicles</span>
        <svg
          class="w-5 h-5 transition-transform group-hover:translate-x-1"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
        </svg>
      </a>
    </div>
  </div>
</section>
