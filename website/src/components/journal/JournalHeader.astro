---
// Quick stats and summary information about the journal
interface Props {
  totalSessions: number;
  totalTags: number;
  latestSessionDate?: Date;
  oldestSessionDate?: Date;
}

const { totalSessions, totalTags, latestSessionDate, oldestSessionDate } =
  Astro.props;

// Calculate campaign duration
let campaignDuration = "";
if (oldestSessionDate && latestSessionDate) {
  const diffTime = Math.abs(
    latestSessionDate.getTime() - oldestSessionDate.getTime()
  );
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays < 30) {
    campaignDuration = `${diffDays} days`;
  } else if (diffDays < 365) {
    const months = Math.floor(diffDays / 30);
    campaignDuration = `${months} month${months > 1 ? "s" : ""}`;
  } else {
    const years = Math.floor(diffDays / 365);
    const remainingMonths = Math.floor((diffDays % 365) / 30);
    campaignDuration = `${years} year${years > 1 ? "s" : ""}${remainingMonths > 0 ? `, ${remainingMonths} month${remainingMonths > 1 ? "s" : ""}` : ""}`;
  }
}
---

<div
  class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 mb-8 shadow-lg"
>
  <div class="max-w-4xl mx-auto">
    <div class="text-center mb-6">
      <h1 class="text-4xl font-bold mb-3">Game Sessions Journal</h1>
      <p class="text-blue-100 text-lg">
        Chronicle your tabletop RPG adventures and memorable moments
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      <!-- Total Sessions -->
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
        <div class="text-3xl font-bold mb-1">{totalSessions}</div>
        <div class="text-blue-100 text-sm font-medium">
          {totalSessions === 1 ? "Session" : "Sessions"} Recorded
        </div>
      </div>

      <!-- Total Tags -->
      <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
        <div class="text-3xl font-bold mb-1">{totalTags}</div>
        <div class="text-blue-100 text-sm font-medium">
          Unique {totalTags === 1 ? "Tag" : "Tags"}
        </div>
      </div>

      <!-- Campaign Duration -->
      {
        campaignDuration && (
          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
            <div class="text-2xl font-bold mb-1">{campaignDuration}</div>
            <div class="text-blue-100 text-sm font-medium">
              Campaign Duration
            </div>
          </div>
        )
      }

      <!-- Latest Session -->
      {
        latestSessionDate && (
          <div class="bg-white/10 backdrop-blur-sm rounded-lg p-4 text-center">
            <div class="text-lg font-bold mb-1">
              {latestSessionDate.toLocaleDateString("en-US", {
                month: "short",
                day: "numeric",
                year: "numeric",
              })}
            </div>
            <div class="text-blue-100 text-sm font-medium">Latest Session</div>
          </div>
        )
      }
    </div>

    <!-- Quick Actions -->
    <div class="flex flex-wrap justify-center gap-4 mt-6">
      <a
        href="/sessions/new"
        class="bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center gap-2"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 4v16m8-8H4"></path>
        </svg>
        New Session
      </a>

      <a
        href="/campaigns"
        class="bg-white/20 backdrop-blur-sm text-white px-6 py-2 rounded-lg font-semibold hover:bg-white/30 transition-colors flex items-center gap-2"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
          ></path>
        </svg>
        Browse Campaigns
      </a>

      <button
        id="random-session"
        class="bg-white/20 backdrop-blur-sm text-white px-6 py-2 rounded-lg font-semibold hover:bg-white/30 transition-colors flex items-center gap-2"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          ></path>
        </svg>
        Random Session
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const randomButton = document.getElementById(
      "random-session"
    ) as HTMLButtonElement;

    randomButton?.addEventListener("click", function () {
      const sessionCards = document.querySelectorAll(
        'article a[href^="/sessions/"]'
      );
      if (sessionCards.length > 0) {
        const randomIndex = Math.floor(Math.random() * sessionCards.length);
        const randomSession = sessionCards[randomIndex] as HTMLAnchorElement;
        window.location.href = randomSession.href;
      }
    });
  });
</script>
