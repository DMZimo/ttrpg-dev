---
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE, DISCORD_INVITE, FOUNDRY_VTT_URL } from "@/consts";
---

<header>
  <nav>
    <h2><a href="/">{SITE_TITLE}</a></h2>
    <div class="internal-links">
      <HeaderLink href="/">Home</HeaderLink>
      <HeaderLink href="/journal">Journal</HeaderLink>
    </div>
    <div class="actions">
      <button id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
        <span class="sr-only">Toggle theme</span>
        <svg
          class="sun-icon"
          viewBox="0 0 24 24"
          width="20"
          height="20"
          aria-hidden="true"
        >
          <path
            fill="currentColor"
            d="M12 17.5c-3.04 0-5.5-2.46-5.5-5.5s2.46-5.5 5.5-5.5 5.5 2.46 5.5 5.5-2.46 5.5-5.5 5.5zm0-9c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5zm0-4c.28 0 .5-.22.5-.5V2c0-.28-.22-.5-.5-.5s-.5.22-.5.5v2c0 .28.22.5.5.5zm0 18c-.28 0-.5.22-.5.5v2c0 .28.22.5.5.5s.5-.22.5-.5v-2c0-.28-.22-.5-.5-.5zM5.99 4.58c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.06 1.06c.39.39 1.03.39 1.42 0s.39-1.03 0-1.42L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.42 0-.39.39-.39 1.03 0 1.42l1.06 1.06c.39.39 1.03.39 1.42 0 .39-.39.39-1.03 0-1.42l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0l-1.06 1.06c-.39.39-.39 1.03 0 1.42s1.03.39 1.42 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.42-.39-.39-1.03-.39-1.42 0l-1.06 1.06c-.39.39-.39 1.03 0 1.42.39.39 1.03.39 1.42 0l1.06-1.06z"
          ></path>
        </svg>
        <svg
          class="moon-icon"
          viewBox="0 0 24 24"
          width="20"
          height="20"
          aria-hidden="true"
        >
          <path
            fill="currentColor"
            d="M12.3 22.81c-1.07 0-2.14-.19-3.18-.57-3.96-1.44-6.78-5.28-6.78-9.77 0-5.61 4.67-10.28 10.28-10.28 1.28 0 2.53.24 3.72.71.35.14.58.48.58.85 0 .38-.23.72-.58.86-.23.09-.47.17-.72.23-2.15.53-3.84 2.22-4.37 4.37-.06.25-.14.49-.23.72-.14.35-.48.58-.85.58-.38 0-.72-.23-.86-.58-.09-.23-.17-.47-.23-.72.53-2.15 2.22-3.84 4.37-4.37.25-.06.49-.14.72-.23.35-.14.58-.48.58-.85 0-.38-.23-.72-.58-.86-1.19-.47-2.44-.71-3.72-.71C6.67 2.19 2 6.86 2 12.47c0 4.49 2.82 8.33 6.78 9.77 1.04.38 2.11.57 3.18.57 5.61 0 10.28-4.67 10.28-10.28 0-1.07-.19-2.14-.57-3.18-.14-.35-.48-.58-.85-.58-.38 0-.72.23-.86.58-.09.23-.17.47-.23.72-.53 2.15-2.22 3.84-4.37 4.37-.25.06-.49.14-.72.23-.35.14-.58.48-.58.85 0 .38.23.72.58.86.23.09.47.17.72.23 2.15.53 3.84 2.22 4.37 4.37.06.25.14.49.23.72.14.35.48.58.85.58.38 0 .72-.23.86-.58.38-1.04.57-2.11.57-3.18 0-5.61-4.67-10.28-10.28-10.28z"
          ></path>
        </svg>
      </button>
      <div class="social-links">
        <a href={DISCORD_INVITE} target="_blank" title="Discord">
          <span class="sr-only">Join our Discord</span>
          <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24">
            <path
              fill="currentColor"
              d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418Z"
            ></path>
          </svg>
        </a>
        <a href={FOUNDRY_VTT_URL} target="_blank" title="Foundry VTT">
          <span class="sr-only">Login to MythOS</span>
          <svg viewBox="0 0 24 24" aria-hidden="true" width="24" height="24">
            <path
              fill="currentColor"
              d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"
            ></path>
          </svg>
        </a>
      </div>
    </div>
  </nav>
</header>

<script>
  // Theme toggle functionality
  function initThemeToggle() {
    const themeToggle = document.getElementById("theme-toggle");
    const htmlElement = document.documentElement;

    // Get initial theme from localStorage or system preference
    function getInitialTheme() {
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        return savedTheme;
      }

      // Check system preference
      if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        return "dark";
      }

      return "light";
    }

    // Apply theme to the document
    function applyTheme(theme: string) {
      htmlElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
      updateToggleIcon(theme);
    }

    // Update the toggle button icon based on current theme
    function updateToggleIcon(theme: string) {
      if (!themeToggle) return;

      const sunIcon = themeToggle.querySelector(".sun-icon") as HTMLElement;
      const moonIcon = themeToggle.querySelector(".moon-icon") as HTMLElement;

      if (!sunIcon || !moonIcon) return;

      if (theme === "dark") {
        sunIcon.style.display = "block";
        moonIcon.style.display = "none";
        themeToggle.setAttribute("aria-label", "Switch to light theme");
        themeToggle.setAttribute("title", "Switch to light theme");
      } else {
        sunIcon.style.display = "none";
        moonIcon.style.display = "block";
        themeToggle.setAttribute("aria-label", "Switch to dark theme");
        themeToggle.setAttribute("title", "Switch to dark theme");
      }
    }

    // Toggle theme function
    function toggleTheme() {
      const currentTheme = htmlElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      applyTheme(newTheme);
    }

    // Initialize theme on page load
    const initialTheme = getInitialTheme();
    applyTheme(initialTheme);

    // Add click event listener to toggle button
    if (themeToggle) {
      themeToggle.addEventListener("click", toggleTheme);
    }

    // Listen for system theme changes
    if (window.matchMedia) {
      const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
      mediaQuery.addEventListener("change", (e) => {
        // Only update if user hasn't manually set a theme
        if (!localStorage.getItem("theme")) {
          applyTheme(e.matches ? "dark" : "light");
        }
      });
    }
  }

  // Initialize when DOM is loaded
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initThemeToggle);
  } else {
    initThemeToggle();
  }

  // Also run on navigation (for SPA-like behavior)
  document.addEventListener("astro:page-load", initThemeToggle);
</script>

<style>
  header {
    margin: 0;
    padding: 0 1em;
    background: rgb(var(--surface));
    border-bottom: 1px solid rgb(var(--border));
    box-shadow: var(--shadow-sm);
    transition: var(--transition);
  }

  h2 {
    margin: 0;
    font-size: 1em;
  }

  h2 a,
  h2 a.active {
    text-decoration: none;
    color: rgb(var(--text));
  }

  nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: var(--header-height);
  }

  nav a {
    padding: 1em 0.5em;
    color: rgb(var(--text-secondary));
    border-bottom: 4px solid transparent;
    text-decoration: none;
    transition: var(--transition);
  }

  nav a:hover {
    color: rgb(var(--text));
  }

  nav a.active {
    text-decoration: none;
    border-bottom-color: rgb(var(--primary));
    color: rgb(var(--text));
  }

  .actions {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #theme-toggle {
    background: none;
    border: 1px solid rgb(var(--border));
    border-radius: 0.5rem;
    padding: 0.5rem;
    cursor: pointer;
    color: rgb(var(--text));
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
  }

  #theme-toggle:hover {
    background: rgb(var(--surface-secondary));
    border-color: rgb(var(--primary));
  }

  #theme-toggle:focus {
    outline: none;
    border-color: rgb(var(--primary));
    box-shadow: 0 0 0 3px rgba(var(--primary), 0.1);
  }

  .sun-icon,
  .moon-icon {
    transition: var(--transition);
  }

  /* Show moon icon by default (light theme) */
  .sun-icon {
    display: none;
  }

  .moon-icon {
    display: block;
  }

  .social-links,
  .social-links a {
    display: flex;
    gap: 0.5rem;
  }

  .social-links a {
    color: rgb(var(--text-secondary));
    transition: var(--transition);
    padding: 0.5rem;
    border-radius: 0.375rem;
  }

  .social-links a:hover {
    color: rgb(var(--primary));
    background: rgb(var(--surface-secondary));
  }

  @media (max-width: 720px) {
    .social-links {
      display: none;
    }

    nav {
      gap: 1rem;
    }

    .internal-links {
      display: none;
    }
  }

  @media (max-width: 480px) {
    header {
      padding: 0 0.5rem;
    }

    .actions {
      gap: 0.5rem;
    }
  }
</style>
